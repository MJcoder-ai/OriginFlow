# Datasheet Ingestion

When a PDF datasheet is parsed successfully, OriginFlow now performs two actions:

1. **Update ComponentMaster** – The parsed metadata (part number, manufacturer, 
   category, ratings, etc.) is inserted or updated in the `component_master` 
   table.
2. **Populate AI Component Library** – The same component is ingested through
   `ComponentDBService`, making it immediately available to AI agents. This
   allows gather steps to detect newly uploaded components and continue without
   manual refresh.

Errors during ingestion are logged but do not interrupt the parsing workflow.

## Naming policy for new components

To make parsed components easy to search and filter, OriginFlow automatically
generates a human-friendly name for each component using a configurable naming
policy. The naming policy is defined in `backend/config.py` via the
`component_name_template` and `component_naming_version` settings. The template
is a Python format string containing placeholders (e.g. `{manufacturer}`,
`{part_number}`, `{rating}`, `{category}`, `{series_name}`) that are filled with
metadata extracted from the datasheet. You can change this template through
environment variables or a future API without modifying code, allowing the
naming convention to evolve over time. See
`backend/services/component_naming_policy.py` for a helper that returns the
current naming policy.

During parsing, the actual name is generated by the `ComponentNamingService`
(`backend/services/component_naming_service.py`). This service reads the
current naming template and applies it to the extracted metadata. It also
derives a `rating` field by inspecting common power, capacity and voltage
keys in the parsed payload. If key fields are missing, the service falls
back to sensible defaults or omits them, ensuring that the resulting name
remains usable. See the service implementation for details on how fields
are extracted and substituted.

### Manual review when critical data is missing

If the naming service cannot find essential fields—such as a manufacturer or
part number—the generated name may be incomplete. In these cases, the parser
sets `needs_manual_name_review` to `true` on the associated `FileAsset`. This
flag signals the UI to highlight the datasheet in the review panel and prompt
the user to provide or correct the component’s name. Once a user edits the
name and confirms it, the `needs_manual_name_review` flag should be cleared and
`is_human_verified` set to `true` to avoid triggering another automatic parse.

### Multi-variant datasheets

Some datasheets describe multiple product variants (e.g., a solar panel family
offered in 400 W, 425 W and 450 W options). When the parser detects a
`variants` list in the extracted payload, it creates a separate
`ComponentMaster` record for each variant. The `ComponentNamingService` is
invoked for every variant with the variant’s own part number and rating,
ensuring that each option has a distinct, descriptive name such as
“BrandX ABC-425 – 425 W Panel” or “BrandX ABC-450 – 450 W Panel”. The shared
`series_name` is retained to group the variants logically, and all variants
inherit common metadata (e.g., manufacturer, category, ports, dependencies)
from the base component.

