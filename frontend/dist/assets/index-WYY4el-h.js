const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-CBy8804z.js","assets/_commonjs-dynamic-modules-TDtrdbi3.js","assets/index-_6hN_l6d.js"])))=>i.map(i=>d[i]);
var XC=Object.defineProperty;var bx=n=>{throw TypeError(n)};var YC=(n,e,t)=>e in n?XC(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var $=(n,e,t)=>YC(n,typeof e!="symbol"?e+"":e,t),Hm=(n,e,t)=>e.has(n)||bx("Cannot "+t);var l=(n,e,t)=>(Hm(n,e,"read from private field"),t?t.call(n):e.get(n)),A=(n,e,t)=>e.has(n)?bx("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),v=(n,e,t,s)=>(Hm(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),_=(n,e,t)=>(Hm(n,e,"access private method"),t);var tn=(n,e,t,s)=>({set _(r){v(n,e,r,t)},get _(){return l(n,e,s)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function q0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function CD(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var N1={exports:{}},om={},T1={exports:{}},ge={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kf=Symbol.for("react.element"),KC=Symbol.for("react.portal"),QC=Symbol.for("react.fragment"),JC=Symbol.for("react.strict_mode"),ZC=Symbol.for("react.profiler"),ek=Symbol.for("react.provider"),tk=Symbol.for("react.context"),nk=Symbol.for("react.forward_ref"),sk=Symbol.for("react.suspense"),rk=Symbol.for("react.memo"),ik=Symbol.for("react.lazy"),Sx=Symbol.iterator;function ak(n){return n===null||typeof n!="object"?null:(n=Sx&&n[Sx]||n["@@iterator"],typeof n=="function"?n:null)}var P1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},R1=Object.assign,L1={};function Su(n,e,t){this.props=n,this.context=e,this.refs=L1,this.updater=t||P1}Su.prototype.isReactComponent={};Su.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Su.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function M1(){}M1.prototype=Su.prototype;function X0(n,e,t){this.props=n,this.context=e,this.refs=L1,this.updater=t||P1}var Y0=X0.prototype=new M1;Y0.constructor=X0;R1(Y0,Su.prototype);Y0.isPureReactComponent=!0;var Ax=Array.isArray,j1=Object.prototype.hasOwnProperty,K0={current:null},D1={key:!0,ref:!0,__self:!0,__source:!0};function I1(n,e,t){var s,r={},i=null,a=null;if(e!=null)for(s in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)j1.call(e,s)&&!D1.hasOwnProperty(s)&&(r[s]=e[s]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var c=Array(o),u=0;u<o;u++)c[u]=arguments[u+2];r.children=c}if(n&&n.defaultProps)for(s in o=n.defaultProps,o)r[s]===void 0&&(r[s]=o[s]);return{$$typeof:kf,type:n,key:i,ref:a,props:r,_owner:K0.current}}function ok(n,e){return{$$typeof:kf,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Q0(n){return typeof n=="object"&&n!==null&&n.$$typeof===kf}function lk(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var _x=/\/+/g;function Vm(n,e){return typeof n=="object"&&n!==null&&n.key!=null?lk(""+n.key):e.toString(36)}function mp(n,e,t,s,r){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case kf:case KC:a=!0}}if(a)return a=n,r=r(a),n=s===""?"."+Vm(a,0):s,Ax(r)?(t="",n!=null&&(t=n.replace(_x,"$&/")+"/"),mp(r,e,t,"",function(u){return u})):r!=null&&(Q0(r)&&(r=ok(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(_x,"$&/")+"/")+n)),e.push(r)),1;if(a=0,s=s===""?".":s+":",Ax(n))for(var o=0;o<n.length;o++){i=n[o];var c=s+Vm(i,o);a+=mp(i,e,t,c,r)}else if(c=ak(n),typeof c=="function")for(n=c.call(n),o=0;!(i=n.next()).done;)i=i.value,c=s+Vm(i,o++),a+=mp(i,e,t,c,r);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Wf(n,e,t){if(n==null)return n;var s=[],r=0;return mp(n,s,"","",function(i){return e.call(t,i,r++)}),s}function ck(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var fn={current:null},yp={transition:null},uk={ReactCurrentDispatcher:fn,ReactCurrentBatchConfig:yp,ReactCurrentOwner:K0};function O1(){throw Error("act(...) is not supported in production builds of React.")}ge.Children={map:Wf,forEach:function(n,e,t){Wf(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Wf(n,function(){e++}),e},toArray:function(n){return Wf(n,function(e){return e})||[]},only:function(n){if(!Q0(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ge.Component=Su;ge.Fragment=QC;ge.Profiler=ZC;ge.PureComponent=X0;ge.StrictMode=JC;ge.Suspense=sk;ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uk;ge.act=O1;ge.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var s=R1({},n.props),r=n.key,i=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=K0.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(c in e)j1.call(e,c)&&!D1.hasOwnProperty(c)&&(s[c]=e[c]===void 0&&o!==void 0?o[c]:e[c])}var c=arguments.length-2;if(c===1)s.children=t;else if(1<c){o=Array(c);for(var u=0;u<c;u++)o[u]=arguments[u+2];s.children=o}return{$$typeof:kf,type:n.type,key:r,ref:i,props:s,_owner:a}};ge.createContext=function(n){return n={$$typeof:tk,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:ek,_context:n},n.Consumer=n};ge.createElement=I1;ge.createFactory=function(n){var e=I1.bind(null,n);return e.type=n,e};ge.createRef=function(){return{current:null}};ge.forwardRef=function(n){return{$$typeof:nk,render:n}};ge.isValidElement=Q0;ge.lazy=function(n){return{$$typeof:ik,_payload:{_status:-1,_result:n},_init:ck}};ge.memo=function(n,e){return{$$typeof:rk,type:n,compare:e===void 0?null:e}};ge.startTransition=function(n){var e=yp.transition;yp.transition={};try{n()}finally{yp.transition=e}};ge.unstable_act=O1;ge.useCallback=function(n,e){return fn.current.useCallback(n,e)};ge.useContext=function(n){return fn.current.useContext(n)};ge.useDebugValue=function(){};ge.useDeferredValue=function(n){return fn.current.useDeferredValue(n)};ge.useEffect=function(n,e){return fn.current.useEffect(n,e)};ge.useId=function(){return fn.current.useId()};ge.useImperativeHandle=function(n,e,t){return fn.current.useImperativeHandle(n,e,t)};ge.useInsertionEffect=function(n,e){return fn.current.useInsertionEffect(n,e)};ge.useLayoutEffect=function(n,e){return fn.current.useLayoutEffect(n,e)};ge.useMemo=function(n,e){return fn.current.useMemo(n,e)};ge.useReducer=function(n,e,t){return fn.current.useReducer(n,e,t)};ge.useRef=function(n){return fn.current.useRef(n)};ge.useState=function(n){return fn.current.useState(n)};ge.useSyncExternalStore=function(n,e,t){return fn.current.useSyncExternalStore(n,e,t)};ge.useTransition=function(){return fn.current.useTransition()};ge.version="18.3.1";T1.exports=ge;var T=T1.exports;const gt=q0(T);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dk=T,hk=Symbol.for("react.element"),fk=Symbol.for("react.fragment"),pk=Object.prototype.hasOwnProperty,gk=dk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,mk={key:!0,ref:!0,__self:!0,__source:!0};function F1(n,e,t){var s,r={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(s in e)pk.call(e,s)&&!mk.hasOwnProperty(s)&&(r[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:hk,type:n,key:i,ref:a,props:r,_owner:gk.current}}om.Fragment=fk;om.jsx=F1;om.jsxs=F1;N1.exports=om;var p=N1.exports,My={},$1={exports:{}},ts={},z1={exports:{}},B1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(O,G){var Q=O.length;O.push(G);e:for(;0<Q;){var H=Q-1>>>1,J=O[H];if(0<r(J,G))O[H]=G,O[Q]=J,Q=H;else break e}}function t(O){return O.length===0?null:O[0]}function s(O){if(O.length===0)return null;var G=O[0],Q=O.pop();if(Q!==G){O[0]=Q;e:for(var H=0,J=O.length,ne=J>>>1;H<ne;){var he=2*(H+1)-1,re=O[he],oe=he+1,fe=O[oe];if(0>r(re,Q))oe<J&&0>r(fe,re)?(O[H]=fe,O[oe]=Q,H=oe):(O[H]=re,O[he]=Q,H=he);else if(oe<J&&0>r(fe,Q))O[H]=fe,O[oe]=Q,H=oe;else break e}}return G}function r(O,G){var Q=O.sortIndex-G.sortIndex;return Q!==0?Q:O.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var c=[],u=[],d=1,h=null,f=3,g=!1,y=!1,m=!1,b=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(O){for(var G=t(u);G!==null;){if(G.callback===null)s(u);else if(G.startTime<=O)s(u),G.sortIndex=G.expirationTime,e(c,G);else break;G=t(u)}}function E(O){if(m=!1,S(O),!y)if(t(c)!==null)y=!0,j(C);else{var G=t(u);G!==null&&D(E,G.startTime-O)}}function C(O,G){y=!1,m&&(m=!1,w(R),R=-1),g=!0;var Q=f;try{for(S(G),h=t(c);h!==null&&(!(h.expirationTime>G)||O&&!M());){var H=h.callback;if(typeof H=="function"){h.callback=null,f=h.priorityLevel;var J=H(h.expirationTime<=G);G=n.unstable_now(),typeof J=="function"?h.callback=J:h===t(c)&&s(c),S(G)}else s(c);h=t(c)}if(h!==null)var ne=!0;else{var he=t(u);he!==null&&D(E,he.startTime-G),ne=!1}return ne}finally{h=null,f=Q,g=!1}}var N=!1,k=null,R=-1,P=5,L=-1;function M(){return!(n.unstable_now()-L<P)}function I(){if(k!==null){var O=n.unstable_now();L=O;var G=!0;try{G=k(!0,O)}finally{G?U():(N=!1,k=null)}}else N=!1}var U;if(typeof x=="function")U=function(){x(I)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,K=B.port2;B.port1.onmessage=I,U=function(){K.postMessage(null)}}else U=function(){b(I,0)};function j(O){k=O,N||(N=!0,U())}function D(O,G){R=b(function(){O(n.unstable_now())},G)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(O){O.callback=null},n.unstable_continueExecution=function(){y||g||(y=!0,j(C))},n.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<O?Math.floor(1e3/O):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(O){switch(f){case 1:case 2:case 3:var G=3;break;default:G=f}var Q=f;f=G;try{return O()}finally{f=Q}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(O,G){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var Q=f;f=O;try{return G()}finally{f=Q}},n.unstable_scheduleCallback=function(O,G,Q){var H=n.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?H+Q:H):Q=H,O){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=Q+J,O={id:d++,callback:G,priorityLevel:O,startTime:Q,expirationTime:J,sortIndex:-1},Q>H?(O.sortIndex=Q,e(u,O),t(c)===null&&O===t(u)&&(m?(w(R),R=-1):m=!0,D(E,Q-H))):(O.sortIndex=J,e(c,O),y||g||(y=!0,j(C))),O},n.unstable_shouldYield=M,n.unstable_wrapCallback=function(O){var G=f;return function(){var Q=f;f=G;try{return O.apply(this,arguments)}finally{f=Q}}}})(B1);z1.exports=B1;var yk=z1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vk=T,es=yk;function F(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var U1=new Set,Cd={};function yl(n,e){hu(n,e),hu(n+"Capture",e)}function hu(n,e){for(Cd[n]=e,n=0;n<e.length;n++)U1.add(e[n])}var xi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jy=Object.prototype.hasOwnProperty,wk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ex={},Cx={};function xk(n){return jy.call(Cx,n)?!0:jy.call(Ex,n)?!1:wk.test(n)?Cx[n]=!0:(Ex[n]=!0,!1)}function bk(n,e,t,s){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Sk(n,e,t,s){if(e===null||typeof e>"u"||bk(n,e,t,s))return!0;if(s)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function pn(n,e,t,s,r,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Bt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Bt[n]=new pn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Bt[e]=new pn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Bt[n]=new pn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Bt[n]=new pn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Bt[n]=new pn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Bt[n]=new pn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Bt[n]=new pn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Bt[n]=new pn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Bt[n]=new pn(n,5,!1,n.toLowerCase(),null,!1,!1)});var J0=/[\-:]([a-z])/g;function Z0(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(J0,Z0);Bt[e]=new pn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(J0,Z0);Bt[e]=new pn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(J0,Z0);Bt[e]=new pn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Bt[n]=new pn(n,1,!1,n.toLowerCase(),null,!1,!1)});Bt.xlinkHref=new pn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Bt[n]=new pn(n,1,!1,n.toLowerCase(),null,!0,!0)});function ew(n,e,t,s){var r=Bt.hasOwnProperty(e)?Bt[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Sk(e,t,r,s)&&(t=null),s||r===null?xk(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,s=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,s?n.setAttributeNS(s,e,t):n.setAttribute(e,t))))}var ki=vk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,qf=Symbol.for("react.element"),Ll=Symbol.for("react.portal"),Ml=Symbol.for("react.fragment"),tw=Symbol.for("react.strict_mode"),Dy=Symbol.for("react.profiler"),H1=Symbol.for("react.provider"),V1=Symbol.for("react.context"),nw=Symbol.for("react.forward_ref"),Iy=Symbol.for("react.suspense"),Oy=Symbol.for("react.suspense_list"),sw=Symbol.for("react.memo"),ji=Symbol.for("react.lazy"),G1=Symbol.for("react.offscreen"),kx=Symbol.iterator;function Ru(n){return n===null||typeof n!="object"?null:(n=kx&&n[kx]||n["@@iterator"],typeof n=="function"?n:null)}var Ye=Object.assign,Gm;function Vu(n){if(Gm===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Gm=e&&e[1]||""}return`
`+Gm+n}var Wm=!1;function qm(n,e){if(!n||Wm)return"";Wm=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){s=u}n.call(e.prototype)}else{try{throw Error()}catch(u){s=u}n()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),i=s.stack.split(`
`),a=r.length-1,o=i.length-1;1<=a&&0<=o&&r[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==i[o]){var c=`
`+r[a].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=a&&0<=o);break}}}finally{Wm=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Vu(n):""}function Ak(n){switch(n.tag){case 5:return Vu(n.type);case 16:return Vu("Lazy");case 13:return Vu("Suspense");case 19:return Vu("SuspenseList");case 0:case 2:case 15:return n=qm(n.type,!1),n;case 11:return n=qm(n.type.render,!1),n;case 1:return n=qm(n.type,!0),n;default:return""}}function Fy(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Ml:return"Fragment";case Ll:return"Portal";case Dy:return"Profiler";case tw:return"StrictMode";case Iy:return"Suspense";case Oy:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case V1:return(n.displayName||"Context")+".Consumer";case H1:return(n._context.displayName||"Context")+".Provider";case nw:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case sw:return e=n.displayName||null,e!==null?e:Fy(n.type)||"Memo";case ji:e=n._payload,n=n._init;try{return Fy(n(e))}catch{}}return null}function _k(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Fy(e);case 8:return e===tw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function La(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function W1(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Ek(n){var e=W1(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),s=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){s=""+a,i.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Xf(n){n._valueTracker||(n._valueTracker=Ek(n))}function q1(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),s="";return n&&(s=W1(n)?n.checked?"true":"false":n.value),n=s,n!==t?(e.setValue(n),!0):!1}function ig(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function $y(n,e){var t=e.checked;return Ye({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Nx(n,e){var t=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;t=La(e.value!=null?e.value:t),n._wrapperState={initialChecked:s,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function X1(n,e){e=e.checked,e!=null&&ew(n,"checked",e,!1)}function zy(n,e){X1(n,e);var t=La(e.value),s=e.type;if(t!=null)s==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(s==="submit"||s==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?By(n,e.type,t):e.hasOwnProperty("defaultValue")&&By(n,e.type,La(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Tx(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function By(n,e,t){(e!=="number"||ig(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Gu=Array.isArray;function Xl(n,e,t,s){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&s&&(n[t].defaultSelected=!0)}else{for(t=""+La(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,s&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function Uy(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(F(91));return Ye({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Px(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(F(92));if(Gu(t)){if(1<t.length)throw Error(F(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:La(t)}}function Y1(n,e){var t=La(e.value),s=La(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),s!=null&&(n.defaultValue=""+s)}function Rx(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function K1(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hy(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?K1(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Yf,Q1=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,s,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,s,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Yf=Yf||document.createElement("div"),Yf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Yf.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function kd(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var fd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ck=["Webkit","ms","Moz","O"];Object.keys(fd).forEach(function(n){Ck.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),fd[e]=fd[n]})});function J1(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||fd.hasOwnProperty(n)&&fd[n]?(""+e).trim():e+"px"}function Z1(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var s=t.indexOf("--")===0,r=J1(t,e[t],s);t==="float"&&(t="cssFloat"),s?n.setProperty(t,r):n[t]=r}}var kk=Ye({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vy(n,e){if(e){if(kk[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(F(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(F(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(F(61))}if(e.style!=null&&typeof e.style!="object")throw Error(F(62))}}function Gy(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wy=null;function rw(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var qy=null,Yl=null,Kl=null;function Lx(n){if(n=Pf(n)){if(typeof qy!="function")throw Error(F(280));var e=n.stateNode;e&&(e=hm(e),qy(n.stateNode,n.type,e))}}function eS(n){Yl?Kl?Kl.push(n):Kl=[n]:Yl=n}function tS(){if(Yl){var n=Yl,e=Kl;if(Kl=Yl=null,Lx(n),e)for(n=0;n<e.length;n++)Lx(e[n])}}function nS(n,e){return n(e)}function sS(){}var Xm=!1;function rS(n,e,t){if(Xm)return n(e,t);Xm=!0;try{return nS(n,e,t)}finally{Xm=!1,(Yl!==null||Kl!==null)&&(sS(),tS())}}function Nd(n,e){var t=n.stateNode;if(t===null)return null;var s=hm(t);if(s===null)return null;t=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(n=n.type,s=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!s;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(F(231,e,typeof t));return t}var Xy=!1;if(xi)try{var Lu={};Object.defineProperty(Lu,"passive",{get:function(){Xy=!0}}),window.addEventListener("test",Lu,Lu),window.removeEventListener("test",Lu,Lu)}catch{Xy=!1}function Nk(n,e,t,s,r,i,a,o,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(d){this.onError(d)}}var pd=!1,ag=null,og=!1,Yy=null,Tk={onError:function(n){pd=!0,ag=n}};function Pk(n,e,t,s,r,i,a,o,c){pd=!1,ag=null,Nk.apply(Tk,arguments)}function Rk(n,e,t,s,r,i,a,o,c){if(Pk.apply(this,arguments),pd){if(pd){var u=ag;pd=!1,ag=null}else throw Error(F(198));og||(og=!0,Yy=u)}}function vl(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function iS(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Mx(n){if(vl(n)!==n)throw Error(F(188))}function Lk(n){var e=n.alternate;if(!e){if(e=vl(n),e===null)throw Error(F(188));return e!==n?null:n}for(var t=n,s=e;;){var r=t.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){t=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===t)return Mx(r),n;if(i===s)return Mx(r),e;i=i.sibling}throw Error(F(188))}if(t.return!==s.return)t=r,s=i;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,s=i;break}if(o===s){a=!0,s=r,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,s=r;break}if(o===s){a=!0,s=i,t=r;break}o=o.sibling}if(!a)throw Error(F(189))}}if(t.alternate!==s)throw Error(F(190))}if(t.tag!==3)throw Error(F(188));return t.stateNode.current===t?n:e}function aS(n){return n=Lk(n),n!==null?oS(n):null}function oS(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=oS(n);if(e!==null)return e;n=n.sibling}return null}var lS=es.unstable_scheduleCallback,jx=es.unstable_cancelCallback,Mk=es.unstable_shouldYield,jk=es.unstable_requestPaint,st=es.unstable_now,Dk=es.unstable_getCurrentPriorityLevel,iw=es.unstable_ImmediatePriority,cS=es.unstable_UserBlockingPriority,lg=es.unstable_NormalPriority,Ik=es.unstable_LowPriority,uS=es.unstable_IdlePriority,lm=null,Er=null;function Ok(n){if(Er&&typeof Er.onCommitFiberRoot=="function")try{Er.onCommitFiberRoot(lm,n,void 0,(n.current.flags&128)===128)}catch{}}var Gs=Math.clz32?Math.clz32:zk,Fk=Math.log,$k=Math.LN2;function zk(n){return n>>>=0,n===0?32:31-(Fk(n)/$k|0)|0}var Kf=64,Qf=4194304;function Wu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function cg(n,e){var t=n.pendingLanes;if(t===0)return 0;var s=0,r=n.suspendedLanes,i=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?s=Wu(o):(i&=a,i!==0&&(s=Wu(i)))}else a=t&~r,a!==0?s=Wu(a):i!==0&&(s=Wu(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=s;0<e;)t=31-Gs(e),r=1<<t,s|=n[t],e&=~r;return s}function Bk(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Uk(n,e){for(var t=n.suspendedLanes,s=n.pingedLanes,r=n.expirationTimes,i=n.pendingLanes;0<i;){var a=31-Gs(i),o=1<<a,c=r[a];c===-1?(!(o&t)||o&s)&&(r[a]=Bk(o,e)):c<=e&&(n.expiredLanes|=o),i&=~o}}function Ky(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function dS(){var n=Kf;return Kf<<=1,!(Kf&4194240)&&(Kf=64),n}function Ym(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Nf(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Gs(e),n[e]=t}function Hk(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var s=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-Gs(t),i=1<<r;e[r]=0,s[r]=-1,n[r]=-1,t&=~i}}function aw(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var s=31-Gs(t),r=1<<s;r&e|n[s]&e&&(n[s]|=e),t&=~r}}var Ce=0;function hS(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var fS,ow,pS,gS,mS,Qy=!1,Jf=[],_a=null,Ea=null,Ca=null,Td=new Map,Pd=new Map,Oi=[],Vk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dx(n,e){switch(n){case"focusin":case"focusout":_a=null;break;case"dragenter":case"dragleave":Ea=null;break;case"mouseover":case"mouseout":Ca=null;break;case"pointerover":case"pointerout":Td.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pd.delete(e.pointerId)}}function Mu(n,e,t,s,r,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=Pf(e),e!==null&&ow(e)),n):(n.eventSystemFlags|=s,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function Gk(n,e,t,s,r){switch(e){case"focusin":return _a=Mu(_a,n,e,t,s,r),!0;case"dragenter":return Ea=Mu(Ea,n,e,t,s,r),!0;case"mouseover":return Ca=Mu(Ca,n,e,t,s,r),!0;case"pointerover":var i=r.pointerId;return Td.set(i,Mu(Td.get(i)||null,n,e,t,s,r)),!0;case"gotpointercapture":return i=r.pointerId,Pd.set(i,Mu(Pd.get(i)||null,n,e,t,s,r)),!0}return!1}function yS(n){var e=Ja(n.target);if(e!==null){var t=vl(e);if(t!==null){if(e=t.tag,e===13){if(e=iS(t),e!==null){n.blockedOn=e,mS(n.priority,function(){pS(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function vp(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Jy(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var s=new t.constructor(t.type,t);Wy=s,t.target.dispatchEvent(s),Wy=null}else return e=Pf(t),e!==null&&ow(e),n.blockedOn=t,!1;e.shift()}return!0}function Ix(n,e,t){vp(n)&&t.delete(e)}function Wk(){Qy=!1,_a!==null&&vp(_a)&&(_a=null),Ea!==null&&vp(Ea)&&(Ea=null),Ca!==null&&vp(Ca)&&(Ca=null),Td.forEach(Ix),Pd.forEach(Ix)}function ju(n,e){n.blockedOn===e&&(n.blockedOn=null,Qy||(Qy=!0,es.unstable_scheduleCallback(es.unstable_NormalPriority,Wk)))}function Rd(n){function e(r){return ju(r,n)}if(0<Jf.length){ju(Jf[0],n);for(var t=1;t<Jf.length;t++){var s=Jf[t];s.blockedOn===n&&(s.blockedOn=null)}}for(_a!==null&&ju(_a,n),Ea!==null&&ju(Ea,n),Ca!==null&&ju(Ca,n),Td.forEach(e),Pd.forEach(e),t=0;t<Oi.length;t++)s=Oi[t],s.blockedOn===n&&(s.blockedOn=null);for(;0<Oi.length&&(t=Oi[0],t.blockedOn===null);)yS(t),t.blockedOn===null&&Oi.shift()}var Ql=ki.ReactCurrentBatchConfig,ug=!0;function qk(n,e,t,s){var r=Ce,i=Ql.transition;Ql.transition=null;try{Ce=1,lw(n,e,t,s)}finally{Ce=r,Ql.transition=i}}function Xk(n,e,t,s){var r=Ce,i=Ql.transition;Ql.transition=null;try{Ce=4,lw(n,e,t,s)}finally{Ce=r,Ql.transition=i}}function lw(n,e,t,s){if(ug){var r=Jy(n,e,t,s);if(r===null)iy(n,e,s,dg,t),Dx(n,s);else if(Gk(r,n,e,t,s))s.stopPropagation();else if(Dx(n,s),e&4&&-1<Vk.indexOf(n)){for(;r!==null;){var i=Pf(r);if(i!==null&&fS(i),i=Jy(n,e,t,s),i===null&&iy(n,e,s,dg,t),i===r)break;r=i}r!==null&&s.stopPropagation()}else iy(n,e,s,null,t)}}var dg=null;function Jy(n,e,t,s){if(dg=null,n=rw(s),n=Ja(n),n!==null)if(e=vl(n),e===null)n=null;else if(t=e.tag,t===13){if(n=iS(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return dg=n,null}function vS(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Dk()){case iw:return 1;case cS:return 4;case lg:case Ik:return 16;case uS:return 536870912;default:return 16}default:return 16}}var Sa=null,cw=null,wp=null;function wS(){if(wp)return wp;var n,e=cw,t=e.length,s,r="value"in Sa?Sa.value:Sa.textContent,i=r.length;for(n=0;n<t&&e[n]===r[n];n++);var a=t-n;for(s=1;s<=a&&e[t-s]===r[i-s];s++);return wp=r.slice(n,1<s?1-s:void 0)}function xp(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Zf(){return!0}function Ox(){return!1}function ns(n){function e(t,s,r,i,a){this._reactName=t,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Zf:Ox,this.isPropagationStopped=Ox,this}return Ye(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Zf)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Zf)},persist:function(){},isPersistent:Zf}),e}var Au={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uw=ns(Au),Tf=Ye({},Au,{view:0,detail:0}),Yk=ns(Tf),Km,Qm,Du,cm=Ye({},Tf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dw,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Du&&(Du&&n.type==="mousemove"?(Km=n.screenX-Du.screenX,Qm=n.screenY-Du.screenY):Qm=Km=0,Du=n),Km)},movementY:function(n){return"movementY"in n?n.movementY:Qm}}),Fx=ns(cm),Kk=Ye({},cm,{dataTransfer:0}),Qk=ns(Kk),Jk=Ye({},Tf,{relatedTarget:0}),Jm=ns(Jk),Zk=Ye({},Au,{animationName:0,elapsedTime:0,pseudoElement:0}),e2=ns(Zk),t2=Ye({},Au,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),n2=ns(t2),s2=Ye({},Au,{data:0}),$x=ns(s2),r2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},i2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},a2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function o2(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=a2[n])?!!e[n]:!1}function dw(){return o2}var l2=Ye({},Tf,{key:function(n){if(n.key){var e=r2[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=xp(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?i2[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dw,charCode:function(n){return n.type==="keypress"?xp(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?xp(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),c2=ns(l2),u2=Ye({},cm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zx=ns(u2),d2=Ye({},Tf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dw}),h2=ns(d2),f2=Ye({},Au,{propertyName:0,elapsedTime:0,pseudoElement:0}),p2=ns(f2),g2=Ye({},cm,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),m2=ns(g2),y2=[9,13,27,32],hw=xi&&"CompositionEvent"in window,gd=null;xi&&"documentMode"in document&&(gd=document.documentMode);var v2=xi&&"TextEvent"in window&&!gd,xS=xi&&(!hw||gd&&8<gd&&11>=gd),Bx=" ",Ux=!1;function bS(n,e){switch(n){case"keyup":return y2.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function SS(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var jl=!1;function w2(n,e){switch(n){case"compositionend":return SS(e);case"keypress":return e.which!==32?null:(Ux=!0,Bx);case"textInput":return n=e.data,n===Bx&&Ux?null:n;default:return null}}function x2(n,e){if(jl)return n==="compositionend"||!hw&&bS(n,e)?(n=wS(),wp=cw=Sa=null,jl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return xS&&e.locale!=="ko"?null:e.data;default:return null}}var b2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hx(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!b2[n.type]:e==="textarea"}function AS(n,e,t,s){eS(s),e=hg(e,"onChange"),0<e.length&&(t=new uw("onChange","change",null,t,s),n.push({event:t,listeners:e}))}var md=null,Ld=null;function S2(n){jS(n,0)}function um(n){var e=Ol(n);if(q1(e))return n}function A2(n,e){if(n==="change")return e}var _S=!1;if(xi){var Zm;if(xi){var ey="oninput"in document;if(!ey){var Vx=document.createElement("div");Vx.setAttribute("oninput","return;"),ey=typeof Vx.oninput=="function"}Zm=ey}else Zm=!1;_S=Zm&&(!document.documentMode||9<document.documentMode)}function Gx(){md&&(md.detachEvent("onpropertychange",ES),Ld=md=null)}function ES(n){if(n.propertyName==="value"&&um(Ld)){var e=[];AS(e,Ld,n,rw(n)),rS(S2,e)}}function _2(n,e,t){n==="focusin"?(Gx(),md=e,Ld=t,md.attachEvent("onpropertychange",ES)):n==="focusout"&&Gx()}function E2(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return um(Ld)}function C2(n,e){if(n==="click")return um(e)}function k2(n,e){if(n==="input"||n==="change")return um(e)}function N2(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var qs=typeof Object.is=="function"?Object.is:N2;function Md(n,e){if(qs(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),s=Object.keys(e);if(t.length!==s.length)return!1;for(s=0;s<t.length;s++){var r=t[s];if(!jy.call(e,r)||!qs(n[r],e[r]))return!1}return!0}function Wx(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function qx(n,e){var t=Wx(n);n=0;for(var s;t;){if(t.nodeType===3){if(s=n+t.textContent.length,n<=e&&s>=e)return{node:t,offset:e-n};n=s}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Wx(t)}}function CS(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?CS(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function kS(){for(var n=window,e=ig();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ig(n.document)}return e}function fw(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function T2(n){var e=kS(),t=n.focusedElem,s=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&CS(t.ownerDocument.documentElement,t)){if(s!==null&&fw(t)){if(e=s.start,n=s.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!n.extend&&i>s&&(r=s,s=i,i=r),r=qx(t,i);var a=qx(t,s);r&&a&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),i>s?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var P2=xi&&"documentMode"in document&&11>=document.documentMode,Dl=null,Zy=null,yd=null,ev=!1;function Xx(n,e,t){var s=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;ev||Dl==null||Dl!==ig(s)||(s=Dl,"selectionStart"in s&&fw(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),yd&&Md(yd,s)||(yd=s,s=hg(Zy,"onSelect"),0<s.length&&(e=new uw("onSelect","select",null,e,t),n.push({event:e,listeners:s}),e.target=Dl)))}function ep(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Il={animationend:ep("Animation","AnimationEnd"),animationiteration:ep("Animation","AnimationIteration"),animationstart:ep("Animation","AnimationStart"),transitionend:ep("Transition","TransitionEnd")},ty={},NS={};xi&&(NS=document.createElement("div").style,"AnimationEvent"in window||(delete Il.animationend.animation,delete Il.animationiteration.animation,delete Il.animationstart.animation),"TransitionEvent"in window||delete Il.transitionend.transition);function dm(n){if(ty[n])return ty[n];if(!Il[n])return n;var e=Il[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in NS)return ty[n]=e[t];return n}var TS=dm("animationend"),PS=dm("animationiteration"),RS=dm("animationstart"),LS=dm("transitionend"),MS=new Map,Yx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function za(n,e){MS.set(n,e),yl(e,[n])}for(var ny=0;ny<Yx.length;ny++){var sy=Yx[ny],R2=sy.toLowerCase(),L2=sy[0].toUpperCase()+sy.slice(1);za(R2,"on"+L2)}za(TS,"onAnimationEnd");za(PS,"onAnimationIteration");za(RS,"onAnimationStart");za("dblclick","onDoubleClick");za("focusin","onFocus");za("focusout","onBlur");za(LS,"onTransitionEnd");hu("onMouseEnter",["mouseout","mouseover"]);hu("onMouseLeave",["mouseout","mouseover"]);hu("onPointerEnter",["pointerout","pointerover"]);hu("onPointerLeave",["pointerout","pointerover"]);yl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));yl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));yl("onBeforeInput",["compositionend","keypress","textInput","paste"]);yl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));yl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));yl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),M2=new Set("cancel close invalid load scroll toggle".split(" ").concat(qu));function Kx(n,e,t){var s=n.type||"unknown-event";n.currentTarget=t,Rk(s,e,void 0,n),n.currentTarget=null}function jS(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var s=n[t],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var a=s.length-1;0<=a;a--){var o=s[a],c=o.instance,u=o.currentTarget;if(o=o.listener,c!==i&&r.isPropagationStopped())break e;Kx(r,o,u),i=c}else for(a=0;a<s.length;a++){if(o=s[a],c=o.instance,u=o.currentTarget,o=o.listener,c!==i&&r.isPropagationStopped())break e;Kx(r,o,u),i=c}}}if(og)throw n=Yy,og=!1,Yy=null,n}function Oe(n,e){var t=e[iv];t===void 0&&(t=e[iv]=new Set);var s=n+"__bubble";t.has(s)||(DS(e,n,2,!1),t.add(s))}function ry(n,e,t){var s=0;e&&(s|=4),DS(t,n,s,e)}var tp="_reactListening"+Math.random().toString(36).slice(2);function jd(n){if(!n[tp]){n[tp]=!0,U1.forEach(function(t){t!=="selectionchange"&&(M2.has(t)||ry(t,!1,n),ry(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[tp]||(e[tp]=!0,ry("selectionchange",!1,e))}}function DS(n,e,t,s){switch(vS(e)){case 1:var r=qk;break;case 4:r=Xk;break;default:r=lw}t=r.bind(null,e,t,n),r=void 0,!Xy||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function iy(n,e,t,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var o=s.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=s.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;a=a.return}for(;o!==null;){if(a=Ja(o),a===null)return;if(c=a.tag,c===5||c===6){s=i=a;continue e}o=o.parentNode}}s=s.return}rS(function(){var u=i,d=rw(t),h=[];e:{var f=MS.get(n);if(f!==void 0){var g=uw,y=n;switch(n){case"keypress":if(xp(t)===0)break e;case"keydown":case"keyup":g=c2;break;case"focusin":y="focus",g=Jm;break;case"focusout":y="blur",g=Jm;break;case"beforeblur":case"afterblur":g=Jm;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=Fx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=Qk;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=h2;break;case TS:case PS:case RS:g=e2;break;case LS:g=p2;break;case"scroll":g=Yk;break;case"wheel":g=m2;break;case"copy":case"cut":case"paste":g=n2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=zx}var m=(e&4)!==0,b=!m&&n==="scroll",w=m?f!==null?f+"Capture":null:f;m=[];for(var x=u,S;x!==null;){S=x;var E=S.stateNode;if(S.tag===5&&E!==null&&(S=E,w!==null&&(E=Nd(x,w),E!=null&&m.push(Dd(x,E,S)))),b)break;x=x.return}0<m.length&&(f=new g(f,y,null,t,d),h.push({event:f,listeners:m}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",g=n==="mouseout"||n==="pointerout",f&&t!==Wy&&(y=t.relatedTarget||t.fromElement)&&(Ja(y)||y[bi]))break e;if((g||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,g?(y=t.relatedTarget||t.toElement,g=u,y=y?Ja(y):null,y!==null&&(b=vl(y),y!==b||y.tag!==5&&y.tag!==6)&&(y=null)):(g=null,y=u),g!==y)){if(m=Fx,E="onMouseLeave",w="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(m=zx,E="onPointerLeave",w="onPointerEnter",x="pointer"),b=g==null?f:Ol(g),S=y==null?f:Ol(y),f=new m(E,x+"leave",g,t,d),f.target=b,f.relatedTarget=S,E=null,Ja(d)===u&&(m=new m(w,x+"enter",y,t,d),m.target=S,m.relatedTarget=b,E=m),b=E,g&&y)t:{for(m=g,w=y,x=0,S=m;S;S=_l(S))x++;for(S=0,E=w;E;E=_l(E))S++;for(;0<x-S;)m=_l(m),x--;for(;0<S-x;)w=_l(w),S--;for(;x--;){if(m===w||w!==null&&m===w.alternate)break t;m=_l(m),w=_l(w)}m=null}else m=null;g!==null&&Qx(h,f,g,m,!1),y!==null&&b!==null&&Qx(h,b,y,m,!0)}}e:{if(f=u?Ol(u):window,g=f.nodeName&&f.nodeName.toLowerCase(),g==="select"||g==="input"&&f.type==="file")var C=A2;else if(Hx(f))if(_S)C=k2;else{C=E2;var N=_2}else(g=f.nodeName)&&g.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=C2);if(C&&(C=C(n,u))){AS(h,C,t,d);break e}N&&N(n,f,u),n==="focusout"&&(N=f._wrapperState)&&N.controlled&&f.type==="number"&&By(f,"number",f.value)}switch(N=u?Ol(u):window,n){case"focusin":(Hx(N)||N.contentEditable==="true")&&(Dl=N,Zy=u,yd=null);break;case"focusout":yd=Zy=Dl=null;break;case"mousedown":ev=!0;break;case"contextmenu":case"mouseup":case"dragend":ev=!1,Xx(h,t,d);break;case"selectionchange":if(P2)break;case"keydown":case"keyup":Xx(h,t,d)}var k;if(hw)e:{switch(n){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else jl?bS(n,t)&&(R="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(xS&&t.locale!=="ko"&&(jl||R!=="onCompositionStart"?R==="onCompositionEnd"&&jl&&(k=wS()):(Sa=d,cw="value"in Sa?Sa.value:Sa.textContent,jl=!0)),N=hg(u,R),0<N.length&&(R=new $x(R,n,null,t,d),h.push({event:R,listeners:N}),k?R.data=k:(k=SS(t),k!==null&&(R.data=k)))),(k=v2?w2(n,t):x2(n,t))&&(u=hg(u,"onBeforeInput"),0<u.length&&(d=new $x("onBeforeInput","beforeinput",null,t,d),h.push({event:d,listeners:u}),d.data=k))}jS(h,e)})}function Dd(n,e,t){return{instance:n,listener:e,currentTarget:t}}function hg(n,e){for(var t=e+"Capture",s=[];n!==null;){var r=n,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=Nd(n,t),i!=null&&s.unshift(Dd(n,i,r)),i=Nd(n,e),i!=null&&s.push(Dd(n,i,r))),n=n.return}return s}function _l(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Qx(n,e,t,s,r){for(var i=e._reactName,a=[];t!==null&&t!==s;){var o=t,c=o.alternate,u=o.stateNode;if(c!==null&&c===s)break;o.tag===5&&u!==null&&(o=u,r?(c=Nd(t,i),c!=null&&a.unshift(Dd(t,c,o))):r||(c=Nd(t,i),c!=null&&a.push(Dd(t,c,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var j2=/\r\n?/g,D2=/\u0000|\uFFFD/g;function Jx(n){return(typeof n=="string"?n:""+n).replace(j2,`
`).replace(D2,"")}function np(n,e,t){if(e=Jx(e),Jx(n)!==e&&t)throw Error(F(425))}function fg(){}var tv=null,nv=null;function sv(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var rv=typeof setTimeout=="function"?setTimeout:void 0,I2=typeof clearTimeout=="function"?clearTimeout:void 0,Zx=typeof Promise=="function"?Promise:void 0,O2=typeof queueMicrotask=="function"?queueMicrotask:typeof Zx<"u"?function(n){return Zx.resolve(null).then(n).catch(F2)}:rv;function F2(n){setTimeout(function(){throw n})}function ay(n,e){var t=e,s=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(s===0){n.removeChild(r),Rd(e);return}s--}else t!=="$"&&t!=="$?"&&t!=="$!"||s++;t=r}while(t);Rd(e)}function ka(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function eb(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var _u=Math.random().toString(36).slice(2),Sr="__reactFiber$"+_u,Id="__reactProps$"+_u,bi="__reactContainer$"+_u,iv="__reactEvents$"+_u,$2="__reactListeners$"+_u,z2="__reactHandles$"+_u;function Ja(n){var e=n[Sr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[bi]||t[Sr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=eb(n);n!==null;){if(t=n[Sr])return t;n=eb(n)}return e}n=t,t=n.parentNode}return null}function Pf(n){return n=n[Sr]||n[bi],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ol(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(F(33))}function hm(n){return n[Id]||null}var av=[],Fl=-1;function Ba(n){return{current:n}}function $e(n){0>Fl||(n.current=av[Fl],av[Fl]=null,Fl--)}function De(n,e){Fl++,av[Fl]=n.current,n.current=e}var Ma={},en=Ba(Ma),_n=Ba(!1),ul=Ma;function fu(n,e){var t=n.type.contextTypes;if(!t)return Ma;var s=n.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in t)r[i]=e[i];return s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function En(n){return n=n.childContextTypes,n!=null}function pg(){$e(_n),$e(en)}function tb(n,e,t){if(en.current!==Ma)throw Error(F(168));De(en,e),De(_n,t)}function IS(n,e,t){var s=n.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return t;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(F(108,_k(n)||"Unknown",r));return Ye({},t,s)}function gg(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ma,ul=en.current,De(en,n),De(_n,_n.current),!0}function nb(n,e,t){var s=n.stateNode;if(!s)throw Error(F(169));t?(n=IS(n,e,ul),s.__reactInternalMemoizedMergedChildContext=n,$e(_n),$e(en),De(en,n)):$e(_n),De(_n,t)}var $r=null,fm=!1,oy=!1;function OS(n){$r===null?$r=[n]:$r.push(n)}function B2(n){fm=!0,OS(n)}function Ua(){if(!oy&&$r!==null){oy=!0;var n=0,e=Ce;try{var t=$r;for(Ce=1;n<t.length;n++){var s=t[n];do s=s(!0);while(s!==null)}$r=null,fm=!1}catch(r){throw $r!==null&&($r=$r.slice(n+1)),lS(iw,Ua),r}finally{Ce=e,oy=!1}}return null}var $l=[],zl=0,mg=null,yg=0,ps=[],gs=0,dl=null,gi=1,mi="";function Ga(n,e){$l[zl++]=yg,$l[zl++]=mg,mg=n,yg=e}function FS(n,e,t){ps[gs++]=gi,ps[gs++]=mi,ps[gs++]=dl,dl=n;var s=gi;n=mi;var r=32-Gs(s)-1;s&=~(1<<r),t+=1;var i=32-Gs(e)+r;if(30<i){var a=r-r%5;i=(s&(1<<a)-1).toString(32),s>>=a,r-=a,gi=1<<32-Gs(e)+r|t<<r|s,mi=i+n}else gi=1<<i|t<<r|s,mi=n}function pw(n){n.return!==null&&(Ga(n,1),FS(n,1,0))}function gw(n){for(;n===mg;)mg=$l[--zl],$l[zl]=null,yg=$l[--zl],$l[zl]=null;for(;n===dl;)dl=ps[--gs],ps[gs]=null,mi=ps[--gs],ps[gs]=null,gi=ps[--gs],ps[gs]=null}var Jn=null,Qn=null,He=!1,Hs=null;function $S(n,e){var t=vs(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function sb(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Jn=n,Qn=ka(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Jn=n,Qn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=dl!==null?{id:gi,overflow:mi}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=vs(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Jn=n,Qn=null,!0):!1;default:return!1}}function ov(n){return(n.mode&1)!==0&&(n.flags&128)===0}function lv(n){if(He){var e=Qn;if(e){var t=e;if(!sb(n,e)){if(ov(n))throw Error(F(418));e=ka(t.nextSibling);var s=Jn;e&&sb(n,e)?$S(s,t):(n.flags=n.flags&-4097|2,He=!1,Jn=n)}}else{if(ov(n))throw Error(F(418));n.flags=n.flags&-4097|2,He=!1,Jn=n}}}function rb(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Jn=n}function sp(n){if(n!==Jn)return!1;if(!He)return rb(n),He=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!sv(n.type,n.memoizedProps)),e&&(e=Qn)){if(ov(n))throw zS(),Error(F(418));for(;e;)$S(n,e),e=ka(e.nextSibling)}if(rb(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(F(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Qn=ka(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Qn=null}}else Qn=Jn?ka(n.stateNode.nextSibling):null;return!0}function zS(){for(var n=Qn;n;)n=ka(n.nextSibling)}function pu(){Qn=Jn=null,He=!1}function mw(n){Hs===null?Hs=[n]:Hs.push(n)}var U2=ki.ReactCurrentBatchConfig;function Iu(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(F(309));var s=t.stateNode}if(!s)throw Error(F(147,n));var r=s,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=r.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof n!="string")throw Error(F(284));if(!t._owner)throw Error(F(290,n))}return n}function rp(n,e){throw n=Object.prototype.toString.call(e),Error(F(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function ib(n){var e=n._init;return e(n._payload)}function BS(n){function e(w,x){if(n){var S=w.deletions;S===null?(w.deletions=[x],w.flags|=16):S.push(x)}}function t(w,x){if(!n)return null;for(;x!==null;)e(w,x),x=x.sibling;return null}function s(w,x){for(w=new Map;x!==null;)x.key!==null?w.set(x.key,x):w.set(x.index,x),x=x.sibling;return w}function r(w,x){return w=Ra(w,x),w.index=0,w.sibling=null,w}function i(w,x,S){return w.index=S,n?(S=w.alternate,S!==null?(S=S.index,S<x?(w.flags|=2,x):S):(w.flags|=2,x)):(w.flags|=1048576,x)}function a(w){return n&&w.alternate===null&&(w.flags|=2),w}function o(w,x,S,E){return x===null||x.tag!==6?(x=py(S,w.mode,E),x.return=w,x):(x=r(x,S),x.return=w,x)}function c(w,x,S,E){var C=S.type;return C===Ml?d(w,x,S.props.children,E,S.key):x!==null&&(x.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===ji&&ib(C)===x.type)?(E=r(x,S.props),E.ref=Iu(w,x,S),E.return=w,E):(E=kp(S.type,S.key,S.props,null,w.mode,E),E.ref=Iu(w,x,S),E.return=w,E)}function u(w,x,S,E){return x===null||x.tag!==4||x.stateNode.containerInfo!==S.containerInfo||x.stateNode.implementation!==S.implementation?(x=gy(S,w.mode,E),x.return=w,x):(x=r(x,S.children||[]),x.return=w,x)}function d(w,x,S,E,C){return x===null||x.tag!==7?(x=cl(S,w.mode,E,C),x.return=w,x):(x=r(x,S),x.return=w,x)}function h(w,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return x=py(""+x,w.mode,S),x.return=w,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case qf:return S=kp(x.type,x.key,x.props,null,w.mode,S),S.ref=Iu(w,null,x),S.return=w,S;case Ll:return x=gy(x,w.mode,S),x.return=w,x;case ji:var E=x._init;return h(w,E(x._payload),S)}if(Gu(x)||Ru(x))return x=cl(x,w.mode,S,null),x.return=w,x;rp(w,x)}return null}function f(w,x,S,E){var C=x!==null?x.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return C!==null?null:o(w,x,""+S,E);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case qf:return S.key===C?c(w,x,S,E):null;case Ll:return S.key===C?u(w,x,S,E):null;case ji:return C=S._init,f(w,x,C(S._payload),E)}if(Gu(S)||Ru(S))return C!==null?null:d(w,x,S,E,null);rp(w,S)}return null}function g(w,x,S,E,C){if(typeof E=="string"&&E!==""||typeof E=="number")return w=w.get(S)||null,o(x,w,""+E,C);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case qf:return w=w.get(E.key===null?S:E.key)||null,c(x,w,E,C);case Ll:return w=w.get(E.key===null?S:E.key)||null,u(x,w,E,C);case ji:var N=E._init;return g(w,x,S,N(E._payload),C)}if(Gu(E)||Ru(E))return w=w.get(S)||null,d(x,w,E,C,null);rp(x,E)}return null}function y(w,x,S,E){for(var C=null,N=null,k=x,R=x=0,P=null;k!==null&&R<S.length;R++){k.index>R?(P=k,k=null):P=k.sibling;var L=f(w,k,S[R],E);if(L===null){k===null&&(k=P);break}n&&k&&L.alternate===null&&e(w,k),x=i(L,x,R),N===null?C=L:N.sibling=L,N=L,k=P}if(R===S.length)return t(w,k),He&&Ga(w,R),C;if(k===null){for(;R<S.length;R++)k=h(w,S[R],E),k!==null&&(x=i(k,x,R),N===null?C=k:N.sibling=k,N=k);return He&&Ga(w,R),C}for(k=s(w,k);R<S.length;R++)P=g(k,w,R,S[R],E),P!==null&&(n&&P.alternate!==null&&k.delete(P.key===null?R:P.key),x=i(P,x,R),N===null?C=P:N.sibling=P,N=P);return n&&k.forEach(function(M){return e(w,M)}),He&&Ga(w,R),C}function m(w,x,S,E){var C=Ru(S);if(typeof C!="function")throw Error(F(150));if(S=C.call(S),S==null)throw Error(F(151));for(var N=C=null,k=x,R=x=0,P=null,L=S.next();k!==null&&!L.done;R++,L=S.next()){k.index>R?(P=k,k=null):P=k.sibling;var M=f(w,k,L.value,E);if(M===null){k===null&&(k=P);break}n&&k&&M.alternate===null&&e(w,k),x=i(M,x,R),N===null?C=M:N.sibling=M,N=M,k=P}if(L.done)return t(w,k),He&&Ga(w,R),C;if(k===null){for(;!L.done;R++,L=S.next())L=h(w,L.value,E),L!==null&&(x=i(L,x,R),N===null?C=L:N.sibling=L,N=L);return He&&Ga(w,R),C}for(k=s(w,k);!L.done;R++,L=S.next())L=g(k,w,R,L.value,E),L!==null&&(n&&L.alternate!==null&&k.delete(L.key===null?R:L.key),x=i(L,x,R),N===null?C=L:N.sibling=L,N=L);return n&&k.forEach(function(I){return e(w,I)}),He&&Ga(w,R),C}function b(w,x,S,E){if(typeof S=="object"&&S!==null&&S.type===Ml&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case qf:e:{for(var C=S.key,N=x;N!==null;){if(N.key===C){if(C=S.type,C===Ml){if(N.tag===7){t(w,N.sibling),x=r(N,S.props.children),x.return=w,w=x;break e}}else if(N.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===ji&&ib(C)===N.type){t(w,N.sibling),x=r(N,S.props),x.ref=Iu(w,N,S),x.return=w,w=x;break e}t(w,N);break}else e(w,N);N=N.sibling}S.type===Ml?(x=cl(S.props.children,w.mode,E,S.key),x.return=w,w=x):(E=kp(S.type,S.key,S.props,null,w.mode,E),E.ref=Iu(w,x,S),E.return=w,w=E)}return a(w);case Ll:e:{for(N=S.key;x!==null;){if(x.key===N)if(x.tag===4&&x.stateNode.containerInfo===S.containerInfo&&x.stateNode.implementation===S.implementation){t(w,x.sibling),x=r(x,S.children||[]),x.return=w,w=x;break e}else{t(w,x);break}else e(w,x);x=x.sibling}x=gy(S,w.mode,E),x.return=w,w=x}return a(w);case ji:return N=S._init,b(w,x,N(S._payload),E)}if(Gu(S))return y(w,x,S,E);if(Ru(S))return m(w,x,S,E);rp(w,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,x!==null&&x.tag===6?(t(w,x.sibling),x=r(x,S),x.return=w,w=x):(t(w,x),x=py(S,w.mode,E),x.return=w,w=x),a(w)):t(w,x)}return b}var gu=BS(!0),US=BS(!1),vg=Ba(null),wg=null,Bl=null,yw=null;function vw(){yw=Bl=wg=null}function ww(n){var e=vg.current;$e(vg),n._currentValue=e}function cv(n,e,t){for(;n!==null;){var s=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),n===t)break;n=n.return}}function Jl(n,e){wg=n,yw=Bl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(An=!0),n.firstContext=null)}function bs(n){var e=n._currentValue;if(yw!==n)if(n={context:n,memoizedValue:e,next:null},Bl===null){if(wg===null)throw Error(F(308));Bl=n,wg.dependencies={lanes:0,firstContext:n}}else Bl=Bl.next=n;return e}var Za=null;function xw(n){Za===null?Za=[n]:Za.push(n)}function HS(n,e,t,s){var r=e.interleaved;return r===null?(t.next=t,xw(e)):(t.next=r.next,r.next=t),e.interleaved=t,Si(n,s)}function Si(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Di=!1;function bw(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function VS(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function yi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Na(n,e,t){var s=n.updateQueue;if(s===null)return null;if(s=s.shared,xe&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,Si(n,t)}return r=s.interleaved,r===null?(e.next=e,xw(s)):(e.next=r.next,r.next=e),s.interleaved=e,Si(n,t)}function bp(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,aw(n,t)}}function ab(n,e){var t=n.updateQueue,s=n.alternate;if(s!==null&&(s=s.updateQueue,t===s)){var r=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?r=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?r=i=e:i=i.next=e}else r=i=e;t={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function xg(n,e,t,s){var r=n.updateQueue;Di=!1;var i=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var c=o,u=c.next;c.next=null,a===null?i=u:a.next=u,a=c;var d=n.alternate;d!==null&&(d=d.updateQueue,o=d.lastBaseUpdate,o!==a&&(o===null?d.firstBaseUpdate=u:o.next=u,d.lastBaseUpdate=c))}if(i!==null){var h=r.baseState;a=0,d=u=c=null,o=i;do{var f=o.lane,g=o.eventTime;if((s&f)===f){d!==null&&(d=d.next={eventTime:g,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var y=n,m=o;switch(f=e,g=t,m.tag){case 1:if(y=m.payload,typeof y=="function"){h=y.call(g,h,f);break e}h=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=m.payload,f=typeof y=="function"?y.call(g,h,f):y,f==null)break e;h=Ye({},h,f);break e;case 2:Di=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,f=r.effects,f===null?r.effects=[o]:f.push(o))}else g={eventTime:g,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},d===null?(u=d=g,c=h):d=d.next=g,a|=f;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;f=o,o=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);if(d===null&&(c=h),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=d,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);fl|=a,n.lanes=a,n.memoizedState=h}}function ob(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var s=n[e],r=s.callback;if(r!==null){if(s.callback=null,s=t,typeof r!="function")throw Error(F(191,r));r.call(s)}}}var Rf={},Cr=Ba(Rf),Od=Ba(Rf),Fd=Ba(Rf);function eo(n){if(n===Rf)throw Error(F(174));return n}function Sw(n,e){switch(De(Fd,e),De(Od,n),De(Cr,Rf),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Hy(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Hy(e,n)}$e(Cr),De(Cr,e)}function mu(){$e(Cr),$e(Od),$e(Fd)}function GS(n){eo(Fd.current);var e=eo(Cr.current),t=Hy(e,n.type);e!==t&&(De(Od,n),De(Cr,t))}function Aw(n){Od.current===n&&($e(Cr),$e(Od))}var qe=Ba(0);function bg(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ly=[];function _w(){for(var n=0;n<ly.length;n++)ly[n]._workInProgressVersionPrimary=null;ly.length=0}var Sp=ki.ReactCurrentDispatcher,cy=ki.ReactCurrentBatchConfig,hl=0,Xe=null,ft=null,Et=null,Sg=!1,vd=!1,$d=0,H2=0;function Ht(){throw Error(F(321))}function Ew(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!qs(n[t],e[t]))return!1;return!0}function Cw(n,e,t,s,r,i){if(hl=i,Xe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Sp.current=n===null||n.memoizedState===null?q2:X2,n=t(s,r),vd){i=0;do{if(vd=!1,$d=0,25<=i)throw Error(F(301));i+=1,Et=ft=null,e.updateQueue=null,Sp.current=Y2,n=t(s,r)}while(vd)}if(Sp.current=Ag,e=ft!==null&&ft.next!==null,hl=0,Et=ft=Xe=null,Sg=!1,e)throw Error(F(300));return n}function kw(){var n=$d!==0;return $d=0,n}function ir(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Et===null?Xe.memoizedState=Et=n:Et=Et.next=n,Et}function Ss(){if(ft===null){var n=Xe.alternate;n=n!==null?n.memoizedState:null}else n=ft.next;var e=Et===null?Xe.memoizedState:Et.next;if(e!==null)Et=e,ft=n;else{if(n===null)throw Error(F(310));ft=n,n={memoizedState:ft.memoizedState,baseState:ft.baseState,baseQueue:ft.baseQueue,queue:ft.queue,next:null},Et===null?Xe.memoizedState=Et=n:Et=Et.next=n}return Et}function zd(n,e){return typeof e=="function"?e(n):e}function uy(n){var e=Ss(),t=e.queue;if(t===null)throw Error(F(311));t.lastRenderedReducer=n;var s=ft,r=s.baseQueue,i=t.pending;if(i!==null){if(r!==null){var a=r.next;r.next=i.next,i.next=a}s.baseQueue=r=i,t.pending=null}if(r!==null){i=r.next,s=s.baseState;var o=a=null,c=null,u=i;do{var d=u.lane;if((hl&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:n(s,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(o=c=h,a=s):c=c.next=h,Xe.lanes|=d,fl|=d}u=u.next}while(u!==null&&u!==i);c===null?a=s:c.next=o,qs(s,e.memoizedState)||(An=!0),e.memoizedState=s,e.baseState=a,e.baseQueue=c,t.lastRenderedState=s}if(n=t.interleaved,n!==null){r=n;do i=r.lane,Xe.lanes|=i,fl|=i,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function dy(n){var e=Ss(),t=e.queue;if(t===null)throw Error(F(311));t.lastRenderedReducer=n;var s=t.dispatch,r=t.pending,i=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do i=n(i,a.action),a=a.next;while(a!==r);qs(i,e.memoizedState)||(An=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,s]}function WS(){}function qS(n,e){var t=Xe,s=Ss(),r=e(),i=!qs(s.memoizedState,r);if(i&&(s.memoizedState=r,An=!0),s=s.queue,Nw(KS.bind(null,t,s,n),[n]),s.getSnapshot!==e||i||Et!==null&&Et.memoizedState.tag&1){if(t.flags|=2048,Bd(9,YS.bind(null,t,s,r,e),void 0,null),kt===null)throw Error(F(349));hl&30||XS(t,e,r)}return r}function XS(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Xe.updateQueue,e===null?(e={lastEffect:null,stores:null},Xe.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function YS(n,e,t,s){e.value=t,e.getSnapshot=s,QS(e)&&JS(n)}function KS(n,e,t){return t(function(){QS(e)&&JS(n)})}function QS(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!qs(n,t)}catch{return!0}}function JS(n){var e=Si(n,1);e!==null&&Ws(e,n,1,-1)}function lb(n){var e=ir();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:zd,lastRenderedState:n},e.queue=n,n=n.dispatch=W2.bind(null,Xe,n),[e.memoizedState,n]}function Bd(n,e,t,s){return n={tag:n,create:e,destroy:t,deps:s,next:null},e=Xe.updateQueue,e===null?(e={lastEffect:null,stores:null},Xe.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(s=t.next,t.next=n,n.next=s,e.lastEffect=n)),n}function ZS(){return Ss().memoizedState}function Ap(n,e,t,s){var r=ir();Xe.flags|=n,r.memoizedState=Bd(1|e,t,void 0,s===void 0?null:s)}function pm(n,e,t,s){var r=Ss();s=s===void 0?null:s;var i=void 0;if(ft!==null){var a=ft.memoizedState;if(i=a.destroy,s!==null&&Ew(s,a.deps)){r.memoizedState=Bd(e,t,i,s);return}}Xe.flags|=n,r.memoizedState=Bd(1|e,t,i,s)}function cb(n,e){return Ap(8390656,8,n,e)}function Nw(n,e){return pm(2048,8,n,e)}function eA(n,e){return pm(4,2,n,e)}function tA(n,e){return pm(4,4,n,e)}function nA(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function sA(n,e,t){return t=t!=null?t.concat([n]):null,pm(4,4,nA.bind(null,e,n),t)}function Tw(){}function rA(n,e){var t=Ss();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Ew(e,s[1])?s[0]:(t.memoizedState=[n,e],n)}function iA(n,e){var t=Ss();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Ew(e,s[1])?s[0]:(n=n(),t.memoizedState=[n,e],n)}function aA(n,e,t){return hl&21?(qs(t,e)||(t=dS(),Xe.lanes|=t,fl|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,An=!0),n.memoizedState=t)}function V2(n,e){var t=Ce;Ce=t!==0&&4>t?t:4,n(!0);var s=cy.transition;cy.transition={};try{n(!1),e()}finally{Ce=t,cy.transition=s}}function oA(){return Ss().memoizedState}function G2(n,e,t){var s=Pa(n);if(t={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null},lA(n))cA(e,t);else if(t=HS(n,e,t,s),t!==null){var r=dn();Ws(t,n,s,r),uA(t,e,s)}}function W2(n,e,t){var s=Pa(n),r={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null};if(lA(n))cA(e,r);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(r.hasEagerState=!0,r.eagerState=o,qs(o,a)){var c=e.interleaved;c===null?(r.next=r,xw(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}t=HS(n,e,r,s),t!==null&&(r=dn(),Ws(t,n,s,r),uA(t,e,s))}}function lA(n){var e=n.alternate;return n===Xe||e!==null&&e===Xe}function cA(n,e){vd=Sg=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function uA(n,e,t){if(t&4194240){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,aw(n,t)}}var Ag={readContext:bs,useCallback:Ht,useContext:Ht,useEffect:Ht,useImperativeHandle:Ht,useInsertionEffect:Ht,useLayoutEffect:Ht,useMemo:Ht,useReducer:Ht,useRef:Ht,useState:Ht,useDebugValue:Ht,useDeferredValue:Ht,useTransition:Ht,useMutableSource:Ht,useSyncExternalStore:Ht,useId:Ht,unstable_isNewReconciler:!1},q2={readContext:bs,useCallback:function(n,e){return ir().memoizedState=[n,e===void 0?null:e],n},useContext:bs,useEffect:cb,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Ap(4194308,4,nA.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Ap(4194308,4,n,e)},useInsertionEffect:function(n,e){return Ap(4,2,n,e)},useMemo:function(n,e){var t=ir();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var s=ir();return e=t!==void 0?t(e):e,s.memoizedState=s.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},s.queue=n,n=n.dispatch=G2.bind(null,Xe,n),[s.memoizedState,n]},useRef:function(n){var e=ir();return n={current:n},e.memoizedState=n},useState:lb,useDebugValue:Tw,useDeferredValue:function(n){return ir().memoizedState=n},useTransition:function(){var n=lb(!1),e=n[0];return n=V2.bind(null,n[1]),ir().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var s=Xe,r=ir();if(He){if(t===void 0)throw Error(F(407));t=t()}else{if(t=e(),kt===null)throw Error(F(349));hl&30||XS(s,e,t)}r.memoizedState=t;var i={value:t,getSnapshot:e};return r.queue=i,cb(KS.bind(null,s,i,n),[n]),s.flags|=2048,Bd(9,YS.bind(null,s,i,t,e),void 0,null),t},useId:function(){var n=ir(),e=kt.identifierPrefix;if(He){var t=mi,s=gi;t=(s&~(1<<32-Gs(s)-1)).toString(32)+t,e=":"+e+"R"+t,t=$d++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=H2++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},X2={readContext:bs,useCallback:rA,useContext:bs,useEffect:Nw,useImperativeHandle:sA,useInsertionEffect:eA,useLayoutEffect:tA,useMemo:iA,useReducer:uy,useRef:ZS,useState:function(){return uy(zd)},useDebugValue:Tw,useDeferredValue:function(n){var e=Ss();return aA(e,ft.memoizedState,n)},useTransition:function(){var n=uy(zd)[0],e=Ss().memoizedState;return[n,e]},useMutableSource:WS,useSyncExternalStore:qS,useId:oA,unstable_isNewReconciler:!1},Y2={readContext:bs,useCallback:rA,useContext:bs,useEffect:Nw,useImperativeHandle:sA,useInsertionEffect:eA,useLayoutEffect:tA,useMemo:iA,useReducer:dy,useRef:ZS,useState:function(){return dy(zd)},useDebugValue:Tw,useDeferredValue:function(n){var e=Ss();return ft===null?e.memoizedState=n:aA(e,ft.memoizedState,n)},useTransition:function(){var n=dy(zd)[0],e=Ss().memoizedState;return[n,e]},useMutableSource:WS,useSyncExternalStore:qS,useId:oA,unstable_isNewReconciler:!1};function Ns(n,e){if(n&&n.defaultProps){e=Ye({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function uv(n,e,t,s){e=n.memoizedState,t=t(s,e),t=t==null?e:Ye({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var gm={isMounted:function(n){return(n=n._reactInternals)?vl(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var s=dn(),r=Pa(n),i=yi(s,r);i.payload=e,t!=null&&(i.callback=t),e=Na(n,i,r),e!==null&&(Ws(e,n,r,s),bp(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var s=dn(),r=Pa(n),i=yi(s,r);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Na(n,i,r),e!==null&&(Ws(e,n,r,s),bp(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=dn(),s=Pa(n),r=yi(t,s);r.tag=2,e!=null&&(r.callback=e),e=Na(n,r,s),e!==null&&(Ws(e,n,s,t),bp(e,n,s))}};function ub(n,e,t,s,r,i,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(s,i,a):e.prototype&&e.prototype.isPureReactComponent?!Md(t,s)||!Md(r,i):!0}function dA(n,e,t){var s=!1,r=Ma,i=e.contextType;return typeof i=="object"&&i!==null?i=bs(i):(r=En(e)?ul:en.current,s=e.contextTypes,i=(s=s!=null)?fu(n,r):Ma),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=gm,n.stateNode=e,e._reactInternals=n,s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=i),e}function db(n,e,t,s){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,s),e.state!==n&&gm.enqueueReplaceState(e,e.state,null)}function dv(n,e,t,s){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},bw(n);var i=e.contextType;typeof i=="object"&&i!==null?r.context=bs(i):(i=En(e)?ul:en.current,r.context=fu(n,i)),r.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(uv(n,e,i,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&gm.enqueueReplaceState(r,r.state,null),xg(n,t,r,s),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function yu(n,e){try{var t="",s=e;do t+=Ak(s),s=s.return;while(s);var r=t}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:r,digest:null}}function hy(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function hv(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var K2=typeof WeakMap=="function"?WeakMap:Map;function hA(n,e,t){t=yi(-1,t),t.tag=3,t.payload={element:null};var s=e.value;return t.callback=function(){Eg||(Eg=!0,Sv=s),hv(n,e)},t}function fA(n,e,t){t=yi(-1,t),t.tag=3;var s=n.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;t.payload=function(){return s(r)},t.callback=function(){hv(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){hv(n,e),typeof s!="function"&&(Ta===null?Ta=new Set([this]):Ta.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function hb(n,e,t){var s=n.pingCache;if(s===null){s=n.pingCache=new K2;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(t)||(r.add(t),n=uN.bind(null,n,e,t),e.then(n,n))}function fb(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function pb(n,e,t,s,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=yi(-1,1),e.tag=2,Na(t,e,1))),t.lanes|=1),n)}var Q2=ki.ReactCurrentOwner,An=!1;function cn(n,e,t,s){e.child=n===null?US(e,null,t,s):gu(e,n.child,t,s)}function gb(n,e,t,s,r){t=t.render;var i=e.ref;return Jl(e,r),s=Cw(n,e,t,s,i,r),t=kw(),n!==null&&!An?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Ai(n,e,r)):(He&&t&&pw(e),e.flags|=1,cn(n,e,s,r),e.child)}function mb(n,e,t,s,r){if(n===null){var i=t.type;return typeof i=="function"&&!Ow(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,pA(n,e,i,s,r)):(n=kp(t.type,null,s,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&r)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:Md,t(a,s)&&n.ref===e.ref)return Ai(n,e,r)}return e.flags|=1,n=Ra(i,s),n.ref=e.ref,n.return=e,e.child=n}function pA(n,e,t,s,r){if(n!==null){var i=n.memoizedProps;if(Md(i,s)&&n.ref===e.ref)if(An=!1,e.pendingProps=s=i,(n.lanes&r)!==0)n.flags&131072&&(An=!0);else return e.lanes=n.lanes,Ai(n,e,r)}return fv(n,e,t,s,r)}function gA(n,e,t){var s=e.pendingProps,r=s.children,i=n!==null?n.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},De(Hl,Xn),Xn|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,De(Hl,Xn),Xn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:t,De(Hl,Xn),Xn|=s}else i!==null?(s=i.baseLanes|t,e.memoizedState=null):s=t,De(Hl,Xn),Xn|=s;return cn(n,e,r,t),e.child}function mA(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function fv(n,e,t,s,r){var i=En(t)?ul:en.current;return i=fu(e,i),Jl(e,r),t=Cw(n,e,t,s,i,r),s=kw(),n!==null&&!An?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Ai(n,e,r)):(He&&s&&pw(e),e.flags|=1,cn(n,e,t,r),e.child)}function yb(n,e,t,s,r){if(En(t)){var i=!0;gg(e)}else i=!1;if(Jl(e,r),e.stateNode===null)_p(n,e),dA(e,t,s),dv(e,t,s,r),s=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var c=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=bs(u):(u=En(t)?ul:en.current,u=fu(e,u));var d=t.getDerivedStateFromProps,h=typeof d=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==s||c!==u)&&db(e,a,s,u),Di=!1;var f=e.memoizedState;a.state=f,xg(e,s,a,r),c=e.memoizedState,o!==s||f!==c||_n.current||Di?(typeof d=="function"&&(uv(e,t,d,s),c=e.memoizedState),(o=Di||ub(e,t,o,s,f,c,u))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=c),a.props=s,a.state=c,a.context=u,s=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{a=e.stateNode,VS(n,e),o=e.memoizedProps,u=e.type===e.elementType?o:Ns(e.type,o),a.props=u,h=e.pendingProps,f=a.context,c=t.contextType,typeof c=="object"&&c!==null?c=bs(c):(c=En(t)?ul:en.current,c=fu(e,c));var g=t.getDerivedStateFromProps;(d=typeof g=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||f!==c)&&db(e,a,s,c),Di=!1,f=e.memoizedState,a.state=f,xg(e,s,a,r);var y=e.memoizedState;o!==h||f!==y||_n.current||Di?(typeof g=="function"&&(uv(e,t,g,s),y=e.memoizedState),(u=Di||ub(e,t,u,s,f,y,c)||!1)?(d||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,y,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,y,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=y),a.props=s,a.state=y,a.context=c,s=u):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),s=!1)}return pv(n,e,t,s,i,r)}function pv(n,e,t,s,r,i){mA(n,e);var a=(e.flags&128)!==0;if(!s&&!a)return r&&nb(e,t,!1),Ai(n,e,i);s=e.stateNode,Q2.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,n!==null&&a?(e.child=gu(e,n.child,null,i),e.child=gu(e,null,o,i)):cn(n,e,o,i),e.memoizedState=s.state,r&&nb(e,t,!0),e.child}function yA(n){var e=n.stateNode;e.pendingContext?tb(n,e.pendingContext,e.pendingContext!==e.context):e.context&&tb(n,e.context,!1),Sw(n,e.containerInfo)}function vb(n,e,t,s,r){return pu(),mw(r),e.flags|=256,cn(n,e,t,s),e.child}var gv={dehydrated:null,treeContext:null,retryLane:0};function mv(n){return{baseLanes:n,cachePool:null,transitions:null}}function vA(n,e,t){var s=e.pendingProps,r=qe.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(r&2)!==0),o?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),De(qe,r&1),n===null)return lv(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=s.children,n=s.fallback,i?(s=e.mode,i=e.child,a={mode:"hidden",children:a},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=vm(a,s,0,null),n=cl(n,s,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=mv(t),e.memoizedState=gv,n):Pw(e,a));if(r=n.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return J2(n,e,a,s,o,r,t);if(i){i=s.fallback,a=e.mode,r=n.child,o=r.sibling;var c={mode:"hidden",children:s.children};return!(a&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=c,e.deletions=null):(s=Ra(r,c),s.subtreeFlags=r.subtreeFlags&14680064),o!==null?i=Ra(o,i):(i=cl(i,a,t,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,a=n.child.memoizedState,a=a===null?mv(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=n.childLanes&~t,e.memoizedState=gv,s}return i=n.child,n=i.sibling,s=Ra(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=t),s.return=e,s.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=s,e.memoizedState=null,s}function Pw(n,e){return e=vm({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function ip(n,e,t,s){return s!==null&&mw(s),gu(e,n.child,null,t),n=Pw(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function J2(n,e,t,s,r,i,a){if(t)return e.flags&256?(e.flags&=-257,s=hy(Error(F(422))),ip(n,e,a,s)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=vm({mode:"visible",children:s.children},r,0,null),i=cl(i,r,a,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&gu(e,n.child,null,a),e.child.memoizedState=mv(a),e.memoizedState=gv,i);if(!(e.mode&1))return ip(n,e,a,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var o=s.dgst;return s=o,i=Error(F(419)),s=hy(i,s,void 0),ip(n,e,a,s)}if(o=(a&n.childLanes)!==0,An||o){if(s=kt,s!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|a)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,Si(n,r),Ws(s,n,r,-1))}return Iw(),s=hy(Error(F(421))),ip(n,e,a,s)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=dN.bind(null,n),r._reactRetry=e,null):(n=i.treeContext,Qn=ka(r.nextSibling),Jn=e,He=!0,Hs=null,n!==null&&(ps[gs++]=gi,ps[gs++]=mi,ps[gs++]=dl,gi=n.id,mi=n.overflow,dl=e),e=Pw(e,s.children),e.flags|=4096,e)}function wb(n,e,t){n.lanes|=e;var s=n.alternate;s!==null&&(s.lanes|=e),cv(n.return,e,t)}function fy(n,e,t,s,r){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:t,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=t,i.tailMode=r)}function wA(n,e,t){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(cn(n,e,s.children,t),s=qe.current,s&2)s=s&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&wb(n,t,e);else if(n.tag===19)wb(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}s&=1}if(De(qe,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&bg(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),fy(e,!1,r,t,i);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&bg(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}fy(e,!0,t,null,i);break;case"together":fy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function _p(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Ai(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),fl|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(F(153));if(e.child!==null){for(n=e.child,t=Ra(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Ra(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function Z2(n,e,t){switch(e.tag){case 3:yA(e),pu();break;case 5:GS(e);break;case 1:En(e.type)&&gg(e);break;case 4:Sw(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;De(vg,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(De(qe,qe.current&1),e.flags|=128,null):t&e.child.childLanes?vA(n,e,t):(De(qe,qe.current&1),n=Ai(n,e,t),n!==null?n.sibling:null);De(qe,qe.current&1);break;case 19:if(s=(t&e.childLanes)!==0,n.flags&128){if(s)return wA(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),De(qe,qe.current),s)break;return null;case 22:case 23:return e.lanes=0,gA(n,e,t)}return Ai(n,e,t)}var xA,yv,bA,SA;xA=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};yv=function(){};bA=function(n,e,t,s){var r=n.memoizedProps;if(r!==s){n=e.stateNode,eo(Cr.current);var i=null;switch(t){case"input":r=$y(n,r),s=$y(n,s),i=[];break;case"select":r=Ye({},r,{value:void 0}),s=Ye({},s,{value:void 0}),i=[];break;case"textarea":r=Uy(n,r),s=Uy(n,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(n.onclick=fg)}Vy(t,s);var a;t=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var o=r[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Cd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var c=s[u];if(o=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&c!==o&&(c!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in c)c.hasOwnProperty(a)&&o[a]!==c[a]&&(t||(t={}),t[a]=c[a])}else t||(i||(i=[]),i.push(u,t)),t=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,o=o?o.__html:void 0,c!=null&&o!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Cd.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&Oe("scroll",n),i||o===c||(i=[])):(i=i||[]).push(u,c))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};SA=function(n,e,t,s){t!==s&&(e.flags|=4)};function Ou(n,e){if(!He)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:s.sibling=null}}function Vt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,s=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=s,n.childLanes=t,e}function eN(n,e,t){var s=e.pendingProps;switch(gw(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vt(e),null;case 1:return En(e.type)&&pg(),Vt(e),null;case 3:return s=e.stateNode,mu(),$e(_n),$e(en),_w(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(n===null||n.child===null)&&(sp(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Hs!==null&&(Ev(Hs),Hs=null))),yv(n,e),Vt(e),null;case 5:Aw(e);var r=eo(Fd.current);if(t=e.type,n!==null&&e.stateNode!=null)bA(n,e,t,s,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(F(166));return Vt(e),null}if(n=eo(Cr.current),sp(e)){s=e.stateNode,t=e.type;var i=e.memoizedProps;switch(s[Sr]=e,s[Id]=i,n=(e.mode&1)!==0,t){case"dialog":Oe("cancel",s),Oe("close",s);break;case"iframe":case"object":case"embed":Oe("load",s);break;case"video":case"audio":for(r=0;r<qu.length;r++)Oe(qu[r],s);break;case"source":Oe("error",s);break;case"img":case"image":case"link":Oe("error",s),Oe("load",s);break;case"details":Oe("toggle",s);break;case"input":Nx(s,i),Oe("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},Oe("invalid",s);break;case"textarea":Px(s,i),Oe("invalid",s)}Vy(t,i),r=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?s.textContent!==o&&(i.suppressHydrationWarning!==!0&&np(s.textContent,o,n),r=["children",o]):typeof o=="number"&&s.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&np(s.textContent,o,n),r=["children",""+o]):Cd.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Oe("scroll",s)}switch(t){case"input":Xf(s),Tx(s,i,!0);break;case"textarea":Xf(s),Rx(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=fg)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=K1(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof s.is=="string"?n=a.createElement(t,{is:s.is}):(n=a.createElement(t),t==="select"&&(a=n,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):n=a.createElementNS(n,t),n[Sr]=e,n[Id]=s,xA(n,e,!1,!1),e.stateNode=n;e:{switch(a=Gy(t,s),t){case"dialog":Oe("cancel",n),Oe("close",n),r=s;break;case"iframe":case"object":case"embed":Oe("load",n),r=s;break;case"video":case"audio":for(r=0;r<qu.length;r++)Oe(qu[r],n);r=s;break;case"source":Oe("error",n),r=s;break;case"img":case"image":case"link":Oe("error",n),Oe("load",n),r=s;break;case"details":Oe("toggle",n),r=s;break;case"input":Nx(n,s),r=$y(n,s),Oe("invalid",n);break;case"option":r=s;break;case"select":n._wrapperState={wasMultiple:!!s.multiple},r=Ye({},s,{value:void 0}),Oe("invalid",n);break;case"textarea":Px(n,s),r=Uy(n,s),Oe("invalid",n);break;default:r=s}Vy(t,r),o=r;for(i in o)if(o.hasOwnProperty(i)){var c=o[i];i==="style"?Z1(n,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Q1(n,c)):i==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&kd(n,c):typeof c=="number"&&kd(n,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Cd.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Oe("scroll",n):c!=null&&ew(n,i,c,a))}switch(t){case"input":Xf(n),Tx(n,s,!1);break;case"textarea":Xf(n),Rx(n);break;case"option":s.value!=null&&n.setAttribute("value",""+La(s.value));break;case"select":n.multiple=!!s.multiple,i=s.value,i!=null?Xl(n,!!s.multiple,i,!1):s.defaultValue!=null&&Xl(n,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=fg)}switch(t){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Vt(e),null;case 6:if(n&&e.stateNode!=null)SA(n,e,n.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(F(166));if(t=eo(Fd.current),eo(Cr.current),sp(e)){if(s=e.stateNode,t=e.memoizedProps,s[Sr]=e,(i=s.nodeValue!==t)&&(n=Jn,n!==null))switch(n.tag){case 3:np(s.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&np(s.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else s=(t.nodeType===9?t:t.ownerDocument).createTextNode(s),s[Sr]=e,e.stateNode=s}return Vt(e),null;case 13:if($e(qe),s=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(He&&Qn!==null&&e.mode&1&&!(e.flags&128))zS(),pu(),e.flags|=98560,i=!1;else if(i=sp(e),s!==null&&s.dehydrated!==null){if(n===null){if(!i)throw Error(F(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(F(317));i[Sr]=e}else pu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Vt(e),i=!1}else Hs!==null&&(Ev(Hs),Hs=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(s=s!==null,s!==(n!==null&&n.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(n===null||qe.current&1?mt===0&&(mt=3):Iw())),e.updateQueue!==null&&(e.flags|=4),Vt(e),null);case 4:return mu(),yv(n,e),n===null&&jd(e.stateNode.containerInfo),Vt(e),null;case 10:return ww(e.type._context),Vt(e),null;case 17:return En(e.type)&&pg(),Vt(e),null;case 19:if($e(qe),i=e.memoizedState,i===null)return Vt(e),null;if(s=(e.flags&128)!==0,a=i.rendering,a===null)if(s)Ou(i,!1);else{if(mt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=bg(n),a!==null){for(e.flags|=128,Ou(i,!1),s=a.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=t,t=e.child;t!==null;)i=t,n=s,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return De(qe,qe.current&1|2),e.child}n=n.sibling}i.tail!==null&&st()>vu&&(e.flags|=128,s=!0,Ou(i,!1),e.lanes=4194304)}else{if(!s)if(n=bg(a),n!==null){if(e.flags|=128,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Ou(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!He)return Vt(e),null}else 2*st()-i.renderingStartTime>vu&&t!==1073741824&&(e.flags|=128,s=!0,Ou(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=st(),e.sibling=null,t=qe.current,De(qe,s?t&1|2:t&1),e):(Vt(e),null);case 22:case 23:return Dw(),s=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?Xn&1073741824&&(Vt(e),e.subtreeFlags&6&&(e.flags|=8192)):Vt(e),null;case 24:return null;case 25:return null}throw Error(F(156,e.tag))}function tN(n,e){switch(gw(e),e.tag){case 1:return En(e.type)&&pg(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return mu(),$e(_n),$e(en),_w(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Aw(e),null;case 13:if($e(qe),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(F(340));pu()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return $e(qe),null;case 4:return mu(),null;case 10:return ww(e.type._context),null;case 22:case 23:return Dw(),null;case 24:return null;default:return null}}var ap=!1,Jt=!1,nN=typeof WeakSet=="function"?WeakSet:Set,X=null;function Ul(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(s){Je(n,e,s)}else t.current=null}function vv(n,e,t){try{t()}catch(s){Je(n,e,s)}}var xb=!1;function sN(n,e){if(tv=ug,n=kS(),fw(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var s=t.getSelection&&t.getSelection();if(s&&s.rangeCount!==0){t=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,c=-1,u=0,d=0,h=n,f=null;t:for(;;){for(var g;h!==t||r!==0&&h.nodeType!==3||(o=a+r),h!==i||s!==0&&h.nodeType!==3||(c=a+s),h.nodeType===3&&(a+=h.nodeValue.length),(g=h.firstChild)!==null;)f=h,h=g;for(;;){if(h===n)break t;if(f===t&&++u===r&&(o=a),f===i&&++d===s&&(c=a),(g=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=g}t=o===-1||c===-1?null:{start:o,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(nv={focusedElem:n,selectionRange:t},ug=!1,X=e;X!==null;)if(e=X,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,X=n;else for(;X!==null;){e=X;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var m=y.memoizedProps,b=y.memoizedState,w=e.stateNode,x=w.getSnapshotBeforeUpdate(e.elementType===e.type?m:Ns(e.type,m),b);w.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(F(163))}}catch(E){Je(e,e.return,E)}if(n=e.sibling,n!==null){n.return=e.return,X=n;break}X=e.return}return y=xb,xb=!1,y}function wd(n,e,t){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&n)===n){var i=r.destroy;r.destroy=void 0,i!==void 0&&vv(e,t,i)}r=r.next}while(r!==s)}}function mm(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var s=t.create;t.destroy=s()}t=t.next}while(t!==e)}}function wv(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function AA(n){var e=n.alternate;e!==null&&(n.alternate=null,AA(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Sr],delete e[Id],delete e[iv],delete e[$2],delete e[z2])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function _A(n){return n.tag===5||n.tag===3||n.tag===4}function bb(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||_A(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function xv(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=fg));else if(s!==4&&(n=n.child,n!==null))for(xv(n,e,t),n=n.sibling;n!==null;)xv(n,e,t),n=n.sibling}function bv(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(s!==4&&(n=n.child,n!==null))for(bv(n,e,t),n=n.sibling;n!==null;)bv(n,e,t),n=n.sibling}var It=null,Us=!1;function Li(n,e,t){for(t=t.child;t!==null;)EA(n,e,t),t=t.sibling}function EA(n,e,t){if(Er&&typeof Er.onCommitFiberUnmount=="function")try{Er.onCommitFiberUnmount(lm,t)}catch{}switch(t.tag){case 5:Jt||Ul(t,e);case 6:var s=It,r=Us;It=null,Li(n,e,t),It=s,Us=r,It!==null&&(Us?(n=It,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):It.removeChild(t.stateNode));break;case 18:It!==null&&(Us?(n=It,t=t.stateNode,n.nodeType===8?ay(n.parentNode,t):n.nodeType===1&&ay(n,t),Rd(n)):ay(It,t.stateNode));break;case 4:s=It,r=Us,It=t.stateNode.containerInfo,Us=!0,Li(n,e,t),It=s,Us=r;break;case 0:case 11:case 14:case 15:if(!Jt&&(s=t.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&vv(t,e,a),r=r.next}while(r!==s)}Li(n,e,t);break;case 1:if(!Jt&&(Ul(t,e),s=t.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=t.memoizedProps,s.state=t.memoizedState,s.componentWillUnmount()}catch(o){Je(t,e,o)}Li(n,e,t);break;case 21:Li(n,e,t);break;case 22:t.mode&1?(Jt=(s=Jt)||t.memoizedState!==null,Li(n,e,t),Jt=s):Li(n,e,t);break;default:Li(n,e,t)}}function Sb(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new nN),e.forEach(function(s){var r=hN.bind(null,n,s);t.has(s)||(t.add(s),s.then(r,r))})}}function Cs(n,e){var t=e.deletions;if(t!==null)for(var s=0;s<t.length;s++){var r=t[s];try{var i=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:It=o.stateNode,Us=!1;break e;case 3:It=o.stateNode.containerInfo,Us=!0;break e;case 4:It=o.stateNode.containerInfo,Us=!0;break e}o=o.return}if(It===null)throw Error(F(160));EA(i,a,r),It=null,Us=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(u){Je(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)CA(e,n),e=e.sibling}function CA(n,e){var t=n.alternate,s=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Cs(e,n),tr(n),s&4){try{wd(3,n,n.return),mm(3,n)}catch(m){Je(n,n.return,m)}try{wd(5,n,n.return)}catch(m){Je(n,n.return,m)}}break;case 1:Cs(e,n),tr(n),s&512&&t!==null&&Ul(t,t.return);break;case 5:if(Cs(e,n),tr(n),s&512&&t!==null&&Ul(t,t.return),n.flags&32){var r=n.stateNode;try{kd(r,"")}catch(m){Je(n,n.return,m)}}if(s&4&&(r=n.stateNode,r!=null)){var i=n.memoizedProps,a=t!==null?t.memoizedProps:i,o=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&X1(r,i),Gy(o,a);var u=Gy(o,i);for(a=0;a<c.length;a+=2){var d=c[a],h=c[a+1];d==="style"?Z1(r,h):d==="dangerouslySetInnerHTML"?Q1(r,h):d==="children"?kd(r,h):ew(r,d,h,u)}switch(o){case"input":zy(r,i);break;case"textarea":Y1(r,i);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var g=i.value;g!=null?Xl(r,!!i.multiple,g,!1):f!==!!i.multiple&&(i.defaultValue!=null?Xl(r,!!i.multiple,i.defaultValue,!0):Xl(r,!!i.multiple,i.multiple?[]:"",!1))}r[Id]=i}catch(m){Je(n,n.return,m)}}break;case 6:if(Cs(e,n),tr(n),s&4){if(n.stateNode===null)throw Error(F(162));r=n.stateNode,i=n.memoizedProps;try{r.nodeValue=i}catch(m){Je(n,n.return,m)}}break;case 3:if(Cs(e,n),tr(n),s&4&&t!==null&&t.memoizedState.isDehydrated)try{Rd(e.containerInfo)}catch(m){Je(n,n.return,m)}break;case 4:Cs(e,n),tr(n);break;case 13:Cs(e,n),tr(n),r=n.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(Mw=st())),s&4&&Sb(n);break;case 22:if(d=t!==null&&t.memoizedState!==null,n.mode&1?(Jt=(u=Jt)||d,Cs(e,n),Jt=u):Cs(e,n),tr(n),s&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!d&&n.mode&1)for(X=n,d=n.child;d!==null;){for(h=X=d;X!==null;){switch(f=X,g=f.child,f.tag){case 0:case 11:case 14:case 15:wd(4,f,f.return);break;case 1:Ul(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){s=f,t=f.return;try{e=s,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(m){Je(s,t,m)}}break;case 5:Ul(f,f.return);break;case 22:if(f.memoizedState!==null){_b(h);continue}}g!==null?(g.return=f,X=g):_b(h)}d=d.sibling}e:for(d=null,h=n;;){if(h.tag===5){if(d===null){d=h;try{r=h.stateNode,u?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=h.stateNode,c=h.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,o.style.display=J1("display",a))}catch(m){Je(n,n.return,m)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(m){Je(n,n.return,m)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Cs(e,n),tr(n),s&4&&Sb(n);break;case 21:break;default:Cs(e,n),tr(n)}}function tr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(_A(t)){var s=t;break e}t=t.return}throw Error(F(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(kd(r,""),s.flags&=-33);var i=bb(n);bv(n,i,r);break;case 3:case 4:var a=s.stateNode.containerInfo,o=bb(n);xv(n,o,a);break;default:throw Error(F(161))}}catch(c){Je(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function rN(n,e,t){X=n,kA(n)}function kA(n,e,t){for(var s=(n.mode&1)!==0;X!==null;){var r=X,i=r.child;if(r.tag===22&&s){var a=r.memoizedState!==null||ap;if(!a){var o=r.alternate,c=o!==null&&o.memoizedState!==null||Jt;o=ap;var u=Jt;if(ap=a,(Jt=c)&&!u)for(X=r;X!==null;)a=X,c=a.child,a.tag===22&&a.memoizedState!==null?Eb(r):c!==null?(c.return=a,X=c):Eb(r);for(;i!==null;)X=i,kA(i),i=i.sibling;X=r,ap=o,Jt=u}Ab(n)}else r.subtreeFlags&8772&&i!==null?(i.return=r,X=i):Ab(n)}}function Ab(n){for(;X!==null;){var e=X;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Jt||mm(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!Jt)if(t===null)s.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Ns(e.type,t.memoizedProps);s.componentDidUpdate(r,t.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&ob(e,i,s);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}ob(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&Rd(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(F(163))}Jt||e.flags&512&&wv(e)}catch(f){Je(e,e.return,f)}}if(e===n){X=null;break}if(t=e.sibling,t!==null){t.return=e.return,X=t;break}X=e.return}}function _b(n){for(;X!==null;){var e=X;if(e===n){X=null;break}var t=e.sibling;if(t!==null){t.return=e.return,X=t;break}X=e.return}}function Eb(n){for(;X!==null;){var e=X;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{mm(4,e)}catch(c){Je(e,t,c)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(c){Je(e,r,c)}}var i=e.return;try{wv(e)}catch(c){Je(e,i,c)}break;case 5:var a=e.return;try{wv(e)}catch(c){Je(e,a,c)}}}catch(c){Je(e,e.return,c)}if(e===n){X=null;break}var o=e.sibling;if(o!==null){o.return=e.return,X=o;break}X=e.return}}var iN=Math.ceil,_g=ki.ReactCurrentDispatcher,Rw=ki.ReactCurrentOwner,ws=ki.ReactCurrentBatchConfig,xe=0,kt=null,ot=null,zt=0,Xn=0,Hl=Ba(0),mt=0,Ud=null,fl=0,ym=0,Lw=0,xd=null,Sn=null,Mw=0,vu=1/0,Ir=null,Eg=!1,Sv=null,Ta=null,op=!1,Aa=null,Cg=0,bd=0,Av=null,Ep=-1,Cp=0;function dn(){return xe&6?st():Ep!==-1?Ep:Ep=st()}function Pa(n){return n.mode&1?xe&2&&zt!==0?zt&-zt:U2.transition!==null?(Cp===0&&(Cp=dS()),Cp):(n=Ce,n!==0||(n=window.event,n=n===void 0?16:vS(n.type)),n):1}function Ws(n,e,t,s){if(50<bd)throw bd=0,Av=null,Error(F(185));Nf(n,t,s),(!(xe&2)||n!==kt)&&(n===kt&&(!(xe&2)&&(ym|=t),mt===4&&Fi(n,zt)),Cn(n,s),t===1&&xe===0&&!(e.mode&1)&&(vu=st()+500,fm&&Ua()))}function Cn(n,e){var t=n.callbackNode;Uk(n,e);var s=cg(n,n===kt?zt:0);if(s===0)t!==null&&jx(t),n.callbackNode=null,n.callbackPriority=0;else if(e=s&-s,n.callbackPriority!==e){if(t!=null&&jx(t),e===1)n.tag===0?B2(Cb.bind(null,n)):OS(Cb.bind(null,n)),O2(function(){!(xe&6)&&Ua()}),t=null;else{switch(hS(s)){case 1:t=iw;break;case 4:t=cS;break;case 16:t=lg;break;case 536870912:t=uS;break;default:t=lg}t=DA(t,NA.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function NA(n,e){if(Ep=-1,Cp=0,xe&6)throw Error(F(327));var t=n.callbackNode;if(Zl()&&n.callbackNode!==t)return null;var s=cg(n,n===kt?zt:0);if(s===0)return null;if(s&30||s&n.expiredLanes||e)e=kg(n,s);else{e=s;var r=xe;xe|=2;var i=PA();(kt!==n||zt!==e)&&(Ir=null,vu=st()+500,ll(n,e));do try{lN();break}catch(o){TA(n,o)}while(!0);vw(),_g.current=i,xe=r,ot!==null?e=0:(kt=null,zt=0,e=mt)}if(e!==0){if(e===2&&(r=Ky(n),r!==0&&(s=r,e=_v(n,r))),e===1)throw t=Ud,ll(n,0),Fi(n,s),Cn(n,st()),t;if(e===6)Fi(n,s);else{if(r=n.current.alternate,!(s&30)&&!aN(r)&&(e=kg(n,s),e===2&&(i=Ky(n),i!==0&&(s=i,e=_v(n,i))),e===1))throw t=Ud,ll(n,0),Fi(n,s),Cn(n,st()),t;switch(n.finishedWork=r,n.finishedLanes=s,e){case 0:case 1:throw Error(F(345));case 2:Wa(n,Sn,Ir);break;case 3:if(Fi(n,s),(s&130023424)===s&&(e=Mw+500-st(),10<e)){if(cg(n,0)!==0)break;if(r=n.suspendedLanes,(r&s)!==s){dn(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=rv(Wa.bind(null,n,Sn,Ir),e);break}Wa(n,Sn,Ir);break;case 4:if(Fi(n,s),(s&4194240)===s)break;for(e=n.eventTimes,r=-1;0<s;){var a=31-Gs(s);i=1<<a,a=e[a],a>r&&(r=a),s&=~i}if(s=r,s=st()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*iN(s/1960))-s,10<s){n.timeoutHandle=rv(Wa.bind(null,n,Sn,Ir),s);break}Wa(n,Sn,Ir);break;case 5:Wa(n,Sn,Ir);break;default:throw Error(F(329))}}}return Cn(n,st()),n.callbackNode===t?NA.bind(null,n):null}function _v(n,e){var t=xd;return n.current.memoizedState.isDehydrated&&(ll(n,e).flags|=256),n=kg(n,e),n!==2&&(e=Sn,Sn=t,e!==null&&Ev(e)),n}function Ev(n){Sn===null?Sn=n:Sn.push.apply(Sn,n)}function aN(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var s=0;s<t.length;s++){var r=t[s],i=r.getSnapshot;r=r.value;try{if(!qs(i(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Fi(n,e){for(e&=~Lw,e&=~ym,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Gs(e),s=1<<t;n[t]=-1,e&=~s}}function Cb(n){if(xe&6)throw Error(F(327));Zl();var e=cg(n,0);if(!(e&1))return Cn(n,st()),null;var t=kg(n,e);if(n.tag!==0&&t===2){var s=Ky(n);s!==0&&(e=s,t=_v(n,s))}if(t===1)throw t=Ud,ll(n,0),Fi(n,e),Cn(n,st()),t;if(t===6)throw Error(F(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Wa(n,Sn,Ir),Cn(n,st()),null}function jw(n,e){var t=xe;xe|=1;try{return n(e)}finally{xe=t,xe===0&&(vu=st()+500,fm&&Ua())}}function pl(n){Aa!==null&&Aa.tag===0&&!(xe&6)&&Zl();var e=xe;xe|=1;var t=ws.transition,s=Ce;try{if(ws.transition=null,Ce=1,n)return n()}finally{Ce=s,ws.transition=t,xe=e,!(xe&6)&&Ua()}}function Dw(){Xn=Hl.current,$e(Hl)}function ll(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,I2(t)),ot!==null)for(t=ot.return;t!==null;){var s=t;switch(gw(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&pg();break;case 3:mu(),$e(_n),$e(en),_w();break;case 5:Aw(s);break;case 4:mu();break;case 13:$e(qe);break;case 19:$e(qe);break;case 10:ww(s.type._context);break;case 22:case 23:Dw()}t=t.return}if(kt=n,ot=n=Ra(n.current,null),zt=Xn=e,mt=0,Ud=null,Lw=ym=fl=0,Sn=xd=null,Za!==null){for(e=0;e<Za.length;e++)if(t=Za[e],s=t.interleaved,s!==null){t.interleaved=null;var r=s.next,i=t.pending;if(i!==null){var a=i.next;i.next=r,s.next=a}t.pending=s}Za=null}return n}function TA(n,e){do{var t=ot;try{if(vw(),Sp.current=Ag,Sg){for(var s=Xe.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Sg=!1}if(hl=0,Et=ft=Xe=null,vd=!1,$d=0,Rw.current=null,t===null||t.return===null){mt=1,Ud=e,ot=null;break}e:{var i=n,a=t.return,o=t,c=e;if(e=zt,o.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=o,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var g=fb(a);if(g!==null){g.flags&=-257,pb(g,a,o,i,e),g.mode&1&&hb(i,u,e),e=g,c=u;var y=e.updateQueue;if(y===null){var m=new Set;m.add(c),e.updateQueue=m}else y.add(c);break e}else{if(!(e&1)){hb(i,u,e),Iw();break e}c=Error(F(426))}}else if(He&&o.mode&1){var b=fb(a);if(b!==null){!(b.flags&65536)&&(b.flags|=256),pb(b,a,o,i,e),mw(yu(c,o));break e}}i=c=yu(c,o),mt!==4&&(mt=2),xd===null?xd=[i]:xd.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var w=hA(i,c,e);ab(i,w);break e;case 1:o=c;var x=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Ta===null||!Ta.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var E=fA(i,o,e);ab(i,E);break e}}i=i.return}while(i!==null)}LA(t)}catch(C){e=C,ot===t&&t!==null&&(ot=t=t.return);continue}break}while(!0)}function PA(){var n=_g.current;return _g.current=Ag,n===null?Ag:n}function Iw(){(mt===0||mt===3||mt===2)&&(mt=4),kt===null||!(fl&268435455)&&!(ym&268435455)||Fi(kt,zt)}function kg(n,e){var t=xe;xe|=2;var s=PA();(kt!==n||zt!==e)&&(Ir=null,ll(n,e));do try{oN();break}catch(r){TA(n,r)}while(!0);if(vw(),xe=t,_g.current=s,ot!==null)throw Error(F(261));return kt=null,zt=0,mt}function oN(){for(;ot!==null;)RA(ot)}function lN(){for(;ot!==null&&!Mk();)RA(ot)}function RA(n){var e=jA(n.alternate,n,Xn);n.memoizedProps=n.pendingProps,e===null?LA(n):ot=e,Rw.current=null}function LA(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=tN(t,e),t!==null){t.flags&=32767,ot=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{mt=6,ot=null;return}}else if(t=eN(t,e,Xn),t!==null){ot=t;return}if(e=e.sibling,e!==null){ot=e;return}ot=e=n}while(e!==null);mt===0&&(mt=5)}function Wa(n,e,t){var s=Ce,r=ws.transition;try{ws.transition=null,Ce=1,cN(n,e,t,s)}finally{ws.transition=r,Ce=s}return null}function cN(n,e,t,s){do Zl();while(Aa!==null);if(xe&6)throw Error(F(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(F(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(Hk(n,i),n===kt&&(ot=kt=null,zt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||op||(op=!0,DA(lg,function(){return Zl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=ws.transition,ws.transition=null;var a=Ce;Ce=1;var o=xe;xe|=4,Rw.current=null,sN(n,t),CA(t,n),T2(nv),ug=!!tv,nv=tv=null,n.current=t,rN(t),jk(),xe=o,Ce=a,ws.transition=i}else n.current=t;if(op&&(op=!1,Aa=n,Cg=r),i=n.pendingLanes,i===0&&(Ta=null),Ok(t.stateNode),Cn(n,st()),e!==null)for(s=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],s(r.value,{componentStack:r.stack,digest:r.digest});if(Eg)throw Eg=!1,n=Sv,Sv=null,n;return Cg&1&&n.tag!==0&&Zl(),i=n.pendingLanes,i&1?n===Av?bd++:(bd=0,Av=n):bd=0,Ua(),null}function Zl(){if(Aa!==null){var n=hS(Cg),e=ws.transition,t=Ce;try{if(ws.transition=null,Ce=16>n?16:n,Aa===null)var s=!1;else{if(n=Aa,Aa=null,Cg=0,xe&6)throw Error(F(331));var r=xe;for(xe|=4,X=n.current;X!==null;){var i=X,a=i.child;if(X.flags&16){var o=i.deletions;if(o!==null){for(var c=0;c<o.length;c++){var u=o[c];for(X=u;X!==null;){var d=X;switch(d.tag){case 0:case 11:case 15:wd(8,d,i)}var h=d.child;if(h!==null)h.return=d,X=h;else for(;X!==null;){d=X;var f=d.sibling,g=d.return;if(AA(d),d===u){X=null;break}if(f!==null){f.return=g,X=f;break}X=g}}}var y=i.alternate;if(y!==null){var m=y.child;if(m!==null){y.child=null;do{var b=m.sibling;m.sibling=null,m=b}while(m!==null)}}X=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,X=a;else e:for(;X!==null;){if(i=X,i.flags&2048)switch(i.tag){case 0:case 11:case 15:wd(9,i,i.return)}var w=i.sibling;if(w!==null){w.return=i.return,X=w;break e}X=i.return}}var x=n.current;for(X=x;X!==null;){a=X;var S=a.child;if(a.subtreeFlags&2064&&S!==null)S.return=a,X=S;else e:for(a=x;X!==null;){if(o=X,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:mm(9,o)}}catch(C){Je(o,o.return,C)}if(o===a){X=null;break e}var E=o.sibling;if(E!==null){E.return=o.return,X=E;break e}X=o.return}}if(xe=r,Ua(),Er&&typeof Er.onPostCommitFiberRoot=="function")try{Er.onPostCommitFiberRoot(lm,n)}catch{}s=!0}return s}finally{Ce=t,ws.transition=e}}return!1}function kb(n,e,t){e=yu(t,e),e=hA(n,e,1),n=Na(n,e,1),e=dn(),n!==null&&(Nf(n,1,e),Cn(n,e))}function Je(n,e,t){if(n.tag===3)kb(n,n,t);else for(;e!==null;){if(e.tag===3){kb(e,n,t);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Ta===null||!Ta.has(s))){n=yu(t,n),n=fA(e,n,1),e=Na(e,n,1),n=dn(),e!==null&&(Nf(e,1,n),Cn(e,n));break}}e=e.return}}function uN(n,e,t){var s=n.pingCache;s!==null&&s.delete(e),e=dn(),n.pingedLanes|=n.suspendedLanes&t,kt===n&&(zt&t)===t&&(mt===4||mt===3&&(zt&130023424)===zt&&500>st()-Mw?ll(n,0):Lw|=t),Cn(n,e)}function MA(n,e){e===0&&(n.mode&1?(e=Qf,Qf<<=1,!(Qf&130023424)&&(Qf=4194304)):e=1);var t=dn();n=Si(n,e),n!==null&&(Nf(n,e,t),Cn(n,t))}function dN(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),MA(n,t)}function hN(n,e){var t=0;switch(n.tag){case 13:var s=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:s=n.stateNode;break;default:throw Error(F(314))}s!==null&&s.delete(e),MA(n,t)}var jA;jA=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||_n.current)An=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return An=!1,Z2(n,e,t);An=!!(n.flags&131072)}else An=!1,He&&e.flags&1048576&&FS(e,yg,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;_p(n,e),n=e.pendingProps;var r=fu(e,en.current);Jl(e,t),r=Cw(null,e,s,n,r,t);var i=kw();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,En(s)?(i=!0,gg(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,bw(e),r.updater=gm,e.stateNode=r,r._reactInternals=e,dv(e,s,n,t),e=pv(null,e,s,!0,i,t)):(e.tag=0,He&&i&&pw(e),cn(null,e,r,t),e=e.child),e;case 16:s=e.elementType;e:{switch(_p(n,e),n=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=pN(s),n=Ns(s,n),r){case 0:e=fv(null,e,s,n,t);break e;case 1:e=yb(null,e,s,n,t);break e;case 11:e=gb(null,e,s,n,t);break e;case 14:e=mb(null,e,s,Ns(s.type,n),t);break e}throw Error(F(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ns(s,r),fv(n,e,s,r,t);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ns(s,r),yb(n,e,s,r,t);case 3:e:{if(yA(e),n===null)throw Error(F(387));s=e.pendingProps,i=e.memoizedState,r=i.element,VS(n,e),xg(e,s,null,t);var a=e.memoizedState;if(s=a.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=yu(Error(F(423)),e),e=vb(n,e,s,t,r);break e}else if(s!==r){r=yu(Error(F(424)),e),e=vb(n,e,s,t,r);break e}else for(Qn=ka(e.stateNode.containerInfo.firstChild),Jn=e,He=!0,Hs=null,t=US(e,null,s,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(pu(),s===r){e=Ai(n,e,t);break e}cn(n,e,s,t)}e=e.child}return e;case 5:return GS(e),n===null&&lv(e),s=e.type,r=e.pendingProps,i=n!==null?n.memoizedProps:null,a=r.children,sv(s,r)?a=null:i!==null&&sv(s,i)&&(e.flags|=32),mA(n,e),cn(n,e,a,t),e.child;case 6:return n===null&&lv(e),null;case 13:return vA(n,e,t);case 4:return Sw(e,e.stateNode.containerInfo),s=e.pendingProps,n===null?e.child=gu(e,null,s,t):cn(n,e,s,t),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ns(s,r),gb(n,e,s,r,t);case 7:return cn(n,e,e.pendingProps,t),e.child;case 8:return cn(n,e,e.pendingProps.children,t),e.child;case 12:return cn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,a=r.value,De(vg,s._currentValue),s._currentValue=a,i!==null)if(qs(i.value,a)){if(i.children===r.children&&!_n.current){e=Ai(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var c=o.firstContext;c!==null;){if(c.context===s){if(i.tag===1){c=yi(-1,t&-t),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=t,c=i.alternate,c!==null&&(c.lanes|=t),cv(i.return,t,e),o.lanes|=t;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(F(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),cv(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}cn(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,Jl(e,t),r=bs(r),s=s(r),e.flags|=1,cn(n,e,s,t),e.child;case 14:return s=e.type,r=Ns(s,e.pendingProps),r=Ns(s.type,r),mb(n,e,s,r,t);case 15:return pA(n,e,e.type,e.pendingProps,t);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ns(s,r),_p(n,e),e.tag=1,En(s)?(n=!0,gg(e)):n=!1,Jl(e,t),dA(e,s,r),dv(e,s,r,t),pv(null,e,s,!0,n,t);case 19:return wA(n,e,t);case 22:return gA(n,e,t)}throw Error(F(156,e.tag))};function DA(n,e){return lS(n,e)}function fN(n,e,t,s){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vs(n,e,t,s){return new fN(n,e,t,s)}function Ow(n){return n=n.prototype,!(!n||!n.isReactComponent)}function pN(n){if(typeof n=="function")return Ow(n)?1:0;if(n!=null){if(n=n.$$typeof,n===nw)return 11;if(n===sw)return 14}return 2}function Ra(n,e){var t=n.alternate;return t===null?(t=vs(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function kp(n,e,t,s,r,i){var a=2;if(s=n,typeof n=="function")Ow(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Ml:return cl(t.children,r,i,e);case tw:a=8,r|=8;break;case Dy:return n=vs(12,t,e,r|2),n.elementType=Dy,n.lanes=i,n;case Iy:return n=vs(13,t,e,r),n.elementType=Iy,n.lanes=i,n;case Oy:return n=vs(19,t,e,r),n.elementType=Oy,n.lanes=i,n;case G1:return vm(t,r,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case H1:a=10;break e;case V1:a=9;break e;case nw:a=11;break e;case sw:a=14;break e;case ji:a=16,s=null;break e}throw Error(F(130,n==null?n:typeof n,""))}return e=vs(a,t,e,r),e.elementType=n,e.type=s,e.lanes=i,e}function cl(n,e,t,s){return n=vs(7,n,s,e),n.lanes=t,n}function vm(n,e,t,s){return n=vs(22,n,s,e),n.elementType=G1,n.lanes=t,n.stateNode={isHidden:!1},n}function py(n,e,t){return n=vs(6,n,null,e),n.lanes=t,n}function gy(n,e,t){return e=vs(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function gN(n,e,t,s,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ym(0),this.expirationTimes=Ym(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ym(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Fw(n,e,t,s,r,i,a,o,c){return n=new gN(n,e,t,o,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=vs(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:s,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},bw(i),n}function mN(n,e,t){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ll,key:s==null?null:""+s,children:n,containerInfo:e,implementation:t}}function IA(n){if(!n)return Ma;n=n._reactInternals;e:{if(vl(n)!==n||n.tag!==1)throw Error(F(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(En(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(F(171))}if(n.tag===1){var t=n.type;if(En(t))return IS(n,t,e)}return e}function OA(n,e,t,s,r,i,a,o,c){return n=Fw(t,s,!0,n,r,i,a,o,c),n.context=IA(null),t=n.current,s=dn(),r=Pa(t),i=yi(s,r),i.callback=e??null,Na(t,i,r),n.current.lanes=r,Nf(n,r,s),Cn(n,s),n}function wm(n,e,t,s){var r=e.current,i=dn(),a=Pa(r);return t=IA(t),e.context===null?e.context=t:e.pendingContext=t,e=yi(i,a),e.payload={element:n},s=s===void 0?null:s,s!==null&&(e.callback=s),n=Na(r,e,a),n!==null&&(Ws(n,r,a,i),bp(n,r,a)),a}function Ng(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Nb(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function $w(n,e){Nb(n,e),(n=n.alternate)&&Nb(n,e)}function yN(){return null}var FA=typeof reportError=="function"?reportError:function(n){console.error(n)};function zw(n){this._internalRoot=n}xm.prototype.render=zw.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(F(409));wm(n,e,null,null)};xm.prototype.unmount=zw.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;pl(function(){wm(null,n,null,null)}),e[bi]=null}};function xm(n){this._internalRoot=n}xm.prototype.unstable_scheduleHydration=function(n){if(n){var e=gS();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Oi.length&&e!==0&&e<Oi[t].priority;t++);Oi.splice(t,0,n),t===0&&yS(n)}};function Bw(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function bm(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Tb(){}function vN(n,e,t,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var u=Ng(a);i.call(u)}}var a=OA(e,s,n,0,null,!1,!1,"",Tb);return n._reactRootContainer=a,n[bi]=a.current,jd(n.nodeType===8?n.parentNode:n),pl(),a}for(;r=n.lastChild;)n.removeChild(r);if(typeof s=="function"){var o=s;s=function(){var u=Ng(c);o.call(u)}}var c=Fw(n,0,!1,null,null,!1,!1,"",Tb);return n._reactRootContainer=c,n[bi]=c.current,jd(n.nodeType===8?n.parentNode:n),pl(function(){wm(e,c,t,s)}),c}function Sm(n,e,t,s,r){var i=t._reactRootContainer;if(i){var a=i;if(typeof r=="function"){var o=r;r=function(){var c=Ng(a);o.call(c)}}wm(e,a,n,r)}else a=vN(t,e,n,r,s);return Ng(a)}fS=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Wu(e.pendingLanes);t!==0&&(aw(e,t|1),Cn(e,st()),!(xe&6)&&(vu=st()+500,Ua()))}break;case 13:pl(function(){var s=Si(n,1);if(s!==null){var r=dn();Ws(s,n,1,r)}}),$w(n,1)}};ow=function(n){if(n.tag===13){var e=Si(n,134217728);if(e!==null){var t=dn();Ws(e,n,134217728,t)}$w(n,134217728)}};pS=function(n){if(n.tag===13){var e=Pa(n),t=Si(n,e);if(t!==null){var s=dn();Ws(t,n,e,s)}$w(n,e)}};gS=function(){return Ce};mS=function(n,e){var t=Ce;try{return Ce=n,e()}finally{Ce=t}};qy=function(n,e,t){switch(e){case"input":if(zy(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var s=t[e];if(s!==n&&s.form===n.form){var r=hm(s);if(!r)throw Error(F(90));q1(s),zy(s,r)}}}break;case"textarea":Y1(n,t);break;case"select":e=t.value,e!=null&&Xl(n,!!t.multiple,e,!1)}};nS=jw;sS=pl;var wN={usingClientEntryPoint:!1,Events:[Pf,Ol,hm,eS,tS,jw]},Fu={findFiberByHostInstance:Ja,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},xN={bundleType:Fu.bundleType,version:Fu.version,rendererPackageName:Fu.rendererPackageName,rendererConfig:Fu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ki.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=aS(n),n===null?null:n.stateNode},findFiberByHostInstance:Fu.findFiberByHostInstance||yN,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lp.isDisabled&&lp.supportsFiber)try{lm=lp.inject(xN),Er=lp}catch{}}ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wN;ts.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bw(e))throw Error(F(200));return mN(n,e,null,t)};ts.createRoot=function(n,e){if(!Bw(n))throw Error(F(299));var t=!1,s="",r=FA;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Fw(n,1,!1,null,null,t,!1,s,r),n[bi]=e.current,jd(n.nodeType===8?n.parentNode:n),new zw(e)};ts.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(F(188)):(n=Object.keys(n).join(","),Error(F(268,n)));return n=aS(e),n=n===null?null:n.stateNode,n};ts.flushSync=function(n){return pl(n)};ts.hydrate=function(n,e,t){if(!bm(e))throw Error(F(200));return Sm(null,n,e,!0,t)};ts.hydrateRoot=function(n,e,t){if(!Bw(n))throw Error(F(405));var s=t!=null&&t.hydratedSources||null,r=!1,i="",a=FA;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=OA(e,null,n,1,t??null,r,!1,i,a),n[bi]=e.current,jd(n),s)for(n=0;n<s.length;n++)t=s[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new xm(e)};ts.render=function(n,e,t){if(!bm(e))throw Error(F(200));return Sm(null,n,e,!1,t)};ts.unmountComponentAtNode=function(n){if(!bm(n))throw Error(F(40));return n._reactRootContainer?(pl(function(){Sm(null,null,n,!1,function(){n._reactRootContainer=null,n[bi]=null})}),!0):!1};ts.unstable_batchedUpdates=jw;ts.unstable_renderSubtreeIntoContainer=function(n,e,t,s){if(!bm(t))throw Error(F(200));if(n==null||n._reactInternals===void 0)throw Error(F(38));return Sm(n,e,t,!1,s)};ts.version="18.3.1-next-f1338f8080-20240426";function $A(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE($A)}catch(n){console.error(n)}}$A(),$1.exports=ts;var Vl=$1.exports,Pb=Vl;My.createRoot=Pb.createRoot,My.hydrateRoot=Pb.hydrateRoot;const bN={},Rb=n=>{let e;const t=new Set,s=(d,h)=>{const f=typeof d=="function"?d(e):d;if(!Object.is(f,e)){const g=e;e=h??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(y=>y(e,g))}},r=()=>e,c={setState:s,getState:r,getInitialState:()=>u,subscribe:d=>(t.add(d),()=>t.delete(d)),destroy:()=>{(bN?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},u=e=n(s,r,c);return c},SN=n=>n?Rb(n):Rb;var zA={exports:{}},BA={},UA={exports:{}},HA={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wu=T;function AN(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var _N=typeof Object.is=="function"?Object.is:AN,EN=wu.useState,CN=wu.useEffect,kN=wu.useLayoutEffect,NN=wu.useDebugValue;function TN(n,e){var t=e(),s=EN({inst:{value:t,getSnapshot:e}}),r=s[0].inst,i=s[1];return kN(function(){r.value=t,r.getSnapshot=e,my(r)&&i({inst:r})},[n,t,e]),CN(function(){return my(r)&&i({inst:r}),n(function(){my(r)&&i({inst:r})})},[n]),NN(t),t}function my(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!_N(n,t)}catch{return!0}}function PN(n,e){return e()}var RN=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?PN:TN;HA.useSyncExternalStore=wu.useSyncExternalStore!==void 0?wu.useSyncExternalStore:RN;UA.exports=HA;var LN=UA.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Am=T,MN=LN;function jN(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var DN=typeof Object.is=="function"?Object.is:jN,IN=MN.useSyncExternalStore,ON=Am.useRef,FN=Am.useEffect,$N=Am.useMemo,zN=Am.useDebugValue;BA.useSyncExternalStoreWithSelector=function(n,e,t,s,r){var i=ON(null);if(i.current===null){var a={hasValue:!1,value:null};i.current=a}else a=i.current;i=$N(function(){function c(g){if(!u){if(u=!0,d=g,g=s(g),r!==void 0&&a.hasValue){var y=a.value;if(r(y,g))return h=y}return h=g}if(y=h,DN(d,g))return y;var m=s(g);return r!==void 0&&r(y,m)?(d=g,y):(d=g,h=m)}var u=!1,d,h,f=t===void 0?null:t;return[function(){return c(e())},f===null?void 0:function(){return c(f())}]},[e,t,s,r]);var o=IN(n,i[0],i[1]);return FN(function(){a.hasValue=!0,a.value=o},[o]),zN(o),o};zA.exports=BA;var BN=zA.exports;const UN=q0(BN),VA={},{useDebugValue:HN}=gt,{useSyncExternalStoreWithSelector:VN}=UN;let Lb=!1;const GN=n=>n;function WN(n,e=GN,t){(VA?"production":void 0)!=="production"&&t&&!Lb&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Lb=!0);const s=VN(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return HN(s),s}const Mb=n=>{(VA?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof n=="function"?SN(n):n,t=(s,r)=>WN(e,s,r);return Object.assign(t,e),t},qN=n=>n?Mb(n):Mb,ee="http://localhost:8000/api/v1",we={async getComponents(){const n=await fetch(`${ee}/components/`);if(!n.ok)throw new Error("Failed to fetch components");return n.json()},async getLinks(){const n=await fetch(`${ee}/links/`);if(!n.ok)throw new Error("Failed to fetch links");return n.json()},async createComponent(n){const e=await fetch(`${ee}/components/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok)throw new Error("Failed to create component");return e.json()},async createLink(n){const e=await fetch(`${ee}/links/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok)throw new Error("Failed to create link");return e.json()},async updateComponent(n,e){const t=await fetch(`${ee}/components/${n}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Failed to update component");return t.json()},async deleteComponent(n){if(!(await fetch(`${ee}/components/${n}`,{method:"DELETE"})).ok)throw new Error("Failed to delete component")},async getPlan(n,e){let t;if(e!=null&&e.sessionId){const s=`${ee}/odl/sessions/${encodeURIComponent(e.sessionId)}/plan?command=${encodeURIComponent(n)}`;t=await fetch(s)}else t=await fetch(`${ee}/ai/plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:n})});if(!t.ok){const s=await t.text();throw new Error(`Plan endpoint error ${t.status}: ${s.slice(0,120)}`)}return t.json()},async analyzeDesign(n,e){const t=await fetch(`${ee}/ai/analyze-design`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:e,snapshot:n})});if(!t.ok)throw new Error(`Analyze failed: ${t.status}`);return t.json()},async act(n,e,t,s){const r=await fetch(`${ee}/odl/sessions/${encodeURIComponent(n)}/act`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_id:e,action:t,version:s,graph_version:s})});if(!r.ok){const i=await r.text(),a=new Error(`Act endpoint error ${r.status}: ${i.slice(0,120)}`);throw a.status=r.status,a.detail=i,a}return r.json()},async createOdlSession(n){const e=await fetch(`${ee}/odl/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n?{session_id:n}:{})});if(!e.ok){const t=await e.text();throw new Error(`Create session error ${e.status}: ${t.slice(0,200)}`)}return e.json()},async getPlanForSession(n,e){const t=await fetch(`${ee}/odl/sessions/${encodeURIComponent(n)}/plan?command=${encodeURIComponent(e)}`);if(!t.ok){const r=await t.text();throw new Error(`Plan session error ${t.status}: ${r.slice(0,200)}`)}const s=await t.json();return Array.isArray(s)?{tasks:s}:s},async sendCommandToAI(n){const e=await fetch(`${ee}/ai/command`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:n})});if(!e.ok){const t=await e.text();throw new Error(`AI endpoint error ${e.status}: ${t.slice(0,120)}`)}return e.json()},async postRequirements(n,e){const t=await fetch(`${ee}/odl/sessions/${encodeURIComponent(n)}/requirements`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({requirements:e})});if(!t.ok)throw new Error(`Requirements update failed: ${t.status}`)},async ingestComponent(n){const e=await fetch(`${ee}/components/ingest`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok)throw new Error(`Component ingest failed: ${e.status}`);return e.json()},async revertToVersion(n,e){const t=await fetch(`${ee}/odl/sessions/${encodeURIComponent(n)}/revert`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target_version:e})});if(!t.ok)throw new Error(`Revert failed: ${t.status}`);const s=await t.json();return{detail:s.message,version:s.current_version}},async listAgentTasks(){const n=await fetch(`${ee}/odl/agents`);if(!n.ok)throw new Error(`List tasks failed: ${n.status}`);return n.json()},async listTenantAgentState(n){const e=n?`/api/v1/odl/agents/state?tenant_id=${encodeURIComponent(n)}`:"/api/v1/odl/agents/state",t=await fetch(e);if(!t.ok)throw new Error("Failed to list tenant agent state");return t.json()},async createAgentDraft(n){const e=await fetch("/api/v1/odl/agents/drafts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spec:n})});if(!e.ok)throw new Error("Failed to create draft");return e.json()},async publishAgent(n,e,t){const s=await fetch(`/api/v1/odl/agents/${encodeURIComponent(n)}/publish`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({version:e,notes:t})});if(!s.ok)throw new Error("Failed to publish agent");return s.json()},async updateTenantAgentState(n,e,t){const s=`/api/v1/odl/agents/${encodeURIComponent(n)}/state${t?`?tenant_id=${encodeURIComponent(t)}`:""}`,r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error("Failed to update tenant agent state");return r.json()},async assistSynthesizeSpec(n,e,t){const s=await fetch("/api/v1/odl/agents/assist/synthesize-spec",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idea:n,target_domain:e,target_actions:t})});if(!s.ok)throw new Error("Failed to synthesize spec");return s.json()},async assistRefineSpec(n,e){const t=await fetch("/api/v1/odl/agents/assist/refine-spec",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({current_spec:n,critique:e})});if(!t.ok)throw new Error("Failed to refine spec");return t.json()},async listApprovals(n={}){const e=new URLSearchParams;n.status&&e.set("status",n.status),n.session_id&&e.set("session_id",n.session_id),n.project_id&&e.set("project_id",n.project_id),n.limit&&e.set("limit",String(n.limit)),n.offset&&e.set("offset",String(n.offset));const t=await fetch(`/api/v1/approvals/?${e.toString()}`);if(!t.ok)throw new Error("Failed to list approvals");return t.json()},async approveApproval(n,e,t=!1){const s=await fetch(`/api/v1/approvals/${n}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:e,approve_and_apply:t})});if(!s.ok)throw new Error("Failed to approve");return s.json()},async rejectApproval(n,e){const t=await fetch(`/api/v1/approvals/${n}/reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:e})});if(!t.ok)throw new Error("Failed to reject");return t.json()},async getApprovalDiff(n){const e=await fetch(`/api/v1/approvals/${n}/diff`);if(!e.ok)throw new Error("Failed to get diff");return e.json()},async getTenantPolicy(){const n=await fetch("/api/v1/tenant/settings");if(!n.ok)throw new Error("Failed to load tenant policy");return n.json()},async updateTenantPolicy(n){const e=await fetch("/api/v1/tenant/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok){const t=await e.text();throw new Error(t||"Failed to update tenant policy")}return e.json()},async testTenantPolicy(n){const e=await fetch("/api/v1/tenant/settings/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok)throw new Error("Failed to test policy");return e.json()},async postSessionAct(n,e){const t=await fetch(`/api/v1/odl/sessions/${encodeURIComponent(n)}/act`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Failed to apply approved action");return t.json()},listAgents:async()=>{const n=await fetch(`${ee}/agents`);if(!n.ok)throw new Error("Failed to list agents");const e=await n.json();return Array.isArray(e)?e:(e==null?void 0:e.agents)??[]},getAgent:async n=>{const e=await fetch(`${ee}/agents/${encodeURIComponent(n)}`);if(!e.ok)throw new Error(`Failed to get agent ${n}`);return e.json()},enableAgent:async n=>{if(!(await fetch(`${ee}/agents/${encodeURIComponent(n)}/enable`,{method:"POST"})).ok)throw new Error("Failed to enable agent")},disableAgent:async n=>{if(!(await fetch(`${ee}/agents/${encodeURIComponent(n)}/disable`,{method:"POST"})).ok)throw new Error("Failed to disable agent")},registerAgent:async n=>{if(!(await fetch(`${ee}/agents/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)throw new Error("Failed to register agent")},async getRequirementsStatus(n){const e=await fetch(`${ee}/odl/sessions/${encodeURIComponent(n)}/analysis`);if(!e.ok)throw new Error(`Requirements status failed: ${e.status}`);return e.json()},async getOdlText(n){const e=await fetch(`${ee}/odl/sessions/${encodeURIComponent(n)}/text`);if(!e.ok)throw new Error(`Get ODL text failed: ${e.status}`);return e.json()},async selectComponent(n,e,t){const s=await fetch(`${ee}/odl/sessions/${encodeURIComponent(n)}/select-component`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({placeholder_id:e,component:t,apply_to_all_similar:!1})});if(!s.ok)throw new Error(`Component selection failed: ${s.status}`);return s.json()},async getSessionVersions(n){const e=await fetch(`${ee}/odl/sessions/${encodeURIComponent(n)}/versions`);if(!e.ok)throw new Error(`Get versions failed: ${e.status}`);return e.json()}};function Ha(n={}){const e=typeof window<"u"?localStorage.getItem("access_token"):null;return e?{...n,Authorization:`Bearer ${e}`}:n}async function Uw(n,e){return new Promise((t,s)=>{const r=new XMLHttpRequest,i=new FormData;i.append("file",n),r.upload.onprogress=o=>{o.lengthComputable&&e(Math.round(o.loaded/o.total*100))},r.onload=()=>{if(r.status>=200&&r.status<300)t(JSON.parse(r.responseText));else{const o=r.getResponseHeader("Content-Type")||"";let c=`${r.status} ${r.statusText}`;if(o.includes("application/json"))try{const d=JSON.parse(r.responseText);d&&d.detail&&(c=`${r.status}: ${d.detail}`)}catch{}const u=new Error(c);u.status=r.status,u.responseText=r.responseText,s(u)}},r.onerror=()=>{const o=new Error("Network error during upload");o.status=0,s(o)},r.open("POST",`${ee}/files/upload`);const a=typeof window<"u"?localStorage.getItem("access_token"):null;a&&r.setRequestHeader("Authorization",`Bearer ${a}`),r.send(i)})}async function XN(){const n=await fetch(`${ee}/files/`,{headers:Ha()});if(!n.ok)throw new Error("Failed to fetch files");return n.json()}async function Hw(n){const e=await fetch(`${ee}/files/${n}/parse`,{method:"POST",headers:Ha({"Content-Type":"application/json"}),body:"{}"});if(!e.ok){const t=await e.json();throw new Error(t.detail||"Failed to parse datasheet")}return e.json()}async function Hd(n){const e=await fetch(`${ee}/files/${n}`,{headers:Ha()});if(!e.ok){const t=await e.json();throw new Error(t.detail||"Failed to fetch status")}return e.json()}async function YN(n,e,t){const s={parsed_payload:e};s.is_human_verified=t;const r=await fetch(`${ee}/files/${n}`,{method:"PATCH",headers:Ha({"Content-Type":"application/json"}),body:JSON.stringify(s)});if(!r.ok){const i=await r.json();throw new Error(i.detail||"Failed to save datasheet")}return r.json()}async function KN(n){const e=await fetch(`${ee}/files/${n}/images`,{headers:Ha()});if(!e.ok){const t=await e.json();throw new Error(t.detail||"Failed to list images")}return e.json()}async function QN(n,e){const t=new FormData;e.forEach(r=>{t.append("files",r)});const s=await fetch(`${ee}/files/${n}/images`,{method:"POST",headers:Ha(),body:t});if(!s.ok){const r=await s.json();throw new Error(r.detail||"Failed to upload images")}return s.json()}async function JN(n,e){const t=await fetch(`${ee}/files/${n}/images/${e}`,{method:"DELETE",headers:Ha()});if(!t.ok){const s=await t.json();throw new Error(s.detail||"Failed to delete image")}}async function ZN(n,e){const t=await fetch(`${ee}/files/${n}/images/${e}/primary`,{method:"PATCH",headers:Ha({"Content-Type":"application/json"}),body:"{}"});if(!t.ok){const s=await t.json();throw new Error(s.detail||"Failed to set primary image")}}const z=qN((n,e)=>({canvasComponents:[],links:[],ghostLinks:[],bomItems:null,selectedComponentId:null,messages:[],sessionId:typeof window<"u"&&localStorage.getItem("of_session_id")||"global",setSessionId:t=>{try{typeof window<"u"&&localStorage.setItem("of_session_id",t)}catch{}n({sessionId:t})},graphVersion:0,setGraphVersion:t=>n({graphVersion:t}),async syncGraphVersion(t){try{if(!t)return;const{version:s}=await we.getOdlText(t);typeof s=="number"&&n({graphVersion:s})}catch(s){console.warn("Failed to sync graph version",s)}},planTasks:[],setPlanTasks:t=>n({planTasks:t}),updatePlanTaskStatus:(t,s)=>n(r=>({planTasks:r.planTasks.map(i=>i.id===t?{...i,status:s}:i)})),clearPlanTasks:()=>n({planTasks:[]}),async performPlanTask(t){const s=e().sessionId||"global",r=a=>{if(!a)return;a.add_nodes&&n(u=>({canvasComponents:[...u.canvasComponents,...a.add_nodes.map(d=>{var h;return{id:d.id,name:((h=d.data)==null?void 0:h.label)??d.type,type:d.type,x:Math.random()*500,y:Math.random()*300,ports:[{id:"input",type:"in"},{id:"output",type:"out"}]}})]})),a.add_edges&&n(u=>({links:[...u.links,...a.add_edges.map(d=>({id:`${d.source}_${d.target}_${crypto.randomUUID()}`,source_id:d.source,target_id:d.target}))]}));const o=a.remove_nodes??a.removed_nodes;o&&o.length&&n(u=>({canvasComponents:u.canvasComponents.filter(d=>!o.includes(d.id)),links:u.links.filter(d=>!o.includes(d.source_id)&&!o.includes(d.target_id))}));const c=a.remove_edges??a.removed_edges;c&&c.length&&n(u=>({links:u.links.filter(d=>!c.some(h=>h.source===d.source_id&&h.target===d.target_id))}))},i=async(a=!1)=>{var o,c;try{const{patch:u,card:d,status:h,version:f}=await we.act(s,t.id,void 0,e().graphVersion);typeof f=="number"&&n({graphVersion:f}),r(u),d&&e().addMessage({id:crypto.randomUUID(),author:"AI",text:d.title,card:{title:d.title,description:d.description,imageUrl:d.image_url,specs:(o=d.specs)==null?void 0:o.map(y=>({label:y.label,value:y.value})),actions:(c=d.actions)==null?void 0:c.map(y=>({label:y.label,command:y.command}))},type:"card"});const g=h||"complete";e().updatePlanTaskStatus(t.id,g);try{const y=await we.getPlanForSession(s,e().lastPrompt||"design");y.tasks&&Array.isArray(y.tasks)&&n({planTasks:y.tasks}),await e().syncGraphVersion(s)}catch(y){console.warn("Failed to refresh plan after act",y)}return g}catch(u){if(!a&&u.status===409){e().addStatusMessage("The design has changed—refreshing…","warning");let d;const h=String(u.detail||"").match(/server has (\d+)/);h&&(d=parseInt(h[1],10)),d!==void 0&&n({graphVersion:d});try{const f=await we.getPlanForSession(s,e().lastPrompt||"design");f.tasks&&Array.isArray(f.tasks)&&n({planTasks:f.tasks}),await e().syncGraphVersion(s)}catch{}return await i(!0)}return console.error("Failed to perform plan task",u),e().updatePlanTaskStatus(t.id,"blocked"),e().addStatusMessage("Failed to perform task","error"),"blocked"}};e().updatePlanTaskStatus(t.id,"in_progress"),n({isAiProcessing:!0});try{return await i(!1)}finally{n({isAiProcessing:!1})}},requirements:{},async updateRequirements(t){const s={...e().requirements,...t};n({requirements:s});try{const r=e().sessionId;if(r&&await we.postRequirements(r,s),r){const i=await we.getPlanForSession(r,e().lastPrompt||"design");i.tasks&&Array.isArray(i.tasks)&&n({planTasks:i.tasks}),await e().syncGraphVersion(r)}}catch(r){console.error("Failed to update requirements",r)}},quickActions:[],setQuickActions:t=>n({quickActions:t}),currentMode:"design",setCurrentMode:t=>n({currentMode:t}),lastPrompt:"",status:"loading",statusMessages:[],chatMode:"default",isAiProcessing:!1,costTotal:null,setCostTotal:t=>n({costTotal:t}),performanceMetrics:{annualKwh:null},setPerformanceMetrics:t=>n({performanceMetrics:t}),datasheetDirty:!1,setDatasheetDirty:t=>n({datasheetDirty:t}),history:[],historyIndex:-1,recordHistory:()=>{const t=e(),s={components:t.canvasComponents.map(r=>({...r})),links:t.links.map(r=>({...r}))};n(r=>{const i=r.history.slice(0,r.historyIndex+1);return{history:[...i,s],historyIndex:i.length}})},undo:()=>{const t=e();if(t.historyIndex<=0)return;const s=t.historyIndex-1,r=t.history[s];r&&n({canvasComponents:r.components.map(i=>({...i})),links:r.links.map(i=>({...i})),historyIndex:s})},redo:()=>{const t=e();if(t.historyIndex<0||t.historyIndex>=t.history.length-1)return;const s=t.historyIndex+1,r=t.history[s];r&&n({canvasComponents:r.components.map(i=>({...i})),links:r.links.map(i=>({...i})),historyIndex:s})},route:"projects",isSubNavVisible:!0,uploads:[],useRuleBased:!0,useTableExtraction:!0,useAiExtraction:!0,useOcrFallback:!1,layers:["Single-Line Diagram","High-Level Overview","Civil/Structural","Networking/Monitoring","ODL Code"],currentLayer:"Single-Line Diagram",setCurrentLayer:t=>{n({currentLayer:t})},voiceMode:"idle",isContinuousConversation:!1,voiceTranscript:"",voiceOutputEnabled:!1,chatDraft:"",activeDatasheet:null,setActiveDatasheet:t=>n({activeDatasheet:t}),setVoiceMode:t=>n({voiceMode:t}),toggleContinuousConversation:()=>n(t=>({isContinuousConversation:!t.isContinuousConversation})),startListening:()=>{n({voiceTranscript:"",voiceMode:"listening"})},stopListening:t=>{n({voiceMode:"idle",voiceTranscript:""}),t&&t.trim()&&e().analyzeAndExecute(t.trim())},updateVoiceTranscript:t=>n({voiceTranscript:t}),toggleVoiceOutput:()=>n(t=>({voiceOutputEnabled:!t.voiceOutputEnabled})),setChatDraft:t=>n({chatDraft:t}),clearChatDraft:()=>n({chatDraft:""}),toggleSubNav:()=>n(t=>({isSubNavVisible:!t.isSubNavVisible})),setExtractionSetting:(t,s)=>n(r=>({...r,[t]:s})),addStatusMessage:(t,s)=>n(r=>({statusMessages:[...r.statusMessages,{id:crypto.randomUUID(),message:t,icon:s}]})),removeStatusMessage:t=>n(s=>({statusMessages:s.statusMessages.filter(r=>r.id!==t)})),addMessage:t=>n(s=>({messages:[...s.messages,t]})),selectComponent:t=>n({selectedComponentId:t}),async fetchProject(){n({status:"loading"}),e().addStatusMessage("Loading project...","info");try{const[t,s]=await Promise.all([we.getComponents(),we.getLinks()]),r=t.map(i=>({...i,layer:i.layer??"Single-Line Diagram",ports:[{id:"input",type:"in"},{id:"output",type:"out"}]}));n({canvasComponents:r,links:s,status:"ready"}),e().addStatusMessage("Project loaded","success")}catch(t){console.error("Failed to load project:",t),n({status:"Error: Could not load project"}),e().addStatusMessage("Failed to load project","error")}},async addComponent(t){n({status:`Adding ${t.type}...`}),e().addStatusMessage(`Adding ${t.type}...`,"info");try{const s={...t,layer:e().currentLayer},r=await we.createComponent(s),i={...r,ports:[{id:"input",type:"in"},{id:"output",type:"out"}],layer:e().currentLayer};n(a=>({canvasComponents:[...a.canvasComponents,i],status:`Component ${r.name} added`})),e().addStatusMessage(`Component ${r.name} added`,"success")}catch(s){console.error("Failed to add component:",s),n({status:"Error: Could not add component"}),e().addStatusMessage("Failed to add component","error")}},async updateComponentName(t,s){const r=e().canvasComponents,i=r.map(a=>a.id===t?{...a,name:s}:a);n({canvasComponents:i});try{await we.updateComponent(t,{name:s})}catch(a){console.error("Failed to update component name:",a),n({canvasComponents:r})}},async updateComponentPosition(t,s){const r=e().canvasComponents,i=r.find(u=>u.id===t);if(!i)return;const a=Math.round(i.x+s.x),o=Math.round(i.y+s.y),c={...i,x:a,y:o};n({canvasComponents:r.map(u=>u.id===t?c:u)});try{await we.updateComponent(t,{x:a,y:o})}catch(u){console.error("Failed to save new position:",u),n({canvasComponents:r})}},async deleteComponent(t){n(s=>({canvasComponents:s.canvasComponents.filter(r=>r.id!==t),links:s.links.filter(r=>r.source_id!==t&&r.target_id!==t),selectedComponentId:null}));try{await we.deleteComponent(t)}catch(s){console.error("Failed to delete component:",s),e().fetchProject()}},async addLink({source_id:t,target_id:s}){if(!(e().links.some(i=>i.source_id===t&&i.target_id===s)||t===s)){n({status:"Creating link..."}),e().addStatusMessage("Creating link...","info");try{const i=await we.createLink({source_id:t,target_id:s});n(a=>({links:[...a.links,i],status:"Link created"})),e().addStatusMessage("Link created","success")}catch(i){console.error("Failed to add link:",i),n({status:"Error: Could not create link"}),e().addStatusMessage("Failed to create link","error")}}},async executeAiActions(t){var r;const s=[];for(const i of t)switch(i.action){case"addComponent":case"addLink":case"removeComponent":case"updatePosition":case"suggestLink":s.push(i);break;case"validation":{const a=(r=i.payload)==null?void 0:r.message;a&&e().addMessage({id:crypto.randomUUID(),author:"AI",text:a});break}case"report":{e().setBom(i.payload.items);break}default:console.error("AI action not implemented",i)}s.length>0&&(e().recordHistory(),await e().applyAiActions(s),e().addMessage({id:crypto.randomUUID(),author:"AI",text:`✅ Applied ${s.length} action(s) automatically.`}))},async applyAiActions(t){for(const s of t)switch(s.action){case"addComponent":await e().addComponent(s.payload);break;case"removeComponent":await e().deleteComponent(s.payload.id);break;case"addLink":await e().addLink(s.payload);break;case"suggestLink":{const{source_name:r,target_name:i,source_id:a,target_id:o}=s.payload,c=e().canvasComponents;let u=c.find(h=>r&&h.name===r),d=c.find(h=>i&&h.name===i);if(!u&&a&&(u=c.find(h=>h.id===a)),!d&&o&&(d=c.find(h=>h.id===o)),u&&d)try{await e().addLink({source_id:u.id,target_id:d.id})}catch(h){console.error("Failed to create link from suggestion",h),n(f=>({ghostLinks:[...f.ghostLinks,s.payload]}))}else n(h=>({ghostLinks:[...h.ghostLinks,s.payload]}));break}case"updatePosition":n(r=>({canvasComponents:r.canvasComponents.map(i=>i.id===s.payload.id?{...i,x:s.payload.x,y:s.payload.y}:i)}));break;case"report":e().setBom(s.payload.items);break;default:console.warn("AI action not implemented",s)}},async analyzeAndExecute(t){const{addMessage:s,setIsAiProcessing:r,setPlanTasks:i,setQuickActions:a}=e();n({lastPrompt:t}),s({id:crypto.randomUUID(),author:"User",text:t}),r(!0),e().addStatusMessage("Processing command","info"),(async()=>{try{const o=e().sessionId||"global";try{const u=await we.createOdlSession(o!=="global"?o:void 0);u!=null&&u.session_id&&e().setSessionId(u.session_id)}catch(u){console.warn("ODL session init failed",u)}const c=await we.getPlanForSession(e().sessionId,t);if(await e().syncGraphVersion(e().sessionId),c.tasks&&Array.isArray(c.tasks)){const u=e().planTasks,d=c.tasks.map(h=>{const f=u.find(g=>g.id===h.id);return{id:h.id,title:h.title,description:h.description,status:f?f.status:h.status??"pending"}});i(d)}if(c.quick_actions&&Array.isArray(c.quick_actions)&&a(c.quick_actions.map(u=>({id:u.id,label:u.label,command:u.command}))),c.tasks&&Array.isArray(c.tasks)){for(const u of c.tasks)if(await e().performPlanTask({id:u.id,title:u.title,description:u.description,status:u.status??"pending"})==="blocked")break}}catch(o){console.error("Failed to load plan",o)}})();try{const{canvasComponents:o,links:c}=e(),u={components:o,links:c};let d=[];d=await we.analyzeDesign(u,t),d.length>0&&await e().executeAiActions(d)}catch(o){console.error("Failed to analyze design",o),e().addStatusMessage("Failed to perform actions","error")}finally{r(!1)}},setBom(t){n({bomItems:t})},setChatMode(t){n({chatMode:t})},setIsAiProcessing(t){n({isAiProcessing:t})},setRoute(t){n({route:t})},addUpload(t){n(s=>({uploads:[...s.uploads,t]}))},updateUpload(t,s){n(r=>({uploads:r.uploads.map(i=>i.id===t?{...i,...s}:i)}))},async loadUploads(){try{const t=await XN();n({uploads:t.map(s=>({id:s.id,name:s.filename,size:s.size,mime:s.mime,progress:101,assetType:"component",parsed_at:s.parsed_at,parsing_status:s.parsing_status??null,parsing_error:s.parsing_error??null,is_human_verified:s.is_human_verified??!1}))})}catch(t){console.error("Failed to load uploads",t)}}}));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eT=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),tT=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),jb=n=>{const e=tT(n);return e.charAt(0).toUpperCase()+e.slice(1)},GA=(...n)=>n.filter((e,t,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===t).join(" ").trim(),nT=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sT={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rT=T.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:a,...o},c)=>T.createElement("svg",{ref:c,...sT,width:e,height:e,stroke:n,strokeWidth:s?Number(t)*24/Number(e):t,className:GA("lucide",r),...!i&&!nT(o)&&{"aria-hidden":"true"},...o},[...a.map(([u,d])=>T.createElement(u,d)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=(n,e)=>{const t=T.forwardRef(({className:s,...r},i)=>T.createElement(rT,{ref:i,iconNode:e,className:GA(`lucide-${eT(jb(n))}`,`lucide-${n}`,s),...r}));return t.displayName=jb(n),t};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],aT=me("arrow-right",iT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],lT=me("book",oT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],WA=me("bot",cT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],dT=me("box",uT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hT=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],fT=me("chevron-down",hT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],gT=me("chevron-left",pT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mT=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],yT=me("chevron-right",mT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vT=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],wT=me("chevron-up",vT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Cv=me("circle-alert",xT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Tg=me("circle-check-big",bT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],AT=me("circle-check",ST);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _T=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ET=me("circle",_T);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CT=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],kT=me("clock",CT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NT=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],TT=me("file-text",NT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],RT=me("file",PT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LT=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],MT=me("funnel",LT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jT=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],DT=me("image",jT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],yy=me("info",IT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.93 4.93 4.24 4.24",key:"1ymg45"}],["path",{d:"m14.83 9.17 4.24-4.24",key:"1cb5xl"}],["path",{d:"m14.83 14.83 4.24 4.24",key:"q42g0n"}],["path",{d:"m9.17 14.83-4.24 4.24",key:"bqpfvv"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}]],FT=me("life-buoy",OT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $T=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ec=me("loader-circle",$T);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zT=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],BT=me("mic",zT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UT=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],HT=me("panel-left-close",UT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VT=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],qA=me("paperclip",VT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GT=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],WT=me("search",GT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qT=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],XT=me("send",qT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YT=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],XA=me("settings",YT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KT=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],QT=me("shield-check",KT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JT=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],ZT=me("shuffle",JT);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eP=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],tP=me("star",eP);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nP=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],sP=me("thumbs-down",nP);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rP=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],iP=me("thumbs-up",rP);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aP=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],oP=me("trash-2",aP);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lP=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],cP=me("triangle-alert",lP);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uP=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Db=me("upload",uP);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dP=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],hP=me("x",dP);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fP=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],pP=me("zoom-in",fP);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gP=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],mP=me("zoom-out",gP),yP=({toggleSidebar:n,toggleToolbar:e})=>p.jsxs("header",{className:"grid-in-header h-16 flex items-center justify-between px-4 bg-white text-black border-b border-gray-200",children:[p.jsx("div",{className:"flex items-center gap-2",children:p.jsx("button",{onClick:n,className:"p-2 rounded-md hover:bg-gray-100 focus:ring-2 focus:ring-blue-500","aria-label":"Toggle sidebar",children:p.jsx(HT,{size:24})})}),p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("nav",{role:"tablist","aria-label":"Primary navigation",className:"flex gap-2",children:["GlobalNav_1","GlobalNav_2","GlobalNav_3"].map(t=>p.jsx("button",{role:"tab",className:"px-4 py-2 rounded-md hover:bg-gray-100 aria-selected:bg-blue-100","aria-selected":t==="GlobalNav_1",children:t},t))}),p.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-100","aria-label":"Toggle sub-navigation",title:"Toggle Sub-Nav",children:p.jsx(XA,{className:"h-5 w-5"})})]}),p.jsxs("div",{className:"flex gap-1",children:[p.jsx("span",{className:"h-6 w-6 rounded-full bg-blue-200 text-xs flex items-center justify-center",children:"AI_1"}),p.jsx("span",{className:"h-6 w-6 rounded-full bg-gray-300 text-xs flex items-center justify-center",children:"Eng_1"})]})]}),_m=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Eu(n){const e=Object.prototype.toString.call(n);return e==="[object Window]"||e==="[object global]"}function Vw(n){return"nodeType"in n}function kn(n){var e,t;return n?Eu(n)?n:Vw(n)&&(e=(t=n.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function Gw(n){const{Document:e}=kn(n);return n instanceof e}function Lf(n){return Eu(n)?!1:n instanceof kn(n).HTMLElement}function YA(n){return n instanceof kn(n).SVGElement}function Cu(n){return n?Eu(n)?n.document:Vw(n)?Gw(n)?n:Lf(n)||YA(n)?n.ownerDocument:document:document:document}const ja=_m?T.useLayoutEffect:T.useEffect;function Ww(n){const e=T.useRef(n);return ja(()=>{e.current=n}),T.useCallback(function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return e.current==null?void 0:e.current(...s)},[])}function vP(){const n=T.useRef(null),e=T.useCallback((s,r)=>{n.current=setInterval(s,r)},[]),t=T.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[e,t]}function Vd(n,e){e===void 0&&(e=[n]);const t=T.useRef(n);return ja(()=>{t.current!==n&&(t.current=n)},e),t}function Mf(n,e){const t=T.useRef();return T.useMemo(()=>{const s=n(t.current);return t.current=s,s},[...e])}function Pg(n){const e=Ww(n),t=T.useRef(null),s=T.useCallback(r=>{r!==t.current&&(e==null||e(r,t.current)),t.current=r},[]);return[t,s]}function kv(n){const e=T.useRef();return T.useEffect(()=>{e.current=n},[n]),e.current}let vy={};function Em(n,e){return T.useMemo(()=>{if(e)return e;const t=vy[n]==null?0:vy[n]+1;return vy[n]=t,n+"-"+t},[n,e])}function KA(n){return function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return s.reduce((i,a)=>{const o=Object.entries(a);for(const[c,u]of o){const d=i[c];d!=null&&(i[c]=d+n*u)}return i},{...e})}}const tc=KA(1),Rg=KA(-1);function wP(n){return"clientX"in n&&"clientY"in n}function QA(n){if(!n)return!1;const{KeyboardEvent:e}=kn(n.target);return e&&n instanceof e}function xP(n){if(!n)return!1;const{TouchEvent:e}=kn(n.target);return e&&n instanceof e}function Nv(n){if(xP(n)){if(n.touches&&n.touches.length){const{clientX:e,clientY:t}=n.touches[0];return{x:e,y:t}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:e,clientY:t}=n.changedTouches[0];return{x:e,y:t}}}return wP(n)?{x:n.clientX,y:n.clientY}:null}const Ib="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function bP(n){return n.matches(Ib)?n:n.querySelector(Ib)}const SP={display:"none"};function AP(n){let{id:e,value:t}=n;return gt.createElement("div",{id:e,style:SP},t)}function _P(n){let{id:e,announcement:t,ariaLiveType:s="assertive"}=n;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return gt.createElement("div",{id:e,style:r,role:"status","aria-live":s,"aria-atomic":!0},t)}function EP(){const[n,e]=T.useState("");return{announce:T.useCallback(s=>{s!=null&&e(s)},[]),announcement:n}}const JA=T.createContext(null);function CP(n){const e=T.useContext(JA);T.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(n)},[n,e])}function kP(){const[n]=T.useState(()=>new Set),e=T.useCallback(s=>(n.add(s),()=>n.delete(s)),[n]);return[T.useCallback(s=>{let{type:r,event:i}=s;n.forEach(a=>{var o;return(o=a[r])==null?void 0:o.call(a,i)})},[n]),e]}const NP={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},TP={onDragStart(n){let{active:e}=n;return"Picked up draggable item "+e.id+"."},onDragOver(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(n){let{active:e}=n;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function PP(n){let{announcements:e=TP,container:t,hiddenTextDescribedById:s,screenReaderInstructions:r=NP}=n;const{announce:i,announcement:a}=EP(),o=Em("DndLiveRegion"),[c,u]=T.useState(!1);if(T.useEffect(()=>{u(!0)},[]),CP(T.useMemo(()=>({onDragStart(h){let{active:f}=h;i(e.onDragStart({active:f}))},onDragMove(h){let{active:f,over:g}=h;e.onDragMove&&i(e.onDragMove({active:f,over:g}))},onDragOver(h){let{active:f,over:g}=h;i(e.onDragOver({active:f,over:g}))},onDragEnd(h){let{active:f,over:g}=h;i(e.onDragEnd({active:f,over:g}))},onDragCancel(h){let{active:f,over:g}=h;i(e.onDragCancel({active:f,over:g}))}}),[i,e])),!c)return null;const d=gt.createElement(gt.Fragment,null,gt.createElement(AP,{id:s,value:r.draggable}),gt.createElement(_P,{id:o,announcement:a}));return t?Vl.createPortal(d,t):d}var pt;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(pt||(pt={}));function Lg(){}function RP(n,e){return T.useMemo(()=>({sensor:n,options:{}}),[n,e])}function LP(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return T.useMemo(()=>[...e].filter(s=>s!=null),[...e])}const Xs=Object.freeze({x:0,y:0});function MP(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return s-t}function jP(n,e){if(!n||n.length===0)return null;const[t]=n;return t[e]}function DP(n,e){const t=Math.max(e.top,n.top),s=Math.max(e.left,n.left),r=Math.min(e.left+e.width,n.left+n.width),i=Math.min(e.top+e.height,n.top+n.height),a=r-s,o=i-t;if(s<r&&t<i){const c=e.width*e.height,u=n.width*n.height,d=a*o,h=d/(c+u-d);return Number(h.toFixed(4))}return 0}const IP=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=[];for(const i of s){const{id:a}=i,o=t.get(a);if(o){const c=DP(o,e);c>0&&r.push({id:a,data:{droppableContainer:i,value:c}})}}return r.sort(MP)};function OP(n,e,t){return{...n,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function ZA(n,e){return n&&e?{x:n.left-e.left,y:n.top-e.top}:Xs}function FP(n){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];return r.reduce((a,o)=>({...a,top:a.top+n*o.y,bottom:a.bottom+n*o.y,left:a.left+n*o.x,right:a.right+n*o.x}),{...t})}}const $P=FP(1);function zP(n){if(n.startsWith("matrix3d(")){const e=n.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(n.startsWith("matrix(")){const e=n.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function BP(n,e,t){const s=zP(e);if(!s)return n;const{scaleX:r,scaleY:i,x:a,y:o}=s,c=n.left-a-(1-r)*parseFloat(t),u=n.top-o-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),d=r?n.width/r:n.width,h=i?n.height/i:n.height;return{width:d,height:h,top:u,right:c+d,bottom:u+h,left:c}}const UP={ignoreTransform:!1};function jf(n,e){e===void 0&&(e=UP);let t=n.getBoundingClientRect();if(e.ignoreTransform){const{transform:u,transformOrigin:d}=kn(n).getComputedStyle(n);u&&(t=BP(t,u,d))}const{top:s,left:r,width:i,height:a,bottom:o,right:c}=t;return{top:s,left:r,width:i,height:a,bottom:o,right:c}}function Ob(n){return jf(n,{ignoreTransform:!0})}function HP(n){const e=n.innerWidth,t=n.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function VP(n,e){return e===void 0&&(e=kn(n).getComputedStyle(n)),e.position==="fixed"}function GP(n,e){e===void 0&&(e=kn(n).getComputedStyle(n));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const i=e[r];return typeof i=="string"?t.test(i):!1})}function qw(n,e){const t=[];function s(r){if(e!=null&&t.length>=e||!r)return t;if(Gw(r)&&r.scrollingElement!=null&&!t.includes(r.scrollingElement))return t.push(r.scrollingElement),t;if(!Lf(r)||YA(r)||t.includes(r))return t;const i=kn(n).getComputedStyle(r);return r!==n&&GP(r,i)&&t.push(r),VP(r,i)?t:s(r.parentNode)}return n?s(n):t}function e_(n){const[e]=qw(n,1);return e??null}function wy(n){return!_m||!n?null:Eu(n)?n:Vw(n)?Gw(n)||n===Cu(n).scrollingElement?window:Lf(n)?n:null:null}function t_(n){return Eu(n)?n.scrollX:n.scrollLeft}function n_(n){return Eu(n)?n.scrollY:n.scrollTop}function Tv(n){return{x:t_(n),y:n_(n)}}var Ct;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Ct||(Ct={}));function s_(n){return!_m||!n?!1:n===document.scrollingElement}function r_(n){const e={x:0,y:0},t=s_(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},s={x:n.scrollWidth-t.width,y:n.scrollHeight-t.height},r=n.scrollTop<=e.y,i=n.scrollLeft<=e.x,a=n.scrollTop>=s.y,o=n.scrollLeft>=s.x;return{isTop:r,isLeft:i,isBottom:a,isRight:o,maxScroll:s,minScroll:e}}const WP={x:.2,y:.2};function qP(n,e,t,s,r){let{top:i,left:a,right:o,bottom:c}=t;s===void 0&&(s=10),r===void 0&&(r=WP);const{isTop:u,isBottom:d,isLeft:h,isRight:f}=r_(n),g={x:0,y:0},y={x:0,y:0},m={height:e.height*r.y,width:e.width*r.x};return!u&&i<=e.top+m.height?(g.y=Ct.Backward,y.y=s*Math.abs((e.top+m.height-i)/m.height)):!d&&c>=e.bottom-m.height&&(g.y=Ct.Forward,y.y=s*Math.abs((e.bottom-m.height-c)/m.height)),!f&&o>=e.right-m.width?(g.x=Ct.Forward,y.x=s*Math.abs((e.right-m.width-o)/m.width)):!h&&a<=e.left+m.width&&(g.x=Ct.Backward,y.x=s*Math.abs((e.left+m.width-a)/m.width)),{direction:g,speed:y}}function XP(n){if(n===document.scrollingElement){const{innerWidth:i,innerHeight:a}=window;return{top:0,left:0,right:i,bottom:a,width:i,height:a}}const{top:e,left:t,right:s,bottom:r}=n.getBoundingClientRect();return{top:e,left:t,right:s,bottom:r,width:n.clientWidth,height:n.clientHeight}}function i_(n){return n.reduce((e,t)=>tc(e,Tv(t)),Xs)}function YP(n){return n.reduce((e,t)=>e+t_(t),0)}function KP(n){return n.reduce((e,t)=>e+n_(t),0)}function QP(n,e){if(e===void 0&&(e=jf),!n)return;const{top:t,left:s,bottom:r,right:i}=e(n);e_(n)&&(r<=0||i<=0||t>=window.innerHeight||s>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const JP=[["x",["left","right"],YP],["y",["top","bottom"],KP]];class Xw{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=qw(t),r=i_(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,a,o]of JP)for(const c of a)Object.defineProperty(this,c,{get:()=>{const u=o(s),d=r[i]-u;return this.rect[c]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Sd{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...t)})},this.target=e}add(e,t,s){var r;(r=this.target)==null||r.addEventListener(e,t,s),this.listeners.push([e,t,s])}}function ZP(n){const{EventTarget:e}=kn(n);return n instanceof e?n:Cu(n)}function xy(n,e){const t=Math.abs(n.x),s=Math.abs(n.y);return typeof e=="number"?Math.sqrt(t**2+s**2)>e:"x"in e&&"y"in e?t>e.x&&s>e.y:"x"in e?t>e.x:"y"in e?s>e.y:!1}var fs;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(fs||(fs={}));function Fb(n){n.preventDefault()}function eR(n){n.stopPropagation()}var Le;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(Le||(Le={}));const a_={start:[Le.Space,Le.Enter],cancel:[Le.Esc],end:[Le.Space,Le.Enter,Le.Tab]},tR=(n,e)=>{let{currentCoordinates:t}=e;switch(n.code){case Le.Right:return{...t,x:t.x+25};case Le.Left:return{...t,x:t.x-25};case Le.Down:return{...t,y:t.y+25};case Le.Up:return{...t,y:t.y-25}}};class o_{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Sd(Cu(t)),this.windowListeners=new Sd(kn(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(fs.Resize,this.handleCancel),this.windowListeners.add(fs.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(fs.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,s=e.node.current;s&&QP(s),t(Xs)}handleKeyDown(e){if(QA(e)){const{active:t,context:s,options:r}=this.props,{keyboardCodes:i=a_,coordinateGetter:a=tR,scrollBehavior:o="smooth"}=r,{code:c}=e;if(i.end.includes(c)){this.handleEnd(e);return}if(i.cancel.includes(c)){this.handleCancel(e);return}const{collisionRect:u}=s.current,d=u?{x:u.left,y:u.top}:Xs;this.referenceCoordinates||(this.referenceCoordinates=d);const h=a(e,{active:t,context:s.current,currentCoordinates:d});if(h){const f=Rg(h,d),g={x:0,y:0},{scrollableAncestors:y}=s.current;for(const m of y){const b=e.code,{isTop:w,isRight:x,isLeft:S,isBottom:E,maxScroll:C,minScroll:N}=r_(m),k=XP(m),R={x:Math.min(b===Le.Right?k.right-k.width/2:k.right,Math.max(b===Le.Right?k.left:k.left+k.width/2,h.x)),y:Math.min(b===Le.Down?k.bottom-k.height/2:k.bottom,Math.max(b===Le.Down?k.top:k.top+k.height/2,h.y))},P=b===Le.Right&&!x||b===Le.Left&&!S,L=b===Le.Down&&!E||b===Le.Up&&!w;if(P&&R.x!==h.x){const M=m.scrollLeft+f.x,I=b===Le.Right&&M<=C.x||b===Le.Left&&M>=N.x;if(I&&!f.y){m.scrollTo({left:M,behavior:o});return}I?g.x=m.scrollLeft-M:g.x=b===Le.Right?m.scrollLeft-C.x:m.scrollLeft-N.x,g.x&&m.scrollBy({left:-g.x,behavior:o});break}else if(L&&R.y!==h.y){const M=m.scrollTop+f.y,I=b===Le.Down&&M<=C.y||b===Le.Up&&M>=N.y;if(I&&!f.x){m.scrollTo({top:M,behavior:o});return}I?g.y=m.scrollTop-M:g.y=b===Le.Down?m.scrollTop-C.y:m.scrollTop-N.y,g.y&&m.scrollBy({top:-g.y,behavior:o});break}}this.handleMove(e,tc(Rg(h,this.referenceCoordinates),g))}}}handleMove(e,t){const{onMove:s}=this.props;e.preventDefault(),s(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}o_.activators=[{eventName:"onKeyDown",handler:(n,e,t)=>{let{keyboardCodes:s=a_,onActivation:r}=e,{active:i}=t;const{code:a}=n.nativeEvent;if(s.start.includes(a)){const o=i.activatorNode.current;return o&&n.target!==o?!1:(n.preventDefault(),r==null||r({event:n.nativeEvent}),!0)}return!1}}];function $b(n){return!!(n&&"distance"in n)}function zb(n){return!!(n&&"delay"in n)}class Yw{constructor(e,t,s){var r;s===void 0&&(s=ZP(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:a}=i;this.props=e,this.events=t,this.document=Cu(a),this.documentListeners=new Sd(this.document),this.listeners=new Sd(s),this.windowListeners=new Sd(kn(a)),this.initialCoordinates=(r=Nv(i))!=null?r:Xs,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(fs.Resize,this.handleCancel),this.windowListeners.add(fs.DragStart,Fb),this.windowListeners.add(fs.VisibilityChange,this.handleCancel),this.windowListeners.add(fs.ContextMenu,Fb),this.documentListeners.add(fs.Keydown,this.handleKeydown),t){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(zb(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if($b(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:s,onPending:r}=this.props;r(s,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(fs.Click,eR,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(fs.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:s,initialCoordinates:r,props:i}=this,{onMove:a,options:{activationConstraint:o}}=i;if(!r)return;const c=(t=Nv(e))!=null?t:Xs,u=Rg(r,c);if(!s&&o){if($b(o)){if(o.tolerance!=null&&xy(u,o.tolerance))return this.handleCancel();if(xy(u,o.distance))return this.handleStart()}if(zb(o)&&xy(u,o.tolerance))return this.handleCancel();this.handlePending(o,u);return}e.cancelable&&e.preventDefault(),a(c)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===Le.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const nR={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Kw extends Yw{constructor(e){const{event:t}=e,s=Cu(t.target);super(e,nR,s)}}Kw.activators=[{eventName:"onPointerDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return!t.isPrimary||t.button!==0?!1:(s==null||s({event:t}),!0)}}];const sR={move:{name:"mousemove"},end:{name:"mouseup"}};var Pv;(function(n){n[n.RightClick=2]="RightClick"})(Pv||(Pv={}));class rR extends Yw{constructor(e){super(e,sR,Cu(e.event.target))}}rR.activators=[{eventName:"onMouseDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return t.button===Pv.RightClick?!1:(s==null||s({event:t}),!0)}}];const by={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class iR extends Yw{constructor(e){super(e,by)}static setup(){return window.addEventListener(by.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(by.move.name,e)};function e(){}}}iR.activators=[{eventName:"onTouchStart",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;const{touches:r}=t;return r.length>1?!1:(s==null||s({event:t}),!0)}}];var Ad;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(Ad||(Ad={}));var Mg;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Mg||(Mg={}));function aR(n){let{acceleration:e,activator:t=Ad.Pointer,canScroll:s,draggingRect:r,enabled:i,interval:a=5,order:o=Mg.TreeOrder,pointerCoordinates:c,scrollableAncestors:u,scrollableAncestorRects:d,delta:h,threshold:f}=n;const g=lR({delta:h,disabled:!i}),[y,m]=vP(),b=T.useRef({x:0,y:0}),w=T.useRef({x:0,y:0}),x=T.useMemo(()=>{switch(t){case Ad.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Ad.DraggableRect:return r}},[t,r,c]),S=T.useRef(null),E=T.useCallback(()=>{const N=S.current;if(!N)return;const k=b.current.x*w.current.x,R=b.current.y*w.current.y;N.scrollBy(k,R)},[]),C=T.useMemo(()=>o===Mg.TreeOrder?[...u].reverse():u,[o,u]);T.useEffect(()=>{if(!i||!u.length||!x){m();return}for(const N of C){if((s==null?void 0:s(N))===!1)continue;const k=u.indexOf(N),R=d[k];if(!R)continue;const{direction:P,speed:L}=qP(N,R,x,e,f);for(const M of["x","y"])g[M][P[M]]||(L[M]=0,P[M]=0);if(L.x>0||L.y>0){m(),S.current=N,y(E,a),b.current=L,w.current=P;return}}b.current={x:0,y:0},w.current={x:0,y:0},m()},[e,E,s,m,i,a,JSON.stringify(x),JSON.stringify(g),y,u,C,d,JSON.stringify(f)])}const oR={x:{[Ct.Backward]:!1,[Ct.Forward]:!1},y:{[Ct.Backward]:!1,[Ct.Forward]:!1}};function lR(n){let{delta:e,disabled:t}=n;const s=kv(e);return Mf(r=>{if(t||!s||!r)return oR;const i={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[Ct.Backward]:r.x[Ct.Backward]||i.x===-1,[Ct.Forward]:r.x[Ct.Forward]||i.x===1},y:{[Ct.Backward]:r.y[Ct.Backward]||i.y===-1,[Ct.Forward]:r.y[Ct.Forward]||i.y===1}}},[t,e,s])}function cR(n,e){const t=e!=null?n.get(e):void 0,s=t?t.node.current:null;return Mf(r=>{var i;return e==null?null:(i=s??r)!=null?i:null},[s,e])}function uR(n,e){return T.useMemo(()=>n.reduce((t,s)=>{const{sensor:r}=s,i=r.activators.map(a=>({eventName:a.eventName,handler:e(a.handler,s)}));return[...t,...i]},[]),[n,e])}var Gd;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(Gd||(Gd={}));var Rv;(function(n){n.Optimized="optimized"})(Rv||(Rv={}));const Bb=new Map;function dR(n,e){let{dragging:t,dependencies:s,config:r}=e;const[i,a]=T.useState(null),{frequency:o,measure:c,strategy:u}=r,d=T.useRef(n),h=b(),f=Vd(h),g=T.useCallback(function(w){w===void 0&&(w=[]),!f.current&&a(x=>x===null?w:x.concat(w.filter(S=>!x.includes(S))))},[f]),y=T.useRef(null),m=Mf(w=>{if(h&&!t)return Bb;if(!w||w===Bb||d.current!==n||i!=null){const x=new Map;for(let S of n){if(!S)continue;if(i&&i.length>0&&!i.includes(S.id)&&S.rect.current){x.set(S.id,S.rect.current);continue}const E=S.node.current,C=E?new Xw(c(E),E):null;S.rect.current=C,C&&x.set(S.id,C)}return x}return w},[n,i,t,h,c]);return T.useEffect(()=>{d.current=n},[n]),T.useEffect(()=>{h||g()},[t,h]),T.useEffect(()=>{i&&i.length>0&&a(null)},[JSON.stringify(i)]),T.useEffect(()=>{h||typeof o!="number"||y.current!==null||(y.current=setTimeout(()=>{g(),y.current=null},o))},[o,h,g,...s]),{droppableRects:m,measureDroppableContainers:g,measuringScheduled:i!=null};function b(){switch(u){case Gd.Always:return!1;case Gd.BeforeDragging:return t;default:return!t}}}function l_(n,e){return Mf(t=>n?t||(typeof e=="function"?e(n):n):null,[e,n])}function hR(n,e){return l_(n,e)}function fR(n){let{callback:e,disabled:t}=n;const s=Ww(e),r=T.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,t]);return T.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function Cm(n){let{callback:e,disabled:t}=n;const s=Ww(e),r=T.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[t]);return T.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function pR(n){return new Xw(jf(n),n)}function Ub(n,e,t){e===void 0&&(e=pR);const[s,r]=T.useState(null);function i(){r(c=>{if(!n)return null;if(n.isConnected===!1){var u;return(u=c??t)!=null?u:null}const d=e(n);return JSON.stringify(c)===JSON.stringify(d)?c:d})}const a=fR({callback(c){if(n)for(const u of c){const{type:d,target:h}=u;if(d==="childList"&&h instanceof HTMLElement&&h.contains(n)){i();break}}}}),o=Cm({callback:i});return ja(()=>{i(),n?(o==null||o.observe(n),a==null||a.observe(document.body,{childList:!0,subtree:!0})):(o==null||o.disconnect(),a==null||a.disconnect())},[n]),s}function gR(n){const e=l_(n);return ZA(n,e)}const Hb=[];function mR(n){const e=T.useRef(n),t=Mf(s=>n?s&&s!==Hb&&n&&e.current&&n.parentNode===e.current.parentNode?s:qw(n):Hb,[n]);return T.useEffect(()=>{e.current=n},[n]),t}function yR(n){const[e,t]=T.useState(null),s=T.useRef(n),r=T.useCallback(i=>{const a=wy(i.target);a&&t(o=>o?(o.set(a,Tv(a)),new Map(o)):null)},[]);return T.useEffect(()=>{const i=s.current;if(n!==i){a(i);const o=n.map(c=>{const u=wy(c);return u?(u.addEventListener("scroll",r,{passive:!0}),[u,Tv(u)]):null}).filter(c=>c!=null);t(o.length?new Map(o):null),s.current=n}return()=>{a(n),a(i)};function a(o){o.forEach(c=>{const u=wy(c);u==null||u.removeEventListener("scroll",r)})}},[r,n]),T.useMemo(()=>n.length?e?Array.from(e.values()).reduce((i,a)=>tc(i,a),Xs):i_(n):Xs,[n,e])}function Vb(n,e){e===void 0&&(e=[]);const t=T.useRef(null);return T.useEffect(()=>{t.current=null},e),T.useEffect(()=>{const s=n!==Xs;s&&!t.current&&(t.current=n),!s&&t.current&&(t.current=null)},[n]),t.current?Rg(n,t.current):Xs}function vR(n){T.useEffect(()=>{if(!_m)return;const e=n.map(t=>{let{sensor:s}=t;return s.setup==null?void 0:s.setup()});return()=>{for(const t of e)t==null||t()}},n.map(e=>{let{sensor:t}=e;return t}))}function wR(n,e){return T.useMemo(()=>n.reduce((t,s)=>{let{eventName:r,handler:i}=s;return t[r]=a=>{i(a,e)},t},{}),[n,e])}function c_(n){return T.useMemo(()=>n?HP(n):null,[n])}const Gb=[];function xR(n,e){e===void 0&&(e=jf);const[t]=n,s=c_(t?kn(t):null),[r,i]=T.useState(Gb);function a(){i(()=>n.length?n.map(c=>s_(c)?s:new Xw(e(c),c)):Gb)}const o=Cm({callback:a});return ja(()=>{o==null||o.disconnect(),a(),n.forEach(c=>o==null?void 0:o.observe(c))},[n]),r}function bR(n){if(!n)return null;if(n.children.length>1)return n;const e=n.children[0];return Lf(e)?e:n}function SR(n){let{measure:e}=n;const[t,s]=T.useState(null),r=T.useCallback(u=>{for(const{target:d}of u)if(Lf(d)){s(h=>{const f=e(d);return h?{...h,width:f.width,height:f.height}:f});break}},[e]),i=Cm({callback:r}),a=T.useCallback(u=>{const d=bR(u);i==null||i.disconnect(),d&&(i==null||i.observe(d)),s(d?e(d):null)},[e,i]),[o,c]=Pg(a);return T.useMemo(()=>({nodeRef:o,rect:t,setRef:c}),[t,o,c])}const AR=[{sensor:Kw,options:{}},{sensor:o_,options:{}}],_R={current:{}},Np={draggable:{measure:Ob},droppable:{measure:Ob,strategy:Gd.WhileDragging,frequency:Rv.Optimized},dragOverlay:{measure:jf}};class _d extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,s;return(t=(s=this.get(e))==null?void 0:s.node.current)!=null?t:void 0}}const ER={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new _d,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Lg},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Np,measureDroppableContainers:Lg,windowRect:null,measuringScheduled:!1},CR={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Lg,draggableNodes:new Map,over:null,measureDroppableContainers:Lg},km=T.createContext(CR),kR=T.createContext(ER);function NR(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new _d}}}function TR(n,e){switch(e.type){case pt.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case pt.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:e.coordinates.x-n.draggable.initialCoordinates.x,y:e.coordinates.y-n.draggable.initialCoordinates.y}}};case pt.DragEnd:case pt.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case pt.RegisterDroppable:{const{element:t}=e,{id:s}=t,r=new _d(n.droppable.containers);return r.set(s,t),{...n,droppable:{...n.droppable,containers:r}}}case pt.SetDroppableDisabled:{const{id:t,key:s,disabled:r}=e,i=n.droppable.containers.get(t);if(!i||s!==i.key)return n;const a=new _d(n.droppable.containers);return a.set(t,{...i,disabled:r}),{...n,droppable:{...n.droppable,containers:a}}}case pt.UnregisterDroppable:{const{id:t,key:s}=e,r=n.droppable.containers.get(t);if(!r||s!==r.key)return n;const i=new _d(n.droppable.containers);return i.delete(t),{...n,droppable:{...n.droppable,containers:i}}}default:return n}}function PR(n){let{disabled:e}=n;const{active:t,activatorEvent:s,draggableNodes:r}=T.useContext(km),i=kv(s),a=kv(t==null?void 0:t.id);return T.useEffect(()=>{if(!e&&!s&&i&&a!=null){if(!QA(i)||document.activeElement===i.target)return;const o=r.get(a);if(!o)return;const{activatorNode:c,node:u}=o;if(!c.current&&!u.current)return;requestAnimationFrame(()=>{for(const d of[c.current,u.current]){if(!d)continue;const h=bP(d);if(h){h.focus();break}}})}},[s,e,r,a,i]),null}function RR(n,e){let{transform:t,...s}=e;return n!=null&&n.length?n.reduce((r,i)=>i({transform:r,...s}),t):t}function LR(n){return T.useMemo(()=>({draggable:{...Np.draggable,...n==null?void 0:n.draggable},droppable:{...Np.droppable,...n==null?void 0:n.droppable},dragOverlay:{...Np.dragOverlay,...n==null?void 0:n.dragOverlay}}),[n==null?void 0:n.draggable,n==null?void 0:n.droppable,n==null?void 0:n.dragOverlay])}function MR(n){let{activeNode:e,measure:t,initialRect:s,config:r=!0}=n;const i=T.useRef(!1),{x:a,y:o}=typeof r=="boolean"?{x:r,y:r}:r;ja(()=>{if(!a&&!o||!e){i.current=!1;return}if(i.current||!s)return;const u=e==null?void 0:e.node.current;if(!u||u.isConnected===!1)return;const d=t(u),h=ZA(d,s);if(a||(h.x=0),o||(h.y=0),i.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const f=e_(u);f&&f.scrollBy({top:h.y,left:h.x})}},[e,a,o,s,t])}const u_=T.createContext({...Xs,scaleX:1,scaleY:1});var Ii;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(Ii||(Ii={}));const jR=T.memo(function(e){var t,s,r,i;let{id:a,accessibility:o,autoScroll:c=!0,children:u,sensors:d=AR,collisionDetection:h=IP,measuring:f,modifiers:g,...y}=e;const m=T.useReducer(TR,void 0,NR),[b,w]=m,[x,S]=kP(),[E,C]=T.useState(Ii.Uninitialized),N=E===Ii.Initialized,{draggable:{active:k,nodes:R,translate:P},droppable:{containers:L}}=b,M=k!=null?R.get(k):null,I=T.useRef({initial:null,translated:null}),U=T.useMemo(()=>{var Ut;return k!=null?{id:k,data:(Ut=M==null?void 0:M.data)!=null?Ut:_R,rect:I}:null},[k,M]),B=T.useRef(null),[K,j]=T.useState(null),[D,O]=T.useState(null),G=Vd(y,Object.values(y)),Q=Em("DndDescribedBy",a),H=T.useMemo(()=>L.getEnabled(),[L]),J=LR(f),{droppableRects:ne,measureDroppableContainers:he,measuringScheduled:re}=dR(H,{dragging:N,dependencies:[P.x,P.y],config:J.droppable}),oe=cR(R,k),fe=T.useMemo(()=>D?Nv(D):null,[D]),it=qC(),gn=hR(oe,J.draggable.measure);MR({activeNode:k!=null?R.get(k):null,config:it.layoutShiftCompensation,initialRect:gn,measure:J.draggable.measure});const ue=Ub(oe,J.draggable.measure,gn),Nn=Ub(oe?oe.parentElement:null),Tt=T.useRef({activatorEvent:null,active:null,activeNode:oe,collisionRect:null,collisions:null,droppableRects:ne,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:L,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),vt=L.getNodeFor((t=Tt.current.over)==null?void 0:t.id),ve=SR({measure:J.dragOverlay.measure}),Ve=(s=ve.nodeRef.current)!=null?s:oe,ke=N?(r=ve.rect)!=null?r:ue:null,_s=!!(ve.nodeRef.current&&ve.rect),Tr=gR(_s?null:ue),Pr=c_(Ve?kn(Ve):null),Qs=mR(N?vt??oe:null),Rr=xR(Qs),bl=RR(g,{transform:{x:P.x-Tr.x,y:P.y-Tr.y,scaleX:1,scaleY:1},activatorEvent:D,active:U,activeNodeRect:ue,containerNodeRect:Nn,draggingNodeRect:ke,over:Tt.current.over,overlayNodeRect:ve.rect,scrollableAncestors:Qs,scrollableAncestorRects:Rr,windowRect:Pr}),Vf=fe?tc(fe,P):null,Gf=yR(Qs),$m=Vb(Gf),zm=Vb(Gf,[ue]),Tn=tc(bl,$m),Es=ke?$P(ke,bl):null,Js=U&&Es?h({active:U,collisionRect:Es,droppableRects:ne,droppableContainers:H,pointerCoordinates:Vf}):null,Sl=jP(Js,"id"),[Ni,vx]=T.useState(null),UC=_s?bl:tc(bl,zm),HC=OP(UC,(i=Ni==null?void 0:Ni.rect)!=null?i:null,ue),Bm=T.useRef(null),wx=T.useCallback((Ut,Pn)=>{let{sensor:Rn,options:Ti}=Pn;if(B.current==null)return;const ss=R.get(B.current);if(!ss)return;const Ln=Ut.nativeEvent,Zs=new Rn({active:B.current,activeNode:ss,event:Ln,options:Ti,context:Tt,onAbort(Pt){if(!R.get(Pt))return;const{onDragAbort:er}=G.current,Lr={id:Pt};er==null||er(Lr),x({type:"onDragAbort",event:Lr})},onPending(Pt,Pi,er,Lr){if(!R.get(Pt))return;const{onDragPending:Tu}=G.current,Ri={id:Pt,constraint:Pi,initialCoordinates:er,offset:Lr};Tu==null||Tu(Ri),x({type:"onDragPending",event:Ri})},onStart(Pt){const Pi=B.current;if(Pi==null)return;const er=R.get(Pi);if(!er)return;const{onDragStart:Lr}=G.current,Nu={activatorEvent:Ln,active:{id:Pi,data:er.data,rect:I}};Vl.unstable_batchedUpdates(()=>{Lr==null||Lr(Nu),C(Ii.Initializing),w({type:pt.DragStart,initialCoordinates:Pt,active:Pi}),x({type:"onDragStart",event:Nu}),j(Bm.current),O(Ln)})},onMove(Pt){w({type:pt.DragMove,coordinates:Pt})},onEnd:Al(pt.DragEnd),onCancel:Al(pt.DragCancel)});Bm.current=Zs;function Al(Pt){return async function(){const{active:er,collisions:Lr,over:Nu,scrollAdjustedTranslate:Tu}=Tt.current;let Ri=null;if(er&&Tu){const{cancelDrop:Pu}=G.current;Ri={activatorEvent:Ln,active:er,collisions:Lr,delta:Tu,over:Nu},Pt===pt.DragEnd&&typeof Pu=="function"&&await Promise.resolve(Pu(Ri))&&(Pt=pt.DragCancel)}B.current=null,Vl.unstable_batchedUpdates(()=>{w({type:Pt}),C(Ii.Uninitialized),vx(null),j(null),O(null),Bm.current=null;const Pu=Pt===pt.DragEnd?"onDragEnd":"onDragCancel";if(Ri){const Um=G.current[Pu];Um==null||Um(Ri),x({type:Pu,event:Ri})}})}}},[R]),VC=T.useCallback((Ut,Pn)=>(Rn,Ti)=>{const ss=Rn.nativeEvent,Ln=R.get(Ti);if(B.current!==null||!Ln||ss.dndKit||ss.defaultPrevented)return;const Zs={active:Ln};Ut(Rn,Pn.options,Zs)===!0&&(ss.dndKit={capturedBy:Pn.sensor},B.current=Ti,wx(Rn,Pn))},[R,wx]),xx=uR(d,VC);vR(d),ja(()=>{ue&&E===Ii.Initializing&&C(Ii.Initialized)},[ue,E]),T.useEffect(()=>{const{onDragMove:Ut}=G.current,{active:Pn,activatorEvent:Rn,collisions:Ti,over:ss}=Tt.current;if(!Pn||!Rn)return;const Ln={active:Pn,activatorEvent:Rn,collisions:Ti,delta:{x:Tn.x,y:Tn.y},over:ss};Vl.unstable_batchedUpdates(()=>{Ut==null||Ut(Ln),x({type:"onDragMove",event:Ln})})},[Tn.x,Tn.y]),T.useEffect(()=>{const{active:Ut,activatorEvent:Pn,collisions:Rn,droppableContainers:Ti,scrollAdjustedTranslate:ss}=Tt.current;if(!Ut||B.current==null||!Pn||!ss)return;const{onDragOver:Ln}=G.current,Zs=Ti.get(Sl),Al=Zs&&Zs.rect.current?{id:Zs.id,rect:Zs.rect.current,data:Zs.data,disabled:Zs.disabled}:null,Pt={active:Ut,activatorEvent:Pn,collisions:Rn,delta:{x:ss.x,y:ss.y},over:Al};Vl.unstable_batchedUpdates(()=>{vx(Al),Ln==null||Ln(Pt),x({type:"onDragOver",event:Pt})})},[Sl]),ja(()=>{Tt.current={activatorEvent:D,active:U,activeNode:oe,collisionRect:Es,collisions:Js,droppableRects:ne,draggableNodes:R,draggingNode:Ve,draggingNodeRect:ke,droppableContainers:L,over:Ni,scrollableAncestors:Qs,scrollAdjustedTranslate:Tn},I.current={initial:ke,translated:Es}},[U,oe,Js,Es,R,Ve,ke,ne,L,Ni,Qs,Tn]),aR({...it,delta:P,draggingRect:Es,pointerCoordinates:Vf,scrollableAncestors:Qs,scrollableAncestorRects:Rr});const GC=T.useMemo(()=>({active:U,activeNode:oe,activeNodeRect:ue,activatorEvent:D,collisions:Js,containerNodeRect:Nn,dragOverlay:ve,draggableNodes:R,droppableContainers:L,droppableRects:ne,over:Ni,measureDroppableContainers:he,scrollableAncestors:Qs,scrollableAncestorRects:Rr,measuringConfiguration:J,measuringScheduled:re,windowRect:Pr}),[U,oe,ue,D,Js,Nn,ve,R,L,ne,Ni,he,Qs,Rr,J,re,Pr]),WC=T.useMemo(()=>({activatorEvent:D,activators:xx,active:U,activeNodeRect:ue,ariaDescribedById:{draggable:Q},dispatch:w,draggableNodes:R,over:Ni,measureDroppableContainers:he}),[D,xx,U,ue,w,Q,R,Ni,he]);return gt.createElement(JA.Provider,{value:S},gt.createElement(km.Provider,{value:WC},gt.createElement(kR.Provider,{value:GC},gt.createElement(u_.Provider,{value:HC},u)),gt.createElement(PR,{disabled:(o==null?void 0:o.restoreFocus)===!1})),gt.createElement(PP,{...o,hiddenTextDescribedById:Q}));function qC(){const Ut=(K==null?void 0:K.autoScrollEnabled)===!1,Pn=typeof c=="object"?c.enabled===!1:c===!1,Rn=N&&!Ut&&!Pn;return typeof c=="object"?{...c,enabled:Rn}:{enabled:Rn}}}),DR=T.createContext(null),Wb="button",IR="Draggable";function d_(n){let{id:e,data:t,disabled:s=!1,attributes:r}=n;const i=Em(IR),{activators:a,activatorEvent:o,active:c,activeNodeRect:u,ariaDescribedById:d,draggableNodes:h,over:f}=T.useContext(km),{role:g=Wb,roleDescription:y="draggable",tabIndex:m=0}=r??{},b=(c==null?void 0:c.id)===e,w=T.useContext(b?u_:DR),[x,S]=Pg(),[E,C]=Pg(),N=wR(a,e),k=Vd(t);ja(()=>(h.set(e,{id:e,key:i,node:x,activatorNode:E,data:k}),()=>{const P=h.get(e);P&&P.key===i&&h.delete(e)}),[h,e]);const R=T.useMemo(()=>({role:g,tabIndex:m,"aria-disabled":s,"aria-pressed":b&&g===Wb?!0:void 0,"aria-roledescription":y,"aria-describedby":d.draggable}),[s,g,m,b,y,d.draggable]);return{active:c,activatorEvent:o,activeNodeRect:u,attributes:R,isDragging:b,listeners:s?void 0:N,node:x,over:f,setNodeRef:S,setActivatorNodeRef:C,transform:w}}const OR="Droppable",FR={timeout:25};function h_(n){let{data:e,disabled:t=!1,id:s,resizeObserverConfig:r}=n;const i=Em(OR),{active:a,dispatch:o,over:c,measureDroppableContainers:u}=T.useContext(km),d=T.useRef({disabled:t}),h=T.useRef(!1),f=T.useRef(null),g=T.useRef(null),{disabled:y,updateMeasurementsFor:m,timeout:b}={...FR,...r},w=Vd(m??s),x=T.useCallback(()=>{if(!h.current){h.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{u(Array.isArray(w.current)?w.current:[w.current]),g.current=null},b)},[b]),S=Cm({callback:x,disabled:y||!a}),E=T.useCallback((R,P)=>{S&&(P&&(S.unobserve(P),h.current=!1),R&&S.observe(R))},[S]),[C,N]=Pg(E),k=Vd(e);return T.useEffect(()=>{!S||!C.current||(S.disconnect(),h.current=!1,S.observe(C.current))},[C,S]),T.useEffect(()=>(o({type:pt.RegisterDroppable,element:{id:s,key:i,disabled:t,node:C,rect:f,data:k}}),()=>o({type:pt.UnregisterDroppable,key:i,id:s})),[s]),T.useEffect(()=>{t!==d.current.disabled&&(o({type:pt.SetDroppableDisabled,id:s,key:i,disabled:t}),d.current.disabled=t)},[s,i,t,o]),{active:a,rect:f,isOver:(c==null?void 0:c.id)===s,node:C,over:c,setNodeRef:N}}const $u=(n,e)=>{const t=document.getElementById(`port_${n}_${e}`);if(!t)return null;const s=t.closest(".canvas-area-container");if(!s)return null;const r=s.getBoundingClientRect(),i=t.getBoundingClientRect();return{x:i.left-r.left+i.width/2,y:i.top-r.top+i.height/2}},$R=({pendingLink:n,mousePos:e})=>{const t=z(c=>c.links),s=z(c=>c.ghostLinks||[]),r=z(c=>c.canvasComponents),[,i]=T.useState(0);T.useLayoutEffect(()=>{i(c=>c+1)},[t,r]);const a=t.map(c=>{const u=$u(c.source_id,"output"),d=$u(c.target_id,"input");return!u||!d?null:p.jsx("line",{x1:u.x,y1:u.y,x2:d.x,y2:d.y,className:"stroke-gray-500 stroke-2"},c.id)}).filter(Boolean);let o=null;if(n){const c=$u(n.sourceId,n.portId);c&&(o=p.jsx("line",{x1:c.x,y1:c.y,x2:e.x,y2:e.y,className:"stroke-blue-500 stroke-2 stroke-dasharray-4"}))}return p.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:[a,s.map(c=>{const u=$u(c.source_id,"output"),d=$u(c.target_id,"input");return!u||!d?null:p.jsx("line",{x1:u.x,y1:u.y,x2:d.x,y2:d.y,className:"stroke-blue-500 stroke-2",strokeDasharray:"4 4"},c.source_id+c.target_id)}),o]})},zR=()=>{const n=z(s=>s.layers),e=z(s=>s.currentLayer),t=z(s=>s.setCurrentLayer);return p.jsx("div",{className:"flex space-x-2 mb-2","aria-label":"Layer selector",children:n.map(s=>p.jsx("button",{onClick:()=>t(s),className:"px-3 py-1 rounded-md text-sm "+(e===s?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:s},s))})},BR=()=>{const n=z(r=>r.analyzeAndExecute),e=z(r=>r.selectedComponentId),t=z(r=>r.canvasComponents),s=()=>{const r=t.find(i=>i.id===e);r&&n(`generate sub assembly for ${r.name}`)};return p.jsx("button",{onClick:s,disabled:!e,className:"px-2 py-1 text-sm rounded bg-gray-100 hover:bg-gray-200 disabled:opacity-50",children:"Generate Sub-Assembly"})},UR=({sessionId:n})=>{const[e,t]=T.useState(null),[s,r]=T.useState(!1),[i,a]=T.useState(null),[o,c]=T.useState(!0),{addStatusMessage:u}=z(),d=T.useRef(!1),h=T.useCallback(async()=>{if(!(!n||n==="global"||d.current)){r(!0),d.current=!0,a(null);try{const m=`${ee}/odl/sessions/${n}/text`,b=await fetch(m).then(w=>{if(!w.ok)throw new Error(`Failed to fetch ODL text: ${w.statusText}`);return w.json()});t(b)}catch(m){const b=m instanceof Error?m.message:"Unknown error";a(b),t({text:`# Error loading ODL text
# ${b}

# Please check your session ID and try again`,version:0,node_count:0,edge_count:0}),u("Failed to load ODL text","error")}finally{r(!1),d.current=!1}}},[n,u]);T.useEffect(()=>{h()},[n,h]),T.useEffect(()=>{if(!o)return;const m=setInterval(h,5e3);return()=>clearInterval(m)},[o,h]);const f=()=>{h()},g=async()=>{if(e!=null&&e.text)try{await navigator.clipboard.writeText(e.text),u("ODL code copied to clipboard","success")}catch{u("Failed to copy to clipboard","error")}},y=()=>{if(!(e!=null&&e.text))return;const m=new Blob([e.text],{type:"text/plain"}),b=URL.createObjectURL(m),w=document.createElement("a");w.href=b,w.download=`odl-design-v${e.version}.txt`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(b),u("ODL code downloaded","success")};return!n||n==="global"?p.jsx("div",{className:"flex items-center justify-center h-64",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"text-gray-500 mb-2",children:"No active session"}),p.jsx("div",{className:"text-sm text-gray-400",children:"Start designing to see ODL code"})]})}):p.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[p.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-gray-200 bg-white",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ODL Code View"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Live representation of your design in ODL format"})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("button",{onClick:()=>c(!o),className:`px-3 py-1 rounded text-sm ${o?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,title:o?"Disable auto-refresh":"Enable auto-refresh",children:o?"🔄 Auto":"⏸️ Manual"}),p.jsx("button",{onClick:f,disabled:s,className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 disabled:opacity-50",title:"Refresh now",children:"🔄 Refresh"}),p.jsx("button",{onClick:g,disabled:!(e!=null&&e.text),className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 disabled:opacity-50",title:"Copy to clipboard",children:"📋 Copy"}),p.jsx("button",{onClick:y,disabled:!(e!=null&&e.text),className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 disabled:opacity-50",title:"Download as file",children:"💾 Download"})]})]}),e&&p.jsxs("div",{className:"mt-3 flex items-center space-x-4 text-xs text-gray-500",children:[p.jsxs("span",{children:["Version: ",e.version]}),p.jsxs("span",{children:["Nodes: ",e.node_count]}),p.jsxs("span",{children:["Edges: ",e.edge_count]}),p.jsxs("span",{children:["Lines: ",e.text.split(`
`).length]}),e.last_updated&&p.jsxs("span",{children:["Updated: ",new Date(e.last_updated).toLocaleTimeString()]}),s&&p.jsx("span",{className:"text-blue-500",children:"Refreshing..."})]}),i&&p.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700",children:["Error: ",i]})]}),p.jsx("div",{className:"flex-1 overflow-auto",children:p.jsx("pre",{className:"p-4 text-sm font-mono bg-gray-50 h-full overflow-auto leading-relaxed",children:p.jsx("code",{className:"odl-syntax",children:(e==null?void 0:e.text)||`# No design data
# Start by creating a design to see ODL code here`})})}),p.jsx("div",{className:"flex-shrink-0 p-2 border-t border-gray-200 bg-white",children:p.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[p.jsxs("div",{className:"flex items-center space-x-4",children:[p.jsxs("span",{children:["Session: ",n.slice(0,8),"..."]}),e&&p.jsxs("span",{className:"text-green-600",children:["✓ ",e.text.split(`
`).filter(m=>m.trim()&&!m.startsWith("#")).length," active lines"]})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("span",{children:"ODL Format"}),o&&p.jsx("span",{className:"text-blue-500",children:"Auto-updating"})]})]})})]})};function f_(n){var e,t,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=f_(n[e]))&&(s&&(s+=" "),s+=t)}else for(t in n)n[t]&&(s&&(s+=" "),s+=t);return s}function kr(){for(var n,e,t=0,s="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=f_(n))&&(s&&(s+=" "),s+=e);return s}const HR="modulepreload",VR=function(n){return"/"+n},qb={},Nm=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(c=>{if(c=VR(c),c in qb)return;qb[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":HR,u||(h.as="script"),h.crossOrigin="",h.href=c,o&&h.setAttribute("nonce",o),document.head.appendChild(h),u)return new Promise((f,g)=>{h.addEventListener("load",f),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})};let Sy=null,Ay=null;async function GR(){return Sy||(Sy=Nm(()=>import("./main-CBy8804z.js").then(n=>n.m),__vite__mapDeps([0,1]))),Sy}async function WR(){return Ay||(Ay=Nm(()=>import("./index-_6hN_l6d.js").then(n=>n.i),__vite__mapDeps([2,1]))),Ay}async function qR(n,e,t,s){const{default:r}=await GR(),i=new r,a={id:"root",layoutOptions:{"elk.algorithm":"layered","elk.direction":"RIGHT","elk.spacing.nodeNode":"50","elk.layered.spacing.nodeNodeBetweenLayers":"120"},children:n.map(u=>{var h;const d={id:u.id,width:u.width??120,height:u.height??72};return s.has(u.id)&&((h=u.layout)!=null&&h[t])&&(d.x=u.layout[t].x,d.y=u.layout[t].y,d.properties={"org.eclipse.elk.fixed":!0}),d}),edges:e.map(u=>({id:u.id,sources:[u.source],targets:[u.target]}))},o=await i.layout(a),c={};for(const u of o.children??[])s.has(u.id)||(c[u.id]={x:Math.round(u.x),y:Math.round(u.y)});return c}async function XR(n,e,t,s){const r=await WR(),i=new r.graphlib.Graph;i.setGraph({rankdir:"LR",nodesep:50,ranksep:120}),i.setDefaultEdgeLabel(()=>({})),n.forEach(o=>{i.setNode(o.id,{width:o.width??120,height:o.height??72})}),e.forEach(o=>i.setEdge(o.source,o.target)),r.layout(i);const a={};return n.forEach(o=>{if(!s.has(o.id)){const c=i.node(o.id);c&&(a[o.id]={x:Math.round(c.x),y:Math.round(c.y)})}}),a}async function YR(n,e,t,s){const r=new Set(Object.keys(s).filter(i=>s[i]));try{return await qR(n,e,t,r)}catch{return await XR(n,e,t,r)}}let _y=null;async function KR(){return _y||(_y=Nm(()=>import("./main-CBy8804z.js").then(n=>n.m),__vite__mapDeps([0,1]))),_y}async function QR(n,e,t,s){const{default:r}=await KR(),i=new r,a={id:"root",layoutOptions:{"elk.algorithm":"layered","elk.direction":"RIGHT","elk.edgeRouting":"ORTHOGONAL"},children:n.map(u=>{var d,h,f,g;return{id:u.id,x:((h=(d=u.layout)==null?void 0:d[t])==null?void 0:h.x)??0,y:((g=(f=u.layout)==null?void 0:f[t])==null?void 0:g.y)??0,width:u.width??120,height:u.height??72,properties:{"org.eclipse.elk.fixed":!0}}}),edges:e.map(u=>({id:u.id,sources:[u.source],targets:[u.target]}))},o=await i.layout(a),c={};for(const u of o.edges??[]){if(s[u.id])continue;const d=u.sections??[],h=[];for(const f of d){f.startPoint&&h.push({x:Math.round(f.startPoint.x),y:Math.round(f.startPoint.y)});for(const g of f.bendPoints??[])h.push({x:Math.round(g.x),y:Math.round(g.y)});f.endPoint&&h.push({x:Math.round(f.endPoint.x),y:Math.round(f.endPoint.y)})}h.length&&(c[u.id]=h)}return c}const JR=({id:n,port:e,isPending:t,onMouseDown:s,onMouseUp:r})=>{const i=e.type==="in";return p.jsx("div",{id:n,onMouseDown:a=>{a.stopPropagation(),s(e.id,a)},onMouseUp:a=>{a.stopPropagation(),r(e.id,a)},className:kr("absolute top-1/2 -translate-y-1/2 w-4 h-4 rounded-full border-2 border-white cursor-crosshair z-10 transition-transform",{" -left-2 bg-green-400":i," -right-2 bg-red-400":!i,"transform scale-150 shadow-lg":t})})},ZR=({component:n,isPendingLinkSource:e,onStartLink:t,onEndLink:s})=>{const{selectedComponentId:r,selectComponent:i,deleteComponent:a}=z(),o=r===n.id,{attributes:c,listeners:u,setNodeRef:d,transform:h}=d_({id:n.id,data:{type:"canvas-card"}}),f={top:n.y,left:n.x,transform:h?`translate3d(${h.x}px, ${h.y}px, 0)`:void 0,position:"absolute"};return p.jsxs("div",{id:`component-card-${n.id}`,ref:d,style:f,onClick:()=>i(n.id),onContextMenu:g=>{g.preventDefault(),window.confirm(`Are you sure you want to delete "${n.name}"?`)&&a(n.id)},className:kr("absolute h-24 w-32 bg-white border-2 rounded-lg shadow-sm flex flex-col items-center justify-center p-2 cursor-grab",{"border-blue-500 ring-2 ring-blue-500":o,"border-gray-300":!o}),children:[p.jsx("div",{...u,...c,className:"w-full h-full cursor-grab"}),p.jsxs("div",{className:"absolute top-0 left-0 w-full h-full flex flex-col items-center justify-center pointer-events-none",children:[p.jsx("span",{className:"text-sm font-bold",children:n.name}),p.jsx("span",{className:"text-xs text-gray-500",children:n.type})]}),n.ports.map(g=>p.jsx(JR,{id:`port_${n.id}_${g.id}`,port:g,isPending:e&&g.id==="output",onMouseDown:y=>t(n.id,y),onMouseUp:y=>s(n.id,y)},g.id))]})},eL=({pendingLinkSourceId:n,onStartLink:e,onEndLink:t})=>{const{setNodeRef:s}=h_({id:"canvas-area"}),r=z(o=>o.currentLayer),a=z(o=>o.canvasComponents).filter(o=>!o.layer||o.layer===r);return p.jsx("div",{className:"flex-grow h-full relative",children:p.jsx("div",{ref:s,className:"canvas-area-container w-full h-full border-2 border-dashed border-gray-300 rounded-lg",children:a.map(o=>p.jsx(ZR,{component:o,isPendingLinkSource:n===o.id,onStartLink:e,onEndLink:t},o.id))})})},tL=()=>{const{addComponent:n,updateComponentPosition:e,addLink:t,fetchProject:s,selectedComponentId:r,deleteComponent:i,currentLayer:a,sessionId:o,canvasComponents:c,links:u}=z();T.useEffect(()=>{s()},[s]),T.useEffect(()=>{const C=N=>{(N.key==="Delete"||N.key==="Backspace")&&r&&i(r)};return window.addEventListener("keydown",C),()=>window.removeEventListener("keydown",C)},[r,i]);const[d,h]=T.useState(null),[f,g]=T.useState({x:0,y:0}),y=(C,N)=>{N==="output"&&h({sourceId:C,portId:N})},m=async(C,N)=>{d&&N==="input"&&d.sourceId!==C&&await t({source_id:d.sourceId,target_id:C}),h(null)},b=C=>{if(d){const N=C.currentTarget.getBoundingClientRect();g({x:C.clientX-N.left,y:C.clientY-N.top})}},w=()=>{h(null)},x=async()=>{const N={"Single-Line Diagram":"single_line","High-Level Overview":"high_level","Civil/Structural":"civil","Networking/Monitoring":"networking","ODL Code":"physical"}[a]||"single_line",k=c.map(M=>({id:M.id,width:120,height:72,layout:{[N]:{x:M.x,y:M.y}}})),R=u.map(M=>({id:M.id,source:M.source_id,target:M.target_id})),L=await YR(k,R,N,{});for(const[M,I]of Object.entries(L)){const U=c.find(K=>K.id===M);if(!U)continue;const B={x:I.x-U.x,y:I.y-U.y};await e(M,B)}},S=async()=>{const N={"Single-Line Diagram":"single_line","High-Level Overview":"high_level","Civil/Structural":"civil","Networking/Monitoring":"networking","ODL Code":"physical"}[a]||"single_line";try{const k=await fetch(`/api/v1/layout/route?session_id=${o}&layer=${N}`,{method:"POST"});if(k.status===501)throw new Error("client router");if(!k.ok)throw new Error(await k.text());return}catch{const k={};u.forEach(M=>{var I;return k[M.id]=((I=M.locked_in_layers)==null?void 0:I[N])??!1});const R=c.map(M=>({id:M.id,width:120,height:72,layout:{[N]:{x:M.x,y:M.y}}})),P=u.map(M=>({id:M.id,source:M.source_id,target:M.target_id})),L=await QR(R,P,N,k);await Promise.all(Object.entries(L).map(([M,I])=>fetch(`/api/v1/links/${M}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({path_by_layer:{[N]:I},locked_in_layers:{[N]:!1}})})))}},E=()=>a==="ODL Code"?p.jsx(UR,{sessionId:o}):p.jsxs(p.Fragment,{children:[p.jsx($R,{pendingLink:d,mousePos:f}),p.jsx(eL,{pendingLinkSourceId:(d==null?void 0:d.sourceId)??null,onStartLink:y,onEndLink:m})]});return p.jsxs("div",{className:"flex-grow h-full relative flex flex-col",onMouseMove:b,onMouseUp:w,children:[p.jsxs("div",{className:"p-2 flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2",children:[p.jsx(zR,{}),p.jsx(BR,{}),p.jsx("button",{onClick:x,className:"px-3 py-1 rounded-md text-sm bg-gray-100 text-gray-700 hover:bg-gray-200",children:"Auto Layout"}),p.jsx("button",{onClick:S,className:"px-3 py-1 rounded-md text-sm bg-gray-100 text-gray-700 hover:bg-gray-200",children:"Auto Route"})]}),p.jsx("div",{className:"flex-grow relative",children:E()})]})},ln=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Lv=[.001,0,0,.001,0,0],Ey=1.35,qn={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ar={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},nL="pdfjs_internal_editor_",ie={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},ye={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},p_={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Gt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Ed={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ze={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},El={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Df={ERRORS:0,WARNINGS:1,INFOS:5},Wd={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},cp={moveTo:0,lineTo:1,curveTo:2,closePath:3},g_={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Tm=Df.WARNINGS;function sL(n){Number.isInteger(n)&&(Tm=n)}function rL(){return Tm}function Pm(n){Tm>=Df.INFOS&&console.log(`Info: ${n}`)}function ae(n){Tm>=Df.WARNINGS&&console.log(`Warning: ${n}`)}function Pe(n){throw new Error(n)}function lt(n,e){n||Pe(e)}function iL(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Qw(n,e=null,t=null){if(!n)return null;if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const r=n.match(/\./g);(r==null?void 0:r.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=uL(n)}catch{}}const s=e?URL.parse(n,e):URL.parse(n);return iL(s)?s:null}function Jw(n,e,t=!1){const s=URL.parse(n);return s?(s.hash=e,s.href):t&&Qw(n,"http://example.com")?n.split("#",1)[0]+`${e?`#${e}`:""}`:""}function pe(n,e,t,s=!1){return Object.defineProperty(n,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const wl=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class Xb extends wl{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Cy extends wl{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class jg extends wl{constructor(e){super(e,"InvalidPDFException")}}class qd extends wl{constructor(e,t,s){super(e,"ResponseException"),this.status=t,this.missing=s}}class aL extends wl{constructor(e){super(e,"FormatError")}}class _i extends wl{constructor(e){super(e,"AbortException")}}function m_(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&Pe("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const s=[];for(let r=0;r<e;r+=t){const i=Math.min(r+t,e),a=n.subarray(r,i);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function If(n){typeof n!="string"&&Pe("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=n.charCodeAt(s)&255;return t}function oL(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function lL(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function cL(){try{return new Function(""),!0}catch{return!1}}class Nt{static get isLittleEndian(){return pe(this,"isLittleEndian",lL())}static get isEvalSupported(){return pe(this,"isEvalSupported",cL())}static get isOffscreenCanvasSupported(){return pe(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return pe(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return pe(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return pe(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const ky=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var vi,Tp,Mv;class te{static makeHexColor(e,t,s){return`#${ky[e]}${ky[t]}${ky[s]}`}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t,s=0){const r=e[s],i=e[s+1];e[s]=r*t[0]+i*t[2]+t[4],e[s+1]=r*t[1]+i*t[3]+t[5]}static applyTransformToBezier(e,t,s=0){const r=t[0],i=t[1],a=t[2],o=t[3],c=t[4],u=t[5];for(let d=0;d<6;d+=2){const h=e[s+d],f=e[s+d+1];e[s+d]=h*r+f*a+c,e[s+d+1]=h*i+f*o+u}}static applyInverseTransform(e,t){const s=e[0],r=e[1],i=t[0]*t[3]-t[1]*t[2];e[0]=(s*t[3]-r*t[2]+t[2]*t[5]-t[4]*t[3])/i,e[1]=(-s*t[1]+r*t[0]+t[4]*t[1]-t[5]*t[0])/i}static axialAlignedBoundingBox(e,t,s){const r=t[0],i=t[1],a=t[2],o=t[3],c=t[4],u=t[5],d=e[0],h=e[1],f=e[2],g=e[3];let y=r*d+c,m=y,b=r*f+c,w=b,x=o*h+u,S=x,E=o*g+u,C=E;if(i!==0||a!==0){const N=i*d,k=i*f,R=a*h,P=a*g;y+=R,w+=R,b+=P,m+=P,x+=N,C+=N,E+=k,S+=k}s[0]=Math.min(s[0],y,b,m,w),s[1]=Math.min(s[1],x,E,S,C),s[2]=Math.max(s[2],y,b,m,w),s[3]=Math.max(s[3],x,E,S,C)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const s=e[0],r=e[1],i=e[2],a=e[3],o=s**2+r**2,c=s*i+r*a,u=i**2+a**2,d=(o+u)/2,h=Math.sqrt(d**2-(o*u-c**2));t[0]=Math.sqrt(d+h||1),t[1]=Math.sqrt(d-h||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>r)return null;const i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>a?null:[s,i,r,a]}static pointBoundingBox(e,t,s){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}static rectBoundingBox(e,t,s,r,i){i[0]=Math.min(i[0],e,s),i[1]=Math.min(i[1],t,r),i[2]=Math.max(i[2],e,s),i[3]=Math.max(i[3],t,r)}static bezierBoundingBox(e,t,s,r,i,a,o,c,u){u[0]=Math.min(u[0],e,o),u[1]=Math.min(u[1],t,c),u[2]=Math.max(u[2],e,o),u[3]=Math.max(u[3],t,c),_(this,vi,Mv).call(this,e,s,i,o,t,r,a,c,3*(-e+3*(s-i)+o),6*(e-2*s+i),3*(s-e),u),_(this,vi,Mv).call(this,e,s,i,o,t,r,a,c,3*(-t+3*(r-a)+c),6*(t-2*r+a),3*(r-t),u)}}vi=new WeakSet,Tp=function(e,t,s,r,i,a,o,c,u,d){if(u<=0||u>=1)return;const h=1-u,f=u*u,g=f*u,y=h*(h*(h*e+3*u*t)+3*f*s)+g*r,m=h*(h*(h*i+3*u*a)+3*f*o)+g*c;d[0]=Math.min(d[0],y),d[1]=Math.min(d[1],m),d[2]=Math.max(d[2],y),d[3]=Math.max(d[3],m)},Mv=function(e,t,s,r,i,a,o,c,u,d,h,f){if(Math.abs(u)<1e-12){Math.abs(d)>=1e-12&&_(this,vi,Tp).call(this,e,t,s,r,i,a,o,c,-h/d,f);return}const g=d**2-4*h*u;if(g<0)return;const y=Math.sqrt(g),m=2*u;_(this,vi,Tp).call(this,e,t,s,r,i,a,o,c,(-d+y)/m,f),_(this,vi,Tp).call(this,e,t,s,r,i,a,o,c,(-d-y)/m,f)},A(te,vi);function uL(n){return decodeURIComponent(escape(n))}let Ny=null,Yb=null;function y_(n){return Ny||(Ny=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Yb=new Map([["ﬅ","ſt"]])),n.replaceAll(Ny,(e,t,s)=>t?t.normalize("NFKC"):Yb.get(s))}function Zw(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),m_(n)}const ex="pdfjs_internal_id_";function dL(n,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[s,r,...i]=t;if(!n(s)&&!Number.isInteger(s)||!e(r))return!1;const a=i.length;let o=!0;switch(r.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;o=!1;break;default:return!1}for(const c of i)if(!(typeof c=="number"||o&&c===null))return!1;return!0}function Qt(n,e,t){return Math.min(Math.max(n,e),t)}function v_(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(m_(n))}function hL(n){return Uint8Array.fromBase64?Uint8Array.fromBase64(n):If(atob(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(n){return n.reduce((e,t)=>e+t,0)});const Mr="http://www.w3.org/2000/svg",Ka=class Ka{};$(Ka,"CSS",96),$(Ka,"PDF",72),$(Ka,"PDF_TO_CSS_UNITS",Ka.CSS/Ka.PDF);let Ei=Ka;async function ku(n,e="text"){if(Xu(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}s(new Error(r.statusText))}},r.send(null)})}class Of{constructor({viewBox:e,userUnit:t,scale:s,rotation:r,offsetX:i=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=r,this.offsetX=i,this.offsetY=a,s*=t;const c=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let d,h,f,g;switch(r%=360,r<0&&(r+=360),r){case 180:d=-1,h=0,f=0,g=1;break;case 90:d=0,h=1,f=1,g=0;break;case 270:d=0,h=-1,f=-1,g=0;break;case 0:d=1,h=0,f=0,g=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(f=-f,g=-g);let y,m,b,w;d===0?(y=Math.abs(u-e[1])*s+i,m=Math.abs(c-e[0])*s+a,b=(e[3]-e[1])*s,w=(e[2]-e[0])*s):(y=Math.abs(c-e[0])*s+i,m=Math.abs(u-e[1])*s+a,b=(e[2]-e[0])*s,w=(e[3]-e[1])*s),this.transform=[d*s,h*s,f*s,g*s,y-d*s*c-f*s*u,m-h*s*c-g*s*u],this.width=b,this.height=w}get rawDims(){const e=this.viewBox;return pe(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:r=this.offsetY,dontFlip:i=!1}={}){return new Of({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:r,dontFlip:i})}convertToViewportPoint(e,t){const s=[e,t];return te.applyTransform(s,this.transform),s}convertToViewportRectangle(e){const t=[e[0],e[1]];te.applyTransform(t,this.transform);const s=[e[2],e[3]];return te.applyTransform(s,this.transform),[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){const s=[e,t];return te.applyInverseTransform(s,this.transform),s}}class Rm extends wl{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Ff(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function Lm(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function w_(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function x_(n,e="document.pdf"){if(typeof n!="string")return e;if(Ff(n))return ae('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,r=t.exec(n);let i=s.exec(r[1])||s.exec(r[2])||s.exec(r[3]);if(i&&(i=i[0],i.includes("%")))try{i=s.exec(decodeURIComponent(i))[0]}catch{}return i||e}class Kb{constructor(){$(this,"started",Object.create(null));$(this,"times",[])}time(e){e in this.started&&ae(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||ae(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:r,end:i}of this.times)e.push(`${s.padEnd(t)} ${i-r}ms
`);return e.join("")}}function Xu(n,e){const t=e?URL.parse(n,e):URL.parse(n);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function As(n){n.preventDefault()}function nt(n){n.preventDefault(),n.stopPropagation()}function fL(n){console.log("Deprecated API usage: "+n)}var Zd;class Mm{static toDateObject(e){if(!e||typeof e!="string")return null;l(this,Zd)||v(this,Zd,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=l(this,Zd).exec(e);if(!t)return null;const s=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;const u=t[7]||"Z";let d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,u==="-"?(a+=d,o+=h):u==="+"&&(a-=d,o-=h),new Date(Date.UTC(s,r,i,a,o,c))}}Zd=new WeakMap,A(Mm,Zd);function b_(n,{scale:e=1,rotation:t=0}){const{width:s,height:r}=n.attributes.style,i=[0,0,parseInt(s),parseInt(r)];return new Of({viewBox:i,userUnit:1,scale:e,rotation:t})}function tx(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(ae(`Not a valid color format: "${n}"`),[0,0,0])}function pL(n){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of n.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;n.set(t,tx(s))}e.remove()}function We(n){const{a:e,b:t,c:s,d:r,e:i,f:a}=n.getTransform();return[e,t,s,r,i,a]}function nr(n){const{a:e,b:t,c:s,d:r,e:i,f:a}=n.getTransform().invertSelf();return[e,t,s,r,i,a]}function Da(n,e,t=!1,s=!0){if(e instanceof Of){const{pageWidth:r,pageHeight:i}=e.rawDims,{style:a}=n,o=Nt.isCSSRoundSupported,c=`var(--total-scale-factor) * ${r}px`,u=`var(--total-scale-factor) * ${i}px`,d=o?`round(down, ${c}, var(--scale-round-x))`:`calc(${c})`,h=o?`round(down, ${u}, var(--scale-round-y))`:`calc(${u})`;!t||e.rotation%180===0?(a.width=d,a.height=h):(a.width=h,a.height=d)}s&&n.setAttribute("data-main-rotation",e.rotation)}class Ys{constructor(){const{pixelRatio:e}=Ys;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,s,r,i=-1){let a=1/0,o=1/0,c=1/0;s=Ys.capPixels(s,i),s>0&&(a=Math.sqrt(s/(e*t))),r!==-1&&(o=r/e,c=r/t);const u=Math.min(a,o,c);return this.sx>u||this.sy>u?(this.sx=u,this.sy=u,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,s):s}return e}}const Dg=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var $i,to,is,zi,eh,ic,th,Ug,S_,$t,A_,__,Yu,E_,Pp;const Or=class Or{constructor(e){A(this,$t);A(this,$i,null);A(this,to,null);A(this,is);A(this,zi,null);A(this,eh,null);A(this,ic,null);v(this,is,e),l(Or,th)||v(Or,th,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=v(this,$i,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=l(this,is)._uiManager._signal;e.addEventListener("contextmenu",As,{signal:t}),e.addEventListener("pointerdown",_(Or,Ug,S_),{signal:t});const s=v(this,zi,document.createElement("div"));s.className="buttons",e.append(s);const r=l(this,is).toolbarPosition;if(r){const{style:i}=e,a=l(this,is)._uiManager.direction==="ltr"?1-r[0]:r[0];i.insetInlineEnd=`${100*a}%`,i.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return _(this,$t,E_).call(this),e}get div(){return l(this,$i)}hide(){var e;l(this,$i).classList.add("hidden"),(e=l(this,to))==null||e.hideDropdown()}show(){var e;l(this,$i).classList.remove("hidden"),(e=l(this,eh))==null||e.shown()}async addAltText(e){const t=await e.render();_(this,$t,Yu).call(this,t),l(this,zi).prepend(t,l(this,$t,Pp)),v(this,eh,e)}addColorPicker(e){v(this,to,e);const t=e.renderButton();_(this,$t,Yu).call(this,t),l(this,zi).prepend(t,l(this,$t,Pp))}async addEditSignatureButton(e){const t=v(this,ic,await e.renderEditButton(l(this,is)));_(this,$t,Yu).call(this,t),l(this,zi).prepend(t,l(this,$t,Pp))}updateEditSignatureButton(e){l(this,ic)&&(l(this,ic).title=e)}remove(){var e;l(this,$i).remove(),(e=l(this,to))==null||e.destroy(),v(this,to,null)}};$i=new WeakMap,to=new WeakMap,is=new WeakMap,zi=new WeakMap,eh=new WeakMap,ic=new WeakMap,th=new WeakMap,Ug=new WeakSet,S_=function(e){e.stopPropagation()},$t=new WeakSet,A_=function(e){l(this,is)._focusEventsAllowed=!1,nt(e)},__=function(e){l(this,is)._focusEventsAllowed=!0,nt(e)},Yu=function(e){const t=l(this,is)._uiManager._signal;e.addEventListener("focusin",_(this,$t,A_).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",_(this,$t,__).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",As,{signal:t})},E_=function(){const{editorType:e,_uiManager:t}=l(this,is),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",l(Or,th)[e]),_(this,$t,Yu).call(this,s),s.addEventListener("click",r=>{t.delete()},{signal:t._signal}),l(this,zi).append(s)},Pp=function(){const e=document.createElement("div");return e.className="divider",e},A(Or,Ug),A(Or,th,null);let jv=Or;var nh,no,so,Oa,C_,k_,N_;class gL{constructor(e){A(this,Oa);A(this,nh,null);A(this,no,null);A(this,so);v(this,so,e)}show(e,t,s){const[r,i]=_(this,Oa,k_).call(this,t,s),{style:a}=l(this,no)||v(this,no,_(this,Oa,C_).call(this));e.append(l(this,no)),a.insetInlineEnd=`${100*r}%`,a.top=`calc(${100*i}% + var(--editor-toolbar-vert-offset))`}hide(){l(this,no).remove()}}nh=new WeakMap,no=new WeakMap,so=new WeakMap,Oa=new WeakSet,C_=function(){const e=v(this,no,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",As,{signal:l(this,so)._signal});const t=v(this,nh,document.createElement("div"));return t.className="buttons",e.append(t),_(this,Oa,N_).call(this),e},k_=function(e,t){let s=0,r=0;for(const i of e){const a=i.y+i.height;if(a<s)continue;const o=i.x+(t?i.width:0);if(a>s){r=o,s=a;continue}t?o>r&&(r=o):o<r&&(r=o)}return[t?1-r:r,s]},N_=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=l(this,so)._signal;e.addEventListener("contextmenu",As,{signal:s}),e.addEventListener("click",()=>{l(this,so).highlightSelection("floating_button")},{signal:s}),l(this,nh).append(e)};function T_(n,e,t){for(const s of t)e.addEventListener(s,n[s].bind(n))}var Hg;class mL{constructor(){A(this,Hg,0)}get id(){return`${nL}${tn(this,Hg)._++}`}}Hg=new WeakMap;var ac,sh,qt,oc,Rp;const px=class px{constructor(){A(this,oc);A(this,ac,Zw());A(this,sh,0);A(this,qt,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const i=r.decode().then(()=>(s.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return pe(this,"_isSVGFittingCanvas",i)}async getFromFile(e){const{lastModified:t,name:s,size:r,type:i}=e;return _(this,oc,Rp).call(this,`${t}_${s}_${r}_${i}`,e)}async getFromUrl(e){return _(this,oc,Rp).call(this,e,e)}async getFromBlob(e,t){const s=await t;return _(this,oc,Rp).call(this,e,s)}async getFromId(e){l(this,qt)||v(this,qt,new Map);const t=l(this,qt).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){l(this,qt)||v(this,qt,new Map);let s=l(this,qt).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),s={bitmap:r.transferToImageBitmap(),id:`image_${l(this,ac)}_${tn(this,sh)._++}`,refCounter:1,isSvg:!1},l(this,qt).set(e,s),l(this,qt).set(s.id,s),s}getSvgUrl(e){const t=l(this,qt).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var r;l(this,qt)||v(this,qt,new Map);const t=l(this,qt).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const i=new OffscreenCanvas(s.width,s.height);i.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=i.convertToBlob()}(r=s.close)==null||r.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${l(this,ac)}_`)}};ac=new WeakMap,sh=new WeakMap,qt=new WeakMap,oc=new WeakSet,Rp=async function(e,t){l(this,qt)||v(this,qt,new Map);let s=l(this,qt).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${l(this,ac)}_${tn(this,sh)._++}`,refCounter:0,isSvg:!1});let r;if(typeof t=="string"?(s.url=t,r=await ku(t,"blob")):t instanceof File?r=s.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const i=px._isSVGFittingCanvas,a=new FileReader,o=new Image,c=new Promise((u,d)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,u()},a.onload=async()=>{const h=s.svgUrl=a.result;o.src=await i?`${h}#svgView(preserveAspectRatio(none))`:h},o.onerror=a.onerror=d});a.readAsDataURL(r),await c}else s.bitmap=await createImageBitmap(r);s.refCounter=1}catch(r){ae(r),s=null}return l(this,qt).set(e,s),s&&l(this,qt).set(s.id,s),s};let Dv=px;var et,Bi,rh,Ge;class yL{constructor(e=128){A(this,et,[]);A(this,Bi,!1);A(this,rh);A(this,Ge,-1);v(this,rh,e)}add({cmd:e,undo:t,post:s,mustExec:r,type:i=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(r&&e(),l(this,Bi))return;const c={cmd:e,undo:t,post:s,type:i};if(l(this,Ge)===-1){l(this,et).length>0&&(l(this,et).length=0),v(this,Ge,0),l(this,et).push(c);return}if(a&&l(this,et)[l(this,Ge)].type===i){o&&(c.undo=l(this,et)[l(this,Ge)].undo),l(this,et)[l(this,Ge)]=c;return}const u=l(this,Ge)+1;u===l(this,rh)?l(this,et).splice(0,1):(v(this,Ge,u),u<l(this,et).length&&l(this,et).splice(u)),l(this,et).push(c)}undo(){if(l(this,Ge)===-1)return;v(this,Bi,!0);const{undo:e,post:t}=l(this,et)[l(this,Ge)];e(),t==null||t(),v(this,Bi,!1),v(this,Ge,l(this,Ge)-1)}redo(){if(l(this,Ge)<l(this,et).length-1){v(this,Ge,l(this,Ge)+1),v(this,Bi,!0);const{cmd:e,post:t}=l(this,et)[l(this,Ge)];e(),t==null||t(),v(this,Bi,!1)}}hasSomethingToUndo(){return l(this,Ge)!==-1}hasSomethingToRedo(){return l(this,Ge)<l(this,et).length-1}cleanType(e){if(l(this,Ge)!==-1){for(let t=l(this,Ge);t>=0;t--)if(l(this,et)[t].type!==e){l(this,et).splice(t+1,l(this,Ge)-t),v(this,Ge,t);return}l(this,et).length=0,v(this,Ge,-1)}}destroy(){v(this,et,null)}}et=new WeakMap,Bi=new WeakMap,rh=new WeakMap,Ge=new WeakMap;var Vg,P_;class $f{constructor(e){A(this,Vg);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Nt.platform;for(const[s,r,i={}]of e)for(const a of s){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:r,options:i}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:r,options:i}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(_(this,Vg,P_).call(this,t));if(!s)return;const{callback:r,options:{bubbles:i=!1,args:a=[],checker:o=null}}=s;o&&!o(e,t)||(r.bind(e,...a,t)(),i||nt(t))}}Vg=new WeakSet,P_=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Gg=class Gg{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return pL(e),pe(this,"_colors",e)}convert(e){const t=tx(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,r]of this._colors)if(r.every((i,a)=>i===t[a]))return Gg._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?te.makeHexColor(...t):e}};$(Gg,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Iv=Gg;var lc,jn,dt,Rt,cc,zr,uc,as,Ui,Hi,dc,ro,ar,Ts,io,ih,ah,hc,oh,or,Vi,fc,Gi,lr,Wg,Wi,lh,qi,ao,oo,Xi,ch,wt,Ee,Br,Yi,lo,uh,dh,Ki,cr,Ur,hh,os,V,Lp,Ov,R_,L_,Mp,M_,j_,D_,Fv,I_,$v,zv,O_,nn,jr,F_,$_,Bv,z_,Ku,Uv;const Wl=class Wl{constructor(e,t,s,r,i,a,o,c,u,d,h,f,g,y){A(this,V);A(this,lc,new AbortController);A(this,jn,null);A(this,dt,new Map);A(this,Rt,new Map);A(this,cc,null);A(this,zr,null);A(this,uc,null);A(this,as,new yL);A(this,Ui,null);A(this,Hi,null);A(this,dc,0);A(this,ro,new Set);A(this,ar,null);A(this,Ts,null);A(this,io,new Set);$(this,"_editorUndoBar",null);A(this,ih,!1);A(this,ah,!1);A(this,hc,!1);A(this,oh,null);A(this,or,null);A(this,Vi,null);A(this,fc,null);A(this,Gi,!1);A(this,lr,null);A(this,Wg,new mL);A(this,Wi,!1);A(this,lh,!1);A(this,qi,null);A(this,ao,null);A(this,oo,null);A(this,Xi,null);A(this,ch,null);A(this,wt,ie.NONE);A(this,Ee,new Set);A(this,Br,null);A(this,Yi,null);A(this,lo,null);A(this,uh,null);A(this,dh,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});A(this,Ki,[0,0]);A(this,cr,null);A(this,Ur,null);A(this,hh,null);A(this,os,null);const m=this._signal=l(this,lc).signal;v(this,Ur,e),v(this,hh,t),v(this,cc,s),v(this,Yi,r),this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:m}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:m}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:m}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:m}),i._on("setpreference",this.onSetPreference.bind(this),{signal:m}),i._on("switchannotationeditorparams",b=>this.updateParams(b.type,b.value),{signal:m}),_(this,V,M_).call(this),_(this,V,O_).call(this),_(this,V,Fv).call(this),v(this,zr,a.annotationStorage),v(this,oh,a.filterFactory),v(this,lo,o),v(this,fc,c||null),v(this,ih,u),v(this,ah,d),v(this,hc,h),v(this,ch,f||null),this.viewParameters={realScale:Ei.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=y!==!1}static get _keyboardManager(){const e=Wl.prototype,t=a=>l(a,Ur).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:c}=o;return c!=="text"&&c!=="number"}return!0},r=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return pe(this,"_keyboardManager",new $f([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&l(a,Ur).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&l(a,Ur).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}]]))}destroy(){var e,t,s,r,i,a,o,c;(e=l(this,os))==null||e.resolve(),v(this,os,null),(t=l(this,lc))==null||t.abort(),v(this,lc,null),this._signal=null;for(const u of l(this,Rt).values())u.destroy();l(this,Rt).clear(),l(this,dt).clear(),l(this,io).clear(),(s=l(this,Xi))==null||s.clear(),v(this,jn,null),l(this,Ee).clear(),l(this,as).destroy(),(r=l(this,cc))==null||r.destroy(),(i=l(this,Yi))==null||i.destroy(),(a=l(this,lr))==null||a.hide(),v(this,lr,null),(o=l(this,oo))==null||o.destroy(),v(this,oo,null),l(this,or)&&(clearTimeout(l(this,or)),v(this,or,null)),l(this,cr)&&(clearTimeout(l(this,cr)),v(this,cr,null)),(c=this._editorUndoBar)==null||c.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return l(this,ch)}get useNewAltTextFlow(){return l(this,ah)}get useNewAltTextWhenAddingImage(){return l(this,hc)}get hcmFilter(){return pe(this,"hcmFilter",l(this,lo)?l(this,oh).addHCMFilter(l(this,lo).foreground,l(this,lo).background):"none")}get direction(){return pe(this,"direction",getComputedStyle(l(this,Ur)).direction)}get highlightColors(){return pe(this,"highlightColors",l(this,fc)?new Map(l(this,fc).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return pe(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),v(this,Hi,e)}setMainHighlightColorPicker(e){v(this,oo,e)}editAltText(e,t=!1){var s;(s=l(this,cc))==null||s.editAltText(this,e,t)}getSignature(e){var t;(t=l(this,Yi))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return l(this,Yi)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":v(this,hc,t);break}}onPageChanging({pageNumber:e}){v(this,dc,e-1)}focusMainContainer(){l(this,Ur).focus()}findParent(e,t){for(const s of l(this,Rt).values()){const{x:r,y:i,width:a,height:o}=s.div.getBoundingClientRect();if(e>=r&&e<=r+a&&t>=i&&t<=i+o)return s}return null}disableUserSelect(e=!1){l(this,hh).classList.toggle("noUserSelect",e)}addShouldRescale(e){l(this,io).add(e)}removeShouldRescale(e){l(this,io).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*Ei.PDF_TO_CSS_UNITS;for(const s of l(this,io))s.onScaleChanging();(t=l(this,Hi))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:s,anchorOffset:r,focusNode:i,focusOffset:a}=t,o=t.toString(),u=_(this,V,Lp).call(this,t).closest(".textLayer"),d=this.getSelectionBoxes(u);if(!d)return;t.empty();const h=_(this,V,Ov).call(this,u),f=l(this,wt)===ie.NONE,g=()=>{h==null||h.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:s,anchorOffset:r,focusNode:i,focusOffset:a,text:o}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(ie.HIGHLIGHT,g);return}g()}addToAnnotationStorage(e){!e.isEmpty()&&l(this,zr)&&!l(this,zr).has(e.id)&&l(this,zr).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,l(this,Gi)&&(v(this,Gi,!1),_(this,V,Mp).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of l(this,Ee))if(t.div.contains(e)){v(this,ao,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!l(this,ao))return;const[e,t]=l(this,ao);v(this,ao,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){_(this,V,Fv).call(this),_(this,V,$v).call(this)}removeEditListeners(){_(this,V,I_).call(this),_(this,V,zv).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of l(this,Ts))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of l(this,Ts))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=l(this,jn))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const r of l(this,Ee)){const i=r.serialize(!0);i&&t.push(i)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const i of t.items)for(const a of l(this,Ts))if(a.isHandlingMimeForPasting(i.type)){a.paste(i,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(i){ae(`paste: "${i.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const r=this.currentLayer;try{const i=[];for(const c of s){const u=await r.deserialize(c);if(!u)return;i.push(u)}const a=()=>{for(const c of i)_(this,V,Bv).call(this,c);_(this,V,Uv).call(this,i)},o=()=>{for(const c of i)c.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(i){ae(`paste: "${i.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),l(this,wt)!==ie.NONE&&!this.isEditorHandlingKeyboard&&Wl._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,l(this,Gi)&&(v(this,Gi,!1),_(this,V,Mp).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(_(this,V,j_).call(this),_(this,V,$v).call(this),_(this,V,nn).call(this,{isEditing:l(this,wt)!==ie.NONE,isEmpty:_(this,V,Ku).call(this),hasSomethingToUndo:l(this,as).hasSomethingToUndo(),hasSomethingToRedo:l(this,as).hasSomethingToRedo(),hasSelectedEditor:!1})):(_(this,V,D_).call(this),_(this,V,zv).call(this),_(this,V,nn).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!l(this,Ts)){v(this,Ts,e);for(const t of l(this,Ts))_(this,V,jr).call(this,t.defaultPropertiesToUpdate)}}getId(){return l(this,Wg).id}get currentLayer(){return l(this,Rt).get(l(this,dc))}getLayer(e){return l(this,Rt).get(e)}get currentPageIndex(){return l(this,dc)}addLayer(e){l(this,Rt).set(e.pageIndex,e),l(this,Wi)?e.enable():e.disable()}removeLayer(e){l(this,Rt).delete(e.pageIndex)}async updateMode(e,t=null,s=!1){var r,i,a;if(l(this,wt)!==e&&!(l(this,os)&&(await l(this,os).promise,!l(this,os)))){if(v(this,os,Promise.withResolvers()),(r=l(this,Hi))==null||r.commitOrRemove(),v(this,wt,e),e===ie.NONE){this.setEditingState(!1),_(this,V,$_).call(this),(i=this._editorUndoBar)==null||i.hide(),l(this,os).resolve();return}e===ie.SIGNATURE&&await((a=l(this,Yi))==null?void 0:a.loadSignatures()),this.setEditingState(!0),await _(this,V,F_).call(this),this.unselectAll();for(const o of l(this,Rt).values())o.updateMode(e);if(!t){s&&this.addNewEditorFromKeyboard(),l(this,os).resolve();return}for(const o of l(this,dt).values())o.annotationElementId===t||o.id===t?(this.setSelected(o),o.enterInEditMode()):o.unselect();l(this,os).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==l(this,wt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){var s;if(l(this,Ts)){switch(e){case ye.CREATE:this.currentLayer.addNewEditor(t);return;case ye.HIGHLIGHT_DEFAULT_COLOR:(s=l(this,oo))==null||s.updateColor(t);break;case ye.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(l(this,uh)||v(this,uh,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const r of l(this,Ee))r.updateParams(e,t);for(const r of l(this,Ts))r.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var i;for(const a of l(this,dt).values())a.editorType===e&&a.show(t);(((i=l(this,uh))==null?void 0:i.get(ye.HIGHLIGHT_SHOW_ALL))??!0)!==t&&_(this,V,jr).call(this,[[ye.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(l(this,lh)!==e){v(this,lh,e);for(const t of l(this,Rt).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const s of l(this,dt).values())s.pageIndex===e&&t.push(s);return t}getEditor(e){return l(this,dt).get(e)}addEditor(e){l(this,dt).set(e.id,e)}removeEditor(e){var t,s;e.div.contains(document.activeElement)&&(l(this,or)&&clearTimeout(l(this,or)),v(this,or,setTimeout(()=>{this.focusMainContainer(),v(this,or,null)},0))),l(this,dt).delete(e.id),e.annotationElementId&&((t=l(this,Xi))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!l(this,ro).has(e.annotationElementId))&&((s=l(this,zr))==null||s.remove(e.id))}addDeletedAnnotationElement(e){l(this,ro).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return l(this,ro).has(e)}removeDeletedAnnotationElement(e){l(this,ro).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){l(this,jn)!==e&&(v(this,jn,e),e&&_(this,V,jr).call(this,e.propertiesToUpdate))}updateUI(e){l(this,V,z_)===e&&_(this,V,jr).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){_(this,V,jr).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(l(this,Ee).has(e)){l(this,Ee).delete(e),e.unselect(),_(this,V,nn).call(this,{hasSelectedEditor:this.hasSelection});return}l(this,Ee).add(e),e.select(),_(this,V,jr).call(this,e.propertiesToUpdate),_(this,V,nn).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=l(this,Hi))==null||t.commitOrRemove();for(const s of l(this,Ee))s!==e&&s.unselect();l(this,Ee).clear(),l(this,Ee).add(e),e.select(),_(this,V,jr).call(this,e.propertiesToUpdate),_(this,V,nn).call(this,{hasSelectedEditor:!0})}isSelected(e){return l(this,Ee).has(e)}get firstSelectedEditor(){return l(this,Ee).values().next().value}unselect(e){e.unselect(),l(this,Ee).delete(e),_(this,V,nn).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return l(this,Ee).size!==0}get isEnterHandled(){return l(this,Ee).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;l(this,as).undo(),_(this,V,nn).call(this,{hasSomethingToUndo:l(this,as).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:_(this,V,Ku).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){l(this,as).redo(),_(this,V,nn).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:l(this,as).hasSomethingToRedo(),isEmpty:_(this,V,Ku).call(this)})}addCommands(e){l(this,as).add(e),_(this,V,nn).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:_(this,V,Ku).call(this)})}cleanUndoStack(e){l(this,as).cleanType(e)}delete(){var i;this.commitOrRemove();const e=(i=this.currentLayer)==null?void 0:i.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...l(this,Ee)],s=()=>{var a;(a=this._editorUndoBar)==null||a.show(r,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},r=()=>{for(const a of t)_(this,V,Bv).call(this,a)};this.addCommands({cmd:s,undo:r,mustExec:!0})}commitOrRemove(){var e;(e=l(this,jn))==null||e.commitOrRemove()}hasSomethingToControl(){return l(this,jn)||this.hasSelection}selectAll(){for(const e of l(this,Ee))e.commit();_(this,V,Uv).call(this,l(this,dt).values())}unselectAll(){var e;if(!(l(this,jn)&&(l(this,jn).commitOrRemove(),l(this,wt)!==ie.NONE))&&!((e=l(this,Hi))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of l(this,Ee))t.unselect();l(this,Ee).clear(),_(this,V,nn).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;l(this,Ki)[0]+=e,l(this,Ki)[1]+=t;const[r,i]=l(this,Ki),a=[...l(this,Ee)],o=1e3;l(this,cr)&&clearTimeout(l(this,cr)),v(this,cr,setTimeout(()=>{v(this,cr,null),l(this,Ki)[0]=l(this,Ki)[1]=0,this.addCommands({cmd:()=>{for(const c of a)l(this,dt).has(c.id)&&(c.translateInPage(r,i),c.translationDone())},undo:()=>{for(const c of a)l(this,dt).has(c.id)&&(c.translateInPage(-r,-i),c.translationDone())},mustExec:!1})},o));for(const c of a)c.translateInPage(e,t),c.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),v(this,ar,new Map);for(const e of l(this,Ee))l(this,ar).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!l(this,ar))return!1;this.disableUserSelect(!1);const e=l(this,ar);v(this,ar,null);let t=!1;for(const[{x:r,y:i,pageIndex:a},o]of e)o.newX=r,o.newY=i,o.newPageIndex=a,t||(t=r!==o.savedX||i!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const s=(r,i,a,o)=>{if(l(this,dt).has(r.id)){const c=l(this,Rt).get(o);c?r._setParentAndPosition(c,i,a):(r.pageIndex=o,r.x=i,r.y=a)}};return this.addCommands({cmd:()=>{for(const[r,{newX:i,newY:a,newPageIndex:o}]of e)s(r,i,a,o)},undo:()=>{for(const[r,{savedX:i,savedY:a,savedPageIndex:o}]of e)s(r,i,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(l(this,ar))for(const s of l(this,ar).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||l(this,Ee).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return l(this,jn)===e}getActive(){return l(this,jn)}getMode(){return l(this,wt)}get imageManager(){return pe(this,"imageManager",new Dv)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,d=t.rangeCount;u<d;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:s,y:r,width:i,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(u,d,h,f)=>({x:(d-r)/a,y:1-(u+h-s)/i,width:f/a,height:h/i});break;case"180":o=(u,d,h,f)=>({x:1-(u+h-s)/i,y:1-(d+f-r)/a,width:h/i,height:f/a});break;case"270":o=(u,d,h,f)=>({x:1-(d+f-r)/a,y:(u-s)/i,width:f/a,height:h/i});break;default:o=(u,d,h,f)=>({x:(u-s)/i,y:(d-r)/a,width:h/i,height:f/a});break}const c=[];for(let u=0,d=t.rangeCount;u<d;u++){const h=t.getRangeAt(u);if(!h.collapsed)for(const{x:f,y:g,width:y,height:m}of h.getClientRects())y===0||m===0||c.push(o(f,g,y,m))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:e,id:t}){(l(this,uc)||v(this,uc,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=l(this,uc))==null||t.delete(e)}renderAnnotationElement(e){var r;const t=(r=l(this,uc))==null?void 0:r.get(e.data.id);if(!t)return;const s=l(this,zr).getRawValue(t);s&&(l(this,wt)===ie.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}setMissingCanvas(e,t,s){var i;const r=(i=l(this,Xi))==null?void 0:i.get(e);r&&(r.setCanvas(t,s),l(this,Xi).delete(e))}addMissingCanvas(e,t){(l(this,Xi)||v(this,Xi,new Map)).set(e,t)}};lc=new WeakMap,jn=new WeakMap,dt=new WeakMap,Rt=new WeakMap,cc=new WeakMap,zr=new WeakMap,uc=new WeakMap,as=new WeakMap,Ui=new WeakMap,Hi=new WeakMap,dc=new WeakMap,ro=new WeakMap,ar=new WeakMap,Ts=new WeakMap,io=new WeakMap,ih=new WeakMap,ah=new WeakMap,hc=new WeakMap,oh=new WeakMap,or=new WeakMap,Vi=new WeakMap,fc=new WeakMap,Gi=new WeakMap,lr=new WeakMap,Wg=new WeakMap,Wi=new WeakMap,lh=new WeakMap,qi=new WeakMap,ao=new WeakMap,oo=new WeakMap,Xi=new WeakMap,ch=new WeakMap,wt=new WeakMap,Ee=new WeakMap,Br=new WeakMap,Yi=new WeakMap,lo=new WeakMap,uh=new WeakMap,dh=new WeakMap,Ki=new WeakMap,cr=new WeakMap,Ur=new WeakMap,hh=new WeakMap,os=new WeakMap,V=new WeakSet,Lp=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Ov=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of l(this,Rt).values())if(s.hasTextLayer(e))return s;return null},R_=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=_(this,V,Lp).call(this,e).closest(".textLayer"),r=this.getSelectionBoxes(s);r&&(l(this,lr)||v(this,lr,new gL(this)),l(this,lr).show(s,r,this.direction==="ltr"))},L_=function(){var i,a,o;const e=document.getSelection();if(!e||e.isCollapsed){l(this,Br)&&((i=l(this,lr))==null||i.hide(),v(this,Br,null),_(this,V,nn).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===l(this,Br))return;const r=_(this,V,Lp).call(this,e).closest(".textLayer");if(!r){l(this,Br)&&((a=l(this,lr))==null||a.hide(),v(this,Br,null),_(this,V,nn).call(this,{hasSelectedText:!1}));return}if((o=l(this,lr))==null||o.hide(),v(this,Br,t),_(this,V,nn).call(this,{hasSelectedText:!0}),!(l(this,wt)!==ie.HIGHLIGHT&&l(this,wt)!==ie.NONE)&&(l(this,wt)===ie.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),v(this,Gi,this.isShiftKeyDown),!this.isShiftKeyDown)){const c=l(this,wt)===ie.HIGHLIGHT?_(this,V,Ov).call(this,r):null;c==null||c.toggleDrawing();const u=new AbortController,d=this.combinedSignal(u),h=f=>{f.type==="pointerup"&&f.button!==0||(u.abort(),c==null||c.toggleDrawing(!0),f.type==="pointerup"&&_(this,V,Mp).call(this,"main_toolbar"))};window.addEventListener("pointerup",h,{signal:d}),window.addEventListener("blur",h,{signal:d})}},Mp=function(e=""){l(this,wt)===ie.HIGHLIGHT?this.highlightSelection(e):l(this,ih)&&_(this,V,R_).call(this)},M_=function(){document.addEventListener("selectionchange",_(this,V,L_).bind(this),{signal:this._signal})},j_=function(){if(l(this,Vi))return;v(this,Vi,new AbortController);const e=this.combinedSignal(l(this,Vi));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},D_=function(){var e;(e=l(this,Vi))==null||e.abort(),v(this,Vi,null)},Fv=function(){if(l(this,qi))return;v(this,qi,new AbortController);const e=this.combinedSignal(l(this,qi));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},I_=function(){var e;(e=l(this,qi))==null||e.abort(),v(this,qi,null)},$v=function(){if(l(this,Ui))return;v(this,Ui,new AbortController);const e=this.combinedSignal(l(this,Ui));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},zv=function(){var e;(e=l(this,Ui))==null||e.abort(),v(this,Ui,null)},O_=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},nn=function(e){Object.entries(e).some(([s,r])=>l(this,dh)[s]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(l(this,dh),e)}),l(this,wt)===ie.HIGHLIGHT&&e.hasSelectedEditor===!1&&_(this,V,jr).call(this,[[ye.HIGHLIGHT_FREE,!0]]))},jr=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},F_=async function(){if(!l(this,Wi)){v(this,Wi,!0);const e=[];for(const t of l(this,Rt).values())e.push(t.enable());await Promise.all(e);for(const t of l(this,dt).values())t.enable()}},$_=function(){if(this.unselectAll(),l(this,Wi)){v(this,Wi,!1);for(const e of l(this,Rt).values())e.disable();for(const e of l(this,dt).values())e.disable()}},Bv=function(e){const t=l(this,Rt).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},z_=function(){let e=null;for(e of l(this,Ee));return e},Ku=function(){if(l(this,dt).size===0)return!0;if(l(this,dt).size===1)for(const e of l(this,dt).values())return e.isEmpty();return!1},Uv=function(e){for(const t of l(this,Ee))t.unselect();l(this,Ee).clear();for(const t of e)t.isEmpty()||(l(this,Ee).add(t),t.select());_(this,V,nn).call(this,{hasSelectedEditor:this.hasSelection})},$(Wl,"TRANSLATE_SMALL",1),$(Wl,"TRANSLATE_BIG",10);let Ia=Wl;var xt,ur,Ps,pc,dr,Dn,gc,hr,vn,Hr,co,fr,Qi,Vs,Qu,jp;const sn=class sn{constructor(e){A(this,Vs);A(this,xt,null);A(this,ur,!1);A(this,Ps,null);A(this,pc,null);A(this,dr,null);A(this,Dn,null);A(this,gc,!1);A(this,hr,null);A(this,vn,null);A(this,Hr,null);A(this,co,null);A(this,fr,!1);v(this,vn,e),v(this,fr,e._uiManager.useNewAltTextFlow),l(sn,Qi)||v(sn,Qi,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){sn._l10n??(sn._l10n=e)}async render(){const e=v(this,Ps,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=v(this,pc,document.createElement("span"));e.append(t),l(this,fr)?(e.classList.add("new"),e.setAttribute("data-l10n-id",l(sn,Qi).missing),t.setAttribute("data-l10n-id",l(sn,Qi)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=l(this,vn)._uiManager._signal;e.addEventListener("contextmenu",As,{signal:s}),e.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:s});const r=i=>{i.preventDefault(),l(this,vn)._uiManager.editAltText(l(this,vn)),l(this,fr)&&l(this,vn)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:l(this,Vs,Qu)}})};return e.addEventListener("click",r,{capture:!0,signal:s}),e.addEventListener("keydown",i=>{i.target===e&&i.key==="Enter"&&(v(this,gc,!0),r(i))},{signal:s}),await _(this,Vs,jp).call(this),e}finish(){l(this,Ps)&&(l(this,Ps).focus({focusVisible:l(this,gc)}),v(this,gc,!1))}isEmpty(){return l(this,fr)?l(this,xt)===null:!l(this,xt)&&!l(this,ur)}hasData(){return l(this,fr)?l(this,xt)!==null||!!l(this,Hr):this.isEmpty()}get guessedText(){return l(this,Hr)}async setGuessedText(e){l(this,xt)===null&&(v(this,Hr,e),v(this,co,await sn._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),_(this,Vs,jp).call(this))}toggleAltTextBadge(e=!1){var t;if(!l(this,fr)||l(this,xt)){(t=l(this,hr))==null||t.remove(),v(this,hr,null);return}if(!l(this,hr)){const s=v(this,hr,document.createElement("div"));s.className="noAltTextBadge",l(this,vn).div.append(s)}l(this,hr).classList.toggle("hidden",!e)}serialize(e){let t=l(this,xt);return!e&&l(this,Hr)===t&&(t=l(this,co)),{altText:t,decorative:l(this,ur),guessedText:l(this,Hr),textWithDisclaimer:l(this,co)}}get data(){return{altText:l(this,xt),decorative:l(this,ur)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:r,cancel:i=!1}){s&&(v(this,Hr,s),v(this,co,r)),!(l(this,xt)===e&&l(this,ur)===t)&&(i||(v(this,xt,e),v(this,ur,t)),_(this,Vs,jp).call(this))}toggle(e=!1){l(this,Ps)&&(!e&&l(this,Dn)&&(clearTimeout(l(this,Dn)),v(this,Dn,null)),l(this,Ps).disabled=!e)}shown(){l(this,vn)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:l(this,Vs,Qu)}})}destroy(){var e,t;(e=l(this,Ps))==null||e.remove(),v(this,Ps,null),v(this,pc,null),v(this,dr,null),(t=l(this,hr))==null||t.remove(),v(this,hr,null)}};xt=new WeakMap,ur=new WeakMap,Ps=new WeakMap,pc=new WeakMap,dr=new WeakMap,Dn=new WeakMap,gc=new WeakMap,hr=new WeakMap,vn=new WeakMap,Hr=new WeakMap,co=new WeakMap,fr=new WeakMap,Qi=new WeakMap,Vs=new WeakSet,Qu=function(){return l(this,xt)&&"added"||l(this,xt)===null&&this.guessedText&&"review"||"missing"},jp=async function(){var r,i,a;const e=l(this,Ps);if(!e)return;if(l(this,fr)){if(e.classList.toggle("done",!!l(this,xt)),e.setAttribute("data-l10n-id",l(sn,Qi)[l(this,Vs,Qu)]),(r=l(this,pc))==null||r.setAttribute("data-l10n-id",l(sn,Qi)[`${l(this,Vs,Qu)}-label`]),!l(this,xt)){(i=l(this,dr))==null||i.remove();return}}else{if(!l(this,xt)&&!l(this,ur)){e.classList.remove("done"),(a=l(this,dr))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=l(this,dr);if(!t){v(this,dr,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${l(this,vn).id}`;const o=100,c=l(this,vn)._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(l(this,Dn)),v(this,Dn,null)},{once:!0}),e.addEventListener("mouseenter",()=>{v(this,Dn,setTimeout(()=>{v(this,Dn,null),l(this,dr).classList.add("show"),l(this,vn)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:c}),e.addEventListener("mouseleave",()=>{var u;l(this,Dn)&&(clearTimeout(l(this,Dn)),v(this,Dn,null)),(u=l(this,dr))==null||u.classList.remove("show")},{signal:c})}l(this,ur)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=l(this,xt)),t.parentNode||e.append(t);const s=l(this,vn).getElementForAltText();s==null||s.setAttribute("aria-describedby",t.id)},A(sn,Qi,null),$(sn,"_l10n",null);let Ig=sn;var mc,uo,fh,ph,gh,mh,yh,Vr,ho,Gr,fo,Wr,Fa,B_,U_,H_;const gx=class gx{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:r=null,onPinching:i=null,onPinchEnd:a=null,signal:o}){A(this,Fa);A(this,mc);A(this,uo,!1);A(this,fh,null);A(this,ph);A(this,gh);A(this,mh);A(this,yh);A(this,Vr,null);A(this,ho);A(this,Gr,null);A(this,fo);A(this,Wr,null);v(this,mc,e),v(this,fh,s),v(this,ph,t),v(this,gh,r),v(this,mh,i),v(this,yh,a),v(this,fo,new AbortController),v(this,ho,AbortSignal.any([o,l(this,fo).signal])),e.addEventListener("touchstart",_(this,Fa,B_).bind(this),{passive:!1,signal:l(this,ho)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Ys.pixelRatio}destroy(){var e,t;(e=l(this,fo))==null||e.abort(),v(this,fo,null),(t=l(this,Vr))==null||t.abort(),v(this,Vr,null)}};mc=new WeakMap,uo=new WeakMap,fh=new WeakMap,ph=new WeakMap,gh=new WeakMap,mh=new WeakMap,yh=new WeakMap,Vr=new WeakMap,ho=new WeakMap,Gr=new WeakMap,fo=new WeakMap,Wr=new WeakMap,Fa=new WeakSet,B_=function(e){var r,i,a;if((r=l(this,ph))!=null&&r.call(this))return;if(e.touches.length===1){if(l(this,Vr))return;const o=v(this,Vr,new AbortController),c=AbortSignal.any([l(this,ho),o.signal]),u=l(this,mc),d={capture:!0,signal:c,passive:!1},h=f=>{var g;f.pointerType==="touch"&&((g=l(this,Vr))==null||g.abort(),v(this,Vr,null))};u.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(nt(f),h(f))},d),u.addEventListener("pointerup",h,d),u.addEventListener("pointercancel",h,d);return}if(!l(this,Wr)){v(this,Wr,new AbortController);const o=AbortSignal.any([l(this,ho),l(this,Wr).signal]),c=l(this,mc),u={signal:o,capture:!1,passive:!1};c.addEventListener("touchmove",_(this,Fa,U_).bind(this),u);const d=_(this,Fa,H_).bind(this);c.addEventListener("touchend",d,u),c.addEventListener("touchcancel",d,u),u.capture=!0,c.addEventListener("pointerdown",nt,u),c.addEventListener("pointermove",nt,u),c.addEventListener("pointercancel",nt,u),c.addEventListener("pointerup",nt,u),(i=l(this,gh))==null||i.call(this)}if(nt(e),e.touches.length!==2||(a=l(this,fh))!=null&&a.call(this)){v(this,Gr,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),v(this,Gr,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},U_=function(e){var E;if(!l(this,Gr)||e.touches.length!==2)return;nt(e);let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:r,screenY:i}=t,{screenX:a,screenY:o}=s,c=l(this,Gr),{touch0X:u,touch0Y:d,touch1X:h,touch1Y:f}=c,g=h-u,y=f-d,m=a-r,b=o-i,w=Math.hypot(m,b)||1,x=Math.hypot(g,y)||1;if(!l(this,uo)&&Math.abs(x-w)<=gx.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=r,c.touch0Y=i,c.touch1X=a,c.touch1Y=o,!l(this,uo)){v(this,uo,!0);return}const S=[(r+a)/2,(i+o)/2];(E=l(this,mh))==null||E.call(this,S,x,w)},H_=function(e){var t;e.touches.length>=2||(l(this,Wr)&&(l(this,Wr).abort(),v(this,Wr,null),(t=l(this,yh))==null||t.call(this)),l(this,Gr)&&(nt(e),v(this,Gr,null),v(this,uo,!1)))};let Xd=gx;var po,Rs,Fe,yc,Ji,vh,go,Lt,mo,qr,Zi,wh,yo,In,xh,vo,Xr,pr,vc,wc,ls,wo,bh,qg,se,Hv,Sh,Vv,Dp,V_,G_,Gv,Ip,Wv,W_,q_,X_,qv,Y_,Xv,K_,Q_,J_,Yv,Ju;const ce=class ce{constructor(e){A(this,se);A(this,po,null);A(this,Rs,null);A(this,Fe,null);A(this,yc,!1);A(this,Ji,null);A(this,vh,"");A(this,go,!1);A(this,Lt,null);A(this,mo,null);A(this,qr,null);A(this,Zi,null);A(this,wh,"");A(this,yo,!1);A(this,In,null);A(this,xh,!1);A(this,vo,!1);A(this,Xr,!1);A(this,pr,null);A(this,vc,0);A(this,wc,0);A(this,ls,null);A(this,wo,null);$(this,"isSelected",!1);$(this,"_isCopy",!1);$(this,"_editToolbar",null);$(this,"_initialOptions",Object.create(null));$(this,"_initialData",null);$(this,"_isVisible",!0);$(this,"_uiManager",null);$(this,"_focusEventsAllowed",!0);A(this,bh,!1);A(this,qg,ce._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:r,pageX:i,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,r],this.pageTranslation=[i,a];const[o,c]=this.parentDimensions;this.x=e.x/o,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=ce.prototype._resizeWithKeyboard,t=Ia.TRANSLATE_SMALL,s=Ia.TRANSLATE_BIG;return pe(this,"_resizerKeyboardManager",new $f([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],ce.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return pe(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new vL({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(ce._l10n??(ce._l10n=e),ce._l10nResizer||(ce._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),ce._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);ce._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Pe("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return l(this,bh)}set _isDraggable(e){var t;v(this,bh,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=l(this,qg)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):_(this,se,Ju).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(l(this,yo)?v(this,yo,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,r){const[i,a]=this.parentDimensions;[s,r]=this.screenToPageTranslation(s,r),this.x=(e+s)/i,this.y=(t+r)/a,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[s,r]=this.parentDimensions;this.setAt(e*s,t*r,this.width*s,this.height*r),this._onTranslated()}translate(e,t){_(this,se,Hv).call(this,this.parentDimensions,e,t)}translateInPage(e,t){l(this,In)||v(this,In,[this.x,this.y,this.width,this.height]),_(this,se,Hv).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){l(this,In)||v(this,In,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[r,i]}=this;if(this.x+=e/r,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[c,u]=this.getBaseTranslation();a+=c,o+=u;const{style:d}=s;d.left=`${(100*a).toFixed(2)}%`,d.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!l(this,In)&&(l(this,In)[0]!==this.x||l(this,In)[1]!==this.y)}get _hasBeenResized(){return!!l(this,In)&&(l(this,In)[2]!==this.width||l(this,In)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=ce,r=s/e,i=s/t;switch(this.rotation){case 90:return[-r,i];case 180:return[r,i];case 270:return[r,-i];default:return[-r,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,r]}=this;let{x:i,y:a,width:o,height:c}=this;if(o*=s,c*=r,i*=s,a*=r,this._mustFixPosition)switch(e){case 0:i=Qt(i,0,s-o),a=Qt(a,0,r-c);break;case 90:i=Qt(i,0,s-c),a=Qt(a,o,r);break;case 180:i=Qt(i,o,s),a=Qt(a,c,r);break;case 270:i=Qt(i,c,s),a=Qt(a,0,r-o);break}this.x=i/=s,this.y=a/=r;const[u,d]=this.getBaseTranslation();i+=u,a+=d,t.left=`${(100*i).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return _(s=ce,Sh,Vv).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return _(s=ce,Sh,Vv).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(e,t){const[s,r]=this.parentDimensions,{style:i}=this.div;i.width=`${(100*e/s).toFixed(2)}%`,l(this,go)||(i.height=`${(100*t/r).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:s}=e,r=s.endsWith("%"),i=!l(this,go)&&t.endsWith("%");if(r&&i)return;const[a,o]=this.parentDimensions;r||(e.width=`${(100*parseFloat(s)/a).toFixed(2)}%`),!l(this,go)&&!i&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=l(this,Fe))==null||e.finish()}async addEditToolbar(){return this._editToolbar||l(this,vo)?this._editToolbar:(this._editToolbar=new jv(this),this.div.append(this._editToolbar.render()),l(this,Fe)&&await this._editToolbar.addAltText(l(this,Fe)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=l(this,Fe))==null||e.destroy())}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){l(this,Fe)||(Ig.initialize(ce._l10n),v(this,Fe,new Ig(this)),l(this,po)&&(l(this,Fe).data=l(this,po),v(this,po,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=l(this,Fe))==null?void 0:e.data}set altTextData(e){l(this,Fe)&&(l(this,Fe).data=e)}get guessedAltText(){var e;return(e=l(this,Fe))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=l(this,Fe))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=l(this,Fe))==null?void 0:t.serialize(e)}hasAltText(){return!!l(this,Fe)&&!l(this,Fe).isEmpty()}hasAltTextData(){var e;return((e=l(this,Fe))==null?void 0:e.hasData())??!1}render(){var a;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=l(this,yc)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),_(this,se,Xv).call(this);const[t,s]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*s/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/s).toFixed(2)}%`);const[r,i]=this.getInitialTranslation();return this.translate(r,i),T_(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(l(this,wo)||v(this,wo,new Xd({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:_(this,se,W_).bind(this),onPinching:_(this,se,q_).bind(this),onPinchEnd:_(this,se,X_).bind(this),signal:this._uiManager._signal}))),(a=this._uiManager._editorUndoBar)==null||a.hide(),e}pointerdown(e){const{isMac:t}=Nt.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(v(this,yo,!0),this._isDraggable){_(this,se,Y_).call(this,e);return}_(this,se,qv).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){l(this,pr)&&clearTimeout(l(this,pr)),v(this,pr,setTimeout(()=>{var e;v(this,pr,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const r=this.parentScale,[i,a]=this.pageDimensions,[o,c]=this.pageTranslation,u=e/r,d=t/r,h=this.x*i,f=this.y*a,g=this.width*i,y=this.height*a;switch(s){case 0:return[h+u+o,a-f-d-y+c,h+u+g+o,a-f-d+c];case 90:return[h+d+o,a-f+u+c,h+d+y+o,a-f+u+g+c];case 180:return[h-u-g+o,a-f+d+c,h-u+o,a-f+d+y+c];case 270:return[h-d-y+o,a-f-u-g+c,h-d+o,a-f-u+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,r,i,a]=e,o=i-s,c=a-r;switch(this.rotation){case 0:return[s,t-a,o,c];case 90:return[s,t-r,c,o];case 180:return[i,t-r,o,c];case 270:return[i,t-a,c,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),v(this,vo,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),v(this,vo,!1),!0):!1}isInEditMode(){return l(this,vo)}shouldGetKeyboardEvents(){return l(this,Xr)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:r}=this.getClientDimensions(),{innerHeight:i,innerWidth:a}=window;return t<a&&r>0&&e<i&&s>0}rebuild(){_(this,se,Xv).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){Pe("An editor must be serializable")}static async deserialize(e,t,s){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});r.rotation=e.rotation,v(r,po,e.accessibilityData),r._isCopy=e.isCopy||!1;const[i,a]=r.pageDimensions,[o,c,u,d]=r.getRectInCurrentCoords(e.rect,a);return r.x=o/i,r.y=c/a,r.width=u/i,r.height=d/a,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=l(this,Zi))==null||e.abort(),v(this,Zi,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),l(this,pr)&&(clearTimeout(l(this,pr)),v(this,pr,null)),_(this,se,Ju).call(this),this.removeEditToolbar(),l(this,ls)){for(const s of l(this,ls).values())clearTimeout(s);v(this,ls,null)}this.parent=null,(t=l(this,wo))==null||t.destroy(),v(this,wo,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(_(this,se,V_).call(this),l(this,Lt).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),v(this,qr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=l(this,Lt).children;if(!l(this,Rs)){v(this,Rs,Array.from(t));const a=_(this,se,K_).bind(this),o=_(this,se,Q_).bind(this),c=this._uiManager._signal;for(const u of l(this,Rs)){const d=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",a,{signal:c}),u.addEventListener("blur",o,{signal:c}),u.addEventListener("focus",_(this,se,J_).bind(this,d),{signal:c}),u.setAttribute("data-l10n-id",ce._l10nResizer[d])}}const s=l(this,Rs)[0];let r=0;for(const a of t){if(a===s)break;r++}const i=(360-this.rotation+this.parentRotation)%360/90*(l(this,Rs).length/4);if(i!==r){if(i<r)for(let o=0;o<r-i;o++)l(this,Lt).append(l(this,Lt).firstChild);else if(i>r)for(let o=0;o<i-r;o++)l(this,Lt).firstChild.before(l(this,Lt).lastChild);let a=0;for(const o of t){const u=l(this,Rs)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",ce._l10nResizer[u])}}_(this,se,Yv).call(this,0),v(this,Xr,!0),l(this,Lt).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){l(this,Xr)&&_(this,se,Wv).call(this,l(this,wh),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){_(this,se,Ju).call(this),this.div.focus()}select(){var e,t,s;if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var r,i;(r=this.div)!=null&&r.classList.contains("selectedEditor")&&((i=this._editToolbar)==null||i.show())});return}(t=this._editToolbar)==null||t.show(),(s=l(this,Fe))==null||s.toggleAltTextBadge(!1)}}unselect(){var e,t,s,r,i;this.isSelected&&(this.isSelected=!1,(e=l(this,Lt))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(r=this._editToolbar)==null||r.hide(),(i=l(this,Fe))==null||i.toggleAltTextBadge(!0))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return l(this,xh)}set isEditing(e){v(this,xh,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){v(this,go,!0);const s=e/t,{style:r}=this.div;r.aspectRatio=s,r.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){l(this,ls)||v(this,ls,new Map);const{action:s}=e;let r=l(this,ls).get(s);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),l(this,ls).delete(s),l(this,ls).size===0&&v(this,ls,null)},ce._telemetryTimeout),l(this,ls).set(s,r);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),v(this,yc,!1)}disable(){this.div&&(this.div.tabIndex=-1),v(this,yc,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};po=new WeakMap,Rs=new WeakMap,Fe=new WeakMap,yc=new WeakMap,Ji=new WeakMap,vh=new WeakMap,go=new WeakMap,Lt=new WeakMap,mo=new WeakMap,qr=new WeakMap,Zi=new WeakMap,wh=new WeakMap,yo=new WeakMap,In=new WeakMap,xh=new WeakMap,vo=new WeakMap,Xr=new WeakMap,pr=new WeakMap,vc=new WeakMap,wc=new WeakMap,ls=new WeakMap,wo=new WeakMap,bh=new WeakMap,qg=new WeakMap,se=new WeakSet,Hv=function([e,t],s,r){[s,r]=this.screenToPageTranslation(s,r),this.x+=s/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Sh=new WeakSet,Vv=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Dp=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},V_=function(){if(l(this,Lt))return;v(this,Lt,document.createElement("div")),l(this,Lt).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const r=document.createElement("div");l(this,Lt).append(r),r.classList.add("resizer",s),r.setAttribute("data-resizer-name",s),r.addEventListener("pointerdown",_(this,se,G_).bind(this,s),{signal:t}),r.addEventListener("contextmenu",As,{signal:t}),r.tabIndex=-1}this.div.prepend(l(this,Lt))},G_=function(e,t){var d;t.preventDefault();const{isMac:s}=Nt.platform;if(t.button!==0||t.ctrlKey&&s)return;(d=l(this,Fe))==null||d.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,v(this,mo,[t.screenX,t.screenY]);const i=new AbortController,a=this._uiManager.combinedSignal(i);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",_(this,se,Wv).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",nt,{passive:!1,signal:a}),window.addEventListener("contextmenu",As,{signal:a}),v(this,qr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{var h;i.abort(),this.parent.togglePointerEvents(!0),(h=l(this,Fe))==null||h.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=o,this.div.style.cursor=c,_(this,se,Ip).call(this)};window.addEventListener("pointerup",u,{signal:a}),window.addEventListener("blur",u,{signal:a})},Gv=function(e,t,s,r){this.width=s,this.height=r,this.x=e,this.y=t;const[i,a]=this.parentDimensions;this.setDims(i*s,a*r),this.fixAndSetPosition(),this._onResized()},Ip=function(){if(!l(this,qr))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:r}=l(this,qr);v(this,qr,null);const i=this.x,a=this.y,o=this.width,c=this.height;i===e&&a===t&&o===s&&c===r||this.addCommands({cmd:_(this,se,Gv).bind(this,i,a,o,c),undo:_(this,se,Gv).bind(this,e,t,s,r),mustExec:!0})},Wv=function(e,t){const[s,r]=this.parentDimensions,i=this.x,a=this.y,o=this.width,c=this.height,u=ce.MIN_SIZE/s,d=ce.MIN_SIZE/r,h=_(this,se,Dp).call(this,this.rotation),f=(j,D)=>[h[0]*j+h[2]*D,h[1]*j+h[3]*D],g=_(this,se,Dp).call(this,360-this.rotation),y=(j,D)=>[g[0]*j+g[2]*D,g[1]*j+g[3]*D];let m,b,w=!1,x=!1;switch(e){case"topLeft":w=!0,m=(j,D)=>[0,0],b=(j,D)=>[j,D];break;case"topMiddle":m=(j,D)=>[j/2,0],b=(j,D)=>[j/2,D];break;case"topRight":w=!0,m=(j,D)=>[j,0],b=(j,D)=>[0,D];break;case"middleRight":x=!0,m=(j,D)=>[j,D/2],b=(j,D)=>[0,D/2];break;case"bottomRight":w=!0,m=(j,D)=>[j,D],b=(j,D)=>[0,0];break;case"bottomMiddle":m=(j,D)=>[j/2,D],b=(j,D)=>[j/2,0];break;case"bottomLeft":w=!0,m=(j,D)=>[0,D],b=(j,D)=>[j,0];break;case"middleLeft":x=!0,m=(j,D)=>[0,D/2],b=(j,D)=>[j,D/2];break}const S=m(o,c),E=b(o,c);let C=f(...E);const N=ce._round(i+C[0]),k=ce._round(a+C[1]);let R=1,P=1,L,M;if(t.fromKeyboard)({deltaX:L,deltaY:M}=t);else{const{screenX:j,screenY:D}=t,[O,G]=l(this,mo);[L,M]=this.screenToPageTranslation(j-O,D-G),l(this,mo)[0]=j,l(this,mo)[1]=D}if([L,M]=y(L/s,M/r),w){const j=Math.hypot(o,c);R=P=Math.max(Math.min(Math.hypot(E[0]-S[0]-L,E[1]-S[1]-M)/j,1/o,1/c),u/o,d/c)}else x?R=Qt(Math.abs(E[0]-S[0]-L),u,1)/o:P=Qt(Math.abs(E[1]-S[1]-M),d,1)/c;const I=ce._round(o*R),U=ce._round(c*P);C=f(...b(I,U));const B=N-C[0],K=k-C[1];l(this,In)||v(this,In,[this.x,this.y,this.width,this.height]),this.width=I,this.height=U,this.x=B,this.y=K,this.setDims(s*I,r*U),this.fixAndSetPosition(),this._onResizing()},W_=function(){var e;v(this,qr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=l(this,Fe))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},q_=function(e,t,s){let i=.7*(s/t)+1-.7;if(i===1)return;const a=_(this,se,Dp).call(this,this.rotation),o=(N,k)=>[a[0]*N+a[2]*k,a[1]*N+a[3]*k],[c,u]=this.parentDimensions,d=this.x,h=this.y,f=this.width,g=this.height,y=ce.MIN_SIZE/c,m=ce.MIN_SIZE/u;i=Math.max(Math.min(i,1/f,1/g),y/f,m/g);const b=ce._round(f*i),w=ce._round(g*i);if(b===f&&w===g)return;l(this,In)||v(this,In,[d,h,f,g]);const x=o(f/2,g/2),S=ce._round(d+x[0]),E=ce._round(h+x[1]),C=o(b/2,w/2);this.x=S-C[0],this.y=E-C[1],this.width=b,this.height=w,this.setDims(c*b,u*w),this.fixAndSetPosition(),this._onResizing()},X_=function(){var e;(e=l(this,Fe))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),_(this,se,Ip).call(this)},qv=function(e){const{isMac:t}=Nt.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},Y_=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const r=new AbortController,i=this._uiManager.combinedSignal(r),a={capture:!0,passive:!1,signal:i},o=u=>{r.abort(),v(this,Ji,null),v(this,yo,!1),this._uiManager.endDragSession()||_(this,se,qv).call(this,u),s&&this._onStopDragging()};t&&(v(this,vc,e.clientX),v(this,wc,e.clientY),v(this,Ji,e.pointerId),v(this,vh,e.pointerType),window.addEventListener("pointermove",u=>{s||(s=!0,this._onStartDragging());const{clientX:d,clientY:h,pointerId:f}=u;if(f!==l(this,Ji)){nt(u);return}const[g,y]=this.screenToPageTranslation(d-l(this,vc),h-l(this,wc));v(this,vc,d),v(this,wc,h),this._uiManager.dragSelectedEditors(g,y)},a),window.addEventListener("touchmove",nt,a),window.addEventListener("pointerdown",u=>{u.pointerType===l(this,vh)&&(l(this,wo)||u.isPrimary)&&o(u),nt(u)},a));const c=u=>{if(!l(this,Ji)||l(this,Ji)===u.pointerId){o(u);return}nt(u)};window.addEventListener("pointerup",c,{signal:i}),window.addEventListener("blur",c,{signal:i})},Xv=function(){if(l(this,Zi)||!this.div)return;v(this,Zi,new AbortController);const e=this._uiManager.combinedSignal(l(this,Zi));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},K_=function(e){ce._resizerKeyboardManager.exec(this,e)},Q_=function(e){var t;l(this,Xr)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==l(this,Lt)&&_(this,se,Ju).call(this)},J_=function(e){v(this,wh,l(this,Xr)?e:"")},Yv=function(e){if(l(this,Rs))for(const t of l(this,Rs))t.tabIndex=e},Ju=function(){v(this,Xr,!1),_(this,se,Yv).call(this,-1),_(this,se,Ip).call(this)},A(ce,Sh),$(ce,"_l10n",null),$(ce,"_l10nResizer",null),$(ce,"_borderLineWidth",-1),$(ce,"_colorManager",new Iv),$(ce,"_zIndex",1),$(ce,"_telemetryTimeout",1e3);let Ie=ce;class vL extends Ie{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Qb=3285377520,rs=4294901760,sr=65535;class Z_{constructor(e){this.h1=e?e&4294967295:Qb,this.h2=e?e&4294967295:Qb}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let m=0,b=e.length;m<b;m++){const w=e.charCodeAt(m);w<=255?t[s++]=w:(t[s++]=w>>>8,t[s++]=w&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=s>>2,i=s-r*4,a=new Uint32Array(t.buffer,0,r);let o=0,c=0,u=this.h1,d=this.h2;const h=3432918353,f=461845907,g=h&sr,y=f&sr;for(let m=0;m<r;m++)m&1?(o=a[m],o=o*h&rs|o*g&sr,o=o<<15|o>>>17,o=o*f&rs|o*y&sr,u^=o,u=u<<13|u>>>19,u=u*5+3864292196):(c=a[m],c=c*h&rs|c*g&sr,c=c<<15|c>>>17,c=c*f&rs|c*y&sr,d^=c,d=d<<13|d>>>19,d=d*5+3864292196);switch(o=0,i){case 3:o^=t[r*4+2]<<16;case 2:o^=t[r*4+1]<<8;case 1:o^=t[r*4],o=o*h&rs|o*g&sr,o=o<<15|o>>>17,o=o*f&rs|o*y&sr,r&1?u^=o:d^=o}this.h1=u,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&rs|e*36045&sr,t=t*4283543511&rs|((t<<16|e>>>16)*2950163797&rs)>>>16,e^=t>>>1,e=e*444984403&rs|e*60499&sr,t=t*3301882366&rs|((t<<16|e>>>16)*3120437893&rs)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Kv=Object.freeze({map:null,hash:"",transfer:void 0});var xo,bo,Mt,Xg,eE;class nx{constructor(){A(this,Xg);A(this,xo,!1);A(this,bo,null);A(this,Mt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=l(this,Mt).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return l(this,Mt).get(e)}remove(e){if(l(this,Mt).delete(e),l(this,Mt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of l(this,Mt).values())if(t instanceof Ie)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=l(this,Mt).get(e);let r=!1;if(s!==void 0)for(const[i,a]of Object.entries(t))s[i]!==a&&(r=!0,s[i]=a);else r=!0,l(this,Mt).set(e,t);r&&_(this,Xg,eE).call(this),t instanceof Ie&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return l(this,Mt).has(e)}get size(){return l(this,Mt).size}resetModified(){l(this,xo)&&(v(this,xo,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new tE(this)}get serializable(){if(l(this,Mt).size===0)return Kv;const e=new Map,t=new Z_,s=[],r=Object.create(null);let i=!1;for(const[a,o]of l(this,Mt)){const c=o instanceof Ie?o.serialize(!1,r):o;c&&(e.set(a,c),t.update(`${a}:${JSON.stringify(c)}`),i||(i=!!c.bitmap))}if(i)for(const a of e.values())a.bitmap&&s.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:Kv}get editorStats(){let e=null;const t=new Map;for(const s of l(this,Mt).values()){if(!(s instanceof Ie))continue;const r=s.telemetryFinalData;if(!r)continue;const{type:i}=r;t.has(i)||t.set(i,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));const a=e[i]||(e[i]=new Map);for(const[o,c]of Object.entries(r)){if(o==="type")continue;let u=a.get(o);u||(u=new Map,a.set(o,u));const d=u.get(c)??0;u.set(c,d+1)}}for(const[s,r]of t)e[s]=r.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){v(this,bo,null)}get modifiedIds(){if(l(this,bo))return l(this,bo);const e=[];for(const t of l(this,Mt).values())!(t instanceof Ie)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return v(this,bo,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return l(this,Mt).entries()}}xo=new WeakMap,bo=new WeakMap,Mt=new WeakMap,Xg=new WeakSet,eE=function(){l(this,xo)||(v(this,xo,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Ah;class tE extends nx{constructor(t){super();A(this,Ah);const{map:s,hash:r,transfer:i}=t.serializable,a=structuredClone(s,i?{transfer:i}:null);v(this,Ah,{map:a,hash:r,transfer:i})}get print(){Pe("Should not call PrintAnnotationStorage.print")}get serializable(){return l(this,Ah)}get modifiedIds(){return pe(this,"modifiedIds",{ids:new Set,hash:""})}}Ah=new WeakMap;var xc;class wL{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){A(this,xc,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),l(this,xc).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:s}){if(!(!e||l(this,xc).has(e.loadedName))){if(lt(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:i,style:a}=e,o=new FontFace(r,i,a);this.addNativeFontFace(o);try{await o.load(),l(this,xc).add(r),s==null||s(e)}catch{ae(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}Pe("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(r){throw ae(`Failed to load font '${s.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const r=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return pe(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return pe(this,"isSyncFontLoadingSupported",ln||Nt.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(lt(!r.done,"completeRequest() cannot be called twice."),r.done=!0;s.length>0&&s[0].done;){const i=s.shift();setTimeout(i.callback,0)}}const{loadingRequests:s}=this,r={done:!1,complete:t,callback:e};return s.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return pe(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(E,C){return E.charCodeAt(C)<<24|E.charCodeAt(C+1)<<16|E.charCodeAt(C+2)<<8|E.charCodeAt(C+3)&255}function r(E,C,N,k){const R=E.substring(0,C),P=E.substring(C+N);return R+k+P}let i,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const c=o.getContext("2d");let u=0;function d(E,C){if(++u>30){ae("Load test font never loaded."),C();return}if(c.font="30px "+E,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){C();return}setTimeout(d.bind(null,E,C))}const h=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=r(f,976,h.length,h);const y=16,m=1482184792;let b=s(f,y);for(i=0,a=h.length-3;i<a;i+=4)b=b-m+s(h,i)|0;i<h.length&&(b=b-m+s(h+"XXX",i)|0),f=r(f,y,4,oL(b));const w=`url(data:font/opentype;base64,${btoa(f)});`,x=`@font-face {font-family:"${h}";src:${w}}`;this.insertRule(x);const S=this._document.createElement("div");S.style.visibility="hidden",S.style.width=S.style.height="10px",S.style.position="absolute",S.style.top=S.style.left="0px";for(const E of[e.loadedName,h]){const C=this._document.createElement("span");C.textContent="Hi",C.style.fontFamily=E,S.append(C)}this._document.body.append(S),d(h,()=>{S.remove(),t.complete()})}}xc=new WeakMap;class xL{constructor(e,t=null){this.compiledGlyphs=Object.create(null);for(const s in e)this[s]=e[s];this._inspectFont=t}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${v_(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let r;try{r=e.get(s)}catch(a){ae(`getPathGenerator - ignoring character: "${a}".`)}const i=new Path2D(r||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=i}}function bL(n){if(n instanceof URL)return n.href;if(typeof n=="string"){if(ln)return n;const e=URL.parse(n,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function SL(n){if(ln&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return If(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function up(n){if(typeof n!="string")return null;if(n.endsWith("/"))return n;throw new Error(`Invalid factory url: "${n}" must include trailing slash.`)}const Qv=n=>typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0,AL=n=>typeof n=="object"&&typeof(n==null?void 0:n.name)=="string",nE=dL.bind(null,Qv,AL);var Yr,Yg;class _L{constructor(){A(this,Yr,new Map);A(this,Yg,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};l(this,Yg).then(()=>{for(const[r]of l(this,Yr))r.call(this,s)})}addEventListener(e,t,s=null){let r=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:i}=s;if(i.aborted){ae("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);r=()=>i.removeEventListener("abort",a),i.addEventListener("abort",a)}l(this,Yr).set(t,r)}removeEventListener(e,t){const s=l(this,Yr).get(t);s==null||s(),l(this,Yr).delete(t)}terminate(){for(const[,e]of l(this,Yr))e==null||e();l(this,Yr).clear()}}Yr=new WeakMap,Yg=new WeakMap;const dp={DATA:1,ERROR:2},at={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Jb(){}function mn(n){if(n instanceof _i||n instanceof jg||n instanceof Xb||n instanceof qd||n instanceof Cy)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||Pe('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new _i(n.message);case"InvalidPDFException":return new jg(n.message);case"PasswordException":return new Xb(n.message,n.code);case"ResponseException":return new qd(n.message,n.status,n.missing);case"UnknownErrorException":return new Cy(n.message,n.details)}return new Cy(n.message,n.toString())}var bc,xs,sE,rE,iE,Op;class Zu{constructor(e,t,s){A(this,xs);A(this,bc,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",_(this,xs,sE).bind(this),{signal:l(this,bc).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const r=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[r]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},s)}catch(a){i.reject(a)}return i.promise}sendWithStream(e,t,s,r){const i=this.streamId++,a=this.sourceName,o=this.targetName,c=this.comObj;return new ReadableStream({start:u=>{const d=Promise.withResolvers();return this.streamControllers[i]={controller:u,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:a,targetName:o,action:e,streamId:i,data:t,desiredSize:u.desiredSize},r),d.promise},pull:u=>{const d=Promise.withResolvers();return this.streamControllers[i].pullCall=d,c.postMessage({sourceName:a,targetName:o,stream:at.PULL,streamId:i,desiredSize:u.desiredSize}),d.promise},cancel:u=>{lt(u instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[i].cancelCall=d,this.streamControllers[i].isClosed=!0,c.postMessage({sourceName:a,targetName:o,stream:at.CANCEL,streamId:i,reason:mn(u)}),d.promise}},s)}destroy(){var e;(e=l(this,bc))==null||e.abort(),v(this,bc,null)}}bc=new WeakMap,xs=new WeakSet,sE=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){_(this,xs,iE).call(this,e);return}if(e.callback){const s=e.callbackId,r=this.callbackCapabilities[s];if(!r)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===dp.DATA)r.resolve(e.data);else if(e.callback===dp.ERROR)r.reject(mn(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,r=e.sourceName,i=this.comObj;Promise.try(t,e.data).then(function(a){i.postMessage({sourceName:s,targetName:r,callback:dp.DATA,callbackId:e.callbackId,data:a})},function(a){i.postMessage({sourceName:s,targetName:r,callback:dp.ERROR,callbackId:e.callbackId,reason:mn(a)})});return}if(e.streamId){_(this,xs,rE).call(this,e);return}t(e.data)},rE=function(e){const t=e.streamId,s=this.sourceName,r=e.sourceName,i=this.comObj,a=this,o=this.actionHandler[e.action],c={enqueue(u,d=1,h){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=d,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:s,targetName:r,stream:at.ENQUEUE,streamId:t,chunk:u},h)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:s,targetName:r,stream:at.CLOSE,streamId:t}),delete a.streamSinks[t])},error(u){lt(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:s,targetName:r,stream:at.ERROR,streamId:t,reason:mn(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,Promise.try(o,e.data,c).then(function(){i.postMessage({sourceName:s,targetName:r,stream:at.START_COMPLETE,streamId:t,success:!0})},function(u){i.postMessage({sourceName:s,targetName:r,stream:at.START_COMPLETE,streamId:t,reason:mn(u)})})},iE=function(e){const t=e.streamId,s=this.sourceName,r=e.sourceName,i=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case at.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(mn(e.reason));break;case at.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(mn(e.reason));break;case at.PULL:if(!o){i.postMessage({sourceName:s,targetName:r,stream:at.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||Jb).then(function(){i.postMessage({sourceName:s,targetName:r,stream:at.PULL_COMPLETE,streamId:t,success:!0})},function(u){i.postMessage({sourceName:s,targetName:r,stream:at.PULL_COMPLETE,streamId:t,reason:mn(u)})});break;case at.ENQUEUE:if(lt(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case at.CLOSE:if(lt(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),_(this,xs,Op).call(this,a,t);break;case at.ERROR:lt(a,"error should have stream controller"),a.controller.error(mn(e.reason)),_(this,xs,Op).call(this,a,t);break;case at.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(mn(e.reason)),_(this,xs,Op).call(this,a,t);break;case at.CANCEL:if(!o)break;const c=mn(e.reason);Promise.try(o.onCancel||Jb,c).then(function(){i.postMessage({sourceName:s,targetName:r,stream:at.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){i.postMessage({sourceName:s,targetName:r,stream:at.CANCEL_COMPLETE,streamId:t,reason:mn(u)})}),o.sinkCapability.reject(c),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Op=async function(e,t){var s,r,i;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(r=e.pullCall)==null?void 0:r.promise,(i=e.cancelCall)==null?void 0:i.promise]),delete this.streamControllers[t]};var _h;class aE{constructor({enableHWA:e=!1}){A(this,_h,!1);v(this,_h,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!l(this,_h)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Pe("Abstract method `_createCanvas` called.")}}_h=new WeakMap;class EL extends aE{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class oE{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Pe("Abstract method `_fetch` called.")}}class Zb extends oE{async _fetch(e){const t=await ku(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):If(t)}}class lE{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,r,i){return"none"}destroy(e=!1){}}var So,Sc,Kr,Qr,Xt,Ao,_o,W,Wt,ed,Cl,Fp,kl,cE,Jv,Nl,td,nd,Zv,sd;class CL extends lE{constructor({docId:t,ownerDocument:s=globalThis.document}){super();A(this,W);A(this,So);A(this,Sc);A(this,Kr);A(this,Qr);A(this,Xt);A(this,Ao);A(this,_o,0);v(this,Qr,t),v(this,Xt,s)}addFilter(t){if(!t)return"none";let s=l(this,W,Wt).get(t);if(s)return s;const[r,i,a]=_(this,W,Fp).call(this,t),o=t.length===1?r:`${r}${i}${a}`;if(s=l(this,W,Wt).get(o),s)return l(this,W,Wt).set(t,s),s;const c=`g_${l(this,Qr)}_transfer_map_${tn(this,_o)._++}`,u=_(this,W,kl).call(this,c);l(this,W,Wt).set(t,u),l(this,W,Wt).set(o,u);const d=_(this,W,Nl).call(this,c);return _(this,W,nd).call(this,r,i,a,d),u}addHCMFilter(t,s){var y;const r=`${t}-${s}`,i="base";let a=l(this,W,ed).get(i);if((a==null?void 0:a.key)===r||(a?((y=a.filter)==null||y.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},l(this,W,ed).set(i,a)),!t||!s))return a.url;const o=_(this,W,sd).call(this,t);t=te.makeHexColor(...o);const c=_(this,W,sd).call(this,s);if(s=te.makeHexColor(...c),l(this,W,Cl).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return a.url;const u=new Array(256);for(let m=0;m<=255;m++){const b=m/255;u[m]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}const d=u.join(","),h=`g_${l(this,Qr)}_hcm_filter`,f=a.filter=_(this,W,Nl).call(this,h);_(this,W,nd).call(this,d,d,d,f),_(this,W,Jv).call(this,f);const g=(m,b)=>{const w=o[m]/255,x=c[m]/255,S=new Array(b+1);for(let E=0;E<=b;E++)S[E]=w+E/b*(x-w);return S.join(",")};return _(this,W,nd).call(this,g(0,5),g(1,5),g(2,5),f),a.url=_(this,W,kl).call(this,h),a.url}addAlphaFilter(t){let s=l(this,W,Wt).get(t);if(s)return s;const[r]=_(this,W,Fp).call(this,[t]),i=`alpha_${r}`;if(s=l(this,W,Wt).get(i),s)return l(this,W,Wt).set(t,s),s;const a=`g_${l(this,Qr)}_alpha_map_${tn(this,_o)._++}`,o=_(this,W,kl).call(this,a);l(this,W,Wt).set(t,o),l(this,W,Wt).set(i,o);const c=_(this,W,Nl).call(this,a);return _(this,W,Zv).call(this,r,c),o}addLuminosityFilter(t){let s=l(this,W,Wt).get(t||"luminosity");if(s)return s;let r,i;if(t?([r]=_(this,W,Fp).call(this,[t]),i=`luminosity_${r}`):i="luminosity",s=l(this,W,Wt).get(i),s)return l(this,W,Wt).set(t,s),s;const a=`g_${l(this,Qr)}_luminosity_map_${tn(this,_o)._++}`,o=_(this,W,kl).call(this,a);l(this,W,Wt).set(t,o),l(this,W,Wt).set(i,o);const c=_(this,W,Nl).call(this,a);return _(this,W,cE).call(this,c),t&&_(this,W,Zv).call(this,r,c),o}addHighlightHCMFilter(t,s,r,i,a){var x;const o=`${s}-${r}-${i}-${a}`;let c=l(this,W,ed).get(t);if((c==null?void 0:c.key)===o||(c?((x=c.filter)==null||x.remove(),c.key=o,c.url="none",c.filter=null):(c={key:o,url:"none",filter:null},l(this,W,ed).set(t,c)),!s||!r))return c.url;const[u,d]=[s,r].map(_(this,W,sd).bind(this));let h=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),f=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[g,y]=[i,a].map(_(this,W,sd).bind(this));f<h&&([h,f,g,y]=[f,h,y,g]),l(this,W,Cl).style.color="";const m=(S,E,C)=>{const N=new Array(256),k=(f-h)/C,R=S/255,P=(E-S)/(255*C);let L=0;for(let M=0;M<=C;M++){const I=Math.round(h+M*k),U=R+M*P;for(let B=L;B<=I;B++)N[B]=U;L=I+1}for(let M=L;M<256;M++)N[M]=N[L-1];return N.join(",")},b=`g_${l(this,Qr)}_hcm_${t}_filter`,w=c.filter=_(this,W,Nl).call(this,b);return _(this,W,Jv).call(this,w),_(this,W,nd).call(this,m(g[0],y[0],5),m(g[1],y[1],5),m(g[2],y[2],5),w),c.url=_(this,W,kl).call(this,b),c.url}destroy(t=!1){var s,r,i,a;t&&((s=l(this,Ao))!=null&&s.size)||((r=l(this,Kr))==null||r.parentNode.parentNode.remove(),v(this,Kr,null),(i=l(this,Sc))==null||i.clear(),v(this,Sc,null),(a=l(this,Ao))==null||a.clear(),v(this,Ao,null),v(this,_o,0))}}So=new WeakMap,Sc=new WeakMap,Kr=new WeakMap,Qr=new WeakMap,Xt=new WeakMap,Ao=new WeakMap,_o=new WeakMap,W=new WeakSet,Wt=function(){return l(this,Sc)||v(this,Sc,new Map)},ed=function(){return l(this,Ao)||v(this,Ao,new Map)},Cl=function(){if(!l(this,Kr)){const t=l(this,Xt).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const r=l(this,Xt).createElementNS(Mr,"svg");r.setAttribute("width",0),r.setAttribute("height",0),v(this,Kr,l(this,Xt).createElementNS(Mr,"defs")),t.append(r),r.append(l(this,Kr)),l(this,Xt).body.append(t)}return l(this,Kr)},Fp=function(t){if(t.length===1){const u=t[0],d=new Array(256);for(let f=0;f<256;f++)d[f]=u[f]/255;const h=d.join(",");return[h,h,h]}const[s,r,i]=t,a=new Array(256),o=new Array(256),c=new Array(256);for(let u=0;u<256;u++)a[u]=s[u]/255,o[u]=r[u]/255,c[u]=i[u]/255;return[a.join(","),o.join(","),c.join(",")]},kl=function(t){if(l(this,So)===void 0){v(this,So,"");const s=l(this,Xt).URL;s!==l(this,Xt).baseURI&&(Ff(s)?ae('#createUrl: ignore "data:"-URL for performance reasons.'):v(this,So,Jw(s,"")))}return`url(${l(this,So)}#${t})`},cE=function(t){const s=l(this,Xt).createElementNS(Mr,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},Jv=function(t){const s=l(this,Xt).createElementNS(Mr,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},Nl=function(t){const s=l(this,Xt).createElementNS(Mr,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),l(this,W,Cl).append(s),s},td=function(t,s,r){const i=l(this,Xt).createElementNS(Mr,s);i.setAttribute("type","discrete"),i.setAttribute("tableValues",r),t.append(i)},nd=function(t,s,r,i){const a=l(this,Xt).createElementNS(Mr,"feComponentTransfer");i.append(a),_(this,W,td).call(this,a,"feFuncR",t),_(this,W,td).call(this,a,"feFuncG",s),_(this,W,td).call(this,a,"feFuncB",r)},Zv=function(t,s){const r=l(this,Xt).createElementNS(Mr,"feComponentTransfer");s.append(r),_(this,W,td).call(this,r,"feFuncA",t)},sd=function(t){return l(this,W,Cl).style.color=t,tx(getComputedStyle(l(this,W,Cl)).getPropertyValue("color"))};class uE{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Pe("Abstract method `_fetch` called.")}}class e1 extends uE{async _fetch(e){const t=await ku(e,"arraybuffer");return new Uint8Array(t)}}class dE{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Pe("Abstract method `_fetch` called.")}}class t1 extends dE{async _fetch(e){const t=await ku(e,"arraybuffer");return new Uint8Array(t)}}ln&&ae("Please use the `legacy` build in Node.js environments.");async function sx(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class kL extends lE{}class NL extends aE{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class TL extends oE{async _fetch(e){return sx(e)}}class PL extends uE{async _fetch(e){return sx(e)}}class RL extends dE{async _fetch(e){return sx(e)}}const Ot={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function e0(n,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,s),n.clip(r)}class rx{isModifyingCurrentTransform(){return!1}getPattern(){Pe("Abstract method `getPattern` called.")}}class LL extends rx{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,r){let i;if(r===Ot.STROKE||r===Ot.FILL){const a=t.current.getClippedPathBoundingBox(r,We(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,c=Math.ceil(a[3]-a[1])||1,u=t.cachedCanvases.getCanvas("pattern",o,c),d=u.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-a[0],-a[1]),s=te.transform(s,[1,0,0,1,a[0],a[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),e0(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),i=e.createPattern(u.canvas,"no-repeat");const h=new DOMMatrix(s);i.setTransform(h)}else e0(e,this._bbox),i=this._createGradient(e);return i}}function Ty(n,e,t,s,r,i,a,o){const c=e.coords,u=e.colors,d=n.data,h=n.width*4;let f;c[t+1]>c[s+1]&&(f=t,t=s,s=f,f=i,i=a,a=f),c[s+1]>c[r+1]&&(f=s,s=r,r=f,f=a,a=o,o=f),c[t+1]>c[s+1]&&(f=t,t=s,s=f,f=i,i=a,a=f);const g=(c[t]+e.offsetX)*e.scaleX,y=(c[t+1]+e.offsetY)*e.scaleY,m=(c[s]+e.offsetX)*e.scaleX,b=(c[s+1]+e.offsetY)*e.scaleY,w=(c[r]+e.offsetX)*e.scaleX,x=(c[r+1]+e.offsetY)*e.scaleY;if(y>=x)return;const S=u[i],E=u[i+1],C=u[i+2],N=u[a],k=u[a+1],R=u[a+2],P=u[o],L=u[o+1],M=u[o+2],I=Math.round(y),U=Math.round(x);let B,K,j,D,O,G,Q,H;for(let J=I;J<=U;J++){if(J<b){const fe=J<y?0:(y-J)/(y-b);B=g-(g-m)*fe,K=S-(S-N)*fe,j=E-(E-k)*fe,D=C-(C-R)*fe}else{let fe;J>x?fe=1:b===x?fe=0:fe=(b-J)/(b-x),B=m-(m-w)*fe,K=N-(N-P)*fe,j=k-(k-L)*fe,D=R-(R-M)*fe}let ne;J<y?ne=0:J>x?ne=1:ne=(y-J)/(y-x),O=g-(g-w)*ne,G=S-(S-P)*ne,Q=E-(E-L)*ne,H=C-(C-M)*ne;const he=Math.round(Math.min(B,O)),re=Math.round(Math.max(B,O));let oe=h*J+he*4;for(let fe=he;fe<=re;fe++)ne=(B-fe)/(B-O),ne<0?ne=0:ne>1&&(ne=1),d[oe++]=K-(K-G)*ne|0,d[oe++]=j-(j-Q)*ne|0,d[oe++]=D-(D-H)*ne|0,d[oe++]=255}}function ML(n,e,t){const s=e.coords,r=e.colors;let i,a;switch(e.type){case"lattice":const o=e.verticesPerRow,c=Math.floor(s.length/o)-1,u=o-1;for(i=0;i<c;i++){let d=i*o;for(let h=0;h<u;h++,d++)Ty(n,t,s[d],s[d+1],s[d+o],r[d],r[d+1],r[d+o]),Ty(n,t,s[d+o+1],s[d+1],s[d+o],r[d+o+1],r[d+1],r[d+o])}break;case"triangles":for(i=0,a=s.length;i<a;i+=3)Ty(n,t,s[i],s[i+1],s[i+2],r[i],r[i+1],r[i+2]);break;default:throw new Error("illegal figure")}}class jL extends rx{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,s){const o=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-o,d=Math.ceil(this._bounds[3])-c,h=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),g=u/h,y=d/f,m={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-c,scaleX:1/g,scaleY:1/y},b=h+2*2,w=f+2*2,x=s.getCanvas("mesh",b,w),S=x.context,E=S.createImageData(h,f);if(t){const N=E.data;for(let k=0,R=N.length;k<R;k+=4)N[k]=t[0],N[k+1]=t[1],N[k+2]=t[2],N[k+3]=255}for(const N of this._figures)ML(E,N,m);return S.putImageData(E,2,2),{canvas:x.canvas,offsetX:o-2*g,offsetY:c-2*y,scaleX:g,scaleY:y}}isModifyingCurrentTransform(){return!0}getPattern(e,t,s,r){e0(e,this._bbox);const i=new Float32Array(2);if(r===Ot.SHADING)te.singularValueDecompose2dScale(We(e),i);else if(this.matrix){te.singularValueDecompose2dScale(this.matrix,i);const[o,c]=i;te.singularValueDecompose2dScale(t.baseTransform,i),i[0]*=o,i[1]*=c}else te.singularValueDecompose2dScale(t.baseTransform,i);const a=this._createMeshCanvas(i,r===Ot.SHADING?null:this._background,t.cachedCanvases);return r!==Ot.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class DL extends rx{getPattern(){return"hotpink"}}function IL(n){switch(n[0]){case"RadialAxial":return new LL(n);case"Mesh":return new jL(n);case"Dummy":return new DL}throw new Error(`Unknown IR type: ${n[0]}`)}const n1={COLORED:1,UNCOLORED:2},Kg=class Kg{constructor(e,t,s,r){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=s,this.baseTransform=r}createPatternCanvas(e){const{bbox:t,operatorList:s,paintType:r,tilingType:i,color:a,canvasGraphicsFactory:o}=this;let{xstep:c,ystep:u}=this;c=Math.abs(c),u=Math.abs(u),Pm("TilingType: "+i);const d=t[0],h=t[1],f=t[2],g=t[3],y=f-d,m=g-h,b=new Float32Array(2);te.singularValueDecompose2dScale(this.matrix,b);const[w,x]=b;te.singularValueDecompose2dScale(this.baseTransform,b);const S=w*b[0],E=x*b[1];let C=y,N=m,k=!1,R=!1;const P=Math.ceil(c*S),L=Math.ceil(u*E),M=Math.ceil(y*S),I=Math.ceil(m*E);P>=M?C=c:k=!0,L>=I?N=u:R=!0;const U=this.getSizeAndScale(C,this.ctx.canvas.width,S),B=this.getSizeAndScale(N,this.ctx.canvas.height,E),K=e.cachedCanvases.getCanvas("pattern",U.size,B.size),j=K.context,D=o.createCanvasGraphics(j);if(D.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(D,r,a),j.translate(-U.scale*d,-B.scale*h),D.transform(U.scale,0,0,B.scale,0,0),j.save(),this.clipBbox(D,d,h,f,g),D.baseTransform=We(D.ctx),D.executeOperatorList(s),D.endDrawing(),j.restore(),k||R){const O=K.canvas;k&&(C=c),R&&(N=u);const G=this.getSizeAndScale(C,this.ctx.canvas.width,S),Q=this.getSizeAndScale(N,this.ctx.canvas.height,E),H=G.size,J=Q.size,ne=e.cachedCanvases.getCanvas("pattern-workaround",H,J),he=ne.context,re=k?Math.floor(y/c):0,oe=R?Math.floor(m/u):0;for(let fe=0;fe<=re;fe++)for(let it=0;it<=oe;it++)he.drawImage(O,H*fe,J*it,H,J,0,0,H,J);return{canvas:ne.canvas,scaleX:G.scale,scaleY:Q.scale,offsetX:d,offsetY:h}}return{canvas:K.canvas,scaleX:U.scale,scaleY:B.scale,offsetX:d,offsetY:h}}getSizeAndScale(e,t,s){const r=Math.max(Kg.MAX_PATTERN_SIZE,t);let i=Math.ceil(e*s);return i>=r?i=r:s=i/e,{scale:s,size:i}}clipBbox(e,t,s,r,i){const a=r-t,o=i-s;e.ctx.rect(t,s,a,o),te.axialAlignedBoundingBox([t,s,r,i],We(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const r=e.ctx,i=e.current;switch(t){case n1.COLORED:const{fillStyle:a,strokeStyle:o}=this.ctx;r.fillStyle=i.fillColor=a,r.strokeStyle=i.strokeColor=o;break;case n1.UNCOLORED:r.fillStyle=r.strokeStyle=s,i.fillColor=i.strokeColor=s;break;default:throw new aL(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,s,r){let i=s;r!==Ot.SHADING&&(i=te.transform(i,t.baseTransform),this.matrix&&(i=te.transform(i,this.matrix)));const a=this.createPatternCanvas(t);let o=new DOMMatrix(i);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const c=e.createPattern(a.canvas,"repeat");return c.setTransform(o),c}};$(Kg,"MAX_PATTERN_SIZE",3e3);let t0=Kg;function OL({src:n,srcPos:e=0,dest:t,width:s,height:r,nonBlackColor:i=4294967295,inverseDecode:a=!1}){const o=Nt.isLittleEndian?4278190080:255,[c,u]=a?[i,o]:[o,i],d=s>>3,h=s&7,f=n.length;t=new Uint32Array(t.buffer);let g=0;for(let y=0;y<r;y++){for(const b=e+d;e<b;e++){const w=e<f?n[e]:255;t[g++]=w&128?u:c,t[g++]=w&64?u:c,t[g++]=w&32?u:c,t[g++]=w&16?u:c,t[g++]=w&8?u:c,t[g++]=w&4?u:c,t[g++]=w&2?u:c,t[g++]=w&1?u:c}if(h===0)continue;const m=e<f?n[e++]:255;for(let b=0;b<h;b++)t[g++]=m&1<<7-b?u:c}return{srcPos:e,destPos:g}}const s1=16,r1=100,FL=15,i1=10,bn=16,Py=new DOMMatrix,Yn=new Float32Array(2),Gl=new Float32Array([1/0,1/0,-1/0,-1/0]);function $L(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},n.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},n.transform=function(t,s,r,i,a,o){e.transform(t,s,r,i,a,o),this.__originalTransform(t,s,r,i,a,o)},n.setTransform=function(t,s,r,i,a,o){e.setTransform(t,s,r,i,a,o),this.__originalSetTransform(t,s,r,i,a,o)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(t){e.rotate(t),this.__originalRotate(t)},n.clip=function(t){e.clip(t),this.__originalClip(t)},n.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},n.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},n.bezierCurveTo=function(t,s,r,i,a,o){e.bezierCurveTo(t,s,r,i,a,o),this.__originalBezierCurveTo(t,s,r,i,a,o)},n.rect=function(t,s,r,i){e.rect(t,s,r,i),this.__originalRect(t,s,r,i)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class zL{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,s)):(r=this.canvasFactory.create(t,s),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function hp(n,e,t,s,r,i,a,o,c,u){const[d,h,f,g,y,m]=We(n);if(h===0&&f===0){const x=a*d+y,S=Math.round(x),E=o*g+m,C=Math.round(E),N=(a+c)*d+y,k=Math.abs(Math.round(N)-S)||1,R=(o+u)*g+m,P=Math.abs(Math.round(R)-C)||1;return n.setTransform(Math.sign(d),0,0,Math.sign(g),S,C),n.drawImage(e,t,s,r,i,0,0,k,P),n.setTransform(d,h,f,g,y,m),[k,P]}if(d===0&&g===0){const x=o*f+y,S=Math.round(x),E=a*h+m,C=Math.round(E),N=(o+u)*f+y,k=Math.abs(Math.round(N)-S)||1,R=(a+c)*h+m,P=Math.abs(Math.round(R)-C)||1;return n.setTransform(0,Math.sign(h),Math.sign(f),0,S,C),n.drawImage(e,t,s,r,i,0,0,P,k),n.setTransform(d,h,f,g,y,m),[P,k]}n.drawImage(e,t,s,r,i,a,o,c,u);const b=Math.hypot(d,h),w=Math.hypot(f,g);return[b*c,w*u]}class a1{constructor(e,t){$(this,"alphaIsShape",!1);$(this,"fontSize",0);$(this,"fontSizeScale",1);$(this,"textMatrix",null);$(this,"textMatrixScale",1);$(this,"fontMatrix",Lv);$(this,"leading",0);$(this,"x",0);$(this,"y",0);$(this,"lineX",0);$(this,"lineY",0);$(this,"charSpacing",0);$(this,"wordSpacing",0);$(this,"textHScale",1);$(this,"textRenderingMode",Gt.FILL);$(this,"textRise",0);$(this,"fillColor","#000000");$(this,"strokeColor","#000000");$(this,"patternFill",!1);$(this,"patternStroke",!1);$(this,"fillAlpha",1);$(this,"strokeAlpha",1);$(this,"lineWidth",1);$(this,"activeSMask",null);$(this,"transferMaps","none");this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Gl.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Ot.FILL,t=null){const s=this.minMax.slice();if(e===Ot.STROKE){t||Pe("Stroke bounding box must include transform."),te.singularValueDecompose2dScale(t,Yn);const r=Yn[0]*this.lineWidth/2,i=Yn[1]*this.lineWidth/2;s[0]-=r,s[1]-=i,s[2]+=r,s[3]+=i}return s}updateClipFromPath(){const e=te.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Gl,0)}getClippedPathBoundingBox(e=Ot.FILL,t=null){return te.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function o1(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,s=e.width,r=t%bn,i=(t-r)/bn,a=r===0?i:i+1,o=n.createImageData(s,bn);let c=0,u;const d=e.data,h=o.data;let f,g,y,m;if(e.kind===Ed.GRAYSCALE_1BPP){const b=d.byteLength,w=new Uint32Array(h.buffer,0,h.byteLength>>2),x=w.length,S=s+7>>3,E=4294967295,C=Nt.isLittleEndian?4278190080:255;for(f=0;f<a;f++){for(y=f<i?bn:r,u=0,g=0;g<y;g++){const N=b-c;let k=0;const R=N>S?s:N*8-7,P=R&-8;let L=0,M=0;for(;k<P;k+=8)M=d[c++],w[u++]=M&128?E:C,w[u++]=M&64?E:C,w[u++]=M&32?E:C,w[u++]=M&16?E:C,w[u++]=M&8?E:C,w[u++]=M&4?E:C,w[u++]=M&2?E:C,w[u++]=M&1?E:C;for(;k<R;k++)L===0&&(M=d[c++],L=128),w[u++]=M&L?E:C,L>>=1}for(;u<x;)w[u++]=0;n.putImageData(o,0,f*bn)}}else if(e.kind===Ed.RGBA_32BPP){for(g=0,m=s*bn*4,f=0;f<i;f++)h.set(d.subarray(c,c+m)),c+=m,n.putImageData(o,0,g),g+=bn;f<a&&(m=s*r*4,h.set(d.subarray(c,c+m)),n.putImageData(o,0,g))}else if(e.kind===Ed.RGB_24BPP)for(y=bn,m=s*y,f=0;f<a;f++){for(f>=i&&(y=r,m=s*y),u=0,g=m;g--;)h[u++]=d[c++],h[u++]=d[c++],h[u++]=d[c++],h[u++]=255;n.putImageData(o,0,f*bn)}else throw new Error(`bad image kind: ${e.kind}`)}function l1(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,r=t%bn,i=(t-r)/bn,a=r===0?i:i+1,o=n.createImageData(s,bn);let c=0;const u=e.data,d=o.data;for(let h=0;h<a;h++){const f=h<i?bn:r;({srcPos:c}=OL({src:u,srcPos:c,dest:d,width:s,height:f,nonBlackColor:0})),n.putImageData(o,0,h*bn)}}function zu(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)n[s]!==void 0&&(e[s]=n[s]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function fp(n){n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0);const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}function c1(n,e){if(e)return!0;te.singularValueDecompose2dScale(n,Yn);const t=Math.fround(Ys.pixelRatio*Ei.PDF_TO_CSS_UNITS);return Yn[0]<=t&&Yn[1]<=t}const BL=["butt","round","square"],UL=["miter","round","bevel"],HL={},u1={};var Ks,n0,s0,r0;const mx=class mx{constructor(e,t,s,r,i,{optionalContentConfig:a,markedContentStack:o=null},c,u){A(this,Ks);this.ctx=e,this.current=new a1(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=r,this.filterFactory=i,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new zL(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:r=null}){const i=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,i,a),this.ctx.fillStyle=o,s){const c=this.cachedCanvases.getCanvas("transparent",i,a);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...We(this.compositeCtx))}this.ctx.save(),fp(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=We(this.ctx)}executeOperatorList(e,t,s,r){const i=e.argsArray,a=e.fnArray;let o=t||0;const c=i.length;if(c===o)return o;const u=c-o>i1&&typeof s=="function",d=u?Date.now()+FL:0;let h=0;const f=this.commonObjs,g=this.objs;let y;for(;;){if(r!==void 0&&o===r.nextBreakPoint)return r.breakIt(o,s),o;if(y=a[o],y!==Wd.dependency)this[y].apply(this,i[o]);else for(const m of i[o]){const b=m.startsWith("g_")?f:g;if(!b.has(m))return b.get(m,s),o}if(o++,o===c)return o;if(u&&++h>i1){if(Date.now()>d)return s(),o;h=0}}}endDrawing(){_(this,Ks,n0).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),_(this,Ks,s0).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,r=e.height??e.displayHeight;let i=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=s,c=r,u="prescale1",d,h;for(;i>2&&o>1||a>2&&c>1;){let f=o,g=c;i>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),i/=o/f),a>2&&c>1&&(g=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,a/=c/g),d=this.cachedCanvases.getCanvas(u,f,g),h=d.context,h.clearRect(0,0,f,g),h.drawImage(e,0,0,o,c,0,0,f,g),e=d.canvas,o=f,c=g,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:c}}_createMaskCanvas(e){const t=this.ctx,{width:s,height:r}=e,i=this.current.fillColor,a=this.current.patternFill,o=We(t);let c,u,d,h;if((e.bitmap||e.data)&&e.count>1){const P=e.bitmap||e.data.buffer;u=JSON.stringify(a?o:[o.slice(0,4),i]),c=this._cachedBitmapsMap.get(P),c||(c=new Map,this._cachedBitmapsMap.set(P,c));const L=c.get(u);if(L&&!a){const M=Math.round(Math.min(o[0],o[2])+o[4]),I=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:L,offsetX:M,offsetY:I}}d=L}d||(h=this.cachedCanvases.getCanvas("maskCanvas",s,r),l1(h.context,e));let f=te.transform(o,[1/s,0,0,-1/r,0,0]);f=te.transform(f,[1,0,0,1,0,-r]);const g=Gl.slice();te.axialAlignedBoundingBox([0,0,s,r],f,g);const[y,m,b,w]=g,x=Math.round(b-y)||1,S=Math.round(w-m)||1,E=this.cachedCanvases.getCanvas("fillCanvas",x,S),C=E.context,N=y,k=m;C.translate(-N,-k),C.transform(...f),d||(d=this._scaleImage(h.canvas,nr(C)),d=d.img,c&&a&&c.set(u,d)),C.imageSmoothingEnabled=c1(We(C),e.interpolate),hp(C,d,0,0,d.width,d.height,0,0,s,r),C.globalCompositeOperation="source-in";const R=te.transform(nr(C),[1,0,0,1,-N,-k]);return C.fillStyle=a?i.getPattern(t,this,R,Ot.FILL):i,C.fillRect(0,0,s,r),c&&!a&&(this.cachedCanvases.delete("fillCanvas"),c.set(u,E.canvas)),{canvas:E.canvas,offsetX:Math.round(N),offsetY:Math.round(k)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=BL[e]}setLineJoin(e){this.ctx.lineJoin=UL[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,s]of e)switch(t){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(s,e,t);this.suspendedCtx=this.ctx;const i=this.ctx=r.context;i.setTransform(this.suspendedCtx.getTransform()),zu(this.suspendedCtx,i),$L(i,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),zu(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,r){const i=r[0],a=r[1],o=r[2]-i,c=r[3]-a;o===0||c===0||(this.genericComposeSMask(t.context,s,o,c,t.subtype,t.backdrop,t.transferMap,i,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,r,i,a,o,c,u,d,h){let f=e.canvas,g=c-d,y=u-h;if(a)if(g<0||y<0||g+s>f.width||y+r>f.height){const b=this.cachedCanvases.getCanvas("maskExtension",s,r),w=b.context;w.drawImage(f,-g,-y),w.globalCompositeOperation="destination-atop",w.fillStyle=a,w.fillRect(0,0,s,r),w.globalCompositeOperation="source-over",f=b.canvas,g=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(g,y,s,r),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(g,y,s,r),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),i==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):i==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const m=new Path2D;m.rect(c,u,s,r),t.clip(m),t.globalCompositeOperation="destination-in",t.drawImage(f,g,y,s,r,c,u,s,r),t.restore()}save(){this.inSMaskMode&&zu(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&zu(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,s,r,i,a){this.ctx.transform(e,t,s,r,i,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s){let[r]=t;if(!s){r||(r=t[0]=new Path2D),this[e](r);return}if(!(r instanceof Path2D)){const i=t[0]=new Path2D;for(let a=0,o=r.length;a<o;)switch(r[a++]){case cp.moveTo:i.moveTo(r[a++],r[a++]);break;case cp.lineTo:i.lineTo(r[a++],r[a++]);break;case cp.curveTo:i.bezierCurveTo(r[a++],r[a++],r[a++],r[a++],r[a++],r[a++]);break;case cp.closePath:i.closePath();break;default:ae(`Unrecognized drawing path operator: ${r[a-1]}`);break}r=i}te.axialAlignedBoundingBox(s,We(this.ctx),this.current.minMax),this[e](r)}closePath(){this.ctx.closePath()}stroke(e,t=!0){const s=this.ctx,r=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const i=r.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=r.getPattern(s,this,nr(s),Ot.STROKE),i){const a=new Path2D;a.addPath(e,s.getTransform().invertSelf().multiplySelf(i)),e=a}this.rescaleAndStroke(e,!1),s.restore()}else this.rescaleAndStroke(e,!0);t&&this.consumePath(e,this.current.getClippedPathBoundingBox(Ot.STROKE,We(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(e){this.stroke(e)}fill(e,t=!0){const s=this.ctx,r=this.current.fillColor,i=this.current.patternFill;let a=!1;if(i){const c=r.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.fillStyle=r.getPattern(s,this,nr(s),Ot.FILL),c){const u=new Path2D;u.addPath(e,s.getTransform().invertSelf().multiplySelf(c)),e=u}a=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(s.fill(e,"evenodd"),this.pendingEOFill=!1):s.fill(e)),a&&s.restore(),t&&this.consumePath(e,o)}eoFill(e){this.pendingEOFill=!0,this.fill(e)}fillStroke(e){this.fill(e,!1),this.stroke(e,!1),this.consumePath(e)}eoFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}closeFillStroke(e){this.fillStroke(e)}closeEOFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}endPath(e){this.consumePath(e)}rawFillPath(e){this.ctx.fill(e)}clip(){this.pendingClip=HL}eoClip(){this.pendingClip=u1}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0)return;const s=new Path2D,r=t.getTransform().invertSelf();for(const{transform:i,x:a,y:o,fontSize:c,path:u}of e)s.addPath(u,new DOMMatrix(i).preMultiplySelf(r).translate(a,o).scale(c,-c));t.clip(s),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var d;const s=this.commonObjs.get(e),r=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=s.fontMatrix||Lv,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&ae("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;const i=s.loadedName||"sans-serif",a=((d=s.systemFontInfo)==null?void 0:d.css)||`"${i}", ${s.fallbackName}`;let o="normal";s.black?o="900":s.bold&&(o="bold");const c=s.italic?"italic":"normal";let u=t;t<s1?u=s1:t>r1&&(u=r1),this.current.fontSizeScale=t/u,this.ctx.font=`${c} ${o} ${u}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e){const{current:t}=this;t.textMatrix=e,t.textMatrixScale=Math.hypot(e[0],e[1]),t.x=t.lineX=0,t.y=t.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,s,r,i){const a=this.ctx,o=this.current,c=o.font,u=o.textRenderingMode,d=o.fontSize/o.fontSizeScale,h=u&Gt.FILL_STROKE_MASK,f=!!(u&Gt.ADD_TO_PATH_FLAG),g=o.patternFill&&!c.missingFile,y=o.patternStroke&&!c.missingFile;let m;if((c.disableFontFace||f||g||y)&&(m=c.getPathGenerator(this.commonObjs,e)),c.disableFontFace||g||y){a.save(),a.translate(t,s),a.scale(d,-d);let b;if((h===Gt.FILL||h===Gt.FILL_STROKE)&&(r?(b=a.getTransform(),a.setTransform(...r),a.fill(_(this,Ks,r0).call(this,m,b,r))):a.fill(m)),h===Gt.STROKE||h===Gt.FILL_STROKE)if(i){b||(b=a.getTransform()),a.setTransform(...i);const{a:w,b:x,c:S,d:E}=b,C=te.inverseTransform(i),N=te.transform([w,x,S,E,0,0],C);te.singularValueDecompose2dScale(N,Yn),a.lineWidth*=Math.max(Yn[0],Yn[1])/d,a.stroke(_(this,Ks,r0).call(this,m,b,i))}else a.lineWidth/=d,a.stroke(m);a.restore()}else(h===Gt.FILL||h===Gt.FILL_STROKE)&&a.fillText(e,t,s),(h===Gt.STROKE||h===Gt.FILL_STROKE)&&a.strokeText(e,t,s);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:We(a),x:t,y:s,fontSize:d,path:m})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){s=!0;break}return pe(this,"isFontSubpixelAAEnabled",s)}showText(e){const t=this.current,s=t.font;if(s.isType3Font)return this.showType3Text(e);const r=t.fontSize;if(r===0)return;const i=this.ctx,a=t.fontSizeScale,o=t.charSpacing,c=t.wordSpacing,u=t.fontDirection,d=t.textHScale*u,h=e.length,f=s.vertical,g=f?1:-1,y=s.defaultVMetrics,m=r*t.fontMatrix[0],b=t.textRenderingMode===Gt.FILL&&!s.disableFontFace&&!t.patternFill;i.save(),t.textMatrix&&i.transform(...t.textMatrix),i.translate(t.x,t.y+t.textRise),u>0?i.scale(d,-1):i.scale(d,1);let w,x;if(t.patternFill){i.save();const k=t.fillColor.getPattern(i,this,nr(i),Ot.FILL);w=We(i),i.restore(),i.fillStyle=k}if(t.patternStroke){i.save();const k=t.strokeColor.getPattern(i,this,nr(i),Ot.STROKE);x=We(i),i.restore(),i.strokeStyle=k}let S=t.lineWidth;const E=t.textMatrixScale;if(E===0||S===0){const k=t.textRenderingMode&Gt.FILL_STROKE_MASK;(k===Gt.STROKE||k===Gt.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=E;if(a!==1&&(i.scale(a,a),S/=a),i.lineWidth=S,s.isInvalidPDFjsFont){const k=[];let R=0;for(const P of e)k.push(P.unicode),R+=P.width;i.fillText(k.join(""),0,0),t.x+=R*m*d,i.restore(),this.compose();return}let C=0,N;for(N=0;N<h;++N){const k=e[N];if(typeof k=="number"){C+=g*k*r/1e3;continue}let R=!1;const P=(k.isSpace?c:0)+o,L=k.fontChar,M=k.accent;let I,U,B=k.width;if(f){const j=k.vmetric||y,D=-(k.vmetric?j[1]:B*.5)*m,O=j[2]*m;B=j?-j[0]:B,I=D/a,U=(C+O)/a}else I=C/a,U=0;if(s.remeasure&&B>0){const j=i.measureText(L).width*1e3/r*a;if(B<j&&this.isFontSubpixelAAEnabled){const D=B/j;R=!0,i.save(),i.scale(D,1),I/=D}else B!==j&&(I+=(B-j)/2e3*r/a)}if(this.contentVisible&&(k.isInFont||s.missingFile)){if(b&&!M)i.fillText(L,I,U);else if(this.paintChar(L,I,U,w,x),M){const j=I+r*M.offset.x/a,D=U-r*M.offset.y/a;this.paintChar(M.fontChar,j,D,w,x)}}const K=f?B*m-P*u:B*m+P*u;C+=K,R&&i.restore()}f?t.y-=C:t.x+=C*d,i.restore(),this.compose()}showType3Text(e){const t=this.ctx,s=this.current,r=s.font,i=s.fontSize,a=s.fontDirection,o=r.vertical?1:-1,c=s.charSpacing,u=s.wordSpacing,d=s.textHScale*a,h=s.fontMatrix||Lv,f=e.length,g=s.textRenderingMode===Gt.INVISIBLE;let y,m,b,w;if(!(g||i===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),s.textMatrix&&t.transform(...s.textMatrix),t.translate(s.x,s.y+s.textRise),t.scale(d,a),y=0;y<f;++y){if(m=e[y],typeof m=="number"){w=o*m*i/1e3,this.ctx.translate(w,0),s.x+=w*d;continue}const x=(m.isSpace?u:0)+c,S=r.charProcOperatorList[m.operatorListId];S?this.contentVisible&&(this.save(),t.scale(i,i),t.transform(...h),this.executeOperatorList(S),this.restore()):ae(`Type3 character "${m.operatorListId}" is not available.`);const E=[m.width,0];te.applyTransform(E,h),b=E[0]*i+x,t.translate(b,0),s.x+=b*d}t.restore()}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,s,r,i,a){const o=new Path2D;o.rect(s,r,i-s,a-r),this.ctx.clip(o),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const s=this.baseTransform||We(this.ctx),r={createCanvasGraphics:i=>new mx(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new t0(e,this.ctx,r,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e){this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e){this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=IL(this.getObject(e)),this.cachedPatterns.set(e,s)),t&&(s.matrix=t),s}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const s=this._getPattern(e);t.fillStyle=s.getPattern(t,this,nr(t),Ot.SHADING);const r=nr(t);if(r){const{width:i,height:a}=t.canvas,o=Gl.slice();te.axialAlignedBoundingBox([0,0,i,a],r,o);const[c,u,d,h]=o;this.ctx.fillRect(c,u,d-c,h-u)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Pe("Should not call beginInlineImage")}beginImageData(){Pe("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=We(this.ctx),t)){te.axialAlignedBoundingBox(t,this.baseTransform,this.current.minMax);const[s,r,i,a]=t,o=new Path2D;o.rect(s,r,i-s,a-r),this.ctx.clip(o),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||Pm("TODO: Support non-isolated groups."),e.knockout&&ae("Knockout groups not supported.");const s=We(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=Gl.slice();te.axialAlignedBoundingBox(e.bbox,We(t),r);const i=[0,0,t.canvas.width,t.canvas.height];r=te.intersect(r,i)||[0,0,0,0];const a=Math.floor(r[0]),o=Math.floor(r[1]),c=Math.max(Math.ceil(r[2])-a,1),u=Math.max(Math.ceil(r[3])-o,1);this.current.startNewPathAndClipBox([0,0,c,u]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);const h=this.cachedCanvases.getCanvas(d,c,u),f=h.context;f.translate(-a,-o),f.transform(...s);let g=new Path2D;const[y,m,b,w]=e.bbox;if(g.rect(y,m,b-y,w-m),e.matrix){const x=new Path2D;x.addPath(g,new DOMMatrix(e.matrix)),g=x}f.clip(g),e.smask?this.smaskStack.push({canvas:h.canvas,context:f,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,o),t.save()),zu(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const r=We(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...r);const i=Gl.slice();te.axialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],r,i),this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(e,t,s,r,i){if(_(this,Ks,n0).call(this),fp(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const a=t[2]-t[0],o=t[3]-t[1];if(i&&this.annotationCanvasMap){s=s.slice(),s[4]-=t[0],s[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=o,te.singularValueDecompose2dScale(We(this.ctx),Yn);const{viewportScale:c}=this,u=Math.ceil(a*this.outputScaleX*c),d=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(u,d);const{canvas:h,context:f}=this.annotationCanvas;this.annotationCanvasMap.set(e,h),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(Yn[0],0,0,-Yn[1],0,o*Yn[1]),fp(this.ctx)}else{fp(this.ctx),this.endPath();const c=new Path2D;c.rect(t[0],t[1],a,o),this.ctx.clip(c)}}this.current=new a1(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...r)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),_(this,Ks,s0).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const s=this.ctx,r=this._createMaskCanvas(e),i=r.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(i,r.offsetX,r.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s=0,r=0,i,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const c=We(o);o.transform(t,s,r,i,0,0);const u=this._createMaskCanvas(e);o.setTransform(1,0,0,1,u.offsetX-c[4],u.offsetY-c[5]);for(let d=0,h=a.length;d<h;d+=2){const f=te.transform(c,[t,s,r,i,a[d],a[d+1]]);o.drawImage(u.canvas,f[4],f[5])}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,s=this.current.fillColor,r=this.current.patternFill;for(const i of e){const{data:a,width:o,height:c,transform:u}=i,d=this.cachedCanvases.getCanvas("maskCanvas",o,c),h=d.context;h.save();const f=this.getObject(a,i);l1(h,f),h.globalCompositeOperation="source-in",h.fillStyle=r?s.getPattern(h,this,nr(t),Ot.FILL):s,h.fillRect(0,0,o,c),h.restore(),t.save(),t.transform(...u),t.scale(1,-1),hp(t,d.canvas,0,0,o,c,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){ae("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,s,r){if(!this.contentVisible)return;const i=this.getObject(e);if(!i){ae("Dependent image isn't ready yet");return}const a=i.width,o=i.height,c=[];for(let u=0,d=r.length;u<d;u+=2)c.push({transform:[t,0,0,s,r[u],r[u+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(i,c)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:r}=e,i=this.cachedCanvases.getCanvas("inlineImage",s,r),a=i.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",i.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,s=e.height,r=this.ctx;this.save();const{filter:i}=r;i!=="none"&&i!==""&&(r.filter="none"),r.scale(1/t,-1/s);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const u=this.cachedCanvases.getCanvas("inlineImage",t,s).context;o1(u,e),a=this.applyTransferMapsToCanvas(u)}const o=this._scaleImage(a,nr(r));r.imageSmoothingEnabled=c1(We(r),e.interpolate),hp(r,o.img,0,0,o.paintWidth,o.paintHeight,0,-s,t,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const s=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const i=e.width,a=e.height,c=this.cachedCanvases.getCanvas("inlineImage",i,a).context;o1(c,e),r=this.applyTransferMapsToCanvas(c)}for(const i of t)s.save(),s.transform(...i.transform),s.scale(1,-1),hp(s,r,i.x,i.y,i.w,i.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e,t){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const r=this.ctx;this.pendingClip&&(s||(this.pendingClip===u1?r.clip(e,"evenodd"):r.clip(e)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=We(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:r,d:i}=this.ctx.getTransform();let a,o;if(s===0&&r===0){const c=Math.abs(t),u=Math.abs(i);if(c===u)if(e===0)a=o=1/c;else{const d=c*e;a=o=d<1?1/d:1}else if(e===0)a=1/c,o=1/u;else{const d=c*e,h=u*e;a=d<1?1/d:1,o=h<1?1/h:1}}else{const c=Math.abs(t*i-s*r),u=Math.hypot(t,s),d=Math.hypot(r,i);if(e===0)a=d/c,o=u/c;else{const h=e*c;a=d>h?d/h:1,o=u>h?u/h:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:s,current:{lineWidth:r}}=this,[i,a]=this.getScaleForStroking();if(i===a){s.lineWidth=(r||1)*i,s.stroke(e);return}const o=s.getLineDash();t&&s.save(),s.scale(i,a),Py.a=1/i,Py.d=1/a;const c=new Path2D;if(c.addPath(e,Py),o.length>0){const u=Math.max(i,a);s.setLineDash(o.map(d=>d/u)),s.lineDashOffset/=u}s.lineWidth=r||1,s.stroke(c),t&&s.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Ks=new WeakSet,n0=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},s0=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},r0=function(e,t,s){const r=new Path2D;return r.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),r};let nc=mx;for(const n in Wd)nc.prototype[n]!==void 0&&(nc.prototype[Wd[n]]=nc.prototype[n]);var Eh,Ch;class ms{static get workerPort(){return l(this,Eh)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");v(this,Eh,e)}static get workerSrc(){return l(this,Ch)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");v(this,Ch,e)}}Eh=new WeakMap,Ch=new WeakMap,A(ms,Eh,null),A(ms,Ch,"");var Ac,kh;class VL{constructor({parsedData:e,rawData:t}){A(this,Ac);A(this,kh);v(this,Ac,e),v(this,kh,t)}getRaw(){return l(this,kh)}get(e){return l(this,Ac).get(e)??null}[Symbol.iterator](){return l(this,Ac).entries()}}Ac=new WeakMap,kh=new WeakMap;const Tl=Symbol("INTERNAL");var Nh,Th,Ph,_c;class GL{constructor(e,{name:t,intent:s,usage:r,rbGroups:i}){A(this,Nh,!1);A(this,Th,!1);A(this,Ph,!1);A(this,_c,!0);v(this,Nh,!!(e&qn.DISPLAY)),v(this,Th,!!(e&qn.PRINT)),this.name=t,this.intent=s,this.usage=r,this.rbGroups=i}get visible(){if(l(this,Ph))return l(this,_c);if(!l(this,_c))return!1;const{print:e,view:t}=this.usage;return l(this,Nh)?(t==null?void 0:t.viewState)!=="OFF":l(this,Th)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==Tl&&Pe("Internal method `_setVisible` called."),v(this,Ph,s),v(this,_c,t)}}Nh=new WeakMap,Th=new WeakMap,Ph=new WeakMap,_c=new WeakMap;var ea,Ne,Ec,Cc,Rh,i0;class WL{constructor(e,t=qn.DISPLAY){A(this,Rh);A(this,ea,null);A(this,Ne,new Map);A(this,Ec,null);A(this,Cc,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,v(this,Cc,e.order);for(const s of e.groups)l(this,Ne).set(s.id,new GL(t,s));if(e.baseState==="OFF")for(const s of l(this,Ne).values())s._setVisible(Tl,!1);for(const s of e.on)l(this,Ne).get(s)._setVisible(Tl,!0);for(const s of e.off)l(this,Ne).get(s)._setVisible(Tl,!1);v(this,Ec,this.getHash())}}isVisible(e){if(l(this,Ne).size===0)return!0;if(!e)return Pm("Optional content group not defined."),!0;if(e.type==="OCG")return l(this,Ne).has(e.id)?l(this,Ne).get(e.id).visible:(ae(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return _(this,Rh,i0).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!l(this,Ne).has(t))return ae(`Optional content group not found: ${t}`),!0;if(l(this,Ne).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!l(this,Ne).has(t))return ae(`Optional content group not found: ${t}`),!0;if(!l(this,Ne).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!l(this,Ne).has(t))return ae(`Optional content group not found: ${t}`),!0;if(!l(this,Ne).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!l(this,Ne).has(t))return ae(`Optional content group not found: ${t}`),!0;if(l(this,Ne).get(t).visible)return!1}return!0}return ae(`Unknown optional content policy ${e.policy}.`),!0}return ae(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var i;const r=l(this,Ne).get(e);if(!r){ae(`Optional content group not found: ${e}`);return}if(s&&t&&r.rbGroups.length)for(const a of r.rbGroups)for(const o of a)o!==e&&((i=l(this,Ne).get(o))==null||i._setVisible(Tl,!1,!0));r._setVisible(Tl,!!t,!0),v(this,ea,null)}setOCGState({state:e,preserveRB:t}){let s;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":s=r;continue}const i=l(this,Ne).get(r);if(i)switch(s){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!i.visible,t);break}}v(this,ea,null)}get hasInitialVisibility(){return l(this,Ec)===null||this.getHash()===l(this,Ec)}getOrder(){return l(this,Ne).size?l(this,Cc)?l(this,Cc).slice():[...l(this,Ne).keys()]:null}getGroup(e){return l(this,Ne).get(e)||null}getHash(){if(l(this,ea)!==null)return l(this,ea);const e=new Z_;for(const[t,s]of l(this,Ne))e.update(`${t}:${s.visible}`);return v(this,ea,e.hexdigest())}[Symbol.iterator](){return l(this,Ne).entries()}}ea=new WeakMap,Ne=new WeakMap,Ec=new WeakMap,Cc=new WeakMap,Rh=new WeakSet,i0=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let r=1;r<t;r++){const i=e[r];let a;if(Array.isArray(i))a=_(this,Rh,i0).call(this,i);else if(l(this,Ne).has(i))a=l(this,Ne).get(i).visible;else return ae(`Optional content group not found: ${i}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"};class qL{constructor(e,{disableRange:t=!1,disableStream:s=!1}){lt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:i,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(i==null?void 0:i.length)>0){const c=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((c,u)=>{this._onReceiveData({begin:c,chunk:u})}),e.addProgressListener((c,u)=>{this._onProgress({loaded:c,total:u})}),e.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const r=this._rangeReaders.some(function(i){return i._begin!==e?!1:(i._enqueue(s),!0)});lt(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,r,i;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(i=(r=this._fullRequestReader)==null?void 0:r.onProgress)==null||i.call(r,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){lt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new XL(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new YL(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class XL{constructor(e,t,s=!1,r=null){this._stream=e,this._done=s||!1,this._filename=Lm(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const i of this._queuedChunks)this._loaded+=i.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class YL{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function KL(n){let e=!0,t=s("filename\\*","i").exec(n);if(t){t=t[1];let d=o(t);return d=unescape(d),d=c(d),d=u(d),i(d)}if(t=a(n),t){const d=u(t);return i(d)}if(t=s("filename","i").exec(n),t){t=t[1];let d=o(t);return d=u(d),i(d)}function s(d,h){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function r(d,h){if(d){if(!/^[\x00-\xFF]+$/.test(h))return h;try{const f=new TextDecoder(d,{fatal:!0}),g=If(h);h=f.decode(g),e=!1}catch{}}return h}function i(d){return e&&/[\x80-\xff]/.test(d)&&(d=r("utf-8",d),e&&(d=r("iso-8859-1",d))),d}function a(d){const h=[];let f;const g=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=g.exec(d))!==null;){let[,m,b,w]=f;if(m=parseInt(m,10),m in h){if(m===0)break;continue}h[m]=[b,w]}const y=[];for(let m=0;m<h.length&&m in h;++m){let[b,w]=h[m];w=o(w),b&&(w=unescape(w),m===0&&(w=c(w))),y.push(w)}return y.join("")}function o(d){if(d.startsWith('"')){const h=d.slice(1).split('\\"');for(let f=0;f<h.length;++f){const g=h[f].indexOf('"');g!==-1&&(h[f]=h[f].slice(0,g),h.length=f+1),h[f]=h[f].replaceAll(/\\(.)/g,"$1")}d=h.join('"')}return d}function c(d){const h=d.indexOf("'");if(h===-1)return d;const f=d.slice(0,h),y=d.slice(h+1).replace(/^[^']*'/,"");return r(f,y)}function u(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,f,g,y){if(g==="q"||g==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(m,b){return String.fromCharCode(parseInt(b,16))}),r(f,y);try{y=atob(y)}catch{}return r(f,y)})}return""}function hE(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const s in e){const r=e[s];r!==void 0&&t.append(s,r)}return t}function jm(n){var e;return((e=URL.parse(n))==null?void 0:e.origin)??null}function fE({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:s}){const r={allowRangeRequests:!1,suggestedLength:void 0},i=parseInt(n.get("Content-Length"),10);return!Number.isInteger(i)||(r.suggestedLength=i,i<=2*t)||s||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function pE(n){const e=n.get("Content-Disposition");if(e){let t=KL(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Lm(t))return t}return null}function zf(n,e){return new qd(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n,n===404||n===0&&e.startsWith("file:"))}function gE(n){return n===200||n===206}function mE(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function yE(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(ae(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class QL{constructor(e){$(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=hE(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return lt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new JL(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new ZL(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class JL{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),r=t.url;fetch(r,mE(s,this._withCredentials,this._abortController)).then(i=>{if(e._responseOrigin=jm(i.url),!gE(i.status))throw zf(i.status,r);this._reader=i.body.getReader(),this._headersCapability.resolve();const a=i.headers,{allowRangeRequests:o,suggestedLength:c}=fE({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=c||this._contentLength,this._filename=pE(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new _i("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:yE(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class ZL{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const i=new Headers(e.headers);i.append("Range",`bytes=${t}-${s-1}`);const a=r.url;fetch(a,mE(i,this._withCredentials,this._abortController)).then(o=>{const c=jm(o.url);if(c!==e._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${e._responseOrigin}".`);if(!gE(o.status))throw zf(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:yE(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Ry=200,Ly=206;function eM(n){const e=n.response;return typeof e!="string"?e:If(e).buffer}class tM{constructor({url:e,httpHeaders:t,withCredentials:s}){$(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=hE(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,r=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[i,a]of this.headers)t.setRequestHeader(i,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=Ly):r.expectedStatus=Ry,t.responseType="arraybuffer",lt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var r;const s=this.pendingRequests[e];s&&((r=s.onProgress)==null||r.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const r=s.xhr;if(r.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){s.onError(r.status);return}const i=r.status||Ry;if(!(i===Ry&&s.expectedStatus===Ly)&&i!==s.expectedStatus){s.onError(r.status);return}const o=eM(r);if(i===Ly){const c=r.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);u?s.onDone({begin:parseInt(u[1],10),chunk:o}):(ae('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class nM{constructor(e){this._source=e,this._manager=new tM(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return lt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new sM(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new rM(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class sM{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=jm(t.responseURL);const s=t.getAllResponseHeaders(),r=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[c,...u]=o.split(": ");return[c,u.join(": ")]}):[]),{allowRangeRequests:i,suggestedLength:a}=fE({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=pE(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=zf(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class rM{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=jm((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=zf(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const iM=/^[a-z][a-z0-9\-+.]+:/i;function aM(n){if(iM.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class oM{constructor(e){this.source=e,this.url=aM(e.url),lt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return lt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new lM(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new cM(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class lM{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=zf(0,this._url.href)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new _i("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class cM{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const i=process.getBuiltinModule("fs");this._setReadableStream(i.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Bu=Symbol("INITIAL_DATA");var On,Lh,a0;class vE{constructor(){A(this,Lh);A(this,On,Object.create(null))}get(e,t=null){if(t){const r=_(this,Lh,a0).call(this,e);return r.promise.then(()=>t(r.data)),null}const s=l(this,On)[e];if(!s||s.data===Bu)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=l(this,On)[e];return!!t&&t.data!==Bu}delete(e){const t=l(this,On)[e];return!t||t.data===Bu?!1:(delete l(this,On)[e],!0)}resolve(e,t=null){const s=_(this,Lh,a0).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in l(this,On)){const{data:s}=l(this,On)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}v(this,On,Object.create(null))}*[Symbol.iterator](){for(const e in l(this,On)){const{data:t}=l(this,On)[e];t!==Bu&&(yield[e,t])}}}On=new WeakMap,Lh=new WeakSet,a0=function(e){var t;return(t=l(this,On))[e]||(t[e]={...Promise.withResolvers(),data:Bu})};const uM=1e5,d1=30;var C1,ta,wn,Mh,jh,Eo,Jr,Dh,Ih,Co,kc,Nc,na,Tc,Oh,Pc,ko,Fh,$h,Qe,Rc,No,zh,sa,Lc,Ci,wE,xE,o0,Zn,$p,l0,bE,SE;let Yd=(Qe=class{constructor({textContentSource:e,container:t,viewport:s}){A(this,Ci);A(this,ta,Promise.withResolvers());A(this,wn,null);A(this,Mh,!1);A(this,jh,!!((C1=globalThis.FontInspector)!=null&&C1.enabled));A(this,Eo,null);A(this,Jr,null);A(this,Dh,0);A(this,Ih,0);A(this,Co,null);A(this,kc,null);A(this,Nc,0);A(this,na,0);A(this,Tc,Object.create(null));A(this,Oh,[]);A(this,Pc,null);A(this,ko,[]);A(this,Fh,new WeakMap);A(this,$h,null);var c;if(e instanceof ReadableStream)v(this,Pc,e);else if(typeof e=="object")v(this,Pc,new ReadableStream({start(u){u.enqueue(e),u.close()}}));else throw new Error('No "textContentSource" parameter specified.');v(this,wn,v(this,kc,t)),v(this,na,s.scale*Ys.pixelRatio),v(this,Nc,s.rotation),v(this,Jr,{div:null,properties:null,ctx:null});const{pageWidth:r,pageHeight:i,pageX:a,pageY:o}=s.rawDims;v(this,$h,[1,0,0,-1,-a,o+i]),v(this,Ih,r),v(this,Dh,i),_(c=Qe,Zn,bE).call(c),Da(t,s),l(this,ta).promise.finally(()=>{l(Qe,Lc).delete(this),v(this,Jr,null),v(this,Tc,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Nt.platform;return pe(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{l(this,Co).read().then(({value:t,done:s})=>{if(s){l(this,ta).resolve();return}l(this,Eo)??v(this,Eo,t.lang),Object.assign(l(this,Tc),t.styles),_(this,Ci,wE).call(this,t.items),e()},l(this,ta).reject)};return v(this,Co,l(this,Pc).getReader()),l(Qe,Lc).add(this),e(),l(this,ta).promise}update({viewport:e,onBefore:t=null}){var i;const s=e.scale*Ys.pixelRatio,r=e.rotation;if(r!==l(this,Nc)&&(t==null||t(),v(this,Nc,r),Da(l(this,kc),{rotation:r})),s!==l(this,na)){t==null||t(),v(this,na,s);const a={div:null,properties:null,ctx:_(i=Qe,Zn,$p).call(i,l(this,Eo))};for(const o of l(this,ko))a.properties=l(this,Fh).get(o),a.div=o,_(this,Ci,o0).call(this,a)}}cancel(){var t;const e=new _i("TextLayer task cancelled.");(t=l(this,Co))==null||t.cancel(e).catch(()=>{}),v(this,Co,null),l(this,ta).reject(e)}get textDivs(){return l(this,ko)}get textContentItemsStr(){return l(this,Oh)}static cleanup(){if(!(l(this,Lc).size>0)){l(this,Rc).clear();for(const{canvas:e}of l(this,No).values())e.remove();l(this,No).clear()}}},ta=new WeakMap,wn=new WeakMap,Mh=new WeakMap,jh=new WeakMap,Eo=new WeakMap,Jr=new WeakMap,Dh=new WeakMap,Ih=new WeakMap,Co=new WeakMap,kc=new WeakMap,Nc=new WeakMap,na=new WeakMap,Tc=new WeakMap,Oh=new WeakMap,Pc=new WeakMap,ko=new WeakMap,Fh=new WeakMap,$h=new WeakMap,Rc=new WeakMap,No=new WeakMap,zh=new WeakMap,sa=new WeakMap,Lc=new WeakMap,Ci=new WeakSet,wE=function(e){var r,i;if(l(this,Mh))return;(i=l(this,Jr)).ctx??(i.ctx=_(r=Qe,Zn,$p).call(r,l(this,Eo)));const t=l(this,ko),s=l(this,Oh);for(const a of e){if(t.length>uM){ae("Ignoring additional textDivs for performance reasons."),v(this,Mh,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=l(this,wn);v(this,wn,document.createElement("span")),l(this,wn).classList.add("markedContent"),a.id!==null&&l(this,wn).setAttribute("id",`${a.id}`),o.append(l(this,wn))}else a.type==="endMarkedContent"&&v(this,wn,l(this,wn).parentNode);continue}s.push(a.str),_(this,Ci,xE).call(this,a)}},xE=function(e){var m;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};l(this,ko).push(t);const r=te.transform(l(this,$h),e.transform);let i=Math.atan2(r[1],r[0]);const a=l(this,Tc)[e.fontName];a.vertical&&(i+=Math.PI/2);let o=l(this,jh)&&a.fontSubstitution||a.fontFamily;o=Qe.fontFamilyMap.get(o)||o;const c=Math.hypot(r[2],r[3]),u=c*_(m=Qe,Zn,SE).call(m,o,a,l(this,Eo));let d,h;i===0?(d=r[4],h=r[5]-u):(d=r[4]+u*Math.sin(i),h=r[5]-u*Math.cos(i));const f="calc(var(--total-scale-factor) *",g=t.style;l(this,wn)===l(this,kc)?(g.left=`${(100*d/l(this,Ih)).toFixed(2)}%`,g.top=`${(100*h/l(this,Dh)).toFixed(2)}%`):(g.left=`${f}${d.toFixed(2)}px)`,g.top=`${f}${h.toFixed(2)}px)`),g.fontSize=`${f}${(l(Qe,sa)*c).toFixed(2)}px)`,g.fontFamily=o,s.fontSize=c,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,l(this,jh)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),i!==0&&(s.angle=i*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const b=Math.abs(e.transform[0]),w=Math.abs(e.transform[3]);b!==w&&Math.max(b,w)/Math.min(b,w)>1.5&&(y=!0)}if(y&&(s.canvasWidth=a.vertical?e.height:e.width),l(this,Fh).set(t,s),l(this,Jr).div=t,l(this,Jr).properties=s,_(this,Ci,o0).call(this,l(this,Jr)),s.hasText&&l(this,wn).append(t),s.hasEOL){const b=document.createElement("br");b.setAttribute("role","presentation"),l(this,wn).append(b)}},o0=function(e){var o;const{div:t,properties:s,ctx:r}=e,{style:i}=t;let a="";if(l(Qe,sa)>1&&(a=`scale(${1/l(Qe,sa)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:c}=i,{canvasWidth:u,fontSize:d}=s;_(o=Qe,Zn,l0).call(o,r,d*l(this,na),c);const{width:h}=r.measureText(t.textContent);h>0&&(a=`scaleX(${u*l(this,na)/h}) ${a}`)}s.angle!==0&&(a=`rotate(${s.angle}deg) ${a}`),a.length>0&&(i.transform=a)},Zn=new WeakSet,$p=function(e=null){let t=l(this,No).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),l(this,No).set(e,t),l(this,zh).set(t,{size:0,family:""})}return t},l0=function(e,t,s){const r=l(this,zh).get(e);t===r.size&&s===r.family||(e.font=`${t}px ${s}`,r.size=t,r.family=s)},bE=function(){if(l(this,sa)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),v(this,sa,e.getBoundingClientRect().height),e.remove()},SE=function(e,t,s){const r=l(this,Rc).get(e);if(r)return r;const i=_(this,Zn,$p).call(this,s);i.canvas.width=i.canvas.height=d1,_(this,Zn,l0).call(this,i,d1,e);const a=i.measureText(""),o=a.fontBoundingBoxAscent,c=Math.abs(a.fontBoundingBoxDescent);i.canvas.width=i.canvas.height=0;let u=.8;return o?u=o/(o+c):(Nt.platform.isFirefox&&ae("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?u=t.ascent:t.descent&&(u=1+t.descent)),l(this,Rc).set(e,u),u},A(Qe,Zn),A(Qe,Rc,new Map),A(Qe,No,new Map),A(Qe,zh,new WeakMap),A(Qe,sa,null),A(Qe,Lc,new Set),Qe);class Kd{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function r(i){var c;if(!i)return;let a=null;const o=i.name;if(o==="#text")a=i.value;else if(Kd.shouldBuildText(o))(c=i==null?void 0:i.attributes)!=null&&c.textContent?a=i.attributes.textContent:i.value&&(a=i.value);else return;if(a!==null&&t.push({str:a}),!!i.children)for(const u of i.children)r(u)}return r(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const dM=100;function ix(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new c0,{docId:t}=e,s=n.url?bL(n.url):null,r=n.data?SL(n.data):null,i=n.httpHeaders||null,a=n.withCredentials===!0,o=n.password??null,c=n.range instanceof ax?n.range:null,u=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:2**16;let d=n.worker instanceof xu?n.worker:null;const h=n.verbosity,f=typeof n.docBaseUrl=="string"&&!Ff(n.docBaseUrl)?n.docBaseUrl:null,g=up(n.cMapUrl),y=n.cMapPacked!==!1,m=n.CMapReaderFactory||(ln?TL:Zb),b=up(n.iccUrl),w=up(n.standardFontDataUrl),x=n.StandardFontDataFactory||(ln?PL:e1),S=up(n.wasmUrl),E=n.WasmFactory||(ln?RL:t1),C=n.stopAtErrors!==!0,N=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,k=n.isEvalSupported!==!1,R=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!ln,P=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!ln&&(Nt.platform.isFirefox||!globalThis.chrome),L=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,M=typeof n.disableFontFace=="boolean"?n.disableFontFace:ln,I=n.fontExtraProperties===!0,U=n.enableXfa===!0,B=n.ownerDocument||globalThis.document,K=n.disableRange===!0,j=n.disableStream===!0,D=n.disableAutoFetch===!0,O=n.pdfBug===!0,G=n.CanvasFactory||(ln?NL:EL),Q=n.FilterFactory||(ln?kL:CL),H=n.enableHWA===!0,J=n.useWasm!==!1,ne=c?c.length:n.length??NaN,he=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!ln&&!M,re=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:!!(m===Zb&&x===e1&&E===t1&&g&&w&&S&&Xu(g,document.baseURI)&&Xu(w,document.baseURI)&&Xu(S,document.baseURI)),oe=null;sL(h);const fe={canvasFactory:new G({ownerDocument:B,enableHWA:H}),filterFactory:new Q({docId:t,ownerDocument:B}),cMapReaderFactory:re?null:new m({baseUrl:g,isCompressed:y}),standardFontDataFactory:re?null:new x({baseUrl:w}),wasmFactory:re?null:new E({baseUrl:S})};d||(d=xu.create({verbosity:h,port:ms.workerPort}),e._worker=d);const it={docId:t,apiVersion:"5.3.31",data:r,password:o,disableAutoFetch:D,rangeChunkSize:u,length:ne,docBaseUrl:f,enableXfa:U,evaluatorOptions:{maxImageSize:N,disableFontFace:M,ignoreErrors:C,isEvalSupported:k,isOffscreenCanvasSupported:R,isImageDecoderSupported:P,canvasMaxAreaInBytes:L,fontExtraProperties:I,useSystemFonts:he,useWasm:J,useWorkerFetch:re,cMapUrl:g,iccUrl:b,standardFontDataUrl:w,wasmUrl:S}},gn={ownerDocument:B,pdfBug:O,styleElement:oe,loadingParams:{disableAutoFetch:D,enableXfa:U}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const ue=d.messageHandler.sendWithPromise("GetDocRequest",it,r?[r.buffer]:null);let Nn;if(c)Nn=new qL(c,{disableRange:K,disableStream:j});else if(!r){if(!s)throw new Error("getDocument - no `url` parameter provided.");const Tt=Xu(s)?QL:ln?oM:nM;Nn=new Tt({url:s,length:ne,httpHeaders:i,withCredentials:a,rangeChunkSize:u,disableRange:K,disableStream:j})}return ue.then(Tt=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const vt=new Zu(t,Tt,d.port),ve=new pM(vt,e,Nn,gn,fe);e._transport=ve,vt.send("Ready",null)})}).catch(e._capability.reject),e}var Qg;const Jg=class Jg{constructor(){$(this,"_capability",Promise.withResolvers());$(this,"_transport",null);$(this,"_worker",null);$(this,"docId",`d${tn(Jg,Qg)._++}`);$(this,"destroyed",!1);$(this,"onPassword",null);$(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,s,r;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(i){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,i}this._transport=null,(r=this._worker)==null||r.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Qg=new WeakMap,A(Jg,Qg,0);let c0=Jg;var To,Bh,Uh,Hh,Vh,k1;let ax=(k1=class{constructor(e,t,s=!1,r=null){A(this,To,Promise.withResolvers());A(this,Bh,[]);A(this,Uh,[]);A(this,Hh,[]);A(this,Vh,[]);this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=r}addRangeListener(e){l(this,Vh).push(e)}addProgressListener(e){l(this,Hh).push(e)}addProgressiveReadListener(e){l(this,Uh).push(e)}addProgressiveDoneListener(e){l(this,Bh).push(e)}onDataRange(e,t){for(const s of l(this,Vh))s(e,t)}onDataProgress(e,t){l(this,To).promise.then(()=>{for(const s of l(this,Hh))s(e,t)})}onDataProgressiveRead(e){l(this,To).promise.then(()=>{for(const t of l(this,Uh))t(e)})}onDataProgressiveDone(){l(this,To).promise.then(()=>{for(const e of l(this,Bh))e()})}transportReady(){l(this,To).resolve()}requestDataRange(e,t){Pe("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},To=new WeakMap,Bh=new WeakMap,Uh=new WeakMap,Hh=new WeakMap,Vh=new WeakMap,k1);class hM{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return pe(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Zr,Po,rd;class fM{constructor(e,t,s,r=!1){A(this,Po);A(this,Zr,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=r?new Kb:null,this._pdfBug=r,this.commonObjs=s.commonObjs,this.objs=new vE,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:r=0,dontFlip:i=!1}={}){return new Of({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:r,dontFlip:i})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return pe(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:s="display",annotationMode:r=Ar.ENABLE,transform:i=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:c=null,pageColors:u=null,printAnnotationStorage:d=null,isEditing:h=!1}){var E,C;(E=this._stats)==null||E.time("Overall");const f=this._transport.getRenderingIntent(s,r,d,h),{renderingIntent:g,cacheKey:y}=f;v(this,Zr,!1),o||(o=this._transport.getOptionalContentConfig(g));let m=this._intentStates.get(y);m||(m=Object.create(null),this._intentStates.set(y,m)),m.streamReaderCancelTimeout&&(clearTimeout(m.streamReaderCancelTimeout),m.streamReaderCancelTimeout=null);const b=!!(g&qn.PRINT);m.displayReadyCapability||(m.displayReadyCapability=Promise.withResolvers(),m.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(C=this._stats)==null||C.time("Page Request"),this._pumpOperatorList(f));const w=N=>{var k;m.renderTasks.delete(x),b&&v(this,Zr,!0),_(this,Po,rd).call(this),N?(x.capability.reject(N),this._abortOperatorList({intentState:m,reason:N instanceof Error?N:new Error(N)})):x.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(k=globalThis.Stats)!=null&&k.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},x=new u0({callback:w,params:{canvasContext:e,viewport:t,transform:i,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:m.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:u});(m.renderTasks||(m.renderTasks=new Set)).add(x);const S=x.task;return Promise.all([m.displayReadyCapability.promise,o]).then(([N,k])=>{var R;if(this.destroyed){w();return}if((R=this._stats)==null||R.time("Rendering"),!(k.renderingIntent&g))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");x.initializeGraphics({transparency:N,optionalContentConfig:k}),x.operatorListChanged()}).catch(w),S}getOperatorList({intent:e="display",annotationMode:t=Ar.ENABLE,printAnnotationStorage:s=null,isEditing:r=!1}={}){var u;function i(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(c))}const a=this._transport.getRenderingIntent(e,t,s,r,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let c;return o.opListReadCapability||(c=Object.create(null),c.operatorListChanged=i,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(c),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(u=this._stats)==null||u.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>Kd.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,r){function i(){a.read().then(function({value:c,done:u}){if(u){s(o);return}o.lang??(o.lang=c.lang),Object.assign(o.styles,c.styles),o.items.push(...c.items),i()},r)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};i()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),v(this,Zr,!1),Promise.all(e)}cleanup(e=!1){v(this,Zr,!0);const t=_(this,Po,rd).call(this);return e&&t&&this._stats&&(this._stats=new Kb),t}_startRenderPage(e,t){var r,i;const s=this._intentStates.get(t);s&&((r=this._stats)==null||r.timeEnd("Page Request"),(i=s.displayReadyCapability)==null||i.resolve(e))}_renderPageChunk(e,t){for(let s=0,r=e.length;s<r;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&_(this,Po,rd).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:r}){const{map:i,transfer:a}=s,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i,modifiedIds:r},a).getReader(),u=this._intentStates.get(t);u.streamReader=c;const d=()=>{c.read().then(({value:h,done:f})=>{if(f){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,u),d())},h=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const f of u.renderTasks)f.operatorListChanged();_(this,Po,rd).call(this)}if(u.displayReadyCapability)u.displayReadyCapability.reject(h);else if(u.opListReadCapability)u.opListReadCapability.reject(h);else throw h}})};d()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof Rm){let r=dM;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new _i(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,i]of this._intentStates)if(i===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}Zr=new WeakMap,Po=new WeakSet,rd=function(){if(!l(this,Zr)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),v(this,Zr,!1),!0};var ra,Ls,ei,Ro,Zg,Lo,Mo,un,zp,AE,_E,id,Mc,Bp;const ze=class ze{constructor({name:e=null,port:t=null,verbosity:s=rL()}={}){A(this,un);A(this,ra,Promise.withResolvers());A(this,Ls,null);A(this,ei,null);A(this,Ro,null);if(this.name=e,this.destroyed=!1,this.verbosity=s,t){if(l(ze,Mo).has(t))throw new Error("Cannot use more than one PDFWorker per port.");l(ze,Mo).set(t,this),_(this,un,AE).call(this,t)}else _(this,un,_E).call(this)}get promise(){return l(this,ra).promise}get port(){return l(this,ei)}get messageHandler(){return l(this,Ls)}destroy(){var e,t;this.destroyed=!0,(e=l(this,Ro))==null||e.terminate(),v(this,Ro,null),l(ze,Mo).delete(l(this,ei)),v(this,ei,null),(t=l(this,Ls))==null||t.destroy(),v(this,Ls,null)}static create(e){const t=l(this,Mo).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new ze(e)}static get workerSrc(){if(ms.workerSrc)return ms.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return pe(this,"_setupFakeWorkerGlobal",(async()=>l(this,Mc,Bp)?l(this,Mc,Bp):(await import(this.workerSrc)).WorkerMessageHandler)())}};ra=new WeakMap,Ls=new WeakMap,ei=new WeakMap,Ro=new WeakMap,Zg=new WeakMap,Lo=new WeakMap,Mo=new WeakMap,un=new WeakSet,zp=function(){l(this,ra).resolve(),l(this,Ls).send("configure",{verbosity:this.verbosity})},AE=function(e){v(this,ei,e),v(this,Ls,new Zu("main","worker",e)),l(this,Ls).on("ready",()=>{}),_(this,un,zp).call(this)},_E=function(){if(l(ze,Lo)||l(ze,Mc,Bp)){_(this,un,id).call(this);return}let{workerSrc:e}=ze;try{ze._isSameOrigin(window.location,e)||(e=ze._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new Zu("main","worker",t),r=()=>{i.abort(),s.destroy(),t.terminate(),this.destroyed?l(this,ra).reject(new Error("Worker was destroyed")):_(this,un,id).call(this)},i=new AbortController;t.addEventListener("error",()=>{l(this,Ro)||r()},{signal:i.signal}),s.on("test",o=>{if(i.abort(),this.destroyed||!o){r();return}v(this,Ls,s),v(this,ei,t),v(this,Ro,t),_(this,un,zp).call(this)}),s.on("ready",o=>{if(i.abort(),this.destroyed){r();return}try{a()}catch{_(this,un,id).call(this)}});const a=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};a();return}catch{Pm("The worker has been disabled.")}_(this,un,id).call(this)},id=function(){l(ze,Lo)||(ae("Setting up fake worker."),v(ze,Lo,!0)),ze._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){l(this,ra).reject(new Error("Worker was destroyed"));return}const t=new _L;v(this,ei,t);const s=`fake${tn(ze,Zg)._++}`,r=new Zu(s+"_worker",s,t);e.setup(r,t),v(this,Ls,new Zu(s,s+"_worker",t)),_(this,un,zp).call(this)}).catch(e=>{l(this,ra).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Mc=new WeakSet,Bp=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},A(ze,Mc),A(ze,Zg,0),A(ze,Lo,!1),A(ze,Mo,new WeakMap),ln&&(v(ze,Lo,!0),ms.workerSrc||(ms.workerSrc="./pdf.worker.mjs")),ze._isSameOrigin=(e,t)=>{const s=URL.parse(e);if(!(s!=null&&s.origin)||s.origin==="null")return!1;const r=new URL(t,s);return s.origin===r.origin},ze._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},ze.fromPort=e=>{if(fL("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return ze.create(e)};let xu=ze;var ti,gr,jc,Dc,ni,jo,ad;class pM{constructor(e,t,s,r,i){A(this,jo);A(this,ti,new Map);A(this,gr,new Map);A(this,jc,new Map);A(this,Dc,new Map);A(this,ni,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new vE,this.fontLoader=new wL({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.wasmFactory=i.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return pe(this,"annotationStorage",new nx)}getRenderingIntent(e,t=Ar.ENABLE,s=null,r=!1,i=!1){let a=qn.DISPLAY,o=Kv;switch(e){case"any":a=qn.ANY;break;case"display":break;case"print":a=qn.PRINT;break;default:ae(`getRenderingIntent - invalid intent: ${e}`)}const c=a&qn.PRINT&&s instanceof tE?s:this.annotationStorage;switch(t){case Ar.DISABLE:a+=qn.ANNOTATIONS_DISABLE;break;case Ar.ENABLE:break;case Ar.ENABLE_FORMS:a+=qn.ANNOTATIONS_FORMS;break;case Ar.ENABLE_STORAGE:a+=qn.ANNOTATIONS_STORAGE,o=c.serializable;break;default:ae(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(a+=qn.IS_EDITING),i&&(a+=qn.OPLIST);const{ids:u,hash:d}=c.modifiedIds,h=[a,o.hash,d];return{renderingIntent:a,cacheKey:h.join("_"),annotationStorageSerializable:o,modifiedIds:u}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=l(this,ni))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of l(this,gr).values())e.push(r._destroy());l(this,gr).clear(),l(this,jc).clear(),l(this,Dc).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var r,i;this.commonObjs.clear(),this.fontLoader.clear(),l(this,ti).clear(),this.filterFactory.destroy(),Yd.cleanup(),(r=this._networkStream)==null||r.cancelAllRequests(new _i("Worker was terminated.")),(i=this.messageHandler)==null||i.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,r)=>{lt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=i=>{this._lastProgress={loaded:i.loaded,total:i.total}},r.onPull=()=>{this._fullReader.read().then(function({value:i,done:a}){if(a){r.close();return}lt(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(i),1,[i])}).catch(i=>{r.error(i)})},r.onCancel=i=>{this._fullReader.cancel(i),r.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:i,contentLength:a}=this._fullReader;return(!r||!i)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=c=>{var u;(u=t.onProgress)==null||u.call(t,{loaded:c.loaded,total:c.total})}),{isStreamingSupported:r,isRangeSupported:i,contentLength:a}}),e.on("GetRangeReader",(s,r)=>{lt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const i=this._networkStream.getRangeReader(s.begin,s.end);if(!i){r.close();return}r.onPull=()=>{i.read().then(function({value:a,done:o}){if(o){r.close();return}lt(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{i.cancel(a),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new hM(s,this))}),e.on("DocException",s=>{t._capability.reject(mn(s))}),e.on("PasswordRequest",s=>{v(this,ni,Promise.withResolvers());try{if(!t.onPassword)throw mn(s);const r=i=>{i instanceof Error?l(this,ni).reject(i):l(this,ni).resolve({password:i})};t.onPassword(r,s.code)}catch(r){l(this,ni).reject(r)}return l(this,ni).promise}),e.on("DataLoaded",s=>{var r;(r=t.onProgress)==null||r.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;l(this,gr).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,r,i])=>{var a;if(this.destroyed||this.commonObjs.has(s))return null;switch(r){case"Font":if("error"in i){const d=i.error;ae(`Error during font loading: ${d}`),this.commonObjs.resolve(s,d);break}const o=this._params.pdfBug&&((a=globalThis.FontInspector)!=null&&a.enabled)?(d,h)=>globalThis.FontInspector.fontAdded(d,h):null,c=new xL(i,o);this.fontLoader.bind(c).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!c.fontExtraProperties&&c.data&&(c.data=null),this.commonObjs.resolve(s,c)});break;case"CopyLocalImage":const{imageRef:u}=i;lt(u,"The imageRef must be defined.");for(const d of l(this,gr).values())for(const[,h]of d.objs)if((h==null?void 0:h.ref)===u)return h.dataLen?(this.commonObjs.resolve(s,structuredClone(h)),h.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,i);break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([s,r,i,a])=>{var c;if(this.destroyed)return;const o=l(this,gr).get(r);if(!o.objs.has(s)){if(o._intentStates.size===0){(c=a==null?void 0:a.bitmap)==null||c.close();return}switch(i){case"Image":case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${i}`)}}}),e.on("DocProgress",s=>{var r;this.destroyed||(r=t.onProgress)==null||r.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const r=this[s.type];if(!r)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return r.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&ae("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=l(this,jc).get(t);if(s)return s;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(i=>{if(this.destroyed)throw new Error("Transport destroyed");i.refStr&&l(this,Dc).set(i.refStr,e);const a=new fM(t,i,this,this._params.pdfBug);return l(this,gr).set(t,a),a});return l(this,jc).set(t,r),r}getPageIndex(e){return Qv(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return _(this,jo,ad).call(this,"GetFieldObjects")}hasJSActions(){return _(this,jo,ad).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return _(this,jo,ad).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return _(this,jo,ad).call(this,"GetOptionalContentConfig").then(t=>new WL(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=l(this,ti).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(r=>{var i,a;return{info:r[0],metadata:r[1]?new VL(r[1]):null,contentDispositionFilename:((i=this._fullReader)==null?void 0:i.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return l(this,ti).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of l(this,gr).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),l(this,ti).clear(),this.filterFactory.destroy(!0),Yd.cleanup()}}cachedPageNumber(e){if(!Qv(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return l(this,Dc).get(t)??null}}ti=new WeakMap,gr=new WeakMap,jc=new WeakMap,Dc=new WeakMap,ni=new WeakMap,jo=new WeakSet,ad=function(e,t=null){const s=l(this,ti).get(e);if(s)return s;const r=this.messageHandler.sendWithPromise(e,t);return l(this,ti).set(e,r),r};var ia;class gM{constructor(e){A(this,ia,null);$(this,"onContinue",null);$(this,"onError",null);v(this,ia,e)}get promise(){return l(this,ia).capability.promise}cancel(e=0){l(this,ia).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=l(this,ia).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=l(this,ia);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}ia=new WeakMap;var aa,Do;const Qa=class Qa{constructor({callback:e,params:t,objs:s,commonObjs:r,annotationCanvasMap:i,operatorList:a,pageIndex:o,canvasFactory:c,filterFactory:u,useRequestAnimationFrame:d=!1,pdfBug:h=!1,pageColors:f=null}){A(this,aa,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=r,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=c,this.filterFactory=u,this._pdfBug=h,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new gM(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,c;if(this.cancelled)return;if(this._canvas){if(l(Qa,Do).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");l(Qa,Do).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:r,transform:i,background:a}=this.params;this.gfx=new nc(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:i,viewport:r,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(c=this.graphicsReadyCallback)==null||c.call(this)}cancel(e=null,t=0){var s,r,i;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),l(this,aa)&&(window.cancelAnimationFrame(l(this,aa)),v(this,aa,null)),l(Qa,Do).delete(this._canvas),e||(e=new Rm(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(i=(r=this.task).onError)==null||i.call(r,e)}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?v(this,aa,window.requestAnimationFrame(()=>{v(this,aa,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),l(Qa,Do).delete(this._canvas),this.callback())))}};aa=new WeakMap,Do=new WeakMap,A(Qa,Do,new WeakSet);let u0=Qa;const EE="5.3.31",CE="47ad820d9";function h1(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function Uu(n){return Math.max(0,Math.min(255,255*n))}class f1{static CMYK_G([e,t,s,r]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Uu(e),[e,e,e]}static G_HTML([e]){const t=h1(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(Uu)}static RGB_HTML(e){return`#${e.map(h1).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,s+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,s,r]){return[Uu(1-Math.min(1,e+r)),Uu(1-Math.min(1,s+r)),Uu(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const r=1-e,i=1-t,a=1-s,o=Math.min(r,i,a);return["CMYK",r,i,a,o]}}class mM{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),s||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Pe("Abstract method `_createSVG` called.")}}class Qd extends mM{_createSVG(e){return document.createElementNS(Mr,e)}}class ox{static setupStorage(e,t,s,r,i){const a=r.getValue(t,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),i==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?e.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&e.removeAttribute("checked"),i==="print")break;e.addEventListener("change",o=>{r.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),i==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const c=o.target.options,u=c.selectedIndex===-1?"":c[c.selectedIndex].value;r.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:r,linkService:i}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${r}`);for(const[c,u]of Object.entries(a))if(u!=null)switch(c){case"class":u.length&&e.setAttribute(c,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!o||c!=="href"&&c!=="newWindow")&&e.setAttribute(c,u)}o&&i.addLinkAttributes(e,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(e,a.dataId,t,s)}static render(e){var h,f;const t=e.annotationStorage,s=e.linkService,r=e.xfaHtml,i=e.intent||"display",a=document.createElement(r.name);r.attributes&&this.setAttributes({html:a,element:r,intent:i,linkService:s});const o=i!=="richText",c=e.div;if(c.append(a),e.viewport){const g=`matrix(${e.viewport.transform.join(",")})`;c.style.transform=g}o&&c.setAttribute("class","xfaLayer xfaFont");const u=[];if(r.children.length===0){if(r.value){const g=document.createTextNode(r.value);a.append(g),o&&Kd.shouldBuildText(r.name)&&u.push(g)}return{textDivs:u}}const d=[[r,-1,a]];for(;d.length>0;){const[g,y,m]=d.at(-1);if(y+1===g.children.length){d.pop();continue}const b=g.children[++d.at(-1)[1]];if(b===null)continue;const{name:w}=b;if(w==="#text"){const S=document.createTextNode(b.value);u.push(S),m.append(S);continue}const x=(h=b==null?void 0:b.attributes)!=null&&h.xmlns?document.createElementNS(b.attributes.xmlns,w):document.createElement(w);if(m.append(x),b.attributes&&this.setAttributes({html:x,element:b,storage:t,intent:i,linkService:s}),((f=b.children)==null?void 0:f.length)>0)d.push([b,-1,x]);else if(b.value){const S=document.createTextNode(b.value);o&&Kd.shouldBuildText(w)&&u.push(S),x.append(S)}}for(const g of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Bf=1e3,yM=9,gl=new WeakSet;class p1{static create(e){switch(e.data.annotationType){case Ze.LINK:return new kE(e);case Ze.TEXT:return new vM(e);case Ze.WIDGET:switch(e.data.fieldType){case"Tx":return new wM(e);case"Btn":return e.data.radioButton?new PE(e):e.data.checkBox?new bM(e):new SM(e);case"Ch":return new AM(e);case"Sig":return new xM(e)}return new xl(e);case Ze.POPUP:return new h0(e);case Ze.FREETEXT:return new DE(e);case Ze.LINE:return new EM(e);case Ze.SQUARE:return new CM(e);case Ze.CIRCLE:return new kM(e);case Ze.POLYLINE:return new IE(e);case Ze.CARET:return new TM(e);case Ze.INK:return new lx(e);case Ze.POLYGON:return new NM(e);case Ze.HIGHLIGHT:return new OE(e);case Ze.UNDERLINE:return new PM(e);case Ze.SQUIGGLY:return new RM(e);case Ze.STRIKEOUT:return new LM(e);case Ze.STAMP:return new FE(e);case Ze.FILEATTACHMENT:return new MM(e);default:return new rt(e)}}}var Io,Ic,Oc,Gh,d0;const yx=class yx{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:r=!1}={}){A(this,Gh);A(this,Io,null);A(this,Ic,!1);A(this,Oc,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),r&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:s}){return!!(e!=null&&e.str||t!=null&&t.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return yx._hasPopupData(this.data)}updateEdited(e){var s;if(!this.container)return;l(this,Io)||v(this,Io,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&_(this,Gh,d0).call(this,t),(s=l(this,Oc))==null||s.popup.updateEdited(e)}resetEdited(){var e;l(this,Io)&&(_(this,Gh,d0).call(this,l(this,Io).rect),(e=l(this,Oc))==null||e.popup.resetEdited(),v(this,Io,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:r}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",t.id),this instanceof xl||(i.tabIndex=Bf);const{style:a}=i;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(i.title=t.alternativeText),t.noRotate&&i.classList.add("norotate"),!t.rect||this instanceof h0){const{rotation:m}=t;return!t.hasOwnCanvas&&m!==0&&this.setRotation(m,i),i}const{width:o,height:c}=this;if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const m=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(m>0||b>0){const x=`calc(${m}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;a.borderRadius=x}else if(this instanceof PE){const x=`calc(${o}px * var(--total-scale-factor)) / calc(${c}px * var(--total-scale-factor))`;a.borderRadius=x}switch(t.borderStyle.style){case El.SOLID:a.borderStyle="solid";break;case El.DASHED:a.borderStyle="dashed";break;case El.BEVELED:ae("Unimplemented border style: beveled");break;case El.INSET:ae("Unimplemented border style: inset");break;case El.UNDERLINE:a.borderBottomStyle="solid";break}const w=t.borderColor||null;w?(v(this,Ic,!0),a.borderColor=te.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):a.borderWidth=0}const u=te.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:d,pageHeight:h,pageX:f,pageY:g}=r.rawDims;a.left=`${100*(u[0]-f)/d}%`,a.top=`${100*(u[1]-g)/h}%`;const{rotation:y}=t;return t.hasOwnCanvas||y===0?(a.width=`${100*o/d}%`,a.height=`${100*c/h}%`):this.setRotation(y,i),i}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:r}=this.parent.viewport.rawDims;let{width:i,height:a}=this;e%180!==0&&([i,a]=[a,i]),t.style.width=`${100*i/s}%`,t.style.height=`${100*a/r}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,r)=>{const i=r.detail[t],a=i[0],o=i.slice(1);r.target.style[s]=f1[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:f1[`${a}_rgb`](o)})};return pe(this,"_commonActions",{display:t=>{const{display:s}=t.detail,r=s%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const r of Object.keys(t.detail)){const i=e[r]||s[r];i==null||i(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[r,i]of Object.entries(t)){const a=s[r];if(a){const o={detail:{[r]:i},target:e};a(o),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,r,i]=this.data.rect.map(m=>Math.fround(m));if(e.length===8){const[m,b,w,x]=e.subarray(2,6);if(r===m&&i===b&&t===w&&s===x)return}const{style:a}=this.container;let o;if(l(this,Ic)){const{borderColor:m,borderWidth:b}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${m}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const c=r-t,u=i-s,{svgFactory:d}=this,h=d.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);const f=d.createElement("defs");h.append(f);const g=d.createElement("clipPath"),y=`clippath_${this.data.id}`;g.setAttribute("id",y),g.setAttribute("clipPathUnits","objectBoundingBox"),f.append(g);for(let m=2,b=e.length;m<b;m+=8){const w=e[m],x=e[m+1],S=e[m+2],E=e[m+3],C=d.createElement("rect"),N=(S-t)/c,k=(i-x)/u,R=(w-S)/c,P=(x-E)/u;C.setAttribute("x",N),C.setAttribute("y",k),C.setAttribute("width",R),C.setAttribute("height",P),g.append(C),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${N}" y="${k}" width="${R}" height="${P}"/>`)}l(this,Ic)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(h),this.container.style.clipPath=`url(#${y})`}_createPopup(){const{data:e}=this,t=v(this,Oc,new h0({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){Pe("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:i,id:a,exportValues:o}of r){if(i===-1||a===t)continue;const c=typeof o=="string"?o:null,u=document.querySelector(`[data-element-id="${a}"]`);if(u&&!gl.has(u)){ae(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:c,domElement:u})}return s}for(const r of document.getElementsByName(e)){const{exportValue:i}=r,a=r.getAttribute("data-element-id");a!==t&&gl.has(r)&&s.push({id:a,exportValue:i,domElement:r})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};Io=new WeakMap,Ic=new WeakMap,Oc=new WeakMap,Gh=new WeakSet,d0=function(e){const{container:{style:t},data:{rect:s,rotation:r},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:c}}}}=this;s==null||s.splice(0,4,...e),t.left=`${100*(e[0]-o)/i}%`,t.top=`${100*(a-e[3]+c)/a}%`,r===0?(t.width=`${100*(e[2]-e[0])/i}%`,t.height=`${100*(e[3]-e[1])/a}%`):this.setRotation(r)};let rt=yx;var Kn,qa,NE,TE;class kE extends rt{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});A(this,Kn);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,r=document.createElement("a");r.setAttribute("data-element-id",t.id);let i=!1;return t.url?(s.addLinkAttributes(r,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(r,t.action),i=!0):t.attachment?(_(this,Kn,NE).call(this,r,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(_(this,Kn,TE).call(this,r,t.setOCGState),i=!0):t.dest?(this._bindLink(r,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,t),i=!0),t.resetForm?(this._bindResetFormAction(r,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(r,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(r),this.container}_bindLink(t,s){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&_(this,Kn,qa).call(this)}_bindNamedAction(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),_(this,Kn,qa).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(s.actions)){const a=r.get(i);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:i}}),!1})}t.onclick||(t.onclick=()=>!1),_(this,Kn,qa).call(this)}_bindResetFormAction(t,s){const r=t.onclick;if(r||(t.href=this.linkService.getAnchorUrl("")),_(this,Kn,qa).call(this),!this._fieldObjects){ae('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(t.onclick=()=>!1);return}t.onclick=()=>{var h;r==null||r();const{fields:i,refs:a,include:o}=s,c=[];if(i.length!==0||a.length!==0){const f=new Set(a);for(const g of i){const y=this._fieldObjects[g]||[];for(const{id:m}of y)f.add(m)}for(const g of Object.values(this._fieldObjects))for(const y of g)f.has(y.id)===o&&c.push(y)}else for(const f of Object.values(this._fieldObjects))c.push(...f);const u=this.annotationStorage,d=[];for(const f of c){const{id:g}=f;switch(d.push(g),f.type){case"text":{const m=f.defaultValue||"";u.setValue(g,{value:m});break}case"checkbox":case"radiobutton":{const m=f.defaultValue===f.exportValues;u.setValue(g,{value:m});break}case"combobox":case"listbox":{const m=f.defaultValue||"";u.setValue(g,{value:m});break}default:continue}const y=document.querySelector(`[data-element-id="${g}"]`);if(y){if(!gl.has(y)){ae(`_bindResetFormAction - element not allowed: ${g}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}}Kn=new WeakSet,qa=function(){this.container.setAttribute("data-internal-link","")},NE=function(t,s,r=null){t.href=this.linkService.getAnchorUrl(""),s.description&&(t.title=s.description),t.onclick=()=>{var i;return(i=this.downloadManager)==null||i.openOrDownloadData(s.content,s.filename,r),!1},_(this,Kn,qa).call(this)},TE=function(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),_(this,Kn,qa).call(this)};class vM extends rt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class xl extends rt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Nt.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,r,i){s.includes("mouse")?e.addEventListener(s,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(s,a=>{var o;if(s==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}i&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(a)}}))})}_setEventListeners(e,t,s,r){var i,a,o;for(const[c,u]of s)(u==="Action"||(i=this.data.actions)!=null&&i[u])&&((u==="Focus"||u==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,c,u,r),u==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):u==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":te.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||yM,i=e.style;let a;const o=2,c=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o),d=Math.round(u/(Ey*r))||1,h=u/d;a=Math.min(r,c(h/Ey))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(r,c(u/Ey))}i.fontSize=`calc(${a}px * var(--total-scale-factor))`,i.color=te.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class wM extends xl{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,r){const i=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=s),i.setValue(a.id,{[r]:s})}render(){var r,i;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const c=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;c&&o.length>c&&(o=o.slice(0,c));let u=a.formattedValue||((r=this.data.textContent)==null?void 0:r.join(`
`))||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const d={userValue:o,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=u??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",u??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),gl.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=Bf,this._setRequired(s,this.data.required),c&&(s.maxLength=c),s.addEventListener("input",f=>{e.setValue(t,{value:f.target.value}),this.setPropertyOnSiblings(s,"value",f.target.value,"value"),d.formattedValue=null}),s.addEventListener("resetform",f=>{const g=this.data.defaultFieldValue??"";s.value=d.userValue=g,d.formattedValue=null});let h=f=>{const{formattedValue:g}=d;g!=null&&(f.target.value=g),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",g=>{var m;if(d.focused)return;const{target:y}=g;d.userValue&&(y.value=d.userValue),d.lastCommittedValue=y.value,d.commitKey=1,(m=this.data.actions)!=null&&m.Focus||(d.focused=!0)}),s.addEventListener("updatefromsandbox",g=>{this.showElementAndHideCanvas(g.target);const y={value(m){d.userValue=m.detail.value??"",e.setValue(t,{value:d.userValue.toString()}),m.target.value=d.userValue},formattedValue(m){const{formattedValue:b}=m.detail;d.formattedValue=b,b!=null&&m.target!==document.activeElement&&(m.target.value=b),e.setValue(t,{formattedValue:b})},selRange(m){m.target.setSelectionRange(...m.detail.selRange)},charLimit:m=>{var S;const{charLimit:b}=m.detail,{target:w}=m;if(b===0){w.removeAttribute("maxLength");return}w.setAttribute("maxLength",b);let x=d.userValue;!x||x.length<=b||(x=x.slice(0,b),w.value=d.userValue=x,e.setValue(t,{value:x}),(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:x,willCommit:!0,commitKey:1,selStart:w.selectionStart,selEnd:w.selectionEnd}}))}};this._dispatchEventFromSandbox(y,g)}),s.addEventListener("keydown",g=>{var b;d.commitKey=1;let y=-1;if(g.key==="Escape"?y=0:g.key==="Enter"&&!this.data.multiLine?y=2:g.key==="Tab"&&(d.commitKey=3),y===-1)return;const{value:m}=g.target;d.lastCommittedValue!==m&&(d.lastCommittedValue=m,d.userValue=m,(b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:m,willCommit:!0,commitKey:y,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}))});const f=h;h=null,s.addEventListener("blur",g=>{var m,b;if(!d.focused||!g.relatedTarget)return;(m=this.data.actions)!=null&&m.Blur||(d.focused=!1);const{value:y}=g.target;d.userValue=y,d.lastCommittedValue!==y&&((b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:d.commitKey,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}})),f(g)}),(i=this.data.actions)!=null&&i.Keystroke&&s.addEventListener("beforeinput",g=>{var C;d.lastCommittedValue=null;const{data:y,target:m}=g,{value:b,selectionStart:w,selectionEnd:x}=m;let S=w,E=x;switch(g.inputType){case"deleteWordBackward":{const N=b.substring(0,w).match(/\w*[^\w]*$/);N&&(S-=N[0].length);break}case"deleteWordForward":{const N=b.substring(w).match(/^[^\w]*\w*/);N&&(E+=N[0].length);break}case"deleteContentBackward":w===x&&(S-=1);break;case"deleteContentForward":w===x&&(E+=1);break}g.preventDefault(),(C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,change:y||"",willCommit:!1,selStart:S,selEnd:E}})}),this._setEventListeners(s,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],g=>g.target.value)}if(h&&s.addEventListener("blur",h),this.data.comb){const g=(this.data.rect[2]-this.data.rect[0])/c;s.classList.add("comb"),s.style.letterSpacing=`calc(${g}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class xM extends xl{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class bM extends xl{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let r=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(s,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return gl.add(i),i.setAttribute("data-element-id",s),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("exportValue",t.exportValue),i.tabIndex=Bf,i.addEventListener("change",a=>{const{name:o,checked:c}=a.target;for(const u of this._getElementsByName(o,s)){const d=c&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=d),e.setValue(u.id,{value:d})}e.setValue(s,{value:c})}),i.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",a=>{const o={value(c){c.target.checked=c.detail.value!=="Off",e.setValue(s,{value:c.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class PE extends xl{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let r=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(s,{value:r})),r)for(const a of this._getElementsByName(t.fieldName,s))e.setValue(a.id,{value:!1});const i=document.createElement("input");if(gl.add(i),i.setAttribute("data-element-id",s),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.tabIndex=Bf,i.addEventListener("change",a=>{const{name:o,checked:c}=a.target;for(const u of this._getElementsByName(o,s))e.setValue(u.id,{value:!1});e.setValue(s,{value:c})}),i.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;i.addEventListener("updatefromsandbox",o=>{const c={value:u=>{const d=a===u.detail.value;for(const h of this._getElementsByName(u.target.name)){const f=d&&h.id===s;h.domElement&&(h.domElement.checked=f),e.setValue(h.id,{value:f})}}};this._dispatchEventFromSandbox(c,o)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class SM extends kE{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class AM extends xl{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");gl.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=Bf;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",d=>{const h=this.data.defaultFieldValue;for(const f of r.options)f.selected=f.value===h});for(const d of this.data.options){const h=document.createElement("option");h.textContent=d.displayValue,h.value=d.exportValue,s.value.includes(d.exportValue)&&(h.setAttribute("selected",!0),i=!1),r.append(h)}let a=null;if(i){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),r.prepend(d),a=()=>{d.remove(),r.removeEventListener("input",a),a=null},r.addEventListener("input",a)}const o=d=>{const h=d?"value":"textContent",{options:f,multiple:g}=r;return g?Array.prototype.filter.call(f,y=>y.selected).map(y=>y[h]):f.selectedIndex===-1?null:f[f.selectedIndex][h]};let c=o(!1);const u=d=>{const h=d.target.options;return Array.prototype.map.call(h,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",d=>{const h={value(f){a==null||a();const g=f.detail.value,y=new Set(Array.isArray(g)?g:[g]);for(const m of r.options)m.selected=y.has(m.value);e.setValue(t,{value:o(!0)}),c=o(!1)},multipleSelection(f){r.multiple=!0},remove(f){const g=r.options,y=f.detail.remove;g[y].selected=!1,r.remove(y),g.length>0&&Array.prototype.findIndex.call(g,b=>b.selected)===-1&&(g[0].selected=!0),e.setValue(t,{value:o(!0),items:u(f)}),c=o(!1)},clear(f){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),c=o(!1)},insert(f){const{index:g,displayValue:y,exportValue:m}=f.detail.insert,b=r.children[g],w=document.createElement("option");w.textContent=y,w.value=m,b?b.before(w):r.append(w),e.setValue(t,{value:o(!0),items:u(f)}),c=o(!1)},items(f){const{items:g}=f.detail;for(;r.length!==0;)r.remove(0);for(const y of g){const{displayValue:m,exportValue:b}=y,w=document.createElement("option");w.textContent=m,w.value=b,r.append(w)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:o(!0),items:u(f)}),c=o(!1)},indices(f){const g=new Set(f.detail.indices);for(const y of f.target.options)y.selected=g.has(y.index);e.setValue(t,{value:o(!0)}),c=o(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(h,d)}),r.addEventListener("input",d=>{var g;const h=o(!0),f=o(!1);e.setValue(t,{value:h}),d.preventDefault(),(g=this.linkService.eventBus)==null||g.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:c,change:f,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):r.addEventListener("input",function(d){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class h0 extends rt{constructor(e){const{data:t,elements:s}=e;super(e,{isRenderable:rt._hasPopupData(t)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new _M({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",t.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(s=>`${ex}${s}`).join(",")),this.container}}var Fc,em,tm,$c,zc,Ke,si,Bc,Wh,qh,Uc,ri,Ms,ii,Xh,ai,Yh,Oo,Fo,Re,Up,f0,RE,LE,ME,jE,Hp,Vp,p0;class _M{constructor({container:e,color:t,elements:s,titleObj:r,modificationDate:i,contentsObj:a,richText:o,parent:c,rect:u,parentRect:d,open:h}){A(this,Re);A(this,Fc,_(this,Re,ME).bind(this));A(this,em,_(this,Re,p0).bind(this));A(this,tm,_(this,Re,Vp).bind(this));A(this,$c,_(this,Re,Hp).bind(this));A(this,zc,null);A(this,Ke,null);A(this,si,null);A(this,Bc,null);A(this,Wh,null);A(this,qh,null);A(this,Uc,null);A(this,ri,!1);A(this,Ms,null);A(this,ii,null);A(this,Xh,null);A(this,ai,null);A(this,Yh,null);A(this,Oo,null);A(this,Fo,!1);var f;v(this,Ke,e),v(this,Yh,r),v(this,si,a),v(this,ai,o),v(this,qh,c),v(this,zc,t),v(this,Xh,u),v(this,Uc,d),v(this,Wh,s),v(this,Bc,Mm.toDateObject(i)),this.trigger=s.flatMap(g=>g.getElementsToTriggerPopup());for(const g of this.trigger)g.addEventListener("click",l(this,$c)),g.addEventListener("mouseenter",l(this,tm)),g.addEventListener("mouseleave",l(this,em)),g.classList.add("popupTriggerArea");for(const g of s)(f=g.container)==null||f.addEventListener("keydown",l(this,Fc));l(this,Ke).hidden=!0,h&&_(this,Re,Hp).call(this)}render(){if(l(this,Ms))return;const e=v(this,Ms,document.createElement("div"));if(e.className="popup",l(this,zc)){const i=e.style.outlineColor=te.makeHexColor(...l(this,zc));e.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`}const t=document.createElement("span");t.className="header";const s=document.createElement("h1");if(t.append(s),{dir:s.dir,str:s.textContent}=l(this,Yh),e.append(t),l(this,Bc)){const i=document.createElement("span");i.classList.add("popupDate"),i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:l(this,Bc).valueOf()})),t.append(i)}const r=l(this,Re,Up);if(r)ox.render({xfaHtml:r,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const i=this._formatContents(l(this,si));e.append(i)}l(this,Ke).append(e)}_formatContents({str:e,dir:t}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=t;const r=e.split(/(?:\r\n?|\n)/);for(let i=0,a=r.length;i<a;++i){const o=r[i];s.append(document.createTextNode(o)),i<a-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:e,popupContent:t}){var s;l(this,Oo)||v(this,Oo,{contentsObj:l(this,si),richText:l(this,ai)}),e&&v(this,ii,null),t&&(v(this,ai,_(this,Re,LE).call(this,t)),v(this,si,null)),(s=l(this,Ms))==null||s.remove(),v(this,Ms,null)}resetEdited(){var e;l(this,Oo)&&({contentsObj:tn(this,si)._,richText:tn(this,ai)._}=l(this,Oo),v(this,Oo,null),(e=l(this,Ms))==null||e.remove(),v(this,Ms,null),v(this,ii,null))}forceHide(){v(this,Fo,this.isVisible),l(this,Fo)&&(l(this,Ke).hidden=!0)}maybeShow(){l(this,Fo)&&(l(this,Ms)||_(this,Re,Vp).call(this),v(this,Fo,!1),l(this,Ke).hidden=!1)}get isVisible(){return l(this,Ke).hidden===!1}}Fc=new WeakMap,em=new WeakMap,tm=new WeakMap,$c=new WeakMap,zc=new WeakMap,Ke=new WeakMap,si=new WeakMap,Bc=new WeakMap,Wh=new WeakMap,qh=new WeakMap,Uc=new WeakMap,ri=new WeakMap,Ms=new WeakMap,ii=new WeakMap,Xh=new WeakMap,ai=new WeakMap,Yh=new WeakMap,Oo=new WeakMap,Fo=new WeakMap,Re=new WeakSet,Up=function(){const e=l(this,ai),t=l(this,si);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&l(this,ai).html||null},f0=function(){var e,t,s;return((s=(t=(e=l(this,Re,Up))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},RE=function(){var e,t,s;return((s=(t=(e=l(this,Re,Up))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},LE=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:l(this,Re,RE),fontSize:l(this,Re,f0)?`calc(${l(this,Re,f0)}px * var(--total-scale-factor))`:""}};for(const i of e.split(`
`))t.push({name:"span",value:i,attributes:r});return s},ME=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&l(this,ri))&&_(this,Re,Hp).call(this)},jE=function(){if(l(this,ii)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:r,pageY:i}}}=l(this,qh);let a=!!l(this,Uc),o=a?l(this,Uc):l(this,Xh);for(const y of l(this,Wh))if(!o||te.intersect(y.data.rect,o)!==null){o=y.data.rect,a=!0;break}const c=te.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),d=a?o[2]-o[0]+5:0,h=c[0]+d,f=c[1];v(this,ii,[100*(h-r)/t,100*(f-i)/s]);const{style:g}=l(this,Ke);g.left=`${l(this,ii)[0]}%`,g.top=`${l(this,ii)[1]}%`},Hp=function(){v(this,ri,!l(this,ri)),l(this,ri)?(_(this,Re,Vp).call(this),l(this,Ke).addEventListener("click",l(this,$c)),l(this,Ke).addEventListener("keydown",l(this,Fc))):(_(this,Re,p0).call(this),l(this,Ke).removeEventListener("click",l(this,$c)),l(this,Ke).removeEventListener("keydown",l(this,Fc)))},Vp=function(){l(this,Ms)||this.render(),this.isVisible?l(this,ri)&&l(this,Ke).classList.add("focused"):(_(this,Re,jE).call(this),l(this,Ke).hidden=!1,l(this,Ke).style.zIndex=parseInt(l(this,Ke).style.zIndex)+1e3)},p0=function(){l(this,Ke).classList.remove("focused"),!(l(this,ri)||!this.isVisible)&&(l(this,Ke).hidden=!0,l(this,Ke).style.zIndex=parseInt(l(this,Ke).style.zIndex)-1e3)};class DE extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=ie.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Kh;class EM extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,Kh,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:s,height:r}=this,i=this.svgFactory.create(s,r,!0),a=v(this,Kh,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,Kh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Kh=new WeakMap;var Qh;class CM extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,Qh,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:s,height:r}=this,i=this.svgFactory.create(s,r,!0),a=t.borderStyle.width,o=v(this,Qh,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",s-a),o.setAttribute("height",r-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,Qh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Qh=new WeakMap;var Jh;class kM extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,Jh,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:s,height:r}=this,i=this.svgFactory.create(s,r,!0),a=t.borderStyle.width,o=v(this,Jh,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",r/2),o.setAttribute("rx",s/2-a/2),o.setAttribute("ry",r/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,Jh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Jh=new WeakMap;var Zh;class IE extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,Zh,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:r,popupRef:i},width:a,height:o}=this;if(!s)return this.container;const c=this.svgFactory.create(a,o,!0);let u=[];for(let h=0,f=s.length;h<f;h+=2){const g=s[h]-t[0],y=t[3]-s[h+1];u.push(`${g},${y}`)}u=u.join(" ");const d=v(this,Zh,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",u),d.setAttribute("stroke-width",r.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),c.append(d),this.container.append(c),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,Zh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Zh=new WeakMap;class NM extends IE{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class TM extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var ef,$o,tf,g0;class lx extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,tf);A(this,ef,null);A(this,$o,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?ie.HIGHLIGHT:ie.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:r,borderStyle:i,popupRef:a}}=this,{transform:o,width:c,height:u}=_(this,tf,g0).call(this,s,t),d=this.svgFactory.create(c,u,!0),h=v(this,ef,this.svgFactory.createElement("svg:g"));d.append(h),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",o);for(let f=0,g=r.length;f<g;f++){const y=this.svgFactory.createElement(this.svgElementName);l(this,$o).push(y),y.setAttribute("points",r[f].join(",")),h.append(y)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:r,rect:i}=t,a=l(this,ef);if(s>=0&&a.setAttribute("stroke-width",s||1),r)for(let o=0,c=l(this,$o).length;o<c;o++)l(this,$o)[o].setAttribute("points",r[o].join(","));if(i){const{transform:o,width:c,height:u}=_(this,tf,g0).call(this,this.data.rotation,i);a.parentElement.setAttribute("viewBox",`0 0 ${c} ${u}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return l(this,$o)}addHighlightArea(){this.container.classList.add("highlightArea")}}ef=new WeakMap,$o=new WeakMap,tf=new WeakSet,g0=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class OE extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=ie.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class PM extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class RM extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class LM extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class FE extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=ie.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var nf,sf,m0;class MM extends rt{constructor(t){var r;super(t,{isRenderable:!0});A(this,sf);A(this,nf,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(r=this.linkService.eventBus)==null||r.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let r;s.hasAppearance||s.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),r.addEventListener("dblclick",_(this,sf,m0).bind(this)),v(this,nf,r);const{isMac:i}=Nt.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(i?a.metaKey:a.ctrlKey)&&_(this,sf,m0).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():r.classList.add("popupTriggerArea"),t.append(r),t}getElementsToTriggerPopup(){return l(this,nf)}addHighlightArea(){this.container.classList.add("highlightArea")}}nf=new WeakMap,sf=new WeakSet,m0=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var rf,zo,oa,af,$a,y0,v0,Hc;let cx=(Hc=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:r,page:i,viewport:a,structTreeLayer:o}){A(this,$a);A(this,rf,null);A(this,zo,null);A(this,oa,new Map);A(this,af,null);this.div=e,v(this,rf,t),v(this,zo,s),v(this,af,o||null),this.page=i,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=r}hasEditableAnnotations(){return l(this,oa).size>0}async render(e){var a;const{annotations:t}=e,s=this.div;Da(s,this.viewport);const r=new Map,i={data:null,layer:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Qd,annotationStorage:e.annotationStorage||new nx,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const c=o.annotationType===Ze.POPUP;if(c){const h=r.get(o.id);if(!h)continue;i.elements=h}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;i.data=o;const u=p1.create(i);if(!u.isRenderable)continue;if(!c&&o.popupRef){const h=r.get(o.popupRef);h?h.push(u):r.set(o.popupRef,[u])}const d=u.render();o.hidden&&(d.style.visibility="hidden"),await _(this,$a,y0).call(this,d,o.id),u._isEditable&&(l(this,oa).set(u.data.id,u),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(u))}_(this,$a,v0).call(this)}async addLinkAnnotations(e,t){const s={data:null,layer:this.div,linkService:t,svgFactory:new Qd,parent:this};for(const r of e){r.borderStyle||(r.borderStyle=Hc._defaultBorderStyle),s.data=r;const i=p1.create(s);if(!i.isRenderable)continue;const a=i.render();await _(this,$a,y0).call(this,a,r.id)}}update({viewport:e}){const t=this.div;this.viewport=e,Da(t,{rotation:e.rotation}),_(this,$a,v0).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(l(this,oa).values())}getEditableAnnotation(e){return l(this,oa).get(e)}static get _defaultBorderStyle(){return pe(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:El.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}},rf=new WeakMap,zo=new WeakMap,oa=new WeakMap,af=new WeakMap,$a=new WeakSet,y0=async function(e,t){var a,o;const s=e.firstChild||e,r=s.id=`${ex}${t}`,i=await((a=l(this,af))==null?void 0:a.getAriaAttributes(r));if(i)for(const[c,u]of i)s.setAttribute(c,u);this.div.append(e),(o=l(this,rf))==null||o.moveElementInDOM(this.div,e,s,!1)},v0=function(){var t;if(!l(this,zo))return;const e=this.div;for(const[s,r]of l(this,zo)){const i=e.querySelector(`[data-annotation-id="${s}"]`);if(!i)continue;r.className="annotationContent";const{firstChild:a}=i;a?a.nodeName==="CANVAS"?a.replaceWith(r):a.classList.contains("annotationContent")?a.after(r):a.before(r):i.append(r);const o=l(this,oa).get(s);o&&(o._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(s,i.id,r),o._hasNoCanvas=!1):o.canvas=r)}l(this,zo).clear()},Hc);const pp=/\r\n?|\n/g;var js,Fn,of,Bo,$n,ct,$E,zE,BE,Gp,wi,Wp,qp,UE,x0,HE;const je=class je extends Ie{constructor(t){super({...t,name:"freeTextEditor"});A(this,ct);A(this,js);A(this,Fn,"");A(this,of,`${this.id}-editor`);A(this,Bo,null);A(this,$n);v(this,js,t.color||je._defaultColor||Ie._defaultLineColor),v(this,$n,t.fontSize||je._defaultFontSize)}static get _keyboardManager(){const t=je.prototype,s=a=>a.isEmpty(),r=Ia.TRANSLATE_SMALL,i=Ia.TRANSLATE_BIG;return pe(this,"_keyboardManager",new $f([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[r,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,r],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}]]))}static initialize(t,s){Ie.initialize(t,s);const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case ye.FREETEXT_SIZE:je._defaultFontSize=s;break;case ye.FREETEXT_COLOR:je._defaultColor=s;break}}updateParams(t,s){switch(t){case ye.FREETEXT_SIZE:_(this,ct,$E).call(this,s);break;case ye.FREETEXT_COLOR:_(this,ct,zE).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[ye.FREETEXT_SIZE,je._defaultFontSize],[ye.FREETEXT_COLOR,je._defaultColor||Ie._defaultLineColor]]}get propertiesToUpdate(){return[[ye.FREETEXT_SIZE,l(this,$n)],[ye.FREETEXT_COLOR,l(this,js)]]}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-je._internalPadding*t,-(je._internalPadding+l(this,$n))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),v(this,Bo,new AbortController);const t=this._uiManager.combinedSignal(l(this,Bo));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",l(this,of)),this._isDraggable=!0,(t=l(this,Bo))==null||t.abort(),v(this,Bo,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=l(this,Fn),s=v(this,Fn,_(this,ct,BE).call(this).trimEnd());if(t===s)return;const r=i=>{if(v(this,Fn,i),!i){this.remove();return}_(this,ct,qp).call(this),this._uiManager.rebuild(this),_(this,ct,Gp).call(this)};this.addCommands({cmd:()=>{r(s)},undo:()=>{r(t)},mustExec:!1}),_(this,ct,Gp).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){je._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,s;(this._isCopy||this.annotationElementId)&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",l(this,of)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${l(this,$n)}px * var(--total-scale-factor))`,r.color=l(this,js),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[i,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[c,u]=this.getInitialTranslation();[c,u]=this.pageTranslationToScreen(c,u);const[d,h]=this.pageDimensions,[f,g]=this.pageTranslation;let y,m;switch(this.rotation){case 0:y=t+(o[0]-f)/d,m=s+this.height-(o[1]-g)/h;break;case 90:y=t+(o[0]-f)/d,m=s-(o[1]-g)/h,[c,u]=[u,-c];break;case 180:y=t-this.width+(o[0]-f)/d,m=s-(o[1]-g)/h,[c,u]=[-c,-u];break;case 270:y=t+(o[0]-f-this.height*h)/d,m=s+(o[1]-g-this.width*d)/h,[c,u]=[-u,c];break}this.setAt(y*i,m*a,c,u)}else this._moveAfterPaste(t,s);_(this,ct,qp).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,m,b;const s=t.clipboardData||window.clipboardData,{types:r}=s;if(r.length===1&&r[0]==="text/plain")return;t.preventDefault();const i=_(y=je,wi,x0).call(y,s.getData("text")||"").replaceAll(pp,`
`);if(!i)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!i.includes(`
`)){o.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:c,startOffset:u}=o,d=[],h=[];if(c.nodeType===Node.TEXT_NODE){const w=c.parentElement;if(h.push(c.nodeValue.slice(u).replaceAll(pp,"")),w!==this.editorDiv){let x=d;for(const S of this.editorDiv.childNodes){if(S===w){x=h;continue}x.push(_(m=je,wi,Wp).call(m,S))}}d.push(c.nodeValue.slice(0,u).replaceAll(pp,""))}else if(c===this.editorDiv){let w=d,x=0;for(const S of this.editorDiv.childNodes)x++===u&&(w=h),w.push(_(b=je,wi,Wp).call(b,S))}v(this,Fn,`${d.join(`
`)}${i}${h.join(`
`)}`),_(this,ct,qp).call(this);const f=new Range;let g=Math.sumPrecise(d.map(w=>w.length));for(const{firstChild:w}of this.editorDiv.childNodes)if(w.nodeType===Node.TEXT_NODE){const x=w.nodeValue.length;if(g<=x){f.setStart(w,g),f.setEnd(w,g);break}g-=x}a.removeAllRanges(),a.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(t,s,r){var o;let i=null;if(t instanceof DE){const{data:{defaultAppearanceData:{fontSize:c,fontColor:u},rect:d,rotation:h,id:f,popupRef:g},textContent:y,textPosition:m,parent:{page:{pageNumber:b}}}=t;if(!y||y.length===0)return null;i=t={annotationType:ie.FREETEXT,color:Array.from(u),fontSize:c,value:y.join(`
`),position:m,pageIndex:b-1,rect:d.slice(0),rotation:h,id:f,deleted:!1,popupRef:g}}const a=await super.deserialize(t,s,r);return v(a,$n,t.fontSize),v(a,js,te.makeHexColor(...t.color)),v(a,Fn,_(o=je,wi,x0).call(o,t.value)),a.annotationElementId=t.id||null,a._initialData=i,a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=je._internalPadding*this.parentScale,r=this.getRect(s,s),i=Ie._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:l(this,js)),a={annotationType:ie.FREETEXT,color:i,fontSize:l(this,$n),value:_(this,ct,UE).call(this),pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(a.isCopy=!0,a):this.annotationElementId&&!_(this,ct,HE).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(this.deleted)return s;const{style:r}=s;r.fontSize=`calc(${l(this,$n)}px * var(--total-scale-factor))`,r.color=l(this,js),s.replaceChildren();for(const a of l(this,Fn).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),s.append(o)}const i=je._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(i,i),popupContent:l(this,Fn)}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};js=new WeakMap,Fn=new WeakMap,of=new WeakMap,Bo=new WeakMap,$n=new WeakMap,ct=new WeakSet,$E=function(t){const s=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--total-scale-factor))`,this.translate(0,-(i-l(this,$n))*this.parentScale),v(this,$n,i),_(this,ct,Gp).call(this)},r=l(this,$n);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ye.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},zE=function(t){const s=i=>{v(this,js,this.editorDiv.style.color=i)},r=l(this,js);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ye.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},BE=function(){var r;const t=[];this.editorDiv.normalize();let s=null;for(const i of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(_(r=je,wi,Wp).call(r,i)),s=i);return t.join(`
`)},Gp=function(){const[t,s]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:i,div:a}=this,o=a.style.display,c=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",i.div.append(this.div),r=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=r.width/t,this.height=r.height/s):(this.width=r.height/t,this.height=r.width/s),this.fixAndSetPosition()},wi=new WeakSet,Wp=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(pp,"")},qp=function(){if(this.editorDiv.replaceChildren(),!!l(this,Fn))for(const t of l(this,Fn).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},UE=function(){return l(this,Fn).replaceAll(" "," ")},x0=function(t){return t.replaceAll(" "," ")},HE=function(t){const{value:s,fontSize:r,color:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||t.value!==s||t.fontSize!==r||t.color.some((o,c)=>o!==i[c])||t.pageIndex!==a},A(je,wi),$(je,"_freeTextDefaultContent",""),$(je,"_internalPadding",0),$(je,"_defaultColor",null),$(je,"_defaultFontSize",10),$(je,"_type","freetext"),$(je,"_editorType",ie.FREETEXT);let w0=je;class q{toSVGPath(){Pe("Abstract method `toSVGPath` must be implemented.")}get box(){Pe("Abstract getter `box` must be implemented.")}serialize(e,t){Pe("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,r,i,a){a||(a=new Float32Array(e.length));for(let o=0,c=e.length;o<c;o+=2)a[o]=t+e[o]*r,a[o+1]=s+e[o+1]*i;return a}static _rescaleAndSwap(e,t,s,r,i,a){a||(a=new Float32Array(e.length));for(let o=0,c=e.length;o<c;o+=2)a[o]=t+e[o+1]*r,a[o+1]=s+e[o]*i;return a}static _translate(e,t,s,r){r||(r=new Float32Array(e.length));for(let i=0,a=e.length;i<a;i+=2)r[i]=t+e[i],r[i+1]=s+e[i+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,r,i){switch(i){case 90:return[1-t/s,e/r];case 180:return[1-e/s,1-t/r];case 270:return[t/s,1-e/r];default:return[e/s,t/r]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,r,i,a){return[(e+5*s)/6,(t+5*r)/6,(5*s+i)/6,(5*r+a)/6,(s+i)/2,(r+a)/2]}}$(q,"PRECISION",1e-4);var zn,Ds,Vc,Gc,mr,de,Uo,Ho,lf,cf,Wc,qc,la,uf,nm,sm,yt,od,VE,GE,WE,qE,XE,YE;const Fr=class Fr{constructor({x:e,y:t},s,r,i,a,o=0){A(this,yt);A(this,zn);A(this,Ds,[]);A(this,Vc);A(this,Gc);A(this,mr,[]);A(this,de,new Float32Array(18));A(this,Uo);A(this,Ho);A(this,lf);A(this,cf);A(this,Wc);A(this,qc);A(this,la,[]);v(this,zn,s),v(this,qc,i*r),v(this,Gc,a),l(this,de).set([NaN,NaN,NaN,NaN,e,t],6),v(this,Vc,o),v(this,cf,l(Fr,uf)*r),v(this,lf,l(Fr,sm)*r),v(this,Wc,r),l(this,la).push(e,t)}isEmpty(){return isNaN(l(this,de)[8])}add({x:e,y:t}){var P;v(this,Uo,e),v(this,Ho,t);const[s,r,i,a]=l(this,zn);let[o,c,u,d]=l(this,de).subarray(8,12);const h=e-u,f=t-d,g=Math.hypot(h,f);if(g<l(this,lf))return!1;const y=g-l(this,cf),m=y/g,b=m*h,w=m*f;let x=o,S=c;o=u,c=d,u+=b,d+=w,(P=l(this,la))==null||P.push(e,t);const E=-w/y,C=b/y,N=E*l(this,qc),k=C*l(this,qc);return l(this,de).set(l(this,de).subarray(2,8),0),l(this,de).set([u+N,d+k],4),l(this,de).set(l(this,de).subarray(14,18),12),l(this,de).set([u-N,d-k],16),isNaN(l(this,de)[6])?(l(this,mr).length===0&&(l(this,de).set([o+N,c+k],2),l(this,mr).push(NaN,NaN,NaN,NaN,(o+N-s)/i,(c+k-r)/a),l(this,de).set([o-N,c-k],14),l(this,Ds).push(NaN,NaN,NaN,NaN,(o-N-s)/i,(c-k-r)/a)),l(this,de).set([x,S,o,c,u,d],6),!this.isEmpty()):(l(this,de).set([x,S,o,c,u,d],6),Math.abs(Math.atan2(S-c,x-o)-Math.atan2(w,b))<Math.PI/2?([o,c,u,d]=l(this,de).subarray(2,6),l(this,mr).push(NaN,NaN,NaN,NaN,((o+u)/2-s)/i,((c+d)/2-r)/a),[o,c,x,S]=l(this,de).subarray(14,18),l(this,Ds).push(NaN,NaN,NaN,NaN,((x+o)/2-s)/i,((S+c)/2-r)/a),!0):([x,S,o,c,u,d]=l(this,de).subarray(0,6),l(this,mr).push(((x+5*o)/6-s)/i,((S+5*c)/6-r)/a,((5*o+u)/6-s)/i,((5*c+d)/6-r)/a,((o+u)/2-s)/i,((c+d)/2-r)/a),[u,d,o,c,x,S]=l(this,de).subarray(12,18),l(this,Ds).push(((x+5*o)/6-s)/i,((S+5*c)/6-r)/a,((5*o+u)/6-s)/i,((5*c+d)/6-r)/a,((o+u)/2-s)/i,((c+d)/2-r)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=l(this,mr),t=l(this,Ds);if(isNaN(l(this,de)[6])&&!this.isEmpty())return _(this,yt,VE).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?s.push(`L${e[r+4]} ${e[r+5]}`):s.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);_(this,yt,WE).call(this,s);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?s.push(`L${t[r+4]} ${t[r+5]}`):s.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return _(this,yt,GE).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,r,i,a){return new KE(e,t,s,r,i,a)}getOutlines(){var h;const e=l(this,mr),t=l(this,Ds),s=l(this,de),[r,i,a,o]=l(this,zn),c=new Float32Array((((h=l(this,la))==null?void 0:h.length)??0)+2);for(let f=0,g=c.length-2;f<g;f+=2)c[f]=(l(this,la)[f]-r)/a,c[f+1]=(l(this,la)[f+1]-i)/o;if(c[c.length-2]=(l(this,Uo)-r)/a,c[c.length-1]=(l(this,Ho)-i)/o,isNaN(s[6])&&!this.isEmpty())return _(this,yt,qE).call(this,c);const u=new Float32Array(l(this,mr).length+24+l(this,Ds).length);let d=e.length;for(let f=0;f<d;f+=2){if(isNaN(e[f])){u[f]=u[f+1]=NaN;continue}u[f]=e[f],u[f+1]=e[f+1]}d=_(this,yt,YE).call(this,u,d);for(let f=t.length-6;f>=6;f-=6)for(let g=0;g<6;g+=2){if(isNaN(t[f+g])){u[d]=u[d+1]=NaN,d+=2;continue}u[d]=t[f+g],u[d+1]=t[f+g+1],d+=2}return _(this,yt,XE).call(this,u,d),this.newFreeDrawOutline(u,c,l(this,zn),l(this,Wc),l(this,Vc),l(this,Gc))}};zn=new WeakMap,Ds=new WeakMap,Vc=new WeakMap,Gc=new WeakMap,mr=new WeakMap,de=new WeakMap,Uo=new WeakMap,Ho=new WeakMap,lf=new WeakMap,cf=new WeakMap,Wc=new WeakMap,qc=new WeakMap,la=new WeakMap,uf=new WeakMap,nm=new WeakMap,sm=new WeakMap,yt=new WeakSet,od=function(){const e=l(this,de).subarray(4,6),t=l(this,de).subarray(16,18),[s,r,i,a]=l(this,zn);return[(l(this,Uo)+(e[0]-t[0])/2-s)/i,(l(this,Ho)+(e[1]-t[1])/2-r)/a,(l(this,Uo)+(t[0]-e[0])/2-s)/i,(l(this,Ho)+(t[1]-e[1])/2-r)/a]},VE=function(){const[e,t,s,r]=l(this,zn),[i,a,o,c]=_(this,yt,od).call(this);return`M${(l(this,de)[2]-e)/s} ${(l(this,de)[3]-t)/r} L${(l(this,de)[4]-e)/s} ${(l(this,de)[5]-t)/r} L${i} ${a} L${o} ${c} L${(l(this,de)[16]-e)/s} ${(l(this,de)[17]-t)/r} L${(l(this,de)[14]-e)/s} ${(l(this,de)[15]-t)/r} Z`},GE=function(e){const t=l(this,Ds);e.push(`L${t[4]} ${t[5]} Z`)},WE=function(e){const[t,s,r,i]=l(this,zn),a=l(this,de).subarray(4,6),o=l(this,de).subarray(16,18),[c,u,d,h]=_(this,yt,od).call(this);e.push(`L${(a[0]-t)/r} ${(a[1]-s)/i} L${c} ${u} L${d} ${h} L${(o[0]-t)/r} ${(o[1]-s)/i}`)},qE=function(e){const t=l(this,de),[s,r,i,a]=l(this,zn),[o,c,u,d]=_(this,yt,od).call(this),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-s)/i,(t[3]-r)/a,NaN,NaN,NaN,NaN,(t[4]-s)/i,(t[5]-r)/a,NaN,NaN,NaN,NaN,o,c,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,(t[16]-s)/i,(t[17]-r)/a,NaN,NaN,NaN,NaN,(t[14]-s)/i,(t[15]-r)/a],0),this.newFreeDrawOutline(h,e,l(this,zn),l(this,Wc),l(this,Vc),l(this,Gc))},XE=function(e,t){const s=l(this,Ds);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},YE=function(e,t){const s=l(this,de).subarray(4,6),r=l(this,de).subarray(16,18),[i,a,o,c]=l(this,zn),[u,d,h,f]=_(this,yt,od).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-i)/o,(s[1]-a)/c,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,h,f,NaN,NaN,NaN,NaN,(r[0]-i)/o,(r[1]-a)/c],t),t+=24},A(Fr,uf,8),A(Fr,nm,2),A(Fr,sm,l(Fr,uf)+l(Fr,nm));let Og=Fr;var Xc,Vo,oi,df,Bn,hf,tt,rm,QE;class KE extends q{constructor(t,s,r,i,a,o){super();A(this,rm);A(this,Xc);A(this,Vo,new Float32Array(4));A(this,oi);A(this,df);A(this,Bn);A(this,hf);A(this,tt);v(this,tt,t),v(this,Bn,s),v(this,Xc,r),v(this,hf,i),v(this,oi,a),v(this,df,o),this.lastPoint=[NaN,NaN],_(this,rm,QE).call(this,o);const[c,u,d,h]=l(this,Vo);for(let f=0,g=t.length;f<g;f+=2)t[f]=(t[f]-c)/d,t[f+1]=(t[f+1]-u)/h;for(let f=0,g=s.length;f<g;f+=2)s[f]=(s[f]-c)/d,s[f+1]=(s[f+1]-u)/h}toSVGPath(){const t=[`M${l(this,tt)[4]} ${l(this,tt)[5]}`];for(let s=6,r=l(this,tt).length;s<r;s+=6){if(isNaN(l(this,tt)[s])){t.push(`L${l(this,tt)[s+4]} ${l(this,tt)[s+5]}`);continue}t.push(`C${l(this,tt)[s]} ${l(this,tt)[s+1]} ${l(this,tt)[s+2]} ${l(this,tt)[s+3]} ${l(this,tt)[s+4]} ${l(this,tt)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,r,i],a){const o=r-t,c=i-s;let u,d;switch(a){case 0:u=q._rescale(l(this,tt),t,i,o,-c),d=q._rescale(l(this,Bn),t,i,o,-c);break;case 90:u=q._rescaleAndSwap(l(this,tt),t,s,o,c),d=q._rescaleAndSwap(l(this,Bn),t,s,o,c);break;case 180:u=q._rescale(l(this,tt),r,s,-o,c),d=q._rescale(l(this,Bn),r,s,-o,c);break;case 270:u=q._rescaleAndSwap(l(this,tt),r,i,-o,-c),d=q._rescaleAndSwap(l(this,Bn),r,i,-o,-c);break}return{outline:Array.from(u),points:[Array.from(d)]}}get box(){return l(this,Vo)}newOutliner(t,s,r,i,a,o=0){return new Og(t,s,r,i,a,o)}getNewOutline(t,s){const[r,i,a,o]=l(this,Vo),[c,u,d,h]=l(this,Xc),f=a*d,g=o*h,y=r*d+c,m=i*h+u,b=this.newOutliner({x:l(this,Bn)[0]*f+y,y:l(this,Bn)[1]*g+m},l(this,Xc),l(this,hf),t,l(this,df),s??l(this,oi));for(let w=2;w<l(this,Bn).length;w+=2)b.add({x:l(this,Bn)[w]*f+y,y:l(this,Bn)[w+1]*g+m});return b.getOutlines()}}Xc=new WeakMap,Vo=new WeakMap,oi=new WeakMap,df=new WeakMap,Bn=new WeakMap,hf=new WeakMap,tt=new WeakMap,rm=new WeakSet,QE=function(t){const s=l(this,tt);let r=s[4],i=s[5];const a=[r,i,r,i];let o=r,c=i;const u=t?Math.max:Math.min;for(let h=6,f=s.length;h<f;h+=6){const g=s[h+4],y=s[h+5];if(isNaN(s[h]))te.pointBoundingBox(g,y,a),c<y?(o=g,c=y):c===y&&(o=u(o,g));else{const m=[1/0,1/0,-1/0,-1/0];te.bezierBoundingBox(r,i,...s.slice(h,h+6),m),te.rectBoundingBox(...m,a),c<m[3]?(o=m[2],c=m[3]):c===m[3]&&(o=u(o,m[2]))}r=g,i=y}const d=l(this,Vo);d[0]=a[0]-l(this,oi),d[1]=a[1]-l(this,oi),d[2]=a[2]-a[0]+2*l(this,oi),d[3]=a[3]-a[1]+2*l(this,oi),this.lastPoint=[o,c]};var ff,pf,ca,Is,hn,JE,Xp,ZE,eC,S0;class b0{constructor(e,t=0,s=0,r=!0){A(this,hn);A(this,ff);A(this,pf);A(this,ca,[]);A(this,Is,[]);const i=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:g,y,width:m,height:b}of e){const w=Math.floor((g-t)/a)*a,x=Math.ceil((g+m+t)/a)*a,S=Math.floor((y-t)/a)*a,E=Math.ceil((y+b+t)/a)*a,C=[w,S,E,!0],N=[x,S,E,!1];l(this,ca).push(C,N),te.rectBoundingBox(w,S,x,E,i)}const o=i[2]-i[0]+2*s,c=i[3]-i[1]+2*s,u=i[0]-s,d=i[1]-s,h=l(this,ca).at(r?-1:-2),f=[h[0],h[2]];for(const g of l(this,ca)){const[y,m,b]=g;g[0]=(y-u)/o,g[1]=(m-d)/c,g[2]=(b-d)/c}v(this,ff,new Float32Array([u,d,o,c])),v(this,pf,f)}getOutlines(){l(this,ca).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of l(this,ca))t[3]?(e.push(..._(this,hn,S0).call(this,t)),_(this,hn,ZE).call(this,t)):(_(this,hn,eC).call(this,t),e.push(..._(this,hn,S0).call(this,t)));return _(this,hn,JE).call(this,e)}}ff=new WeakMap,pf=new WeakMap,ca=new WeakMap,Is=new WeakMap,hn=new WeakSet,JE=function(e){const t=[],s=new Set;for(const a of e){const[o,c,u]=a;t.push([o,c,a],[o,u,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const c=t[a][2],u=t[a+1][2];c.push(u),u.push(c),s.add(c),s.add(u)}const r=[];let i;for(;s.size>0;){const a=s.values().next().value;let[o,c,u,d,h]=a;s.delete(a);let f=o,g=c;for(i=[o,u],r.push(i);;){let y;if(s.has(d))y=d;else if(s.has(h))y=h;else break;s.delete(y),[o,c,u,d,h]=y,f!==o&&(i.push(f,g,o,g===c?c:u),f=o),g=g===c?u:c}i.push(f,g)}return new jM(r,l(this,ff),l(this,pf))},Xp=function(e){const t=l(this,Is);let s=0,r=t.length-1;for(;s<=r;){const i=s+r>>1,a=t[i][0];if(a===e)return i;a<e?s=i+1:r=i-1}return r+1},ZE=function([,e,t]){const s=_(this,hn,Xp).call(this,e);l(this,Is).splice(s,0,[e,t])},eC=function([,e,t]){const s=_(this,hn,Xp).call(this,e);for(let r=s;r<l(this,Is).length;r++){const[i,a]=l(this,Is)[r];if(i!==e)break;if(i===e&&a===t){l(this,Is).splice(r,1);return}}for(let r=s-1;r>=0;r--){const[i,a]=l(this,Is)[r];if(i!==e)break;if(i===e&&a===t){l(this,Is).splice(r,1);return}}},S0=function(e){const[t,s,r]=e,i=[[t,s,r]],a=_(this,hn,Xp).call(this,r);for(let o=0;o<a;o++){const[c,u]=l(this,Is)[o];for(let d=0,h=i.length;d<h;d++){const[,f,g]=i[d];if(!(u<=f||g<=c)){if(f>=c){if(g>u)i[d][1]=u;else{if(h===1)return[];i.splice(d,1),d--,h--}continue}i[d][2]=c,g>u&&i.push([t,u,g])}}}return i};var gf,Yc;class jM extends q{constructor(t,s,r){super();A(this,gf);A(this,Yc);v(this,Yc,t),v(this,gf,s),this.lastPoint=r}toSVGPath(){const t=[];for(const s of l(this,Yc)){let[r,i]=s;t.push(`M${r} ${i}`);for(let a=2;a<s.length;a+=2){const o=s[a],c=s[a+1];o===r?(t.push(`V${c}`),i=c):c===i&&(t.push(`H${o}`),r=o)}t.push("Z")}return t.join(" ")}serialize([t,s,r,i],a){const o=[],c=r-t,u=i-s;for(const d of l(this,Yc)){const h=new Array(d.length);for(let f=0;f<d.length;f+=2)h[f]=t+d[f]*c,h[f+1]=i-d[f+1]*u;o.push(h)}return o}get box(){return l(this,gf)}get classNamesForOutlining(){return["highlightOutline"]}}gf=new WeakMap,Yc=new WeakMap;class A0 extends Og{newFreeDrawOutline(e,t,s,r,i,a){return new DM(e,t,s,r,i,a)}}class DM extends KE{newOutliner(e,t,s,r,i,a=0){return new A0(e,t,s,r,i,a)}}var Os,Go,Kc,ht,mf,Qc,yf,vf,ua,Fs,Jc,wf,Te,_0,E0,C0,Xa,tC,Mi;const yn=class yn{constructor({editor:e=null,uiManager:t=null}){A(this,Te);A(this,Os,null);A(this,Go,null);A(this,Kc);A(this,ht,null);A(this,mf,!1);A(this,Qc,!1);A(this,yf,null);A(this,vf);A(this,ua,null);A(this,Fs,null);A(this,Jc);var s;e?(v(this,Qc,!1),v(this,Jc,ye.HIGHLIGHT_COLOR),v(this,yf,e)):(v(this,Qc,!0),v(this,Jc,ye.HIGHLIGHT_DEFAULT_COLOR)),v(this,Fs,(e==null?void 0:e._uiManager)||t),v(this,vf,l(this,Fs)._eventBus),v(this,Kc,(e==null?void 0:e.color)||((s=l(this,Fs))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),l(yn,wf)||v(yn,wf,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return pe(this,"_keyboardManager",new $f([[["Escape","mac+Escape"],yn.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],yn.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],yn.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],yn.prototype._moveToPrevious],[["Home","mac+Home"],yn.prototype._moveToBeginning],[["End","mac+End"],yn.prototype._moveToEnd]]))}renderButton(){const e=v(this,Os,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=l(this,Fs)._signal;e.addEventListener("click",_(this,Te,Xa).bind(this),{signal:t}),e.addEventListener("keydown",_(this,Te,C0).bind(this),{signal:t});const s=v(this,Go,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=l(this,Kc),e.append(s),e}renderMainDropdown(){const e=v(this,ht,_(this,Te,_0).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===l(this,Os)){_(this,Te,Xa).call(this,e);return}const t=e.target.getAttribute("data-color");t&&_(this,Te,E0).call(this,t,e)}_moveToNext(e){var t,s;if(!l(this,Te,Mi)){_(this,Te,Xa).call(this,e);return}if(e.target===l(this,Os)){(t=l(this,ht).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=l(this,ht))==null?void 0:t.firstChild)||e.target===l(this,Os)){l(this,Te,Mi)&&this._hideDropdownFromKeyboard();return}l(this,Te,Mi)||_(this,Te,Xa).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!l(this,Te,Mi)){_(this,Te,Xa).call(this,e);return}(t=l(this,ht).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!l(this,Te,Mi)){_(this,Te,Xa).call(this,e);return}(t=l(this,ht).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=l(this,ht))==null||e.classList.add("hidden"),(t=l(this,ua))==null||t.abort(),v(this,ua,null)}_hideDropdownFromKeyboard(){var e;if(!l(this,Qc)){if(!l(this,Te,Mi)){(e=l(this,yf))==null||e.unselect();return}this.hideDropdown(),l(this,Os).focus({preventScroll:!0,focusVisible:l(this,mf)})}}updateColor(e){if(l(this,Go)&&(l(this,Go).style.backgroundColor=e),!l(this,ht))return;const t=l(this,Fs).highlightColors.values();for(const s of l(this,ht).children)s.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=l(this,Os))==null||e.remove(),v(this,Os,null),v(this,Go,null),(t=l(this,ht))==null||t.remove(),v(this,ht,null)}};Os=new WeakMap,Go=new WeakMap,Kc=new WeakMap,ht=new WeakMap,mf=new WeakMap,Qc=new WeakMap,yf=new WeakMap,vf=new WeakMap,ua=new WeakMap,Fs=new WeakMap,Jc=new WeakMap,wf=new WeakMap,Te=new WeakSet,_0=function(){const e=document.createElement("div"),t=l(this,Fs)._signal;e.addEventListener("contextmenu",As,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,r]of l(this,Fs).highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",r),i.title=s,i.setAttribute("data-l10n-id",l(yn,wf)[s]);const a=document.createElement("span");i.append(a),a.className="swatch",a.style.backgroundColor=r,i.setAttribute("aria-selected",r===l(this,Kc)),i.addEventListener("click",_(this,Te,E0).bind(this,r),{signal:t}),e.append(i)}return e.addEventListener("keydown",_(this,Te,C0).bind(this),{signal:t}),e},E0=function(e,t){t.stopPropagation(),l(this,vf).dispatch("switchannotationeditorparams",{source:this,type:l(this,Jc),value:e})},C0=function(e){yn._keyboardManager.exec(this,e)},Xa=function(e){if(l(this,Te,Mi)){this.hideDropdown();return}if(v(this,mf,e.detail===0),l(this,ua)||(v(this,ua,new AbortController),window.addEventListener("pointerdown",_(this,Te,tC).bind(this),{signal:l(this,Fs).combinedSignal(l(this,ua))})),l(this,ht)){l(this,ht).classList.remove("hidden");return}const t=v(this,ht,_(this,Te,_0).call(this));l(this,Os).append(t)},tC=function(e){var t;(t=l(this,ht))!=null&&t.contains(e.target)||this.hideDropdown()},Mi=function(){return l(this,ht)&&!l(this,ht).classList.contains("hidden")},A(yn,wf,null);let Jd=yn;var Zc,xf,li,Wo,eu,xn,bf,Sf,qo,cs,Un,jt,tu,ci,Yt,nu,us,Af,le,k0,Yp,nC,sC,rC,N0,Ya,ys,Pl,iC,Kp,ld,aC,oC,lC,cC,uC;const Ae=class Ae extends Ie{constructor(t){super({...t,name:"highlightEditor"});A(this,le);A(this,Zc,null);A(this,xf,0);A(this,li);A(this,Wo,null);A(this,eu,null);A(this,xn,null);A(this,bf,null);A(this,Sf,0);A(this,qo,null);A(this,cs,null);A(this,Un,null);A(this,jt,!1);A(this,tu,null);A(this,ci);A(this,Yt,null);A(this,nu,"");A(this,us);A(this,Af,"");this.color=t.color||Ae._defaultColor,v(this,us,t.thickness||Ae._defaultThickness),v(this,ci,t.opacity||Ae._defaultOpacity),v(this,li,t.boxes||null),v(this,Af,t.methodOfCreation||""),v(this,nu,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(v(this,jt,!0),_(this,le,Yp).call(this,t),_(this,le,Ya).call(this)):l(this,li)&&(v(this,Zc,t.anchorNode),v(this,xf,t.anchorOffset),v(this,bf,t.focusNode),v(this,Sf,t.focusOffset),_(this,le,k0).call(this),_(this,le,Ya).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=Ae.prototype;return pe(this,"_keyboardManager",new $f([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:l(this,jt)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:l(this,us),methodOfCreation:l(this,Af)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var r;Ie.initialize(t,s),Ae._defaultColor||(Ae._defaultColor=((r=s.highlightColors)==null?void 0:r.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case ye.HIGHLIGHT_DEFAULT_COLOR:Ae._defaultColor=s;break;case ye.HIGHLIGHT_THICKNESS:Ae._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return l(this,tu)}updateParams(t,s){switch(t){case ye.HIGHLIGHT_COLOR:_(this,le,nC).call(this,s);break;case ye.HIGHLIGHT_THICKNESS:_(this,le,sC).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[ye.HIGHLIGHT_DEFAULT_COLOR,Ae._defaultColor],[ye.HIGHLIGHT_THICKNESS,Ae._defaultThickness]]}get propertiesToUpdate(){return[[ye.HIGHLIGHT_COLOR,this.color||Ae._defaultColor],[ye.HIGHLIGHT_THICKNESS,l(this,us)||Ae._defaultThickness],[ye.HIGHLIGHT_FREE,l(this,jt)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(v(this,eu,new Jd({editor:this})),t.addColorPicker(l(this,eu))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(_(this,le,ld).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,_(this,le,ld).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){_(this,le,N0).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(_(this,le,Ya).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let s=!1;this.parent&&!t?_(this,le,N0).call(this):t&&(_(this,le,Ya).call(this,t),s=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var i,a,o;const{drawLayer:s}=this.parent;let r;l(this,jt)?(t=(t-this.rotation+360)%360,r=_(i=Ae,ys,Pl).call(i,l(this,cs).box,t)):r=_(a=Ae,ys,Pl).call(a,[this.x,this.y,this.width,this.height],t),s.updateProperties(l(this,Un),{bbox:r,root:{"data-main-rotation":t}}),s.updateProperties(l(this,Yt),{bbox:_(o=Ae,ys,Pl).call(o,l(this,xn).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();l(this,nu)&&(t.setAttribute("aria-label",l(this,nu)),t.setAttribute("role","mark")),l(this,jt)?t.classList.add("free"):this.div.addEventListener("keydown",_(this,le,iC).bind(this),{signal:this._uiManager._signal});const s=v(this,qo,document.createElement("div"));t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=l(this,Wo);const[r,i]=this.parentDimensions;return this.setDims(this.width*r,this.height*i),T_(this,l(this,qo),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(l(this,Yt),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(l(this,Yt),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:_(this,le,Kp).call(this,!0);break;case 1:case 3:_(this,le,Kp).call(this,!1);break}}select(){var t;super.select(),l(this,Yt)&&((t=this.parent)==null||t.drawLayer.updateProperties(l(this,Yt),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),l(this,Yt)&&((t=this.parent)==null||t.drawLayer.updateProperties(l(this,Yt),{rootClass:{selected:!1}}),l(this,jt)||_(this,le,Kp).call(this,!1))}get _mustFixPosition(){return!l(this,jt)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(l(this,Un),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(l(this,Yt),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:r,x:i,y:a}){const{x:o,y:c,width:u,height:d}=r.getBoundingClientRect(),h=new AbortController,f=t.combinedSignal(h),g=y=>{h.abort(),_(this,ys,cC).call(this,t,y)};window.addEventListener("blur",g,{signal:f}),window.addEventListener("pointerup",g,{signal:f}),window.addEventListener("pointerdown",nt,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",As,{signal:f}),r.addEventListener("pointermove",_(this,ys,lC).bind(this,t),{signal:f}),this._freeHighlight=new A0({x:i,y:a},[o,c,u,d],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,r){var m,b,w,x;let i=null;if(t instanceof OE){const{data:{quadPoints:S,rect:E,rotation:C,id:N,color:k,opacity:R,popupRef:P},parent:{page:{pageNumber:L}}}=t;i=t={annotationType:ie.HIGHLIGHT,color:Array.from(k),opacity:R,quadPoints:S,boxes:null,pageIndex:L-1,rect:E.slice(0),rotation:C,id:N,deleted:!1,popupRef:P}}else if(t instanceof lx){const{data:{inkLists:S,rect:E,rotation:C,id:N,color:k,borderStyle:{rawWidth:R},popupRef:P},parent:{page:{pageNumber:L}}}=t;i=t={annotationType:ie.HIGHLIGHT,color:Array.from(k),thickness:R,inkLists:S,boxes:null,pageIndex:L-1,rect:E.slice(0),rotation:C,id:N,deleted:!1,popupRef:P}}const{color:a,quadPoints:o,inkLists:c,opacity:u}=t,d=await super.deserialize(t,s,r);d.color=te.makeHexColor(...a),v(d,ci,u||1),c&&v(d,us,t.thickness),d.annotationElementId=t.id||null,d._initialData=i;const[h,f]=d.pageDimensions,[g,y]=d.pageTranslation;if(o){const S=v(d,li,[]);for(let E=0;E<o.length;E+=8)S.push({x:(o[E]-g)/h,y:1-(o[E+1]-y)/f,width:(o[E+2]-o[E])/h,height:(o[E+1]-o[E+5])/f});_(m=d,le,k0).call(m),_(b=d,le,Ya).call(b),d.rotate(d.rotation)}else if(c){v(d,jt,!0);const S=c[0],E={x:S[0]-g,y:f-(S[1]-y)},C=new A0(E,[0,0,h,f],1,l(d,us)/2,!0,.001);for(let R=0,P=S.length;R<P;R+=2)E.x=S[R]-g,E.y=f-(S[R+1]-y),C.add(E);const{id:N,clipPathId:k}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);_(w=d,le,Yp).call(w,{highlightOutlines:C.getOutlines(),highlightId:N,clipPathId:k}),_(x=d,le,Ya).call(x),d.rotate(d.parentRotation)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),r=Ie._colorManager.convert(this.color),i={annotationType:ie.HIGHLIGHT,color:r,opacity:l(this,ci),thickness:l(this,us),quadPoints:_(this,le,aC).call(this),outlines:_(this,le,oC).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:_(this,le,ld).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!_(this,le,uC).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Zc=new WeakMap,xf=new WeakMap,li=new WeakMap,Wo=new WeakMap,eu=new WeakMap,xn=new WeakMap,bf=new WeakMap,Sf=new WeakMap,qo=new WeakMap,cs=new WeakMap,Un=new WeakMap,jt=new WeakMap,tu=new WeakMap,ci=new WeakMap,Yt=new WeakMap,nu=new WeakMap,us=new WeakMap,Af=new WeakMap,le=new WeakSet,k0=function(){const t=new b0(l(this,li),.001);v(this,cs,t.getOutlines()),[this.x,this.y,this.width,this.height]=l(this,cs).box;const s=new b0(l(this,li),.0025,.001,this._uiManager.direction==="ltr");v(this,xn,s.getOutlines());const{lastPoint:r}=l(this,xn);v(this,tu,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},Yp=function({highlightOutlines:t,highlightId:s,clipPathId:r}){var h,f;if(v(this,cs,t),v(this,xn,t.getNewOutline(l(this,us)/2+1.5,.0025)),s>=0)v(this,Un,s),v(this,Wo,r),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),v(this,Yt,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:l(this,xn).box,path:{d:l(this,xn).toSVGPath()}},!0));else if(this.parent){const g=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(l(this,Un),{bbox:_(h=Ae,ys,Pl).call(h,l(this,cs).box,(g-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(l(this,Yt),{bbox:_(f=Ae,ys,Pl).call(f,l(this,xn).box,g),path:{d:l(this,xn).toSVGPath()}})}const[a,o,c,u]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=c,this.height=u;break;case 90:{const[g,y]=this.parentDimensions;this.x=o,this.y=1-a,this.width=c*y/g,this.height=u*g/y;break}case 180:this.x=1-a,this.y=1-o,this.width=c,this.height=u;break;case 270:{const[g,y]=this.parentDimensions;this.x=1-o,this.y=a,this.width=c*y/g,this.height=u*g/y;break}}const{lastPoint:d}=l(this,xn);v(this,tu,[(d[0]-a)/c,(d[1]-o)/u])},nC=function(t){const s=(a,o)=>{var c,u;this.color=a,v(this,ci,o),(c=this.parent)==null||c.drawLayer.updateProperties(l(this,Un),{root:{fill:a,"fill-opacity":o}}),(u=l(this,eu))==null||u.updateColor(a)},r=this.color,i=l(this,ci);this.addCommands({cmd:s.bind(this,t,Ae._defaultOpacity),undo:s.bind(this,r,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ye.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},sC=function(t){const s=l(this,us),r=i=>{v(this,us,i),_(this,le,rC).call(this,i)};this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ye.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},rC=function(t){if(!l(this,jt))return;_(this,le,Yp).call(this,{highlightOutlines:l(this,cs).getNewOutline(t/2)}),this.fixAndSetPosition();const[s,r]=this.parentDimensions;this.setDims(this.width*s,this.height*r)},N0=function(){l(this,Un)===null||!this.parent||(this.parent.drawLayer.remove(l(this,Un)),v(this,Un,null),this.parent.drawLayer.remove(l(this,Yt)),v(this,Yt,null))},Ya=function(t=this.parent){l(this,Un)===null&&({id:tn(this,Un)._,clipPathId:tn(this,Wo)._}=t.drawLayer.draw({bbox:l(this,cs).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":l(this,ci)},rootClass:{highlight:!0,free:l(this,jt)},path:{d:l(this,cs).toSVGPath()}},!1,!0),v(this,Yt,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:l(this,jt)},bbox:l(this,xn).box,path:{d:l(this,xn).toSVGPath()}},l(this,jt))),l(this,qo)&&(l(this,qo).style.clipPath=l(this,Wo)))},ys=new WeakSet,Pl=function([t,s,r,i],a){switch(a){case 90:return[1-s-i,t,i,r];case 180:return[1-t-r,1-s-i,r,i];case 270:return[s,1-t-r,i,r]}return[t,s,r,i]},iC=function(t){Ae._keyboardManager.exec(this,t)},Kp=function(t){if(!l(this,Zc))return;const s=window.getSelection();t?s.setPosition(l(this,Zc),l(this,xf)):s.setPosition(l(this,bf),l(this,Sf))},ld=function(){return l(this,jt)?this.rotation:0},aC=function(){if(l(this,jt))return null;const[t,s]=this.pageDimensions,[r,i]=this.pageTranslation,a=l(this,li),o=new Float32Array(a.length*8);let c=0;for(const{x:u,y:d,width:h,height:f}of a){const g=u*t+r,y=(1-d)*s+i;o[c]=o[c+4]=g,o[c+1]=o[c+3]=y,o[c+2]=o[c+6]=g+h*t,o[c+5]=o[c+7]=y-f*s,c+=8}return o},oC=function(t){return l(this,cs).serialize(t,_(this,le,ld).call(this))},lC=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},cC=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},uC=function(t){const{color:s}=this._initialData;return t.color.some((r,i)=>r!==s[i])},A(Ae,ys),$(Ae,"_defaultColor",null),$(Ae,"_defaultOpacity",1),$(Ae,"_defaultThickness",12),$(Ae,"_type","highlight"),$(Ae,"_editorType",ie.HIGHLIGHT),$(Ae,"_freeHighlightId",-1),$(Ae,"_freeHighlight",null),$(Ae,"_freeHighlightClipId","");let Fg=Ae;var Xo;class dC{constructor(){A(this,Xo,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,s)}updateSVGProperty(e,t){l(this,Xo)[e]=t}toSVGProperties(){const e=l(this,Xo);return v(this,Xo,Object.create(null)),{root:e}}reset(){v(this,Xo,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Pe("Not implemented")}}Xo=new WeakMap;var Hn,su,bt,Yo,Ko,da,ha,fa,Qo,be,T0,P0,R0,cd,hC,Qp,ud,Rl;const Y=class Y extends Ie{constructor(t){super(t);A(this,be);A(this,Hn,null);A(this,su);$(this,"_drawId",null);v(this,su,t.mustBeCommitted||!1),this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(_(this,be,T0).call(this,t),_(this,be,cd).call(this))}static _mergeSVGProperties(t,s){const r=new Set(Object.keys(t));for(const[i,a]of Object.entries(s))r.has(i)?Object.assign(t[i],a):t[i]=a;return t}static getDefaultDrawingOptions(t){Pe("Not implemented")}static get typesMap(){Pe("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const r=this.typesMap.get(t);r&&this._defaultDrawingOptions.updateProperty(r,s),this._currentParent&&(l(Y,bt).updateProperty(r,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const r=this.constructor.typesMap.get(t);r&&this._updateProperty(t,r,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[r,i]of this.typesMap)t.push([r,s[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[r,i]of this.constructor.typesMap)t.push([r,s[i]]);return t}_updateProperty(t,s,r){const i=this._drawingOptions,a=i[s],o=c=>{var d;i.updateProperty(s,c);const u=l(this,Hn).updateProperty(s,c);u&&_(this,be,ud).call(this,u),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:o.bind(this,r),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Y._mergeSVGProperties(l(this,Hn).getPathResizingSVGProperties(_(this,be,Qp).call(this)),{bbox:_(this,be,Rl).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Y._mergeSVGProperties(l(this,Hn).getPathResizedSVGProperties(_(this,be,Qp).call(this)),{bbox:_(this,be,Rl).call(this)}))}_onTranslating(t,s){var r;(r=this.parent)==null||r.drawLayer.updateProperties(this._drawId,{bbox:_(this,be,Rl).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Y._mergeSVGProperties(l(this,Hn).getPathTranslatedSVGProperties(_(this,be,Qp).call(this),this.parentDimensions),{bbox:_(this,be,Rl).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,l(this,su)&&(v(this,su,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){_(this,be,R0).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(_(this,be,cd).call(this),_(this,be,ud).call(this,l(this,Hn).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),_(this,be,R0).call(this)):t&&(this._uiManager.addShouldRescale(this),_(this,be,cd).call(this,t),s=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Y._mergeSVGProperties({bbox:_(this,be,Rl).call(this)},l(this,Hn).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&_(this,be,ud).call(this,l(this,Hn).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,s;this._isCopy&&(t=this.x,s=this.y);const r=super.render();r.classList.add("draw");const i=document.createElement("div");r.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";const[a,o]=this.parentDimensions;return this.setDims(this.width*a,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,s),r}static createDrawerInstance(t,s,r,i,a){Pe("Not implemented")}static startDrawing(t,s,r,i){var b;const{target:a,offsetX:o,offsetY:c,pointerId:u,pointerType:d}=i;if(l(Y,ha)&&l(Y,ha)!==d)return;const{viewport:{rotation:h}}=t,{width:f,height:g}=a.getBoundingClientRect(),y=v(Y,Yo,new AbortController),m=t.combinedSignal(y);if(l(Y,da)||v(Y,da,u),l(Y,ha)??v(Y,ha,d),window.addEventListener("pointerup",w=>{var x;l(Y,da)===w.pointerId?this._endDraw(w):(x=l(Y,fa))==null||x.delete(w.pointerId)},{signal:m}),window.addEventListener("pointercancel",w=>{var x;l(Y,da)===w.pointerId?this._currentParent.endDrawingSession():(x=l(Y,fa))==null||x.delete(w.pointerId)},{signal:m}),window.addEventListener("pointerdown",w=>{l(Y,ha)===w.pointerType&&((l(Y,fa)||v(Y,fa,new Set)).add(w.pointerId),l(Y,bt).isCancellable()&&(l(Y,bt).removeLastElement(),l(Y,bt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",As,{signal:m}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:m}),a.addEventListener("touchmove",w=>{w.timeStamp===l(Y,Qo)&&nt(w)},{signal:m}),t.toggleDrawing(),(b=s._editorUndoBar)==null||b.hide(),l(Y,bt)){t.drawLayer.updateProperties(this._currentDrawId,l(Y,bt).startNew(o,c,f,g,h));return}s.updateUIForDefaultProperties(this),v(Y,bt,this.createDrawerInstance(o,c,f,g,h)),v(Y,Ko,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(l(Y,Ko).toSVGProperties(),l(Y,bt).defaultSVGProperties),!0,!1)}static _drawMove(t){var a;if(v(Y,Qo,-1),!l(Y,bt))return;const{offsetX:s,offsetY:r,pointerId:i}=t;if(l(Y,da)===i){if(((a=l(Y,fa))==null?void 0:a.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,l(Y,bt).add(s,r)),v(Y,Qo,t.timeStamp),nt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,v(Y,bt,null),v(Y,Ko,null),v(Y,ha,null),v(Y,Qo,NaN)),l(Y,Yo)&&(l(Y,Yo).abort(),v(Y,Yo,null),v(Y,da,NaN),v(Y,fa,null))}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,l(Y,bt).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const r=l(Y,bt),i=this._currentDrawId,a=r.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(i,r.setLastElement(a))},undo:()=>{s.drawLayer.updateProperties(i,r.removeLastElement())},mustExec:!1,type:ye.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(ye.DRAW_STEP),!l(Y,bt).isEmpty()){const{pageDimensions:[r,i],scale:a}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:l(Y,bt).getOutlines(r*a,i*a,a,this._INNER_MARGIN),drawingOptions:l(Y,Ko),mustBeCommitted:!t});return this._cleanup(!0),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,r,i,a,o){Pe("Not implemented")}static async deserialize(t,s,r){var h,f;const{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:c}}=s.viewport,u=this.deserializeDraw(o,c,i,a,this._INNER_MARGIN,t),d=await super.deserialize(t,s,r);return d.createDrawingOptions(t),_(h=d,be,T0).call(h,{drawOutlines:u}),_(f=d,be,cd).call(f),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){const[s,r]=this.pageTranslation,[i,a]=this.pageDimensions;return l(this,Hn).serialize([s,r,i,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Hn=new WeakMap,su=new WeakMap,bt=new WeakMap,Yo=new WeakMap,Ko=new WeakMap,da=new WeakMap,ha=new WeakMap,fa=new WeakMap,Qo=new WeakMap,be=new WeakSet,T0=function({drawOutlines:t,drawId:s,drawingOptions:r}){v(this,Hn,t),this._drawingOptions||(this._drawingOptions=r),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=_(this,be,P0).call(this,t,this.parent),_(this,be,ud).call(this,t.box)},P0=function(t,s){const{id:r}=s.drawLayer.draw(Y._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return r},R0=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},cd=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=_(this,be,P0).call(this,l(this,Hn),t)}},hC=function([t,s,r,i]){const{parentDimensions:[a,o],rotation:c}=this;switch(c){case 90:return[s,1-t,r*(o/a),i*(a/o)];case 180:return[1-t,1-s,r,i];case 270:return[1-s,t,r*(o/a),i*(a/o)];default:return[t,s,r,i]}},Qp=function(){const{x:t,y:s,width:r,height:i,parentDimensions:[a,o],rotation:c}=this;switch(c){case 90:return[1-s,t,r*(a/o),i*(o/a)];case 180:return[1-t,1-s,r,i];case 270:return[s,1-t,r*(a/o),i*(o/a)];default:return[t,s,r,i]}},ud=function(t){if([this.x,this.y,this.width,this.height]=_(this,be,hC).call(this,t),this.div){this.fixAndSetPosition();const[s,r]=this.parentDimensions;this.setDims(this.width*s,this.height*r)}this._onResized()},Rl=function(){const{x:t,y:s,width:r,height:i,rotation:a,parentRotation:o,parentDimensions:[c,u]}=this;switch((a*4+o)/90){case 1:return[1-s-i,t,i,r];case 2:return[1-t-r,1-s-i,r,i];case 3:return[s,1-t-r,i,r];case 4:return[t,s-r*(c/u),i*(u/c),r*(c/u)];case 5:return[1-s,t,r*(c/u),i*(u/c)];case 6:return[1-t-i*(u/c),1-s,i*(u/c),r*(c/u)];case 7:return[s-r*(c/u),1-t-i*(u/c),r*(c/u),i*(u/c)];case 8:return[t-r,s-i,r,i];case 9:return[1-s,t-r,i,r];case 10:return[1-t,1-s,r,i];case 11:return[s-i,1-t,i,r];case 12:return[t-i*(u/c),s,i*(u/c),r*(c/u)];case 13:return[1-s-r*(c/u),t-i*(u/c),r*(c/u),i*(u/c)];case 14:return[1-t,1-s-r*(c/u),i*(u/c),r*(c/u)];case 15:return[s,1-t,r*(c/u),i*(u/c)];default:return[t,s,r,i]}},$(Y,"_currentDrawId",-1),$(Y,"_currentParent",null),A(Y,bt,null),A(Y,Yo,null),A(Y,Ko,null),A(Y,da,NaN),A(Y,ha,null),A(Y,fa,null),A(Y,Qo,NaN),$(Y,"_INNER_MARGIN",3);let $g=Y;var yr,St,At,Jo,ru,rn,Dt,ds,Zo,el,tl,iu,Jp;class IM{constructor(e,t,s,r,i,a){A(this,iu);A(this,yr,new Float64Array(6));A(this,St);A(this,At);A(this,Jo);A(this,ru);A(this,rn);A(this,Dt,"");A(this,ds,0);A(this,Zo,new Uf);A(this,el);A(this,tl);v(this,el,s),v(this,tl,r),v(this,Jo,i),v(this,ru,a),[e,t]=_(this,iu,Jp).call(this,e,t);const o=v(this,St,[NaN,NaN,NaN,NaN,e,t]);v(this,rn,[e,t]),v(this,At,[{line:o,points:l(this,rn)}]),l(this,yr).set(o,0)}updateProperty(e,t){e==="stroke-width"&&v(this,ru,t)}isEmpty(){return!l(this,At)||l(this,At).length===0}isCancellable(){return l(this,rn).length<=10}add(e,t){[e,t]=_(this,iu,Jp).call(this,e,t);const[s,r,i,a]=l(this,yr).subarray(2,6),o=e-i,c=t-a;return Math.hypot(l(this,el)*o,l(this,tl)*c)<=2?null:(l(this,rn).push(e,t),isNaN(s)?(l(this,yr).set([i,a,e,t],2),l(this,St).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(l(this,yr)[0])&&l(this,St).splice(6,6),l(this,yr).set([s,r,i,a,e,t],0),l(this,St).push(...q.createBezierPoints(s,r,i,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(l(this,rn).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,r,i){v(this,el,s),v(this,tl,r),v(this,Jo,i),[e,t]=_(this,iu,Jp).call(this,e,t);const a=v(this,St,[NaN,NaN,NaN,NaN,e,t]);v(this,rn,[e,t]);const o=l(this,At).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),l(this,At).push({line:a,points:l(this,rn)}),l(this,yr).set(a,0),v(this,ds,0),this.toSVGPath(),null}getLastElement(){return l(this,At).at(-1)}setLastElement(e){return l(this,At)?(l(this,At).push(e),v(this,St,e.line),v(this,rn,e.points),v(this,ds,0),{path:{d:this.toSVGPath()}}):l(this,Zo).setLastElement(e)}removeLastElement(){if(!l(this,At))return l(this,Zo).removeLastElement();l(this,At).pop(),v(this,Dt,"");for(let e=0,t=l(this,At).length;e<t;e++){const{line:s,points:r}=l(this,At)[e];v(this,St,s),v(this,rn,r),v(this,ds,0),this.toSVGPath()}return{path:{d:l(this,Dt)}}}toSVGPath(){const e=q.svgRound(l(this,St)[4]),t=q.svgRound(l(this,St)[5]);if(l(this,rn).length===2)return v(this,Dt,`${l(this,Dt)} M ${e} ${t} Z`),l(this,Dt);if(l(this,rn).length<=6){const r=l(this,Dt).lastIndexOf("M");v(this,Dt,`${l(this,Dt).slice(0,r)} M ${e} ${t}`),v(this,ds,6)}if(l(this,rn).length===4){const r=q.svgRound(l(this,St)[10]),i=q.svgRound(l(this,St)[11]);return v(this,Dt,`${l(this,Dt)} L ${r} ${i}`),v(this,ds,12),l(this,Dt)}const s=[];l(this,ds)===0&&(s.push(`M ${e} ${t}`),v(this,ds,6));for(let r=l(this,ds),i=l(this,St).length;r<i;r+=6){const[a,o,c,u,d,h]=l(this,St).slice(r,r+6).map(q.svgRound);s.push(`C${a} ${o} ${c} ${u} ${d} ${h}`)}return v(this,Dt,l(this,Dt)+s.join(" ")),v(this,ds,l(this,St).length),l(this,Dt)}getOutlines(e,t,s,r){const i=l(this,At).at(-1);return i.line=new Float32Array(i.line),i.points=new Float32Array(i.points),l(this,Zo).build(l(this,At),e,t,s,l(this,Jo),l(this,ru),r),v(this,yr,null),v(this,St,null),v(this,At,null),v(this,Dt,null),l(this,Zo)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}yr=new WeakMap,St=new WeakMap,At=new WeakMap,Jo=new WeakMap,ru=new WeakMap,rn=new WeakMap,Dt=new WeakMap,ds=new WeakMap,Zo=new WeakMap,el=new WeakMap,tl=new WeakMap,iu=new WeakSet,Jp=function(e,t){return q._normalizePoint(e,t,l(this,el),l(this,tl),l(this,Jo))};var an,_f,Ef,Vn,vr,wr,au,ou,nl,Ft,Dr,fC,pC,gC;class Uf extends q{constructor(){super(...arguments);A(this,Ft);A(this,an);A(this,_f,0);A(this,Ef);A(this,Vn);A(this,vr);A(this,wr);A(this,au);A(this,ou);A(this,nl)}build(t,s,r,i,a,o,c){v(this,vr,s),v(this,wr,r),v(this,au,i),v(this,ou,a),v(this,nl,o),v(this,Ef,c??0),v(this,Vn,t),_(this,Ft,pC).call(this)}get thickness(){return l(this,nl)}setLastElement(t){return l(this,Vn).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return l(this,Vn).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of l(this,Vn)){if(t.push(`M${q.svgRound(s[4])} ${q.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12&&isNaN(s[6])){t.push(`L${q.svgRound(s[10])} ${q.svgRound(s[11])}`);continue}for(let r=6,i=s.length;r<i;r+=6){const[a,o,c,u,d,h]=s.subarray(r,r+6).map(q.svgRound);t.push(`C${a} ${o} ${c} ${u} ${d} ${h}`)}}return t.join("")}serialize([t,s,r,i],a){const o=[],c=[],[u,d,h,f]=_(this,Ft,fC).call(this);let g,y,m,b,w,x,S,E,C;switch(l(this,ou)){case 0:C=q._rescale,g=t,y=s+i,m=r,b=-i,w=t+u*r,x=s+(1-d-f)*i,S=t+(u+h)*r,E=s+(1-d)*i;break;case 90:C=q._rescaleAndSwap,g=t,y=s,m=r,b=i,w=t+d*r,x=s+u*i,S=t+(d+f)*r,E=s+(u+h)*i;break;case 180:C=q._rescale,g=t+r,y=s,m=-r,b=i,w=t+(1-u-h)*r,x=s+d*i,S=t+(1-u)*r,E=s+(d+f)*i;break;case 270:C=q._rescaleAndSwap,g=t+r,y=s+i,m=-r,b=-i,w=t+(1-d-f)*r,x=s+(1-u-h)*i,S=t+(1-d)*r,E=s+(1-u)*i;break}for(const{line:N,points:k}of l(this,Vn))o.push(C(N,g,y,m,b,a?new Array(N.length):null)),c.push(C(k,g,y,m,b,a?new Array(k.length):null));return{lines:o,points:c,rect:[w,x,S,E]}}static deserialize(t,s,r,i,a,{paths:{lines:o,points:c},rotation:u,thickness:d}){const h=[];let f,g,y,m,b;switch(u){case 0:b=q._rescale,f=-t/r,g=s/i+1,y=1/r,m=-1/i;break;case 90:b=q._rescaleAndSwap,f=-s/i,g=-t/r,y=1/i,m=1/r;break;case 180:b=q._rescale,f=t/r+1,g=-s/i,y=-1/r,m=1/i;break;case 270:b=q._rescaleAndSwap,f=s/i+1,g=t/r+1,y=-1/i,m=-1/r;break}if(!o){o=[];for(const x of c){const S=x.length;if(S===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1]]));continue}if(S===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1],NaN,NaN,NaN,NaN,x[2],x[3]]));continue}const E=new Float32Array(3*(S-2));o.push(E);let[C,N,k,R]=x.subarray(0,4);E.set([NaN,NaN,NaN,NaN,C,N],0);for(let P=4;P<S;P+=2){const L=x[P],M=x[P+1];E.set(q.createBezierPoints(C,N,k,R,L,M),(P-2)*3),[C,N,k,R]=[k,R,L,M]}}}for(let x=0,S=o.length;x<S;x++)h.push({line:b(o[x].map(E=>E??NaN),f,g,y,m),points:b(c[x].map(E=>E??NaN),f,g,y,m)});const w=new this.prototype.constructor;return w.build(h,r,i,1,u,d,a),w}get box(){return l(this,an)}updateProperty(t,s){return t==="stroke-width"?_(this,Ft,gC).call(this,s):null}updateParentDimensions([t,s],r){const[i,a]=_(this,Ft,Dr).call(this);v(this,vr,t),v(this,wr,s),v(this,au,r);const[o,c]=_(this,Ft,Dr).call(this),u=o-i,d=c-a,h=l(this,an);return h[0]-=u,h[1]-=d,h[2]+=2*u,h[3]+=2*d,h}updateRotation(t){return v(this,_f,t),{path:{transform:this.rotationTransform}}}get viewBox(){return l(this,an).map(q.svgRound).join(" ")}get defaultProperties(){const[t,s]=l(this,an);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${q.svgRound(t)} ${q.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=l(this,an);let r=0,i=0,a=0,o=0,c=0,u=0;switch(l(this,_f)){case 90:i=s/t,a=-t/s,c=t;break;case 180:r=-1,o=-1,c=t,u=s;break;case 270:i=-s/t,a=t/s,u=s;break;default:return""}return`matrix(${r} ${i} ${a} ${o} ${q.svgRound(c)} ${q.svgRound(u)})`}getPathResizingSVGProperties([t,s,r,i]){const[a,o]=_(this,Ft,Dr).call(this),[c,u,d,h]=l(this,an);if(Math.abs(d-a)<=q.PRECISION||Math.abs(h-o)<=q.PRECISION){const b=t+r/2-(c+d/2),w=s+i/2-(u+h/2);return{path:{"transform-origin":`${q.svgRound(t)} ${q.svgRound(s)}`,transform:`${this.rotationTransform} translate(${b} ${w})`}}}const f=(r-2*a)/(d-2*a),g=(i-2*o)/(h-2*o),y=d/r,m=h/i;return{path:{"transform-origin":`${q.svgRound(c)} ${q.svgRound(u)}`,transform:`${this.rotationTransform} scale(${y} ${m}) translate(${q.svgRound(a)} ${q.svgRound(o)}) scale(${f} ${g}) translate(${q.svgRound(-a)} ${q.svgRound(-o)})`}}}getPathResizedSVGProperties([t,s,r,i]){const[a,o]=_(this,Ft,Dr).call(this),c=l(this,an),[u,d,h,f]=c;if(c[0]=t,c[1]=s,c[2]=r,c[3]=i,Math.abs(h-a)<=q.PRECISION||Math.abs(f-o)<=q.PRECISION){const w=t+r/2-(u+h/2),x=s+i/2-(d+f/2);for(const{line:S,points:E}of l(this,Vn))q._translate(S,w,x,S),q._translate(E,w,x,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${q.svgRound(t)} ${q.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const g=(r-2*a)/(h-2*a),y=(i-2*o)/(f-2*o),m=-g*(u+a)+t+a,b=-y*(d+o)+s+o;if(g!==1||y!==1||m!==0||b!==0)for(const{line:w,points:x}of l(this,Vn))q._rescale(w,m,b,g,y,w),q._rescale(x,m,b,g,y,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${q.svgRound(t)} ${q.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],r){const[i,a]=r,o=l(this,an),c=t-o[0],u=s-o[1];if(l(this,vr)===i&&l(this,wr)===a)for(const{line:d,points:h}of l(this,Vn))q._translate(d,c,u,d),q._translate(h,c,u,h);else{const d=l(this,vr)/i,h=l(this,wr)/a;v(this,vr,i),v(this,wr,a);for(const{line:f,points:g}of l(this,Vn))q._rescale(f,c,u,d,h,f),q._rescale(g,c,u,d,h,g);o[2]*=d,o[3]*=h}return o[0]=t,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${q.svgRound(t)} ${q.svgRound(s)}`}}}get defaultSVGProperties(){const t=l(this,an);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${q.svgRound(t[0])} ${q.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}an=new WeakMap,_f=new WeakMap,Ef=new WeakMap,Vn=new WeakMap,vr=new WeakMap,wr=new WeakMap,au=new WeakMap,ou=new WeakMap,nl=new WeakMap,Ft=new WeakSet,Dr=function(t=l(this,nl)){const s=l(this,Ef)+t/2*l(this,au);return l(this,ou)%180===0?[s/l(this,vr),s/l(this,wr)]:[s/l(this,wr),s/l(this,vr)]},fC=function(){const[t,s,r,i]=l(this,an),[a,o]=_(this,Ft,Dr).call(this,0);return[t+a,s+o,r-2*a,i-2*o]},pC=function(){const t=v(this,an,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:i}of l(this,Vn)){if(i.length<=12){for(let c=4,u=i.length;c<u;c+=6)te.pointBoundingBox(i[c],i[c+1],t);continue}let a=i[4],o=i[5];for(let c=6,u=i.length;c<u;c+=6){const[d,h,f,g,y,m]=i.subarray(c,c+6);te.bezierBoundingBox(a,o,d,h,f,g,y,m,t),a=y,o=m}}const[s,r]=_(this,Ft,Dr).call(this);t[0]=Qt(t[0]-s,0,1),t[1]=Qt(t[1]-r,0,1),t[2]=Qt(t[2]+s,0,1),t[3]=Qt(t[3]+r,0,1),t[2]-=t[0],t[3]-=t[1]},gC=function(t){const[s,r]=_(this,Ft,Dr).call(this);v(this,nl,t);const[i,a]=_(this,Ft,Dr).call(this),[o,c]=[i-s,a-r],u=l(this,an);return u[0]-=o,u[1]-=c,u[2]+=2*o,u[3]+=2*c,u};class Dm extends dC{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Ie._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Dm(this._viewParameters);return e.updateAll(this),e}}var im,mC;const ql=class ql extends $g{constructor(t){super({...t,name:"inkEditor"});A(this,im);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,s){Ie.initialize(t,s),this._defaultDrawingOptions=new Dm(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return pe(this,"typesMap",new Map([[ye.INK_THICKNESS,"stroke-width"],[ye.INK_COLOR,"stroke"],[ye.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,r,i,a){return new IM(t,s,r,i,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,r,i,a,o){return Uf.deserialize(t,s,r,i,a,o)}static async deserialize(t,s,r){let i=null;if(t instanceof lx){const{data:{inkLists:o,rect:c,rotation:u,id:d,color:h,opacity:f,borderStyle:{rawWidth:g},popupRef:y},parent:{page:{pageNumber:m}}}=t;i=t={annotationType:ie.INK,color:Array.from(h),thickness:g,opacity:f,paths:{points:o},boxes:null,pageIndex:m-1,rect:c.slice(0),rotation:u,id:d,deleted:!1,popupRef:y}}const a=await super.deserialize(t,s,r);return a.annotationElementId=t.id||null,a._initialData=i,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:r}=this;s.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:r}){this._drawingOptions=ql.getDefaultDrawingOptions({stroke:te.makeHexColor(...t),"stroke-width":s,"stroke-opacity":r})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:r,rect:i}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":c}}=this,u={annotationType:ie.INK,color:Ie._colorManager.convert(a),opacity:o,thickness:c,paths:{lines:s,points:r},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(u.isCopy=!0,u):this.annotationElementId&&!_(this,im,mC).call(this,u)?null:(u.id=this.annotationElementId,u)}renderAnnotationElement(t){const{points:s,rect:r}=this.serializeDraw(!1);return t.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:s}),null}};im=new WeakSet,mC=function(t){const{color:s,thickness:r,opacity:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,c)=>o!==s[c])||t.thickness!==r||t.opacity!==i||t.pageIndex!==a},$(ql,"_type","ink"),$(ql,"_editorType",ie.INK),$(ql,"_defaultDrawingOptions",null);let L0=ql;class M0 extends Uf{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const gp=8,Hu=3;var sl,_e,j0,$s,yC,vC,D0,Zp,wC,xC,bC,I0,O0,SC;class _r{static extractContoursFromText(e,{fontFamily:t,fontStyle:s,fontWeight:r},i,a,o,c){let u=new OffscreenCanvas(1,1),d=u.getContext("2d",{alpha:!1});const h=200,f=d.font=`${s} ${r} ${h}px ${t}`,{actualBoundingBoxLeft:g,actualBoundingBoxRight:y,actualBoundingBoxAscent:m,actualBoundingBoxDescent:b,fontBoundingBoxAscent:w,fontBoundingBoxDescent:x,width:S}=d.measureText(e),E=1.5,C=Math.ceil(Math.max(Math.abs(g)+Math.abs(y)||0,S)*E),N=Math.ceil(Math.max(Math.abs(m)+Math.abs(b)||h,Math.abs(w)+Math.abs(x)||h)*E);u=new OffscreenCanvas(C,N),d=u.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=f,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,C,N),d.fillStyle="black",d.fillText(e,C*(E-1)/2,N*(3-E)/2);const k=_(this,_e,I0).call(this,d.getImageData(0,0,C,N).data),R=_(this,_e,bC).call(this,k),P=_(this,_e,O0).call(this,R),L=_(this,_e,D0).call(this,k,C,N,P);return this.processDrawnLines({lines:{curves:L,width:C,height:N},pageWidth:i,pageHeight:a,rotation:o,innerMargin:c,mustSmooth:!0,areContours:!0})}static process(e,t,s,r,i){const[a,o,c]=_(this,_e,SC).call(this,e),[u,d]=_(this,_e,xC).call(this,a,o,c,Math.hypot(o,c)*l(this,sl).sigmaSFactor,l(this,sl).sigmaR,l(this,sl).kernelSize),h=_(this,_e,O0).call(this,d),f=_(this,_e,D0).call(this,u,o,c,h);return this.processDrawnLines({lines:{curves:f,width:o,height:c},pageWidth:t,pageHeight:s,rotation:r,innerMargin:i,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:r,innerMargin:i,mustSmooth:a,areContours:o}){r%180!==0&&([t,s]=[s,t]);const{curves:c,width:u,height:d}=e,h=e.thickness??0,f=[],g=Math.min(t/u,s/d),y=g/t,m=g/s,b=[];for(const{points:x}of c){const S=a?_(this,_e,wC).call(this,x):x;if(!S)continue;b.push(S);const E=S.length,C=new Float32Array(E),N=new Float32Array(3*(E===2?2:E-2));if(f.push({line:N,points:C}),E===2){C[0]=S[0]*y,C[1]=S[1]*m,N.set([NaN,NaN,NaN,NaN,C[0],C[1]],0);continue}let[k,R,P,L]=S;k*=y,R*=m,P*=y,L*=m,C.set([k,R,P,L],0),N.set([NaN,NaN,NaN,NaN,k,R],0);for(let M=4;M<E;M+=2){const I=C[M]=S[M]*y,U=C[M+1]=S[M+1]*m;N.set(q.createBezierPoints(k,R,P,L,I,U),(M-2)*3),[k,R,P,L]=[P,L,I,U]}}if(f.length===0)return null;const w=o?new M0:new Uf;return w.build(f,t,s,1,r,o?0:h,i),{outline:w,newCurves:b,areContours:o,thickness:h,width:u,height:d}}static async compressSignature({outlines:e,areContours:t,thickness:s,width:r,height:i}){let a=1/0,o=-1/0,c=0;for(const S of e){c+=S.length;for(let E=2,C=S.length;E<C;E++){const N=S[E]-S[E-2];a=Math.min(a,N),o=Math.max(o,N)}}let u;a>=-128&&o<=127?u=Int8Array:a>=-32768&&o<=32767?u=Int16Array:u=Int32Array;const d=e.length,h=gp+Hu*d,f=new Uint32Array(h);let g=0;f[g++]=h*Uint32Array.BYTES_PER_ELEMENT+(c-2*d)*u.BYTES_PER_ELEMENT,f[g++]=0,f[g++]=r,f[g++]=i,f[g++]=t?0:1,f[g++]=Math.max(0,Math.floor(s??0)),f[g++]=d,f[g++]=u.BYTES_PER_ELEMENT;for(const S of e)f[g++]=S.length-2,f[g++]=S[0],f[g++]=S[1];const y=new CompressionStream("deflate-raw"),m=y.writable.getWriter();await m.ready,m.write(f);const b=u.prototype.constructor;for(const S of e){const E=new b(S.length-2);for(let C=2,N=S.length;C<N;C++)E[C-2]=S[C]-S[C-2];m.write(E)}m.close();const w=await new Response(y.readable).arrayBuffer(),x=new Uint8Array(w);return v_(x)}static async decompressSignature(e){try{const t=hL(e),{readable:s,writable:r}=new DecompressionStream("deflate-raw"),i=r.getWriter();await i.ready,i.write(t).then(async()=>{await i.ready,await i.close()}).catch(()=>{});let a=null,o=0;for await(const S of s)a||(a=new Uint8Array(new Uint32Array(S.buffer,0,4)[0])),a.set(S,o),o+=S.length;const c=new Uint32Array(a.buffer,0,a.length>>2),u=c[1];if(u!==0)throw new Error(`Invalid version: ${u}`);const d=c[2],h=c[3],f=c[4]===0,g=c[5],y=c[6],m=c[7],b=[],w=(gp+Hu*y)*Uint32Array.BYTES_PER_ELEMENT;let x;switch(m){case Int8Array.BYTES_PER_ELEMENT:x=new Int8Array(a.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:x=new Int16Array(a.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:x=new Int32Array(a.buffer,w);break}o=0;for(let S=0;S<y;S++){const E=c[Hu*S+gp],C=new Float32Array(E+2);b.push(C);for(let N=0;N<Hu-1;N++)C[N]=c[Hu*S+gp+N+1];for(let N=0;N<E;N++)C[N+2]=C[N]+x[o++]}return{areContours:f,thickness:g,outlines:b,width:d,height:h}}catch(t){return ae(`decompressSignature: ${t}`),null}}}sl=new WeakMap,_e=new WeakSet,j0=function(e,t,s,r){return s-=e,r-=t,s===0?r>0?0:4:s===1?r+6:2-r},$s=new WeakMap,yC=function(e,t,s,r,i,a,o){const c=_(this,_e,j0).call(this,s,r,i,a);for(let u=0;u<8;u++){const d=(-u+c-o+16)%8,h=l(this,$s)[2*d],f=l(this,$s)[2*d+1];if(e[(s+h)*t+(r+f)]!==0)return d}return-1},vC=function(e,t,s,r,i,a,o){const c=_(this,_e,j0).call(this,s,r,i,a);for(let u=0;u<8;u++){const d=(u+c+o+16)%8,h=l(this,$s)[2*d],f=l(this,$s)[2*d+1];if(e[(s+h)*t+(r+f)]!==0)return d}return-1},D0=function(e,t,s,r){const i=e.length,a=new Int32Array(i);for(let d=0;d<i;d++)a[d]=e[d]<=r?1:0;for(let d=1;d<s-1;d++)a[d*t]=a[d*t+t-1]=0;for(let d=0;d<t;d++)a[d]=a[t*s-1-d]=0;let o=1,c;const u=[];for(let d=1;d<s-1;d++){c=1;for(let h=1;h<t-1;h++){const f=d*t+h,g=a[f];if(g===0)continue;let y=d,m=h;if(g===1&&a[f-1]===0)o+=1,m-=1;else if(g>=1&&a[f+1]===0)o+=1,m+=1,g>1&&(c=g);else{g!==1&&(c=Math.abs(g));continue}const b=[h,d],w=m===h+1,x={isHole:w,points:b,id:o,parent:0};u.push(x);let S;for(const M of u)if(M.id===c){S=M;break}S?S.isHole?x.parent=w?S.parent:c:x.parent=w?c:S.parent:x.parent=w?c:0;const E=_(this,_e,yC).call(this,a,t,d,h,y,m,0);if(E===-1){a[f]=-o,a[f]!==1&&(c=Math.abs(a[f]));continue}let C=l(this,$s)[2*E],N=l(this,$s)[2*E+1];const k=d+C,R=h+N;y=k,m=R;let P=d,L=h;for(;;){const M=_(this,_e,vC).call(this,a,t,P,L,y,m,1);C=l(this,$s)[2*M],N=l(this,$s)[2*M+1];const I=P+C,U=L+N;b.push(U,I);const B=P*t+L;if(a[B+1]===0?a[B]=-o:a[B]===1&&(a[B]=o),I===d&&U===h&&P===k&&L===R){a[f]!==1&&(c=Math.abs(a[f]));break}else y=P,m=L,P=I,L=U}}}return u},Zp=function(e,t,s,r){if(s-t<=4){for(let k=t;k<s-2;k+=2)r.push(e[k],e[k+1]);return}const i=e[t],a=e[t+1],o=e[s-4]-i,c=e[s-3]-a,u=Math.hypot(o,c),d=o/u,h=c/u,f=d*a-h*i,g=c/o,y=1/u,m=Math.atan(g),b=Math.cos(m),w=Math.sin(m),x=y*(Math.abs(b)+Math.abs(w)),S=y*(1-x+x**2),E=Math.max(Math.atan(Math.abs(w+b)*S),Math.atan(Math.abs(w-b)*S));let C=0,N=t;for(let k=t+2;k<s-2;k+=2){const R=Math.abs(f-d*e[k+1]+h*e[k]);R>C&&(N=k,C=R)}C>(u*E)**2?(_(this,_e,Zp).call(this,e,t,N+2,r),_(this,_e,Zp).call(this,e,N,s,r)):r.push(i,a)},wC=function(e){const t=[],s=e.length;return _(this,_e,Zp).call(this,e,0,s,t),t.push(e[s-2],e[s-1]),t.length<=4?null:t},xC=function(e,t,s,r,i,a){const o=new Float32Array(a**2),c=-2*r**2,u=a>>1;for(let m=0;m<a;m++){const b=(m-u)**2;for(let w=0;w<a;w++)o[m*a+w]=Math.exp((b+(w-u)**2)/c)}const d=new Float32Array(256),h=-2*i**2;for(let m=0;m<256;m++)d[m]=Math.exp(m**2/h);const f=e.length,g=new Uint8Array(f),y=new Uint32Array(256);for(let m=0;m<s;m++)for(let b=0;b<t;b++){const w=m*t+b,x=e[w];let S=0,E=0;for(let N=0;N<a;N++){const k=m+N-u;if(!(k<0||k>=s))for(let R=0;R<a;R++){const P=b+R-u;if(P<0||P>=t)continue;const L=e[k*t+P],M=o[N*a+R]*d[Math.abs(L-x)];S+=L*M,E+=M}}const C=g[w]=Math.round(S/E);y[C]++}return[g,y]},bC=function(e){const t=new Uint32Array(256);for(const s of e)t[s]++;return t},I0=function(e){const t=e.length,s=new Uint8ClampedArray(t>>2);let r=-1/0,i=1/0;for(let o=0,c=s.length;o<c;o++){if(e[(o<<2)+3]===0){r=s[o]=255;continue}const d=s[o]=e[o<<2];d>r&&(r=d),d<i&&(i=d)}const a=255/(r-i);for(let o=0;o<t;o++)s[o]=(s[o]-i)*a;return s},O0=function(e){let t,s=-1/0,r=-1/0;const i=e.findIndex(c=>c!==0);let a=i,o=i;for(t=i;t<256;t++){const c=e[t];c>s&&(t-a>r&&(r=t-a,o=t-1),s=c,a=t)}for(t=o-1;t>=0&&!(e[t]>e[t+1]);t--);return t},SC=function(e){const t=e,{width:s,height:r}=e,{maxDim:i}=l(this,sl);let a=s,o=r;if(s>i||r>i){let f=s,g=r,y=Math.log2(Math.max(s,r)/i);const m=Math.floor(y);y=y===m?m-1:m;for(let w=0;w<y;w++){a=Math.ceil(f/2),o=Math.ceil(g/2);const x=new OffscreenCanvas(a,o);x.getContext("2d").drawImage(e,0,0,f,g,0,0,a,o),f=a,g=o,e!==t&&e.close(),e=x.transferToImageBitmap()}const b=Math.min(i/a,i/o);a=Math.round(a*b),o=Math.round(o*b)}const u=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});u.filter="grayscale(1)",u.drawImage(e,0,0,e.width,e.height,0,0,a,o);const d=u.getImageData(0,0,a,o).data;return[_(this,_e,I0).call(this,d),a,o]},A(_r,_e),A(_r,sl,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),A(_r,$s,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class ux extends dC{constructor(){super(),super.updateProperties({fill:Ie._defaultLineColor,"stroke-width":0})}clone(){const e=new ux;return e.updateAll(this),e}}class dx extends Dm{constructor(e){super(e),super.updateProperties({stroke:Ie._defaultLineColor,"stroke-width":1})}clone(){const e=new dx(this._viewParameters);return e.updateAll(this),e}}var pa,Gn,ga,ma;const Mn=class Mn extends $g{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});A(this,pa,!1);A(this,Gn,null);A(this,ga,null);A(this,ma,null);this._willKeepAspectRatio=!0,v(this,ga,t.signatureData||null),v(this,Gn,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,s){Ie.initialize(t,s),this._defaultDrawingOptions=new ux,this._defaultDrawnSignatureOptions=new dx(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return pe(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!l(this,Gn)}}static computeTelemetryFinalData(t){const s=t.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,s;const{_isCopy:r}=this;if(r&&(this._isCopy=!1,t=this.x,s=this.y),super.render(),this._drawId===null)if(l(this,ga)){const{lines:i,mustSmooth:a,areContours:o,description:c,uuid:u,heightInPage:d}=l(this,ga),{rawDims:{pageWidth:h,pageHeight:f},rotation:g}=this.parent.viewport,y=_r.processDrawnLines({lines:i,pageWidth:h,pageHeight:f,rotation:g,innerMargin:Mn._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(y,d,c,u)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return r&&(this._isCopy=!0,this._moveAfterPaste(t,s)),this.div}setUuid(t){v(this,ma,t),this.addEditToolbar()}getUuid(){return l(this,ma)}get description(){return l(this,Gn)}set description(t){v(this,Gn,t),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(t)})}getSignaturePreview(){const{newCurves:t,areContours:s,thickness:r,width:i,height:a}=l(this,ga),o=Math.max(i,a),c=_r.processDrawnLines({lines:{curves:t.map(u=>({points:u})),thickness:r,width:i,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:c.outline}}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.signatureManager&&l(this,Gn)!==null&&(await t.addEditSignatureButton(this._uiManager.signatureManager,l(this,ma),l(this,Gn)),t.show()),t):null}addSignature(t,s,r,i){const{x:a,y:o}=this,{outline:c}=v(this,ga,t);v(this,pa,c instanceof M0),v(this,Gn,r),this.div.setAttribute("data-l10n-args",JSON.stringify({description:r}));let u;l(this,pa)?u=Mn.getDefaultDrawingOptions():(u=Mn._defaultDrawnSignatureOptions.clone(),u.updateProperties({"stroke-width":c.thickness})),this._addOutlines({drawOutlines:c,drawingOptions:u});const[d,h]=this.parentDimensions,[,f]=this.pageDimensions;let g=s/f;g=g>=1?.5:g,this.width*=g/this.height,this.width>=1&&(g*=.9/this.width,this.width=.9),this.height=g,this.setDims(d*this.width,h*this.height),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!r}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:s,pageHeight:r},rotation:i}=this.parent.viewport;return _r.process(t,s,r,i,Mn._INNER_MARGIN)}getFromText(t,s){const{rawDims:{pageWidth:r,pageHeight:i},rotation:a}=this.parent.viewport;return _r.extractContoursFromText(t,s,r,i,a,Mn._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:s,pageHeight:r},rotation:i}=this.parent.viewport;return _r.processDrawnLines({lines:t,pageWidth:s,pageHeight:r,rotation:i,innerMargin:Mn._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:s}){t?this._drawingOptions=Mn.getDefaultDrawingOptions():(this._drawingOptions=Mn._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:s,points:r,rect:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":a}}=this,o={annotationType:ie.SIGNATURE,isSignature:!0,areContours:l(this,pa),color:[0,0,0],thickness:l(this,pa)?0:a,pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(o.paths={lines:s,points:r},o.uuid=l(this,ma),o.isCopy=!0):o.lines=s,l(this,Gn)&&(o.accessibilityData={type:"Figure",alt:l(this,Gn)}),o}static deserializeDraw(t,s,r,i,a,o){return o.areContours?M0.deserialize(t,s,r,i,a,o):Uf.deserialize(t,s,r,i,a,o)}static async deserialize(t,s,r){var a;const i=await super.deserialize(t,s,r);return v(i,pa,t.areContours),v(i,Gn,((a=t.accessibilityData)==null?void 0:a.alt)||""),v(i,ma,t.uuid),i}};pa=new WeakMap,Gn=new WeakMap,ga=new WeakMap,ma=new WeakMap,$(Mn,"_type","signature"),$(Mn,"_editorType",ie.SIGNATURE),$(Mn,"_defaultDrawingOptions",null);let F0=Mn;var Be,_t,ya,ui,va,lu,di,rl,xr,Wn,cu,Se,dd,hd,eg,tg,ng,z0,sg,AC;class $0 extends Ie{constructor(t){super({...t,name:"stampEditor"});A(this,Se);A(this,Be,null);A(this,_t,null);A(this,ya,null);A(this,ui,null);A(this,va,null);A(this,lu,"");A(this,di,null);A(this,rl,!1);A(this,xr,null);A(this,Wn,!1);A(this,cu,!1);v(this,ui,t.bitmapUrl),v(this,va,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,s){Ie.initialize(t,s)}static isHandlingMimeForPasting(t){return Dg.includes(t)}static paste(t,s){s.pasteEditor({mode:ie.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!await r.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,c=await r.guess({name:"altText",request:{data:i,width:a,height:o,channels:i.length/(a*o)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const u=c.output;return await this.setGuessedAltText(u),s&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}remove(){var t;l(this,_t)&&(v(this,Be,null),this._uiManager.imageManager.deleteId(l(this,_t)),(t=l(this,di))==null||t.remove(),v(this,di,null),l(this,xr)&&(clearTimeout(l(this,xr)),v(this,xr,null))),super.remove()}rebuild(){if(!this.parent){l(this,_t)&&_(this,Se,eg).call(this);return}super.rebuild(),this.div!==null&&(l(this,_t)&&l(this,di)===null&&_(this,Se,eg).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(l(this,ya)||l(this,Be)||l(this,ui)||l(this,va)||l(this,_t)||l(this,rl))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;return this._isCopy&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),l(this,rl)||(l(this,Be)?_(this,Se,tg).call(this):_(this,Se,eg).call(this)),this._isCopy&&this._moveAfterPaste(t,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,s){const{id:r,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,s);s.remove(),r&&this._uiManager.imageManager.isValidId(r)&&(v(this,_t,r),i&&v(this,Be,i),v(this,rl,!1),_(this,Se,tg).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;l(this,xr)!==null&&clearTimeout(l(this,xr)),v(this,xr,setTimeout(()=>{v(this,xr,null),_(this,Se,z0).call(this)},200))}copyCanvas(t,s,r=!1){var g;t||(t=224);const{width:i,height:a}=l(this,Be),o=new Ys;let c=l(this,Be),u=i,d=a,h=null;if(s){if(i>s||a>s){const R=Math.min(s/i,s/a);u=Math.floor(i*R),d=Math.floor(a*R)}h=document.createElement("canvas");const y=h.width=Math.ceil(u*o.sx),m=h.height=Math.ceil(d*o.sy);l(this,Wn)||(c=_(this,Se,ng).call(this,y,m));const b=h.getContext("2d");b.filter=this._uiManager.hcmFilter;let w="white",x="#cfcfd8";this._uiManager.hcmFilter!=="none"?x="black":(g=window.matchMedia)!=null&&g.call(window,"(prefers-color-scheme: dark)").matches&&(w="#8f8f9d",x="#42414d");const S=15,E=S*o.sx,C=S*o.sy,N=new OffscreenCanvas(E*2,C*2),k=N.getContext("2d");k.fillStyle=w,k.fillRect(0,0,E*2,C*2),k.fillStyle=x,k.fillRect(0,0,E,C),k.fillRect(E,C,E,C),b.fillStyle=b.createPattern(N,"repeat"),b.fillRect(0,0,y,m),b.drawImage(c,0,0,c.width,c.height,0,0,y,m)}let f=null;if(r){let y,m;if(o.symmetric&&c.width<t&&c.height<t)y=c.width,m=c.height;else if(c=l(this,Be),i>t||a>t){const x=Math.min(t/i,t/a);y=Math.floor(i*x),m=Math.floor(a*x),l(this,Wn)||(c=_(this,Se,ng).call(this,y,m))}const w=new OffscreenCanvas(y,m).getContext("2d",{willReadFrequently:!0});w.drawImage(c,0,0,c.width,c.height,0,0,y,m),f={width:y,height:m,data:w.getImageData(0,0,y,m).data}}return{canvas:h,width:u,height:d,imageData:f}}static async deserialize(t,s,r){var b;let i=null,a=!1;if(t instanceof FE){const{data:{rect:w,rotation:x,id:S,structParent:E,popupRef:C},container:N,parent:{page:{pageNumber:k}},canvas:R}=t;let P,L;R?(delete t.canvas,{id:P,bitmap:L}=r.imageManager.getFromCanvas(N.id,R),R.remove()):(a=!0,t._hasNoCanvas=!0);const M=((b=await s._structTree.getAriaAttributes(`${ex}${S}`))==null?void 0:b.get("aria-label"))||"";i=t={annotationType:ie.STAMP,bitmapId:P,bitmap:L,pageIndex:k-1,rect:w.slice(0),rotation:x,id:S,deleted:!1,accessibilityData:{decorative:!1,altText:M},isSvg:!1,structParent:E,popupRef:C}}const o=await super.deserialize(t,s,r),{rect:c,bitmap:u,bitmapUrl:d,bitmapId:h,isSvg:f,accessibilityData:g}=t;a?(r.addMissingCanvas(t.id,o),v(o,rl,!0)):h&&r.imageManager.isValidId(h)?(v(o,_t,h),u&&v(o,Be,u)):v(o,ui,d),v(o,Wn,f);const[y,m]=o.pageDimensions;return o.width=(c[2]-c[0])/y,o.height=(c[3]-c[1])/m,o.annotationElementId=t.id||null,g&&(o.altTextData=g),o._initialData=i,v(o,cu,!!i),o}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r={annotationType:ie.STAMP,bitmapId:l(this,_t),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:l(this,Wn),structTreeParentId:this._structTreeParentId};if(t)return r.bitmapUrl=_(this,Se,sg).call(this,!0),r.accessibilityData=this.serializeAltText(!0),r.isCopy=!0,r;const{decorative:i,altText:a}=this.serializeAltText(!1);if(!i&&a&&(r.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const c=_(this,Se,AC).call(this,r);if(c.isSame)return null;c.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1}if(r.id=this.annotationElementId,s===null)return r;s.stamps||(s.stamps=new Map);const o=l(this,Wn)?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!s.stamps.has(l(this,_t)))s.stamps.set(l(this,_t),{area:o,serialized:r}),r.bitmap=_(this,Se,sg).call(this,!1);else if(l(this,Wn)){const c=s.stamps.get(l(this,_t));o>c.area&&(c.area=o,c.serialized.bitmap.close(),c.serialized.bitmap=_(this,Se,sg).call(this,!1))}return r}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}Be=new WeakMap,_t=new WeakMap,ya=new WeakMap,ui=new WeakMap,va=new WeakMap,lu=new WeakMap,di=new WeakMap,rl=new WeakMap,xr=new WeakMap,Wn=new WeakMap,cu=new WeakMap,Se=new WeakSet,dd=function(t,s=!1){if(!t){this.remove();return}v(this,Be,t.bitmap),s||(v(this,_t,t.id),v(this,Wn,t.isSvg)),t.file&&v(this,lu,t.file.name),_(this,Se,tg).call(this)},hd=function(){if(v(this,ya,null),this._uiManager.enableWaiting(!1),!!l(this,di)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,Be)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,Be)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},eg=function(){if(l(this,_t)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(l(this,_t)).then(r=>_(this,Se,dd).call(this,r,!0)).finally(()=>_(this,Se,hd).call(this));return}if(l(this,ui)){const r=l(this,ui);v(this,ui,null),this._uiManager.enableWaiting(!0),v(this,ya,this._uiManager.imageManager.getFromUrl(r).then(i=>_(this,Se,dd).call(this,i)).finally(()=>_(this,Se,hd).call(this)));return}if(l(this,va)){const r=l(this,va);v(this,va,null),this._uiManager.enableWaiting(!0),v(this,ya,this._uiManager.imageManager.getFromFile(r).then(i=>_(this,Se,dd).call(this,i)).finally(()=>_(this,Se,hd).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=Dg.join(",");const s=this._uiManager._signal;v(this,ya,new Promise(r=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),_(this,Se,dd).call(this,i)}r()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),r()},{signal:s})}).finally(()=>_(this,Se,hd).call(this))),t.click()},tg=function(){var h;const{div:t}=this;let{width:s,height:r}=l(this,Be);const[i,a]=this.pageDimensions,o=.75;if(this.width)s=this.width*i,r=this.height*a;else if(s>o*i||r>o*a){const f=Math.min(o*i/s,o*a/r);s*=f,r*=f}const[c,u]=this.parentDimensions;this.setDims(s*c/i,r*u/a),this._uiManager.enableWaiting(!1);const d=v(this,di,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=s/i,this.height=r/a,(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),_(this,Se,z0).call(this),l(this,cu)||(this.parent.addUndoableEditor(this),v(this,cu,!0)),this._reportTelemetry({action:"inserted_image"}),l(this,lu)&&this.div.setAttribute("aria-description",l(this,lu))},ng=function(t,s){const{width:r,height:i}=l(this,Be);let a=r,o=i,c=l(this,Be);for(;a>2*t||o>2*s;){const u=a,d=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const h=new OffscreenCanvas(a,o);h.getContext("2d").drawImage(c,0,0,u,d,0,0,a,o),c=h.transferToImageBitmap()}return c},z0=function(){const[t,s]=this.parentDimensions,{width:r,height:i}=this,a=new Ys,o=Math.ceil(r*t*a.sx),c=Math.ceil(i*s*a.sy),u=l(this,di);if(!u||u.width===o&&u.height===c)return;u.width=o,u.height=c;const d=l(this,Wn)?l(this,Be):_(this,Se,ng).call(this,o,c),h=u.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(d,0,0,d.width,d.height,0,0,o,c)},sg=function(t){if(t){if(l(this,Wn)){const i=this._uiManager.imageManager.getSvgUrl(l(this,_t));if(i)return i}const s=document.createElement("canvas");return{width:s.width,height:s.height}=l(this,Be),s.getContext("2d").drawImage(l(this,Be),0,0),s.toDataURL()}if(l(this,Wn)){const[s,r]=this.pageDimensions,i=Math.round(this.width*s*Ei.PDF_TO_CSS_UNITS),a=Math.round(this.height*r*Ei.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(i,a);return o.getContext("2d").drawImage(l(this,Be),0,0,l(this,Be).width,l(this,Be).height,0,0,i,a),o.transferToImageBitmap()}return structuredClone(l(this,Be))},AC=function(t){var o;const{pageIndex:s,accessibilityData:{altText:r}}=this._initialData,i=t.pageIndex===s,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===r;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&a,isSameAltText:a}},$($0,"_type","stamp"),$($0,"_editorType",ie.STAMP);var il,uu,br,wa,hi,hs,xa,du,al,zs,fi,Kt,pi,Z,ba,Ue,_C,rr,B0,U0,rg;const ks=class ks{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:r,accessibilityManager:i,annotationLayer:a,drawLayer:o,textLayer:c,viewport:u,l10n:d}){A(this,Ue);A(this,il);A(this,uu,!1);A(this,br,null);A(this,wa,null);A(this,hi,null);A(this,hs,new Map);A(this,xa,!1);A(this,du,!1);A(this,al,!1);A(this,zs,null);A(this,fi,null);A(this,Kt,null);A(this,pi,null);A(this,Z);const h=[...l(ks,ba).values()];if(!ks._initialized){ks._initialized=!0;for(const f of h)f.initialize(d,e)}e.registerEditorTypes(h),v(this,Z,e),this.pageIndex=t,this.div=s,v(this,il,i),v(this,br,a),this.viewport=u,v(this,Kt,c),this.drawLayer=o,this._structTree=r,l(this,Z).addLayer(this)}get isEmpty(){return l(this,hs).size===0}get isInvisible(){return this.isEmpty&&l(this,Z).getMode()===ie.NONE}updateToolbar(e){l(this,Z).updateToolbar(e)}updateMode(e=l(this,Z).getMode()){switch(_(this,Ue,rg).call(this),e){case ie.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ie.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case ie.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const s of l(ks,ba).values())t.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=l(this,Kt))==null?void 0:t.div)}setEditingState(e){l(this,Z).setEditingState(e)}addCommands(e){l(this,Z).addCommands(e)}cleanUndoStack(e){l(this,Z).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=l(this,br))==null||t.div.classList.toggle("disabled",!e)}async enable(){v(this,al,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const s of l(this,hs).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(l(this,Z).removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!l(this,br)){v(this,al,!1);return}const t=l(this,br).getEditableAnnotations();for(const s of t){if(s.hide(),l(this,Z).isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const r=await this.deserialize(s);r&&(this.addOrRebuild(r),r.enableEditing())}v(this,al,!1)}disable(){var r;v(this,du,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const i of l(this,hs).values())if(i.disableEditing(),!!i.annotationElementId){if(i.serialize()!==null){e.set(i.annotationElementId,i);continue}else t.set(i.annotationElementId,i);(r=this.getEditableAnnotation(i.annotationElementId))==null||r.show(),i.remove()}if(l(this,br)){const i=l(this,br).getEditableAnnotations();for(const a of i){const{id:o}=a.data;if(l(this,Z).isDeletedAnnotationElement(o))continue;let c=t.get(o);if(c){c.resetAnnotationElement(a),c.show(!1),a.show();continue}c=e.get(o),c&&(l(this,Z).addChangedExistingAnnotation(c),c.renderAnnotationElement(a)&&c.show(!1)),a.show()}}_(this,Ue,rg).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const i of l(ks,ba).values())s.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),v(this,du,!1)}getEditableAnnotation(e){var t;return((t=l(this,br))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){l(this,Z).getActive()!==e&&l(this,Z).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=l(this,Kt))!=null&&e.div&&!l(this,pi)){v(this,pi,new AbortController);const t=l(this,Z).combinedSignal(l(this,pi));l(this,Kt).div.addEventListener("pointerdown",_(this,Ue,_C).bind(this),{signal:t}),l(this,Kt).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=l(this,Kt))!=null&&e.div&&l(this,pi)&&(l(this,pi).abort(),v(this,pi,null),l(this,Kt).div.classList.remove("highlighting"))}enableClick(){if(l(this,wa))return;v(this,wa,new AbortController);const e=l(this,Z).combinedSignal(l(this,wa));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=l(this,wa))==null||e.abort(),v(this,wa,null)}attach(e){l(this,hs).set(e.id,e);const{annotationElementId:t}=e;t&&l(this,Z).isDeletedAnnotationElement(t)&&l(this,Z).removeDeletedAnnotationElement(e)}detach(e){var t;l(this,hs).delete(e.id),(t=l(this,il))==null||t.removePointerInTextLayer(e.contentDiv),!l(this,du)&&e.annotationElementId&&l(this,Z).addDeletedAnnotationElement(e)}remove(e){this.detach(e),l(this,Z).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(l(this,Z).addDeletedAnnotationElement(e.annotationElementId),Ie.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),l(this,Z).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!l(this,al)),l(this,Z).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!l(this,hi)&&(e._focusEventsAllowed=!1,v(this,hi,setTimeout(()=>{v(this,hi,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:l(this,Z)._signal}),t.focus())},0))),e._structTreeParentId=(s=l(this,il))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getNextId(){return l(this,Z).getId()}combinedSignal(e){return l(this,Z).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=l(this,Ue,rr))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await l(this,Z).updateMode(e.mode);const{offsetX:s,offsetY:r}=_(this,Ue,U0).call(this),i=this.getNextId(),a=_(this,Ue,B0).call(this,{parent:this,id:i,x:s,y:r,uiManager:l(this,Z),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=l(ks,ba).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,l(this,Z)))||null}createAndAddNewEditor(e,t,s={}){const r=this.getNextId(),i=_(this,Ue,B0).call(this,{parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:l(this,Z),isCentered:t,...s});return i&&this.add(i),i}addNewEditor(e={}){this.createAndAddNewEditor(_(this,Ue,U0).call(this),!0,e)}setSelected(e){l(this,Z).setSelected(e)}toggleSelected(e){l(this,Z).toggleSelected(e)}unselect(e){l(this,Z).unselect(e)}pointerup(e){var r;const{isMac:t}=Nt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!l(this,xa)||(v(this,xa,!1),(r=l(this,Ue,rr))!=null&&r.isDrawer&&l(this,Ue,rr).supportMultipleDrawings))return;if(!l(this,uu)){v(this,uu,!0);return}const s=l(this,Z).getMode();if(s===ie.STAMP||s===ie.SIGNATURE){l(this,Z).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var r;if(l(this,Z).getMode()===ie.HIGHLIGHT&&this.enableTextSelection(),l(this,xa)){v(this,xa,!1);return}const{isMac:t}=Nt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(v(this,xa,!0),(r=l(this,Ue,rr))!=null&&r.isDrawer){this.startDrawingSession(e);return}const s=l(this,Z).getActive();v(this,uu,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),l(this,zs)){l(this,Ue,rr).startDrawing(this,l(this,Z),!1,e);return}l(this,Z).setCurrentDrawingSession(this),v(this,zs,new AbortController);const t=l(this,Z).combinedSignal(l(this,zs));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(v(this,fi,null),this.commitOrRemove())},{signal:t}),l(this,Ue,rr).startDrawing(this,l(this,Z),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&v(this,fi,t);return}l(this,fi)&&setTimeout(()=>{var t;(t=l(this,fi))==null||t.focus(),v(this,fi,null)},0)}endDrawingSession(e=!1){return l(this,zs)?(l(this,Z).setCurrentDrawingSession(null),l(this,zs).abort(),v(this,zs,null),v(this,fi,null),l(this,Ue,rr).endDrawing(e)):null}findNewParent(e,t,s){const r=l(this,Z).findParent(t,s);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return l(this,zs)?(this.endDrawingSession(),!0):!1}onScaleChanging(){l(this,zs)&&l(this,Ue,rr).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=l(this,Z).getActive())==null?void 0:e.parent)===this&&(l(this,Z).commitOrRemove(),l(this,Z).setActiveEditor(null)),l(this,hi)&&(clearTimeout(l(this,hi)),v(this,hi,null));for(const s of l(this,hs).values())(t=l(this,il))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,l(this,hs).clear(),l(this,Z).removeLayer(this)}render({viewport:e}){this.viewport=e,Da(this.div,e);for(const t of l(this,Z).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){l(this,Z).commitOrRemove(),_(this,Ue,rg).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Da(this.div,{rotation:s}),t!==s)for(const r of l(this,hs).values())r.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return l(this,Z).viewParameters.realScale}};il=new WeakMap,uu=new WeakMap,br=new WeakMap,wa=new WeakMap,hi=new WeakMap,hs=new WeakMap,xa=new WeakMap,du=new WeakMap,al=new WeakMap,zs=new WeakMap,fi=new WeakMap,Kt=new WeakMap,pi=new WeakMap,Z=new WeakMap,ba=new WeakMap,Ue=new WeakSet,_C=function(e){l(this,Z).unselectAll();const{target:t}=e;if(t===l(this,Kt).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&l(this,Kt).div.contains(t)){const{isMac:s}=Nt.platform;if(e.button!==0||e.ctrlKey&&s)return;l(this,Z).showAllEditors("highlight",!0,!0),l(this,Kt).div.classList.add("free"),this.toggleDrawing(),Fg.startHighlighting(this,l(this,Z).direction==="ltr",{target:l(this,Kt).div,x:e.x,y:e.y}),l(this,Kt).div.addEventListener("pointerup",()=>{l(this,Kt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:l(this,Z)._signal}),e.preventDefault()}},rr=function(){return l(ks,ba).get(l(this,Z).getMode())},B0=function(e){const t=l(this,Ue,rr);return t?new t.prototype.constructor(e):null},U0=function(){const{x:e,y:t,width:s,height:r}=this.div.getBoundingClientRect(),i=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+s),c=Math.min(window.innerHeight,t+r),u=(i+o)/2-e,d=(a+c)/2-t,[h,f]=this.viewport.rotation%180===0?[u,d]:[d,u];return{offsetX:h,offsetY:f}},rg=function(){for(const e of l(this,hs).values())e.isEmpty()&&e.remove()},$(ks,"_initialized",!1),A(ks,ba,new Map([w0,L0,$0,Fg,F0].map(e=>[e._editorType,e])));let zg=ks;var Bs,on,ol,Cf,am,EC,Nr,H0,CC,V0;const ut=class ut{constructor({pageIndex:e}){A(this,Nr);A(this,Bs,null);A(this,on,new Map);A(this,ol,new Map);this.pageIndex=e}setParent(e){if(!l(this,Bs)){v(this,Bs,e);return}if(l(this,Bs)!==e){if(l(this,on).size>0)for(const t of l(this,on).values())t.remove(),e.append(t);v(this,Bs,e)}}static get _svgFactory(){return pe(this,"_svgFactory",new Qd)}draw(e,t=!1,s=!1){const r=tn(ut,Cf)._++,i=_(this,Nr,H0).call(this),a=ut._svgFactory.createElement("defs");i.append(a);const o=ut._svgFactory.createElement("path");a.append(o);const c=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",c),o.setAttribute("vector-effect","non-scaling-stroke"),t&&l(this,ol).set(r,o);const u=s?_(this,Nr,CC).call(this,a,c):null,d=ut._svgFactory.createElement("use");return i.append(d),d.setAttribute("href",`#${c}`),this.updateProperties(i,e),l(this,on).set(r,i),{id:r,clipPathId:`url(#${u})`}}drawOutline(e,t){const s=tn(ut,Cf)._++,r=_(this,Nr,H0).call(this),i=ut._svgFactory.createElement("defs");r.append(i);const a=ut._svgFactory.createElement("path");i.append(a);const o=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let c;if(t){const h=ut._svgFactory.createElement("mask");i.append(h),c=`mask_p${this.pageIndex}_${s}`,h.setAttribute("id",c),h.setAttribute("maskUnits","objectBoundingBox");const f=ut._svgFactory.createElement("rect");h.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const g=ut._svgFactory.createElement("use");h.append(g),g.setAttribute("href",`#${o}`),g.setAttribute("stroke","none"),g.setAttribute("fill","black"),g.setAttribute("fill-rule","nonzero"),g.classList.add("mask")}const u=ut._svgFactory.createElement("use");r.append(u),u.setAttribute("href",`#${o}`),c&&u.setAttribute("mask",`url(#${c})`);const d=u.cloneNode();return r.append(d),u.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(r,e),l(this,on).set(s,r),s}finalizeDraw(e,t){l(this,ol).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var c;if(!t)return;const{root:s,bbox:r,rootClass:i,path:a}=t,o=typeof e=="number"?l(this,on).get(e):e;if(o){if(s&&_(this,Nr,V0).call(this,o,s),r&&_(c=ut,am,EC).call(c,o,r),i){const{classList:u}=o;for(const[d,h]of Object.entries(i))u.toggle(d,h)}if(a){const d=o.firstChild.firstChild;_(this,Nr,V0).call(this,d,a)}}}updateParent(e,t){if(t===this)return;const s=l(this,on).get(e);s&&(l(t,Bs).append(s),l(this,on).delete(e),l(t,on).set(e,s))}remove(e){l(this,ol).delete(e),l(this,Bs)!==null&&(l(this,on).get(e).remove(),l(this,on).delete(e))}destroy(){v(this,Bs,null);for(const e of l(this,on).values())e.remove();l(this,on).clear(),l(this,ol).clear()}};Bs=new WeakMap,on=new WeakMap,ol=new WeakMap,Cf=new WeakMap,am=new WeakSet,EC=function(e,[t,s,r,i]){const{style:a}=e;a.top=`${100*s}%`,a.left=`${100*t}%`,a.width=`${100*r}%`,a.height=`${100*i}%`},Nr=new WeakSet,H0=function(){const e=ut._svgFactory.create(1,1,!0);return l(this,Bs).append(e),e.setAttribute("aria-hidden",!0),e},CC=function(e,t){const s=ut._svgFactory.createElement("clipPath");e.append(s);const r=`clip_${t}`;s.setAttribute("id",r),s.setAttribute("clipPathUnits","objectBoundingBox");const i=ut._svgFactory.createElement("use");return s.append(i),i.setAttribute("href",`#${t}`),i.classList.add("clip"),r},V0=function(e,t){for(const[s,r]of Object.entries(t))r===null?e.removeAttribute(s):e.setAttribute(s,r)},A(ut,am),A(ut,Cf,0);let Bg=ut;globalThis._pdfjsTestingUtils={HighlightOutliner:b0};globalThis.pdfjsLib={AbortException:_i,AnnotationEditorLayer:zg,AnnotationEditorParamsType:ye,AnnotationEditorType:ie,AnnotationEditorUIManager:Ia,AnnotationLayer:cx,AnnotationMode:Ar,AnnotationType:Ze,build:CE,ColorPicker:Jd,createValidAbsoluteUrl:Qw,DOMSVGFactory:Qd,DrawLayer:Bg,FeatureTest:Nt,fetchData:ku,getDocument:ix,getFilenameFromUrl:w_,getPdfFilenameFromUrl:x_,getUuid:Zw,getXfaPageViewport:b_,GlobalWorkerOptions:ms,ImageKind:Ed,InvalidPDFException:jg,isDataScheme:Ff,isPdfFile:Lm,isValidExplicitDest:nE,MathClamp:Qt,noContextMenu:As,normalizeUnicode:y_,OPS:Wd,OutputScale:Ys,PasswordResponses:g_,PDFDataRangeTransport:ax,PDFDateString:Mm,PDFWorker:xu,PermissionFlag:p_,PixelsPerInch:Ei,RenderingCancelledException:Rm,ResponseException:qd,setLayerDimensions:Da,shadow:pe,SignatureExtractor:_r,stopEvent:nt,SupportedImageMimeTypes:Dg,TextLayer:Yd,TouchManager:Xd,updateUrlHash:Jw,Util:te,VerbosityLevel:Df,version:EE,XfaLayer:ox};const OM=Object.freeze(Object.defineProperty({__proto__:null,AbortException:_i,AnnotationEditorLayer:zg,AnnotationEditorParamsType:ye,AnnotationEditorType:ie,AnnotationEditorUIManager:Ia,AnnotationLayer:cx,AnnotationMode:Ar,AnnotationType:Ze,ColorPicker:Jd,DOMSVGFactory:Qd,DrawLayer:Bg,FeatureTest:Nt,GlobalWorkerOptions:ms,ImageKind:Ed,InvalidPDFException:jg,MathClamp:Qt,OPS:Wd,OutputScale:Ys,PDFDataRangeTransport:ax,PDFDateString:Mm,PDFWorker:xu,PasswordResponses:g_,PermissionFlag:p_,PixelsPerInch:Ei,RenderingCancelledException:Rm,ResponseException:qd,SignatureExtractor:_r,SupportedImageMimeTypes:Dg,TextLayer:Yd,TouchManager:Xd,Util:te,VerbosityLevel:Df,XfaLayer:ox,build:CE,createValidAbsoluteUrl:Qw,fetchData:ku,getDocument:ix,getFilenameFromUrl:w_,getPdfFilenameFromUrl:x_,getUuid:Zw,getXfaPageViewport:b_,isDataScheme:Ff,isPdfFile:Lm,isValidExplicitDest:nE,noContextMenu:As,normalizeUnicode:y_,setLayerDimensions:Da,shadow:pe,stopEvent:nt,updateUrlHash:Jw,version:EE},Symbol.toStringTag,{value:"Module"})),FM=["onCopy","onCut","onPaste"],$M=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],zM=["onFocus","onBlur"],BM=["onInput","onInvalid","onReset","onSubmit"],UM=["onLoad","onError"],HM=["onKeyDown","onKeyPress","onKeyUp"],VM=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],GM=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],WM=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],qM=["onSelect"],XM=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],YM=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],KM=["onScroll"],QM=["onWheel"],JM=["onAnimationStart","onAnimationEnd","onAnimationIteration"],ZM=["onTransitionEnd"],ej=["onToggle"],tj=["onChange"],nj=[...FM,...$M,...zM,...BM,...UM,...HM,...VM,...GM,...WM,...qM,...XM,...YM,...KM,...QM,...JM,...ZM,...tj,...ej];function kC(n,e){const t={};for(const s of nj){const r=n[s];r&&(e?t[s]=i=>r(i,e(s)):t[s]=r)}return t}function Hf(n){let e=!1;return{promise:new Promise((s,r)=>{n.then(i=>!e&&s(i)).catch(i=>!e&&r(i))}),cancel(){e=!0}}}var sj="Invariant failed";function Me(n,e){if(!n)throw new Error(sj)}var rj=function(){},ij=rj;const Zt=q0(ij);var g1=Object.prototype.hasOwnProperty;function m1(n,e,t){for(t of n.keys())if(sc(t,e))return t}function sc(n,e){var t,s,r;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((s=n.length)===e.length)for(;s--&&sc(n[s],e[s]););return s===-1}if(t===Set){if(n.size!==e.size)return!1;for(s of n)if(r=s,r&&typeof r=="object"&&(r=m1(e,r),!r)||!e.has(r))return!1;return!0}if(t===Map){if(n.size!==e.size)return!1;for(s of n)if(r=s[0],r&&typeof r=="object"&&(r=m1(e,r),!r)||!sc(s[1],e.get(r)))return!1;return!0}if(t===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(t===DataView){if((s=n.byteLength)===e.byteLength)for(;s--&&n.getInt8(s)===e.getInt8(s););return s===-1}if(ArrayBuffer.isView(n)){if((s=n.byteLength)===e.byteLength)for(;s--&&n[s]===e[s];);return s===-1}if(!t||typeof n=="object"){s=0;for(t in n)if(g1.call(n,t)&&++s&&!g1.call(e,t)||!(t in e)||!sc(n[t],e[t]))return!1;return Object.keys(e).length===s}}return n!==n&&e!==e}const NC=T.createContext(null);function rc({children:n,type:e}){return p.jsx("div",{className:`react-pdf__message react-pdf__message--${e}`,children:n})}const aj="noopener noreferrer nofollow";class oj{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(e){this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setExternalLinkRel(e){this.externalLinkRel=e}setExternalLinkTarget(e){this.externalLinkTarget=e}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return Me(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(e){Me(this.pdfViewer),this.pdfViewer.currentPageNumber=e}get rotation(){return 0}set rotation(e){}goToDestination(e){return new Promise(t=>{Me(this.pdfDocument),Me(e),typeof e=="string"?this.pdfDocument.getDestination(e).then(t):Array.isArray(e)?t(e):e.then(t)}).then(t=>{Me(Array.isArray(t));const s=t[0];new Promise(r=>{Me(this.pdfDocument),s instanceof Object?this.pdfDocument.getPageIndex(s).then(i=>{r(i)}).catch(()=>{Me(!1)}):typeof s=="number"?r(s):Me(!1)}).then(r=>{const i=r+1;Me(this.pdfViewer),Me(i>=1&&i<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:t,pageIndex:r,pageNumber:i})})})}navigateTo(e){this.goToDestination(e)}goToPage(e){const t=e-1;Me(this.pdfViewer),Me(e>=1&&e<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:t,pageNumber:e})}addLinkAttributes(e,t,s){e.href=t,e.rel=this.externalLinkRel||aj,e.target=s?"_blank":this.externalLinkTarget||""}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}setHash(){}executeNamedAction(){}cachePageRef(){}isPageVisible(){return!0}isPageCached(){return!0}executeSetOCGState(){}}const y1={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},Im=typeof window<"u",TC=Im&&window.location.protocol==="file:";function lj(n){return typeof n<"u"}function Va(n){return lj(n)&&n!==null}function cj(n){return typeof n=="string"}function uj(n){return n instanceof ArrayBuffer}function dj(n){return Me(Im),n instanceof Blob}function G0(n){return cj(n)&&/^data:/.test(n)}function v1(n){Me(G0(n));const[e="",t=""]=n.split(",");return e.split(";").indexOf("base64")!==-1?atob(t):unescape(t)}function hj(){return Im&&window.devicePixelRatio||1}const PC="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function w1(){Zt(!TC,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${PC}`)}function fj(){Zt(!TC,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${PC}`)}function ml(n){n!=null&&n.cancel&&n.cancel()}function W0(n,e){return Object.defineProperty(n,"width",{get(){return this.view[2]*e},configurable:!0}),Object.defineProperty(n,"height",{get(){return this.view[3]*e},configurable:!0}),Object.defineProperty(n,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(n,"originalHeight",{get(){return this.view[3]},configurable:!0}),n}function pj(n){return n.name==="RenderingCancelledException"}function gj(n){return new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{if(!s.result)return t(new Error("Error while reading a file."));e(s.result)},s.onerror=r=>{if(!r.target)return t(new Error("Error while reading a file."));const{error:i}=r.target;if(!i)return t(new Error("Error while reading a file."));switch(i.code){case i.NOT_FOUND_ERR:return t(new Error("Error while reading a file: File not found."));case i.SECURITY_ERR:return t(new Error("Error while reading a file: Security error."));case i.ABORT_ERR:return t(new Error("Error while reading a file: Aborted."));default:return t(new Error("Error while reading a file."))}},s.readAsArrayBuffer(n)})}function mj(n,e){switch(e.type){case"RESOLVE":return{value:e.value,error:void 0};case"REJECT":return{value:!1,error:e.error};case"RESET":return{value:void 0,error:void 0};default:return n}}function bu(){return T.useReducer(mj,{value:void 0,error:void 0})}var x1=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};const{PDFDataRangeTransport:yj}=OM,vj=(n,e)=>{switch(e){case y1.NEED_PASSWORD:{const t=prompt("Enter the password to open this PDF file.");n(t);break}case y1.INCORRECT_PASSWORD:{const t=prompt("Invalid password. Please try again.");n(t);break}}};function b1(n){return typeof n=="object"&&n!==null&&("data"in n||"range"in n||"url"in n)}const wj=T.forwardRef(function(e,t){var{children:s,className:r,error:i="Failed to load PDF file.",externalLinkRel:a,externalLinkTarget:o,file:c,inputRef:u,imageResourcesPath:d,loading:h="Loading PDF…",noData:f="No PDF file specified.",onItemClick:g,onLoadError:y,onLoadProgress:m,onLoadSuccess:b,onPassword:w=vj,onSourceError:x,onSourceSuccess:S,options:E,renderMode:C,rotate:N,scale:k}=e,R=x1(e,["children","className","error","externalLinkRel","externalLinkTarget","file","inputRef","imageResourcesPath","loading","noData","onItemClick","onLoadError","onLoadProgress","onLoadSuccess","onPassword","onSourceError","onSourceSuccess","options","renderMode","rotate","scale"]);const[P,L]=bu(),{value:M,error:I}=P,[U,B]=bu(),{value:K,error:j}=U,D=T.useRef(new oj),O=T.useRef([]),G=T.useRef(void 0),Q=T.useRef(void 0);c&&c!==G.current&&b1(c)&&(Zt(!sc(c,G.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),G.current=c),E&&E!==Q.current&&(Zt(!sc(E,Q.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),Q.current=E);const H=T.useRef({scrollPageIntoView:ve=>{const{dest:Ve,pageNumber:ke,pageIndex:_s=ke-1}=ve;if(g){g({dest:Ve,pageIndex:_s,pageNumber:ke});return}const Tr=O.current[_s];if(Tr){Tr.scrollIntoView();return}Zt(!1,`An internal link leading to page ${ke} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});T.useImperativeHandle(t,()=>({linkService:D,pages:O,viewer:H}),[]);function J(){S&&S()}function ne(){I&&(Zt(!1,I.toString()),x&&x(I))}function he(){L({type:"RESET"})}T.useEffect(he,[c,L]);const re=T.useCallback(async()=>{if(!c)return null;if(typeof c=="string")return G0(c)?{data:v1(c)}:(w1(),{url:c});if(c instanceof yj)return{range:c};if(uj(c))return{data:c};if(Im&&dj(c))return{data:await gj(c)};if(Me(typeof c=="object"),Me(b1(c)),"url"in c&&typeof c.url=="string"){if(G0(c.url)){const{url:ve}=c,Ve=x1(c,["url"]),ke=v1(ve);return Object.assign({data:ke},Ve)}w1()}return c},[c]);T.useEffect(()=>{const ve=Hf(re());return ve.promise.then(Ve=>{L({type:"RESOLVE",value:Ve})}).catch(Ve=>{L({type:"REJECT",error:Ve})}),()=>{ml(ve)}},[re,L]),T.useEffect(()=>{if(!(typeof M>"u")){if(M===!1){ne();return}J()}},[M]);function oe(){K&&(b&&b(K),O.current=new Array(K.numPages),D.current.setDocument(K))}function fe(){j&&(Zt(!1,j.toString()),y&&y(j))}T.useEffect(function(){B({type:"RESET"})},[B,M]),T.useEffect(function(){if(!M)return;const Ve=E?Object.assign(Object.assign({},M),E):M,ke=ix(Ve);m&&(ke.onProgress=m),w&&(ke.onPassword=w);const _s=ke,Tr=_s.promise.then(Pr=>{B({type:"RESOLVE",value:Pr})}).catch(Pr=>{_s.destroyed||B({type:"REJECT",error:Pr})});return()=>{Tr.finally(()=>_s.destroy())}},[E,B,M]),T.useEffect(()=>{if(!(typeof K>"u")){if(K===!1){fe();return}oe()}},[K]),T.useEffect(function(){D.current.setViewer(H.current),D.current.setExternalLinkRel(a),D.current.setExternalLinkTarget(o)},[a,o]);const it=T.useCallback((ve,Ve)=>{O.current[ve]=Ve},[]),gn=T.useCallback(ve=>{delete O.current[ve]},[]),ue=T.useMemo(()=>({imageResourcesPath:d,linkService:D.current,onItemClick:g,pdf:K,registerPage:it,renderMode:C,rotate:N,scale:k,unregisterPage:gn}),[d,g,K,it,C,N,k,gn]),Nn=T.useMemo(()=>kC(R,()=>K),[R,K]);function Tt(){return p.jsx(NC.Provider,{value:ue,children:s})}function vt(){return c?K==null?p.jsx(rc,{type:"loading",children:typeof h=="function"?h():h}):K===!1?p.jsx(rc,{type:"error",children:typeof i=="function"?i():i}):Tt():p.jsx(rc,{type:"no-data",children:typeof f=="function"?f():f})}return p.jsx("div",Object.assign({className:kr("react-pdf__Document",r),ref:u},Nn,{children:vt()}))});function RC(){return T.useContext(NC)}function LC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.filter(Boolean);if(t.length<=1){var s=t[0];return s||null}return function(i){for(var a=0,o=t;a<o.length;a++){var c=o[a];typeof c=="function"?c(i):c&&(c.current=i)}}}const MC=T.createContext(null),jC={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},xj=/^H(\d+)$/;function bj(n){return n in jC}function Om(n){return"children"in n}function DC(n){return Om(n)?n.children.length===1&&0 in n.children&&"id"in n.children[0]:!1}function Sj(n){const e={};if(Om(n)){const{role:t}=n,s=t.match(xj);if(s)e.role="heading",e["aria-level"]=Number(s[1]);else if(bj(t)){const r=jC[t];r&&(e.role=r)}}return e}function IC(n){const e={};if(Om(n)){if(n.alt!==void 0&&(e["aria-label"]=n.alt),n.lang!==void 0&&(e.lang=n.lang),DC(n)){const[t]=n.children;if(t){const s=IC(t);return Object.assign(Object.assign({},e),s)}}}else"id"in n&&(e["aria-owns"]=n.id);return e}function Aj(n){return n?Object.assign(Object.assign({},Sj(n)),IC(n)):null}function OC({className:n,node:e}){const t=T.useMemo(()=>Aj(e),[e]),s=T.useMemo(()=>!Om(e)||DC(e)?null:e.children.map((r,i)=>p.jsx(OC,{node:r},i)),[e]);return p.jsx("span",Object.assign({className:n},t,{children:s}))}function Fm(){return T.useContext(MC)}function _j(){const n=Fm();Me(n);const{onGetStructTreeError:e,onGetStructTreeSuccess:t}=n,[s,r]=bu(),{value:i,error:a}=s,{customTextRenderer:o,page:c}=n;function u(){i&&t&&t(i)}function d(){a&&(Zt(!1,a.toString()),e&&e(a))}return T.useEffect(function(){r({type:"RESET"})},[r,c]),T.useEffect(function(){if(o||!c)return;const f=Hf(c.getStructTree()),g=f;return f.promise.then(y=>{r({type:"RESOLVE",value:y})}).catch(y=>{r({type:"REJECT",error:y})}),()=>ml(g)},[o,c,r]),T.useEffect(()=>{if(i!==void 0){if(i===!1){d();return}u()}},[i]),i?p.jsx(OC,{className:"react-pdf__Page__structTree structTree",node:i}):null}const S1=Ar;function Ej(n){const e=Fm();Me(e);const t=Object.assign(Object.assign({},e),n),{_className:s,canvasBackground:r,devicePixelRatio:i=hj(),onRenderError:a,onRenderSuccess:o,page:c,renderForms:u,renderTextLayer:d,rotate:h,scale:f}=t,{canvasRef:g}=n;Me(c);const y=T.useRef(null);function m(){c&&o&&o(W0(c,f))}function b(E){pj(E)||(Zt(!1,E.toString()),a&&a(E))}const w=T.useMemo(()=>c.getViewport({scale:f*i,rotation:h}),[i,c,h,f]),x=T.useMemo(()=>c.getViewport({scale:f,rotation:h}),[c,h,f]);T.useEffect(function(){if(!c)return;c.cleanup();const{current:C}=y;if(!C)return;C.width=w.width,C.height=w.height,C.style.width=`${Math.floor(x.width)}px`,C.style.height=`${Math.floor(x.height)}px`,C.style.visibility="hidden";const N={annotationMode:u?S1.ENABLE_FORMS:S1.ENABLE,canvasContext:C.getContext("2d",{alpha:!1}),viewport:w};r&&(N.background=r);const k=c.render(N),R=k;return k.promise.then(()=>{C.style.visibility="",m()}).catch(b),()=>ml(R)},[r,c,u,w,x]);const S=T.useCallback(()=>{const{current:E}=y;E&&(E.width=0,E.height=0)},[]);return T.useEffect(()=>S,[S]),p.jsx("canvas",{className:`${s}__canvas`,dir:"ltr",ref:LC(g,y),style:{display:"block",userSelect:"none"},children:d?p.jsx(_j,{}):null})}function Cj(n){return"str"in n}function kj(){const n=Fm();Me(n);const{customTextRenderer:e,onGetTextError:t,onGetTextSuccess:s,onRenderTextLayerError:r,onRenderTextLayerSuccess:i,page:a,pageIndex:o,pageNumber:c,rotate:u,scale:d}=n;Me(a);const[h,f]=bu(),{value:g,error:y}=h,m=T.useRef(null);Zt(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function b(){g&&s&&s(g)}function w(){y&&(Zt(!1,y.toString()),t&&t(y))}T.useEffect(function(){f({type:"RESET"})},[a,f]),T.useEffect(function(){if(!a)return;const R=Hf(a.getTextContent()),P=R;return R.promise.then(L=>{f({type:"RESOLVE",value:L})}).catch(L=>{f({type:"REJECT",error:L})}),()=>ml(P)},[a,f]),T.useEffect(()=>{if(g!==void 0){if(g===!1){w();return}b()}},[g]);const x=T.useCallback(()=>{i&&i()},[i]),S=T.useCallback(k=>{Zt(!1,k.toString()),r&&r(k)},[r]);function E(){const k=m.current;k&&k.classList.add("selecting")}function C(){const k=m.current;k&&k.classList.remove("selecting")}const N=T.useMemo(()=>a.getViewport({scale:d,rotation:u}),[a,u,d]);return T.useLayoutEffect(function(){if(!a||!g)return;const{current:R}=m;if(!R)return;R.innerHTML="";const P=a.streamTextContent({includeMarkedContent:!0}),L={container:R,textContentSource:P,viewport:N},M=new Yd(L),I=M;return M.render().then(()=>{const U=document.createElement("div");U.className="endOfContent",R.append(U);const B=R.querySelectorAll('[role="presentation"]');if(e){let K=0;g.items.forEach((j,D)=>{if(!Cj(j))return;const O=B[K];if(!O)return;const G=e(Object.assign({pageIndex:o,pageNumber:c,itemIndex:D},j));O.innerHTML=G,K+=j.str&&j.hasEOL?2:1})}x()}).catch(S),()=>ml(I)},[e,S,x,a,o,c,g,N]),p.jsx("div",{className:kr("react-pdf__Page__textContent","textLayer"),onMouseUp:C,onMouseDown:E,ref:m})}function Nj(){const n=RC(),e=Fm();Me(e);const t=Object.assign(Object.assign({},n),e),{imageResourcesPath:s,linkService:r,onGetAnnotationsError:i,onGetAnnotationsSuccess:a,onRenderAnnotationLayerError:o,onRenderAnnotationLayerSuccess:c,page:u,pdf:d,renderForms:h,rotate:f,scale:g=1}=t;Me(d),Me(u),Me(r);const[y,m]=bu(),{value:b,error:w}=y,x=T.useRef(null);Zt(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function S(){b&&a&&a(b)}function E(){w&&(Zt(!1,w.toString()),i&&i(w))}T.useEffect(function(){m({type:"RESET"})},[m,u]),T.useEffect(function(){if(!u)return;const P=Hf(u.getAnnotations()),L=P;return P.promise.then(M=>{m({type:"RESOLVE",value:M})}).catch(M=>{m({type:"REJECT",error:M})}),()=>{ml(L)}},[m,u]),T.useEffect(()=>{if(b!==void 0){if(b===!1){E();return}S()}},[b]);function C(){c&&c()}function N(R){Zt(!1,`${R}`),o&&o(R)}const k=T.useMemo(()=>u.getViewport({scale:g,rotation:f}),[u,f,g]);return T.useEffect(function(){if(!d||!u||!r||!b)return;const{current:P}=x;if(!P)return;const L=k.clone({dontFlip:!0}),M={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,div:P,l10n:null,page:u,structTreeLayer:null,viewport:L},I={annotations:b,annotationStorage:d.annotationStorage,div:P,imageResourcesPath:s,linkService:r,page:u,renderForms:h,viewport:L};P.innerHTML="";try{new cx(M).render(I),C()}catch(U){N(U)}return()=>{}},[b,s,r,u,d,h,k]),p.jsx("div",{className:kr("react-pdf__Page__annotations","annotationLayer"),ref:x})}var Tj=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};const A1=1;function Pj(n){const e=RC(),t=Object.assign(Object.assign({},e),n),{_className:s="react-pdf__Page",_enableRegisterUnregisterPage:r=!0,canvasBackground:i,canvasRef:a,children:o,className:c,customRenderer:u,customTextRenderer:d,devicePixelRatio:h,error:f="Failed to load the page.",height:g,inputRef:y,loading:m="Loading page…",noData:b="No page specified.",onGetAnnotationsError:w,onGetAnnotationsSuccess:x,onGetStructTreeError:S,onGetStructTreeSuccess:E,onGetTextError:C,onGetTextSuccess:N,onLoadError:k,onLoadSuccess:R,onRenderAnnotationLayerError:P,onRenderAnnotationLayerSuccess:L,onRenderError:M,onRenderSuccess:I,onRenderTextLayerError:U,onRenderTextLayerSuccess:B,pageIndex:K,pageNumber:j,pdf:D,registerPage:O,renderAnnotationLayer:G=!0,renderForms:Q=!1,renderMode:H="canvas",renderTextLayer:J=!0,rotate:ne,scale:he=A1,unregisterPage:re,width:oe}=t,fe=Tj(t,["_className","_enableRegisterUnregisterPage","canvasBackground","canvasRef","children","className","customRenderer","customTextRenderer","devicePixelRatio","error","height","inputRef","loading","noData","onGetAnnotationsError","onGetAnnotationsSuccess","onGetStructTreeError","onGetStructTreeSuccess","onGetTextError","onGetTextSuccess","onLoadError","onLoadSuccess","onRenderAnnotationLayerError","onRenderAnnotationLayerSuccess","onRenderError","onRenderSuccess","onRenderTextLayerError","onRenderTextLayerSuccess","pageIndex","pageNumber","pdf","registerPage","renderAnnotationLayer","renderForms","renderMode","renderTextLayer","rotate","scale","unregisterPage","width"]),[it,gn]=bu(),{value:ue,error:Nn}=it,Tt=T.useRef(null);Me(D);const vt=Va(j)?j-1:K??null,ve=j??(Va(K)?K+1:null),Ve=ne??(ue?ue.rotate:null),ke=T.useMemo(()=>{if(!ue)return null;let Tn=1;const Es=he??A1;if(oe||g){const Js=ue.getViewport({scale:1,rotation:Ve});oe?Tn=oe/Js.width:g&&(Tn=g/Js.height)}return Es*Tn},[g,ue,Ve,he,oe]);T.useEffect(function(){return()=>{Va(vt)&&r&&re&&re(vt)}},[r,D,vt,re]);function _s(){if(R){if(!ue||!ke)return;R(W0(ue,ke))}if(r&&O){if(!Va(vt)||!Tt.current)return;O(vt,Tt.current)}}function Tr(){Nn&&(Zt(!1,Nn.toString()),k&&k(Nn))}T.useEffect(function(){gn({type:"RESET"})},[gn,D,vt]),T.useEffect(function(){if(!D||!ve)return;const Es=Hf(D.getPage(ve)),Js=Es;return Es.promise.then(Sl=>{gn({type:"RESOLVE",value:Sl})}).catch(Sl=>{gn({type:"REJECT",error:Sl})}),()=>ml(Js)},[gn,D,ve]),T.useEffect(()=>{if(ue!==void 0){if(ue===!1){Tr();return}_s()}},[ue,ke]);const Pr=T.useMemo(()=>ue&&Va(vt)&&ve&&Va(Ve)&&Va(ke)?{_className:s,canvasBackground:i,customTextRenderer:d,devicePixelRatio:h,onGetAnnotationsError:w,onGetAnnotationsSuccess:x,onGetStructTreeError:S,onGetStructTreeSuccess:E,onGetTextError:C,onGetTextSuccess:N,onRenderAnnotationLayerError:P,onRenderAnnotationLayerSuccess:L,onRenderError:M,onRenderSuccess:I,onRenderTextLayerError:U,onRenderTextLayerSuccess:B,page:ue,pageIndex:vt,pageNumber:ve,renderForms:Q,renderTextLayer:J,rotate:Ve,scale:ke}:null,[s,i,d,h,w,x,S,E,C,N,P,L,M,I,U,B,ue,vt,ve,Q,J,Ve,ke]),Qs=T.useMemo(()=>kC(fe,()=>ue&&(ke?W0(ue,ke):void 0)),[fe,ue,ke]),Rr=`${vt}@${ke}/${Ve}`;function bl(){switch(H){case"custom":return Me(u),p.jsx(u,{},`${Rr}_custom`);case"none":return null;case"canvas":default:return p.jsx(Ej,{canvasRef:a},`${Rr}_canvas`)}}function Vf(){return J?p.jsx(kj,{},`${Rr}_text`):null}function Gf(){return G?p.jsx(Nj,{},`${Rr}_annotations`):null}function $m(){return p.jsxs(MC.Provider,{value:Pr,children:[bl(),Vf(),Gf(),o]})}function zm(){return ve?D===null||ue===void 0||ue===null?p.jsx(rc,{type:"loading",children:typeof m=="function"?m():m}):D===!1||ue===!1?p.jsx(rc,{type:"error",children:typeof f=="function"?f():f}):$m():p.jsx(rc,{type:"no-data",children:typeof b=="function"?b():b})}return p.jsx("div",Object.assign({className:kr(s,c),"data-page-number":ve,ref:LC(y,Tt),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${ke}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:i||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"}},Qs,{children:zm()}))}fj();ms.workerSrc="pdf.worker.mjs";async function hx(n){const e=await fetch(`${ee}/components/${n}/attributes/view`);if(!e.ok)throw new Error(`Failed to load attributes: ${e.status}`);return e.json()}async function FC(n,e){const t=await fetch(`${ee}/components/${n}/attributes`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`Failed to save: ${t.status}`)}async function fx(n){const e=await fetch(`${ee}/components/${n}/confirm-close`,{method:"POST",headers:{"Content-Type":"application/json"},body:"{}"});if(!e.ok)throw new Error(`Failed to confirm & close: ${e.status}`)}async function $C(n){const e=await fetch(`${ee}/components/${n}/reanalyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:"{}"});if(!e.ok)throw new Error(`Failed to reanalyze: ${e.status}`);return e.json()}const Rj=Object.freeze(Object.defineProperty({__proto__:null,confirmClose:fx,getAttributesView:hx,patchAttributes:FC,reanalyze:$C},Symbol.toStringTag,{value:"Module"}));function zC(n,e=300){let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>n(...s),e)}}function Lj({componentId:n,onDirtyChange:e}){const[t,s]=T.useState([]),[r,i]=T.useState({}),[a,o]=T.useState(!0);T.useEffect(()=>{let h=!0;return(async()=>{o(!0);const f=await hx(n);h&&(s(f),i({}),o(!1),e==null||e(!1))})(),()=>{h=!1}},[n]);const c=(h,f,g)=>{i(y=>{const m={...y,[h]:{value:f,unit:g}};return e==null||e(!0),m}),d(h,f,g)},u=async(h,f,g)=>{await FC(n,[{attribute_id:h,op:"upsert",value:f,unit:g}]),i(y=>{const m={...y};delete m[h];const b=Object.keys(m).length>0;return e==null||e(b),m})},d=T.useMemo(()=>zC(u,500),[n]);return a?p.jsx("div",{className:"p-4 text-sm text-gray-500",children:"Loading attributes…"}):p.jsx("div",{className:"flex flex-col gap-4",children:t.map(h=>{var m,b,w,x,S,E;const f=((m=r[h.attribute_id])==null?void 0:m.value)??((b=h.current)==null?void 0:b.value)??"",g=((w=r[h.attribute_id])==null?void 0:w.unit)??((x=h.current)==null?void 0:x.unit)??h.unit_default??"",y=h.data_type!=="json";return p.jsxs("div",{className:"p-3 border-b last:border-0 hover:bg-gray-50",children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:[h.display_label,h.category&&p.jsx("span",{className:"ml-2 text-xs text-gray-400",children:h.category})]}),y?p.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:f,onChange:C=>c(h.attribute_id,C.target.value,g)}):p.jsx("textarea",{className:"w-full border rounded px-2 py-1 text-sm",value:String(f??""),onChange:C=>c(h.attribute_id,C.target.value,g),rows:2}),p.jsx("div",{className:"mt-1 flex items-center justify-between text-xs text-gray-500",children:p.jsxs("div",{className:"flex gap-2 items-center",children:[g?p.jsx("span",{className:"px-1.5 py-0.5 rounded bg-gray-100",children:g}):null,((S=h.current)==null?void 0:S.confidence)!=null&&p.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-gray-100",children:[Math.round((h.current.confidence||0)*100),"%"]})]})}),((E=h.candidates)==null?void 0:E.length)>0&&p.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:h.candidates.map((C,N)=>{var k;return p.jsxs("button",{className:"text-xs border rounded px-2 py-1 hover:bg-gray-100",onClick:()=>c(h.attribute_id,C.value,C.unit),title:`From page ${((k=C.source)==null?void 0:k.page)??"?"}`,children:[String(C.value)," ",C.unit??""]},N)})})]},h.attribute_id)})})}const Mj=({assetId:n,pdfUrl:e,initialParsedData:t,onClose:s})=>{const[r,i]=T.useState(null),[a,o]=T.useState(1),[c,u]=T.useState(1),[d,h]=T.useState([]),f=z(L=>L.setDatasheetDirty),[g,y]=T.useState(null),[m,b]=T.useState(t||{});T.useEffect(()=>{b(t||{})},[n,t]);const w=gt.useMemo(()=>zC(L=>{YN(n,L,!1).catch(M=>{console.error("Failed to save parsed data",M)})},500),[n]);T.useEffect(()=>{f(!1)},[n]),T.useEffect(()=>{async function L(){try{const M=await KN(n);h(M)}catch(M){console.error("Failed to load images",M)}}L()},[n]),T.useEffect(()=>{let L=!1;return(async()=>{try{const{getAttributesView:M}=await Nm(async()=>{const{getAttributesView:U}=await Promise.resolve().then(()=>Rj);return{getAttributesView:U}},[]),I=await M(n);L||y(I&&I.length>0)}catch(M){console.error("Failed to load attributes for preview",M),L||y(!1)}})(),()=>{L=!0}},[n]);const x=async L=>{const M=L.target.files;if(!M||M.length===0)return;const I=[];for(let U=0;U<M.length;U++)I.push(M[U]);try{const U=await QN(n,I);h(B=>[...B,...U]),f(!0)}catch(U){console.error("Image upload failed",U)}L.target.value=""},S=async L=>{if(window.confirm("Are you sure you want to delete this image?"))try{await JN(n,L),h(M=>M.filter(I=>I.id!==L)),f(!0)}catch(M){console.error("Failed to delete image",M)}},E=async L=>{try{await ZN(n,L),h(M=>M.map(I=>({...I,is_primary:I.id===L}))),f(!0)}catch(M){console.error("Failed to set primary image",M)}};function C({numPages:L}){i(L),o(1)}const N=()=>o(L=>Math.max(L-1,1)),k=()=>o(L=>Math.min(L+1,r||1)),R=()=>u(L=>L+.1),P=()=>u(L=>Math.max(L-.1,.1));return p.jsxs("div",{className:"flex h-full min-h-0",children:[p.jsxs("div",{className:"w-1/2 border-r flex flex-col min-h-0",children:[p.jsxs("div",{className:"flex items-center justify-between p-2 border-b bg-white",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("button",{onClick:N,className:"p-1 border rounded",children:p.jsx(gT,{className:"w-4 h-4"})}),p.jsxs("span",{className:"text-sm",children:["Page ",a," / ",r]}),p.jsx("button",{onClick:k,className:"p-1 border rounded",children:p.jsx(yT,{className:"w-4 h-4"})})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("button",{onClick:P,className:"p-1 border rounded",children:p.jsx(mP,{className:"w-4 h-4"})}),p.jsx("button",{onClick:R,className:"p-1 border rounded",children:p.jsx(pP,{className:"w-4 h-4"})})]})]}),p.jsx("div",{className:"flex-1 overflow-auto scroll-container bg-gray-50 flex justify-center min-h-0",children:p.jsx(wj,{file:e,onLoadSuccess:C,className:"m-2",children:p.jsx(Pj,{pageNumber:a,scale:c})})})]}),p.jsx("div",{className:"w-1/2 flex flex-col min-h-0",children:p.jsxs("div",{className:"flex-1 overflow-auto scroll-container p-4 flex flex-col gap-4 min-h-0",children:[g===null?p.jsx("div",{className:"text-sm text-gray-500",children:"Loading attributes…"}):g?p.jsx(Lj,{componentId:n,onDirtyChange:L=>{f(L)}}):t?p.jsxs("div",{className:"flex flex-col gap-0",children:[p.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Raw data"}),Object.entries(m).map(([L,M])=>p.jsxs("div",{className:"p-3 border-b last:border-0",children:[p.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1 capitalize",children:L.replace(/_/g," ")}),typeof M=="object"&&M!==null?p.jsx("textarea",{value:JSON.stringify(M,null,2),onChange:I=>{let U=I.target.value;try{U=JSON.parse(I.target.value)}catch{}b(B=>{const K={...B,[L]:U};return f(!0),w(K),K})},rows:3,className:"w-full border rounded px-2 py-1 text-sm font-mono resize-y"}):p.jsx("input",{type:"text",value:String(M??""),onChange:I=>{const U=I.target.value;b(B=>{const K={...B,[L]:U};return f(!0),w(K),K})},className:"w-full border rounded px-2 py-1 text-sm"})]},L))]}):p.jsx("div",{className:"text-sm text-gray-500",children:"No attributes or parsed data available."}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Images"}),p.jsxs("div",{className:"flex flex-wrap gap-3",children:[d.map(L=>p.jsxs("div",{className:"relative border rounded",children:[p.jsx("img",{src:`${ee.replace(/\/api\/v1$/,"")}${L.url}`,alt:L.filename,className:"w-24 h-24 object-cover rounded"}),L.is_primary&&p.jsx("span",{className:"absolute top-1 left-1 bg-blue-500 text-white text-xs px-1 rounded",children:"Primary"}),p.jsx("button",{onClick:()=>E(L.id),className:"absolute top-1 right-6 text-white",title:"Make primary",children:p.jsx(tP,{className:L.is_primary?"w-4 h-4 text-yellow-400 fill-yellow-400":"w-4 h-4 text-white drop-shadow"})}),p.jsx("button",{onClick:()=>S(L.id),className:"absolute top-1 right-1 text-white",title:"Delete",children:p.jsx(oP,{className:"w-4 h-4 text-red-500"})})]},L.id)),p.jsxs("label",{className:"flex items-center justify-center w-24 h-24 border-2 border-dashed rounded cursor-pointer text-gray-500",children:[p.jsx("span",{className:"text-sm",children:"+ Add"}),p.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:x,className:"hidden"})]})]})]})]})})]})},jj=()=>{const n=z(h=>h.activeDatasheet),e=z(h=>h.setActiveDatasheet),{addUpload:t,updateUpload:s,setRoute:r,addStatusMessage:i}=z(),{setNodeRef:a}=h_({id:"component-canvas-area"}),o=T.useCallback(async h=>{const f=`temp-${Date.now()}`;t({id:f,name:h.name,size:h.size,mime:h.type,progress:0,assetType:"component",parsed_at:null,parsing_status:null,parsing_error:null,is_human_verified:!1});try{const g=await Uw(h,m=>s(f,{progress:m}));s(g.id,{...g,parsing_status:"processing"}),r("components"),Hw(g.id).catch(m=>{s(g.id,{parsing_status:"failed",parsing_error:m.message})});const y=setInterval(async()=>{try{const m=await Hd(g.id);if(m.parsing_status==="success"){clearInterval(y),s(g.id,{parsing_status:"success",parsing_error:null});const b=`${ee}/files/${m.id}/file`;e({id:m.id,url:b,payload:m.parsed_payload})}else m.parsing_status==="failed"&&(clearInterval(y),s(g.id,{parsing_status:"failed",parsing_error:m.parsing_error}))}catch(m){clearInterval(y),s(g.id,{parsing_status:"failed",parsing_error:m.message||"Failed to fetch status"})}},2e3)}catch(g){console.error(g),s(f,{parsing_status:"failed",parsing_error:"Upload or parse failed"}),(g==null?void 0:g.status)===401?i("Unauthorized. Please log in to upload files.","error"):i("Upload failed","error")}},[t,s,e,r]),c=T.useCallback(h=>{if(h.preventDefault(),h.dataTransfer.files&&h.dataTransfer.files[0]){const f=h.dataTransfer.files[0];f.type==="application/pdf"&&o(f)}},[o]),u=h=>h.preventDefault(),d=()=>e(null);return p.jsx("div",{ref:a,className:"w-full h-full flex flex-col",onDrop:c,onDragOver:u,children:n?p.jsx(Mj,{assetId:n.id,pdfUrl:n.url,initialParsedData:n.payload,onClose:d}):p.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400 border-2 border-dashed rounded-lg pointer-events-none",children:p.jsx("p",{children:"Drop a component from the library or a PDF from your computer to begin."})})})},Dj=()=>{const[n,e]=T.useState([]),[t,s]=T.useState(null);return T.useEffect(()=>{(async()=>{try{const i=await fetch(`${ee}/memory`);if(i.ok){const a=await i.json();e(a)}else s(`Failed to load memory: ${i.status}`)}catch(i){s(`Failed to load memory: ${i.message??i}`)}})()},[]),p.jsxs("div",{className:"space-y-4",children:[p.jsx("h3",{className:"text-lg font-semibold",children:"Memory Entries"}),t&&p.jsx("div",{className:"text-red-600 text-sm",children:t}),p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"min-w-full border text-xs text-left",children:[p.jsx("thead",{className:"bg-gray-100",children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-3 py-2 font-medium",children:"ID"}),p.jsx("th",{className:"px-3 py-2 font-medium",children:"Kind"}),p.jsx("th",{className:"px-3 py-2 font-medium",children:"Project"}),p.jsx("th",{className:"px-3 py-2 font-medium",children:"Created"})]})}),p.jsxs("tbody",{children:[n.map(r=>p.jsxs("tr",{className:"border-t",children:[p.jsx("td",{className:"px-3 py-1 font-mono",children:r.id}),p.jsx("td",{className:"px-3 py-1",children:r.kind}),p.jsx("td",{className:"px-3 py-1",children:r.project_id??"-"}),p.jsx("td",{className:"px-3 py-1",children:new Date(r.created_at).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"})})]},r.id)),n.length===0&&!t&&p.jsx("tr",{children:p.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-gray-500",children:"No memory entries found."})})]})]})})]})},Ij=()=>{const[n,e]=T.useState([]),[t,s]=T.useState(null),[r,i]=T.useState([]),[a,o]=T.useState(null);return T.useEffect(()=>{(async()=>{try{const u=await fetch(`${ee}/traces`);if(!u.ok){o(`Failed to load traces: ${u.status}`);return}const d=await u.json();e(d)}catch(u){o(`Failed to load traces: ${u.message??u}`)}})()},[]),T.useEffect(()=>{if(!t){i([]);return}(async()=>{try{const u=await fetch(`${ee}/traces/${t}`);if(!u.ok){o(`Failed to load events: ${u.status}`);return}const d=await u.json();i(d)}catch(u){o(`Failed to load events: ${u.message??u}`)}})()},[t]),p.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[p.jsx("h3",{className:"text-lg font-semibold",children:"Traceability"}),a&&p.jsx("div",{className:"text-red-600 text-sm",children:a}),p.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[p.jsxs("div",{className:"w-1/3 pr-2 border-r overflow-y-auto",children:[p.jsx("h4",{className:"font-medium mb-2",children:"Traces"}),p.jsxs("ul",{className:"divide-y",children:[n.map(c=>p.jsxs("li",{className:`p-2 cursor-pointer ${t===c.trace_id?"bg-blue-50":"hover:bg-gray-100"}`,onClick:()=>s(c.trace_id),children:[p.jsx("div",{className:"font-mono text-xs truncate",children:c.trace_id}),p.jsxs("div",{className:"text-xs text-gray-500",children:[c.count," event",c.count===1?"":"s"]})]},c.trace_id)),n.length===0&&p.jsx("li",{className:"p-2 text-gray-500 text-sm",children:"No traces found."})]})]}),p.jsxs("div",{className:"w-2/3 pl-2 overflow-y-auto",children:[p.jsx("h4",{className:"font-medium mb-2",children:"Events"}),t&&r.length===0&&p.jsx("div",{className:"text-sm text-gray-500",children:"No events for this trace."}),r.map(c=>p.jsxs("div",{className:"border-b pb-2 mb-2",children:[p.jsxs("div",{className:"text-xs font-semibold",children:[new Date(c.ts).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"})," - ",c.event_type]}),p.jsx("pre",{className:"whitespace-pre-wrap bg-gray-50 p-2 rounded text-xs overflow-x-auto",children:JSON.stringify(c.payload,null,2)})]},c.id))]})]})]})};async function Oj(n){const e=await fetch(`${ee}/tenant/${n}/settings`,{credentials:"include"});if(!e.ok)throw new Error(await e.text());return e.json()}async function Fj(n,e){const t=await fetch(`${ee}/tenant/${n}/settings`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok)throw new Error(await t.text());return t.json()}async function $j(n,e,t){const s=new URLSearchParams;e&&s.set("status",e);const r=await fetch(`${ee}/tenant/${n}/approvals?${s.toString()}`,{credentials:"include"});if(!r.ok)throw new Error(await r.text());return r.json()}async function zj(n,e){const t=await fetch(`${ee}/approvals/${n}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:e})});if(!t.ok)throw new Error(await t.text());return t.json()}async function Bj(n,e){const t=await fetch(`${ee}/approvals/${n}/reject`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:e})});if(!t.ok)throw new Error(await t.text());return t.json()}const Uj=()=>{var d;const[n,e]=T.useState("tenant_default"),[t,s]=T.useState(null),[r,i]=T.useState([]),[a,o]=T.useState("pending"),c=async()=>{const h=await Oj(n);s(h);const f=await $j(n,a);i(f)};if(T.useEffect(()=>{c();const h=setInterval(c,1e4);return()=>clearInterval(h)},[n,a]),!t)return p.jsx("div",{className:"p-4",children:"Loading governance settings…"});const u=async()=>{const h={ai_auto_approve:t.ai_auto_approve,risk_threshold_low:t.risk_threshold_low,risk_threshold_medium:t.risk_threshold_medium,risk_threshold_high:t.risk_threshold_high,whitelisted_actions:t.whitelisted_actions,enabled_domains:t.enabled_domains,feature_flags:t.feature_flags},f=await Fj(n,h);s(f)};return p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"flex gap-2 items-center",children:[p.jsx("label",{className:"text-sm",children:"Tenant"}),p.jsx("input",{className:"border rounded px-2 py-1",value:n,onChange:h=>e(h.target.value)})]}),p.jsxs("section",{className:"border rounded p-4 space-y-3",children:[p.jsx("h3",{className:"font-medium",children:"Auto-Approval Policy"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:t.ai_auto_approve,onChange:h=>s({...t,ai_auto_approve:h.target.checked})}),p.jsx("span",{children:"Enable auto-approval (still constrained by risk thresholds)"})]}),p.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"text-sm block",children:"Low Threshold"}),p.jsx("input",{type:"number",step:"0.01",className:"border rounded px-2 py-1 w-full",value:t.risk_threshold_low,onChange:h=>s({...t,risk_threshold_low:parseFloat(h.target.value)})})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm block",children:"Medium Threshold"}),p.jsx("input",{type:"number",step:"0.01",className:"border rounded px-2 py-1 w-full",value:t.risk_threshold_medium,onChange:h=>s({...t,risk_threshold_medium:parseFloat(h.target.value)})})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm block",children:"High Threshold"}),p.jsx("input",{type:"number",step:"0.01",className:"border rounded px-2 py-1 w-full",value:t.risk_threshold_high,onChange:h=>s({...t,risk_threshold_high:parseFloat(h.target.value)})})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm block",children:"Whitelisted action types (comma-separated)"}),p.jsx("input",{className:"border rounded px-2 py-1 w-full",value:(((d=t.whitelisted_actions)==null?void 0:d.items)||[]).join(","),onChange:h=>s({...t,whitelisted_actions:{items:h.target.value.split(",").map(f=>f.trim()).filter(Boolean)}})})]}),p.jsx("button",{className:"bg-black text-white rounded px-3 py-1",onClick:u,children:"Save"})]}),p.jsxs("section",{className:"border rounded p-4 space-y-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h3",{className:"font-medium",children:"Approval Queue"}),p.jsxs("select",{className:"border rounded px-2 py-1",value:a,onChange:h=>o(h.target.value),children:[p.jsx("option",{value:"pending",children:"Pending"}),p.jsx("option",{value:"approved",children:"Approved"}),p.jsx("option",{value:"rejected",children:"Rejected"})]})]}),p.jsxs("div",{className:"border rounded divide-y",children:[r.map(h=>p.jsxs("div",{className:"p-3 flex items-start justify-between gap-4",children:[p.jsxs("div",{className:"text-sm",children:[p.jsxs("div",{className:"font-mono text-xs text-gray-500",children:["#",h.id," · ",h.status]}),p.jsxs("div",{children:[p.jsx("b",{children:h.action_type})," by ",p.jsx("code",{children:h.agent_name})," (risk: ",h.risk_class,", conf: ",h.confidence.toFixed(2),")"]}),p.jsx("pre",{className:"bg-gray-50 p-2 rounded mt-2 overflow-auto text-xs",children:JSON.stringify(h.payload,null,2)})]}),p.jsx("div",{className:"flex gap-2",children:h.status==="pending"?p.jsxs(p.Fragment,{children:[p.jsx("button",{className:"bg-green-600 text-white rounded px-3 py-1",onClick:()=>zj(h.id).then(c),children:"Approve"}),p.jsx("button",{className:"bg-red-600 text-white rounded px-3 py-1",onClick:()=>Bj(h.id).then(c),children:"Reject"})]}):p.jsxs("div",{className:"text-xs text-gray-600",children:[h.status==="approved"?"Approved":"Rejected",h.decided_by?` by ${h.decided_by}`:"",h.decision_reason?` · ${h.decision_reason}`:""]})})]},h.id)),r.length===0&&p.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:"No items"})]})]})]})},Hj=()=>{const[n,e]=T.useState(null),[t,s]=T.useState("profile");T.useEffect(()=>{(async()=>{try{const o=await fetch(`${ee}/me`);if(o.ok){const c=await o.json();e(c)}else e({id:"anonymous",org_id:"unknown",roles:[],permissions:[]})}catch(o){console.error("Failed to fetch user profile",o),e({id:"anonymous",org_id:"unknown",roles:[],permissions:[]})}})()},[]);const r=a=>{var o;return a?((o=n==null?void 0:n.permissions)==null?void 0:o.includes(a))??!1:!0},i=[{id:"profile",label:"Profile",content:p.jsx("div",{children:"Your profile settings go here."})},{id:"organization",label:"Organization",content:p.jsx("div",{children:"Organization settings (coming soon)."})},{id:"roles",label:"Roles & Permissions",content:p.jsx("div",{children:"Role management (coming soon)."}),perm:"policy:edit"},{id:"memory",label:"Memory",content:p.jsx(Dj,{}),perm:"memory:read"},{id:"traceability",label:"Traceability",content:p.jsx(Ij,{}),perm:"trace:read"},{id:"governance",label:"Governance & Approvals",content:p.jsx(Uj,{}),perm:"policy:edit"},{id:"integrations",label:"Integrations",content:p.jsx("div",{children:"Integrations configuration (coming soon)."}),perm:"policy:edit"},{id:"models",label:"Models & Costs",content:p.jsx("div",{children:"Model settings (coming soon)."}),perm:"policy:edit"},{id:"automations",label:"Automations",content:p.jsx("div",{children:"Automation schedules (coming soon)."}),perm:"policy:edit"}];return p.jsxs("div",{className:"p-4 h-full overflow-auto bg-gray-50 text-black flex flex-col",children:[p.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Settings"}),p.jsx("div",{className:"flex space-x-4 border-b border-gray-200 mb-4",children:i.filter(a=>r(a.perm)).map(a=>p.jsx("button",{onClick:()=>s(a.id),className:`py-2 px-3 border-b-2 font-medium text-sm ${t===a.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:a.label},a.id))}),p.jsx("div",{className:"flex-1 overflow-auto",children:i.filter(a=>r(a.perm)).map(a=>p.jsx("div",{className:t===a.id?"block":"hidden",children:a.content},a.id))})]})};function Vj(){const[n,e]=T.useState(null),[t,s]=T.useState(null),[r,i]=T.useState(""),[a,o]=T.useState(""),[c,u]=T.useState(""),[d,h]=T.useState("");async function f(){try{const x=await we.listTenantAgentState(r||void 0);e(x),s(null)}catch(x){s(x.message)}}T.useEffect(()=>{f()},[]);async function g(x){await we.updateTenantAgentState(x.agent_name,{enabled:!x.enabled},r||void 0),await f()}async function y(x,S){await we.updateTenantAgentState(x.agent_name,{pinned_version:S??void 0},r||void 0),await f()}async function m(){if(!a.trim())return;const x=await we.assistSynthesizeSpec(a);u(JSON.stringify(x.spec,null,2))}async function b(){if(!c.trim())return;const x=JSON.parse(c);await we.createAgentDraft(x),o(""),h(""),await f()}async function w(){if(!c.trim()||!d.trim())return;const x=JSON.parse(c),S=await we.assistRefineSpec(x,d);u(JSON.stringify(S.spec,null,2))}return p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsx("h1",{className:"text-xl font-semibold",children:"AI Agents (Tenant Catalog)"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("label",{className:"text-sm text-gray-500",children:"Tenant:"}),p.jsx("input",{value:r,onChange:x=>i(x.target.value),placeholder:"default",className:"border px-2 py-1 rounded"}),p.jsx("button",{onClick:f,className:"px-3 py-1 rounded bg-blue-600 text-white",children:"Reload"})]}),t&&p.jsx("div",{className:"text-red-600 text-sm",children:t}),p.jsxs("div",{className:"border rounded",children:[p.jsxs("div",{className:"grid grid-cols-7 gap-2 px-3 py-2 bg-gray-50 text-xs font-medium",children:[p.jsx("div",{children:"Name"}),p.jsx("div",{children:"Display"}),p.jsx("div",{children:"Domain"}),p.jsx("div",{children:"Enabled"}),p.jsx("div",{children:"Effective"}),p.jsx("div",{children:"Pinned"}),p.jsx("div",{children:"Actions"})]}),n==null?void 0:n.map(x=>p.jsxs("div",{className:"grid grid-cols-7 gap-2 px-3 py-2 border-t items-center text-sm",children:[p.jsx("div",{children:x.agent_name}),p.jsx("div",{children:x.display_name}),p.jsx("div",{children:x.domain||"-"}),p.jsx("div",{children:p.jsx("button",{onClick:()=>g(x),className:`px-2 py-1 rounded ${x.enabled?"bg-green-600":"bg-gray-400"} text-white`,children:x.enabled?"Enabled":"Disabled"})}),p.jsx("div",{children:x.effective_version??"-"}),p.jsx("div",{children:p.jsx("input",{type:"number",className:"w-20 border rounded px-2 py-1",placeholder:"version",onKeyDown:async S=>{if(S.key==="Enter"){const E=S.target.value;await y(x,E?parseInt(E,10):null),S.target.value=""}}})}),p.jsx("div",{className:"flex gap-2",children:p.jsx("button",{onClick:async()=>{await we.publishAgent(x.agent_name),await f()},className:"px-2 py-1 rounded bg-indigo-600 text-white",children:"Publish latest"})})]},x.agent_name))]}),p.jsxs("div",{className:"mt-6",children:[p.jsx("h2",{className:"text-lg font-semibold",children:"Author new/updated Agent (LLM assisted)"}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm text-gray-600",children:"Idea"}),p.jsx("textarea",{value:a,onChange:x=>o(x.target.value),rows:6,className:"w-full border rounded p-2",placeholder:"Describe what the agent should do..."}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("button",{onClick:m,className:"px-3 py-1 rounded bg-blue-600 text-white",children:"Synthesize Spec"}),p.jsx("button",{onClick:b,className:"px-3 py-1 rounded bg-emerald-600 text-white",children:"Save Draft"})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm text-gray-600",children:"Draft Spec (editable JSON)"}),p.jsx("textarea",{value:c,onChange:x=>u(x.target.value),rows:12,className:"w-full border rounded p-2 font-mono text-xs"}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("input",{value:d,onChange:x=>h(x.target.value),className:"flex-1 border rounded p-2",placeholder:"Refinement critique..."}),p.jsx("button",{onClick:w,className:"px-3 py-1 rounded bg-purple-600 text-white",children:"Refine"})]})]})]})]})]})}function Gj({open:n,onClose:e,loading:t,error:s,beforeGraph:r,afterGraph:i,note:a,diff:o,onApproveAndApply:c}){var u,d,h,f,g;return n?p.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-center justify-center",children:p.jsxs("div",{className:"bg-white rounded-xl w-[90vw] max-w-[1200px] max-h-[85vh] overflow-hidden shadow-xl border",children:[p.jsxs("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[p.jsx("div",{className:"font-semibold",children:"Action Impact Preview"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("button",{onClick:c,className:"px-3 py-1 rounded bg-emerald-600 text-white",children:"Approve & Apply"}),p.jsx("button",{onClick:e,className:"px-3 py-1 rounded bg-gray-200",children:"Close"})]})]}),p.jsxs("div",{className:"p-4 space-y-3 overflow-auto",children:[t&&p.jsx("div",{className:"text-sm text-gray-600",children:"Loading preview…"}),s&&p.jsx("div",{className:"text-sm text-red-600",children:s}),!t&&!s&&p.jsxs(p.Fragment,{children:[a&&p.jsxs("div",{className:"text-sm text-gray-600",children:["Note: ",a]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"border rounded p-2",children:[p.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Before (latest snapshot)"}),p.jsx("div",{className:"text-xs font-mono whitespace-pre-wrap overflow-auto max-h-[40vh]",children:p.jsx("pre",{children:JSON.stringify(r||{nodes:[],edges:[]},null,2)})})]}),p.jsxs("div",{className:"border rounded p-2",children:[p.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"After (simulated)"}),p.jsx("div",{className:"text-xs font-mono whitespace-pre-wrap overflow-auto max-h-[40vh]",children:p.jsx("pre",{children:JSON.stringify(i||{nodes:[],edges:[]},null,2)})})]})]}),p.jsxs("div",{className:"border rounded p-2",children:[p.jsx("div",{className:"text-xs font-medium text-gray-500 mb-2",children:"Changes"}),p.jsxs("div",{className:"grid grid-cols-5 gap-2 text-xs",children:[p.jsxs("div",{children:[p.jsx("span",{className:"font-semibold",children:"Added nodes:"})," ",((u=o==null?void 0:o.added_nodes)==null?void 0:u.length)??0]}),p.jsxs("div",{children:[p.jsx("span",{className:"font-semibold",children:"Removed nodes:"})," ",((d=o==null?void 0:o.removed_nodes)==null?void 0:d.length)??0]}),p.jsxs("div",{children:[p.jsx("span",{className:"font-semibold",children:"Modified nodes:"})," ",((h=o==null?void 0:o.modified_nodes)==null?void 0:h.length)??0]}),p.jsxs("div",{children:[p.jsx("span",{className:"font-semibold",children:"Added edges:"})," ",((f=o==null?void 0:o.added_edges)==null?void 0:f.length)??0]}),p.jsxs("div",{children:[p.jsx("span",{className:"font-semibold",children:"Removed edges:"})," ",((g=o==null?void 0:o.removed_edges)==null?void 0:g.length)??0]})]}),p.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("div",{className:"font-semibold text-xs mb-1",children:"Node & Edge Additions"}),p.jsx("div",{className:"text-xs font-mono whitespace-pre-wrap max-h-[25vh] overflow-auto",children:p.jsx("pre",{children:JSON.stringify({added_nodes:(o==null?void 0:o.added_nodes)||[],added_edges:(o==null?void 0:o.added_edges)||[]},null,2)})})]}),p.jsxs("div",{children:[p.jsx("div",{className:"font-semibold text-xs mb-1",children:"Node & Edge Removals / Modifications"}),p.jsx("div",{className:"text-xs font-mono whitespace-pre-wrap max-h-[25vh] overflow-auto",children:p.jsx("pre",{children:JSON.stringify({removed_nodes:(o==null?void 0:o.removed_nodes)||[],removed_edges:(o==null?void 0:o.removed_edges)||[],modified_nodes:(o==null?void 0:o.modified_nodes)||[]},null,2)})})]})]})]})]})]})]})}):null}function Wj(){const[n,e]=T.useState([]),[t,s]=T.useState("pending"),[r,i]=T.useState(""),[a,o]=T.useState(""),[c,u]=T.useState(""),[d,h]=T.useState(!1),[f,g]=T.useState(null),[y,m]=T.useState(!0),[b,w]=T.useState(!1),[x,S]=T.useState(!1),[E,C]=T.useState(null),[N,k]=T.useState(null),[R,P]=T.useState(null),[L,M]=T.useState(null),[I,U]=T.useState(null),[B,K]=T.useState(null);async function j(){h(!0);try{const H=await we.listApprovals({status:t||void 0,session_id:r||void 0,project_id:a||void 0,limit:100});e(H.items||[]),g(null)}catch(H){g(H.message)}finally{h(!1)}}T.useEffect(()=>{j()},[]),T.useEffect(()=>{const H=new EventSource("/api/v1/approvals/stream");return H.onmessage=J=>{try{const ne=JSON.parse(J.data||"{}");if(!ne||!ne.type||ne.type==="heartbeat"||ne.type==="hello")return;const he=ne.item;if(!he)return;e(re=>{const oe=re.findIndex(ue=>ue.id===he.id),fe=(!t||t===""||he.status===t)&&(!r||he.session_id===r)&&(!a||he.project_id===a);if(oe===-1)return fe?[he,...re]:re;const it=re.slice();return it[oe]={...re[oe],...he},(!t||t===""||it[oe].status===t)&&(!r||it[oe].session_id===r)&&(!a||it[oe].project_id===a)||it.splice(oe,1),it})}catch{}},H.onerror=()=>{},()=>{H.close()}},[t,r,a]);async function D(H){const J=await we.approveApproval(H.id,c||void 0,y),ne=J.approved;!y&&(ne!=null&&ne.session_id)&&J.apply_client_side&&ne.payload&&await we.postSessionAct(ne.session_id,ne.payload),u(""),await j()}async function O(H){await we.rejectApproval(H.id,c||void 0),u(""),await j()}async function G(H){var J,ne,he;K(H),w(!0),S(!0),C(null),k(null),P(null),M(null),U(null);try{const re=await we.getApprovalDiff(H.id);k(((J=re==null?void 0:re.before_snapshot)==null?void 0:J.graph)||null),P(((ne=re==null?void 0:re.after_preview)==null?void 0:ne.graph)||null),M(((he=re==null?void 0:re.after_preview)==null?void 0:he.note)||null),U((re==null?void 0:re.diff)||null)}catch(re){C((re==null?void 0:re.message)||"Failed to load preview")}finally{S(!1)}}async function Q(){B&&(await D({...B}),w(!1))}return p.jsx(p.Fragment,{children:p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsx("h1",{className:"text-xl font-semibold",children:"Approvals"}),p.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[p.jsx("label",{className:"text-sm text-gray-500",children:"Status"}),p.jsxs("select",{value:t,onChange:H=>s(H.target.value),className:"border rounded px-2 py-1",children:[p.jsx("option",{value:"pending",children:"pending"}),p.jsx("option",{value:"",children:"(all)"}),p.jsx("option",{value:"approved",children:"approved"}),p.jsx("option",{value:"rejected",children:"rejected"}),p.jsx("option",{value:"applied",children:"applied"})]}),p.jsx("input",{placeholder:"session id",value:r,onChange:H=>i(H.target.value),className:"border rounded px-2 py-1"}),p.jsx("input",{placeholder:"project id",value:a,onChange:H=>o(H.target.value),className:"border rounded px-2 py-1"}),p.jsx("button",{onClick:j,className:"px-3 py-1 rounded bg-blue-600 text-white",children:"Reload"}),p.jsx("input",{placeholder:"decision note...",value:c,onChange:H=>u(H.target.value),className:"border rounded px-2 py-1 flex-1"}),p.jsxs("label",{className:"ml-2 text-sm flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:y,onChange:H=>m(H.target.checked)}),"Apply server-side"]})]}),f&&p.jsx("div",{className:"text-red-600 text-sm",children:f}),p.jsxs("div",{className:"border rounded",children:[p.jsxs("div",{className:"grid grid-cols-8 gap-2 px-3 py-2 bg-gray-50 text-xs font-medium",children:[p.jsx("div",{children:"ID"}),p.jsx("div",{children:"Session"}),p.jsx("div",{children:"Agent"}),p.jsx("div",{children:"Action"}),p.jsx("div",{children:"Conf"}),p.jsx("div",{children:"Status"}),p.jsx("div",{children:"Reason"}),p.jsx("div",{children:"Decide"})]}),n.map(H=>p.jsxs("div",{className:"border-t",children:[p.jsxs("div",{className:"grid grid-cols-8 gap-2 px-3 py-2 items-center text-sm",children:[p.jsx("div",{children:H.id}),p.jsx("div",{className:"truncate",title:H.session_id||"",children:H.session_id||"-"}),p.jsx("div",{children:H.agent_name||"-"}),p.jsx("div",{children:H.action_type}),p.jsx("div",{children:H.confidence!=null?H.confidence.toFixed(2):"-"}),p.jsx("div",{children:H.status}),p.jsx("div",{className:"truncate",title:H.reason||"",children:H.reason||"-"}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("button",{onClick:()=>G(H),className:"px-2 py-1 rounded bg-gray-700 text-white",children:"Preview"}),p.jsx("button",{onClick:()=>D(H),className:"px-2 py-1 rounded bg-emerald-600 text-white",children:"Approve"}),p.jsx("button",{onClick:()=>O(H),className:"px-2 py-1 rounded bg-rose-600 text-white",children:"Reject"})]})]}),p.jsx("div",{className:"bg-gray-50 rounded p-2 text-xs font-mono overflow-auto mx-3 mb-2",children:p.jsx("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(H.payload,null,2)})})]},H.id)),!d&&n.length===0&&p.jsx("div",{className:"px-3 py-4 text-sm text-gray-500",children:"No items"})]}),p.jsx(Gj,{open:b,onClose:()=>w(!1),loading:x,error:E,beforeGraph:N,afterGraph:R,note:L,diff:I,onApproveAndApply:Q})]})})}function qj(){var N,k,R;const[n,e]=T.useState(!0),[t,s]=T.useState(!1),[r,i]=T.useState(null),[a,o]=T.useState(null),[c,u]=T.useState(!1),[d,h]=T.useState("component.create"),[f,g]=T.useState(.9),[y,m]=T.useState(""),[b,w]=T.useState(null);T.useEffect(()=>{(async()=>{try{e(!0);const P=await we.getTenantPolicy();o(P)}catch(P){i((P==null?void 0:P.message)||"Failed to load")}finally{e(!1)}})()},[]);function x(P){a&&(o({...a,...P}),u(!0))}function S(P,L){const M=L.split(",").map(U=>U.trim()).filter(Boolean);if(!a)return;const I=P==="enabled_domains"?{domains:M}:{actions:M};x({[P]:I})}async function E(){if(a)try{s(!0);const P={version:a.version,auto_approve_enabled:a.auto_approve_enabled,risk_threshold_default:a.risk_threshold_default,action_whitelist:a.action_whitelist,action_blacklist:a.action_blacklist,enabled_domains:a.enabled_domains,feature_flags:a.feature_flags,data:a.data},L=await we.updateTenantPolicy(P);o(L),u(!1)}catch(P){alert((P==null?void 0:P.message)||"Save failed")}finally{s(!1)}}async function C(){try{const P=await we.testTenantPolicy({action_type:d,confidence:f,agent_name:y||void 0});w(P)}catch(P){w({error:(P==null?void 0:P.message)||"Failed"})}}return n?p.jsx("div",{className:"p-4 text-sm text-gray-600",children:"Loading policy…"}):r?p.jsx("div",{className:"p-4 text-sm text-red-600",children:r}):a?p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("div",{className:"text-lg font-semibold",children:"Tenant Policy"}),p.jsxs("div",{className:"text-xs text-gray-500",children:["Tenant: ",a.tenant_id," • Version: ",a.version," • Updated by: ",a.updated_by_id||"-"," • Updated at:",a.updated_at||"-"]})]}),p.jsx("div",{className:"flex items-center gap-2",children:p.jsx("button",{disabled:!c||t,onClick:E,className:`px-3 py-1 rounded ${c?"bg-blue-600 text-white":"bg-gray-300 text-gray-700"}`,children:t?"Saving…":"Save"})})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"border rounded p-3 space-y-3",children:[p.jsx("div",{className:"font-medium",children:"Auto-approval"}),p.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[p.jsx("input",{type:"checkbox",checked:a.auto_approve_enabled,onChange:P=>x({auto_approve_enabled:P.target.checked})}),"Enable auto-approval"]}),p.jsxs("div",{className:"text-sm",children:[p.jsx("div",{children:"Risk threshold (0–1):"}),p.jsx("input",{type:"range",min:0,max:1,step:.01,value:a.risk_threshold_default,onChange:P=>x({risk_threshold_default:parseFloat(P.target.value)}),className:"w-full"}),p.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Current: ",a.risk_threshold_default.toFixed(2)]})]})]}),p.jsxs("div",{className:"border rounded p-3 space-y-3",children:[p.jsx("div",{className:"font-medium",children:"Domains"}),p.jsx("div",{className:"text-sm",children:"Enabled domains (comma separated):"}),p.jsx("input",{className:"border rounded px-2 py-1 w-full",value:(((N=a.enabled_domains)==null?void 0:N.domains)||[]).join(", "),onChange:P=>S("enabled_domains",P.target.value),placeholder:"pv, wiring, structural, battery"}),p.jsx("div",{className:"text-xs text-gray-600",children:"Agents in disabled domains won’t register/run for this tenant."})]}),p.jsxs("div",{className:"border rounded p-3 space-y-3",children:[p.jsx("div",{className:"font-medium",children:"Whitelists & Blacklists"}),p.jsx("div",{className:"text-sm",children:"Whitelist actions (comma separated):"}),p.jsx("input",{className:"border rounded px-2 py-1 w-full",value:(((k=a.action_whitelist)==null?void 0:k.actions)||[]).join(", "),onChange:P=>S("action_whitelist",P.target.value),placeholder:"component.create, link.create"}),p.jsx("div",{className:"text-sm mt-2",children:"Blacklist actions (comma separated):"}),p.jsx("input",{className:"border rounded px-2 py-1 w-full",value:(((R=a.action_blacklist)==null?void 0:R.actions)||[]).join(", "),onChange:P=>S("action_blacklist",P.target.value),placeholder:"remove_link, structural.delete"}),p.jsx("div",{className:"text-xs text-gray-600",children:"Blacklist always denies; whitelist always approves (overrides threshold)."})]}),p.jsxs("div",{className:"border rounded p-3 space-y-3",children:[p.jsx("div",{className:"font-medium",children:"Feature flags"}),p.jsx("div",{className:"text-xs text-gray-600",children:"Toggle platform features for this tenant."}),p.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:["placeholder_fallback_enabled","server_side_apply_default","live_updates_enabled","agent_registry_hydrate_on_request"].map(P=>{var L;return p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:!!((L=a.feature_flags)!=null&&L[P]),onChange:M=>{const I={...a.feature_flags||{}};I[P]=M.target.checked,x({feature_flags:I})}}),P]},P)})})]})]}),p.jsxs("div",{className:"border rounded p-3 space-y-3",children:[p.jsx("div",{className:"font-medium",children:"Dry-run policy test"}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 text-sm",children:[p.jsxs("div",{children:[p.jsx("div",{children:"Action type"}),p.jsx("input",{className:"border rounded px-2 py-1 w-full",value:d,onChange:P=>h(P.target.value),placeholder:"component.create"})]}),p.jsxs("div",{children:[p.jsx("div",{children:"Confidence"}),p.jsx("input",{type:"number",min:0,max:1,step:.01,className:"border rounded px-2 py-1 w-full",value:f,onChange:P=>g(parseFloat(P.target.value))})]}),p.jsxs("div",{children:[p.jsx("div",{children:"Agent (optional)"}),p.jsx("input",{className:"border rounded px-2 py-1 w-full",value:y,onChange:P=>m(P.target.value),placeholder:"component_agent"})]}),p.jsx("div",{className:"flex items-end",children:p.jsx("button",{onClick:C,className:"px-3 py-1 rounded bg-gray-800 text-white w-full",children:"Test"})})]}),b&&p.jsx("div",{className:"text-xs font-mono mt-2 bg-gray-50 rounded p-2 overflow-auto",children:p.jsx("pre",{children:JSON.stringify(b,null,2)})})]})]}):p.jsx("div",{className:"p-4 text-sm",children:"No policy found."})}const Xj=()=>{const n=z(e=>e.route);return p.jsxs("main",{className:"grid-in-main flex flex-col bg-gray-50 text-black h-full w-full p-2 overflow-hidden",children:[n==="projects"&&p.jsx(tL,{}),n==="components"&&p.jsx(jj,{}),n==="settings"&&p.jsx(Hj,{}),n==="agents"&&p.jsx(Vj,{}),n==="approvals"&&p.jsx(Wj,{}),n==="policy"&&p.jsx(qj,{})]})},Yj=({u:n})=>{const e=z(d=>d.setActiveDatasheet),t=z(d=>d.setRoute),s=z(d=>d.updateUpload),{attributes:r,listeners:i,setNodeRef:a,isDragging:o}=d_({id:`file-asset-${n.id}`,data:{type:"file-asset",asset:n}}),c=()=>n.parsing_status==="processing"?p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}):n.parsing_status==="failed"?p.jsx("span",{title:n.parsing_error||"An unknown error occurred.",className:"text-red-500",children:"❗"}):n.parsing_status==="success"?p.jsx("span",{className:"text-green-500",children:"✔"}):null,u=async()=>{try{s(n.id,{parsing_status:"processing"}),await Hw(n.id);const d=setInterval(async()=>{try{const h=await Hd(n.id);if(h.parsing_status==="success"){clearInterval(d),s(n.id,{parsing_status:"success",parsing_error:null});const f=`${ee}/files/${h.id}/file`;e({id:h.id,url:f,payload:h.parsed_payload}),t("components")}else h.parsing_status==="failed"&&(clearInterval(d),s(n.id,{parsing_status:"failed",parsing_error:h.parsing_error}))}catch(h){clearInterval(d),s(n.id,{parsing_status:"failed",parsing_error:h.message||"Failed to fetch status"})}},2e3)}catch(d){console.error(d),s(n.id,{parsing_status:"failed",parsing_error:d.message||"Failed to parse datasheet"})}};return p.jsxs("div",{ref:a,...i,...r,onClick:async()=>{if(n.parsing_status==="success"){const d=await Hd(n.id),h=`${ee}/files/${d.id}/file`;e({id:d.id,url:h,payload:d.parsed_payload}),t("components")}},className:kr("border rounded p-2 text-sm transition bg-white shadow-sm",o&&"opacity-50"),children:[p.jsxs("div",{className:"flex justify-between items-center gap-2",children:[p.jsx("div",{className:"font-medium truncate flex-1",children:n.name}),(!n.parsing_status||n.parsing_status==="failed")&&p.jsx("button",{onClick:d=>{d.stopPropagation(),u()},className:"text-xs text-blue-600 hover:underline",title:"Parse datasheet",children:"Parse"})]}),p.jsx("div",{className:"h-1 bg-gray-200 rounded mt-1",children:p.jsx("div",{className:kr("h-1 rounded bg-emerald-500 transition-all",n.progress>100?"w-full":void 0),style:{width:`${Math.min(n.progress,100)}%`}})}),p.jsx("div",{className:"text-xs text-right text-gray-500 flex items-center gap-1 mt-1",children:n.progress>100?p.jsx(c,{}):`${n.progress}%`})]})},Kj=()=>{const n=z(c=>c.uploads.filter(u=>u.progress>100)),[e,t]=T.useState(!1),[s,r]=T.useState(""),[i,a]=T.useState(!1);if(!n.length)return null;const o=n.filter(c=>{if(!s)return!0;const u=s.toLowerCase();if(c.name&&c.name.toLowerCase().includes(u))return!0;try{if(c.parsed_payload&&JSON.stringify(c.parsed_payload).toLowerCase().includes(u))return!0}catch{}return!1});return p.jsxs("div",{className:"p-2 space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[!e&&p.jsx("div",{className:"text-sm font-medium text-gray-500 px-2 whitespace-nowrap",children:"Component Library"}),e&&p.jsx("input",{type:"text",className:"flex-grow border rounded-full text-sm px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 transition",placeholder:"Search",value:s,onChange:c=>r(c.target.value)}),p.jsx(WT,{className:"h-5 w-5 cursor-pointer text-gray-500 hover:text-gray-700",onClick:()=>t(c=>!c)}),p.jsx(MT,{className:"h-5 w-5 cursor-pointer text-gray-500 hover:text-gray-700",onClick:()=>a(c=>!c)})]}),i&&p.jsx("div",{className:"px-2 py-1 text-xs text-gray-400 italic bg-gray-50 rounded",children:"Advanced filtering options coming soon."}),o.map(c=>p.jsx(Yj,{u:c},c.id))]})},Qj=[{name:"projects",label:"Projects",icon:lT},{name:"components",label:"Components",icon:dT},{name:"agents",label:"Agents",icon:WA},{name:"approvals",label:"Approvals",icon:AT},{name:"policy",label:"Tenant Policy",icon:QT},{name:"settings",label:"Settings",icon:XA}],Jj=({isCollapsed:n})=>{const e=z(s=>s.route),t=z(s=>s.setRoute);return p.jsx("div",{className:"grid-in-sidebar flex flex-col bg-white text-black border-r border-gray-200",children:p.jsxs("nav",{className:"flex-1 py-4 px-2 mt-2","aria-label":"Sidebar navigation",children:[p.jsx("ul",{className:"space-y-1",children:Qj.map(s=>p.jsx("li",{children:p.jsxs("button",{onClick:()=>t(s.name),className:`flex w-full items-center gap-3 p-3 rounded-r-lg transition-colors ${n?"justify-center":""} ${e===s.name?"bg-blue-100 text-blue-600":"hover:bg-blue-50"}`,"aria-current":e===s.name?"page":void 0,title:n?s.label:void 0,children:[p.jsx(s.icon,{className:"h-5 w-5"}),!n&&p.jsx("span",{children:s.label})]})},s.name))}),!n&&p.jsx(Kj,{})]})})},Zj=({isCollapsed:n})=>p.jsx("div",{className:`grid-in-sidebar-header flex items-center p-4 h-16 border-b border-r border-gray-200 ${n?"justify-center":"justify-start"}`,children:p.jsxs("a",{href:"/",className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-2xl",children:"🌀"}),!n&&p.jsx("h1",{className:"text-xl font-bold",children:"OriginFlow"})]})}),eD=({isCollapsed:n})=>p.jsx("div",{className:"grid-in-sidebar-footer p-2 border-t border-r border-gray-200 bg-white flex items-center",children:p.jsxs("a",{href:"#",className:"flex items-center gap-3 px-4 py-2 text-sm font-medium rounded-md hover:bg-gray-100",children:[p.jsx(FT,{size:20}),!n&&p.jsx("span",{children:"Help & Support"})]})}),tD={info:"text-blue-600",success:"text-green-600",error:"text-red-600"},nD=()=>{const n=z(i=>i.statusMessages),e=n[n.length-1],t=e!=null&&e.icon?tD[e.icon]??"text-gray-600":"text-gray-600",s=z(i=>i.costTotal),r=z(i=>i.performanceMetrics.annualKwh);return p.jsxs("footer",{role:"status","aria-live":"polite",className:`grid-in-status flex items-center justify-between px-4 py-2 bg-white text-black border-t border-gray-200 text-sm ${t}`,children:[p.jsx("span",{className:"flex-1 truncate",children:(e==null?void 0:e.message)??"Ready"}),p.jsxs("span",{className:"flex-none ml-4 whitespace-nowrap",children:[s!==null&&p.jsxs("span",{className:"mr-4",children:["Cost: $",s.toFixed(0)]}),r!==null&&p.jsxs("span",{children:["Annual kWh: ",r.toLocaleString()]})]})]})};async function sD(n){var o,c;const e=await hx(n),t=[];t.push(["attribute_key","label","value","unit"]);for(const u of e){const d=u.key,h=u.display_label,f=((o=u.current)==null?void 0:o.value)??"",g=((c=u.current)==null?void 0:c.unit)??u.unit_default??"",y=String(f).replace(/"/g,'""');t.push([d,h,y,g])}const s=t.map(u=>u.map(d=>`"${d}"`).join(",")).join(`
`),r=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=window.URL.createObjectURL(r),a=document.createElement("a");a.href=i,a.setAttribute("download",`component_${n}_attributes.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(i)}const rD=()=>{const n=z(b=>b.analyzeAndExecute),e=z(b=>b.undo),t=z(b=>b.redo),s=z(b=>b.historyIndex),r=z(b=>b.history.length),i=z(b=>b.activeDatasheet),a=z(b=>b.addStatusMessage),o=z(b=>b.setActiveDatasheet),c=z(b=>b.setRoute),u=z(b=>b.datasheetDirty),d=z(b=>b.setDatasheetDirty),h=z(b=>b.route),[f,g]=gt.useState(!1),y=async()=>{if(i){if(!window.confirm("Re-analysing will discard extracted images and metadata. Continue?"))return;try{a("Re-analysing datasheet...","info"),await $C(i.id)}catch(w){console.error("Failed to reanalyze datasheet",w),a("Re-Analyze failed","error")}}else n("validate my design")},m=async()=>{if(i)try{await fx(i.id),a("Datasheet confirmed","success"),d(!1),o(null),c("components")}catch(b){console.error("Failed to confirm datasheet",b),a("Failed to confirm datasheet","error")}};return p.jsxs("section",{className:"grid-in-toolbar h-12 flex items-center justify-between px-6 border-b bg-white shadow-sm",role:"region","aria-label":"Sub Navigation",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[h!=="agents"&&p.jsxs(p.Fragment,{children:[p.jsx("button",{onClick:y,className:"px-3 py-1 text-sm rounded bg-gray-100 text-gray-700 hover:bg-blue-600 hover:text-white",children:"Analyze"}),p.jsx("button",{className:"px-3 py-1 text-sm rounded bg-gray-100 hover:bg-gray-200",children:"Filter"}),p.jsx("button",{onClick:async()=>{if(i)try{await sD(i.id)}catch(b){console.error("Export failed",b)}},className:"px-3 py-1 text-sm rounded bg-gray-100 hover:bg-gray-200",children:"Export"})]}),h==="agents"&&p.jsxs(p.Fragment,{children:[p.jsx("button",{onClick:()=>g(!0),className:"px-3 py-1 text-sm rounded bg-gray-100 text-gray-700 hover:bg-blue-600 hover:text-white",children:"New Agent"}),p.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("of:agents:refresh")),className:"px-3 py-1 text-sm rounded bg-gray-100 hover:bg-gray-200",title:"Refresh agents list",children:"Refresh"})]}),i&&p.jsx("button",{onClick:m,disabled:!u,className:`px-3 py-1 text-sm rounded border border-transparent shadow-sm focus:outline-none ${u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:"Confirm & Close"}),p.jsx("button",{onClick:e,disabled:s<=0,className:"px-2 py-1 text-sm rounded bg-gray-100 hover:bg-gray-200 disabled:opacity-50",children:"Undo"}),p.jsx("button",{onClick:t,disabled:s<0||s>=r-1,className:"px-2 py-1 text-sm rounded bg-gray-100 hover:bg-gray-200 disabled:opacity-50",children:"Redo"})]}),p.jsx("div",{className:"text-xs text-gray-500 italic",children:h==="agents"?"Agents Catalog":"Sub-nav active"}),h==="agents"&&f&&p.jsx(iD,{onClose:()=>g(!1)})]})},iD=({onClose:n})=>{const[e,t]=gt.useState([]),[s,r]=gt.useState(""),i=z(o=>o.addStatusMessage);gt.useEffect(()=>{(async()=>{var o,c;try{const d=await(await fetch("/api/v1/agents/templates")).json();t((d==null?void 0:d.templates)??[]),(c=(o=d==null?void 0:d.templates)==null?void 0:o[0])!=null&&c.spec&&r(JSON.stringify(d.templates[0].spec,null,2))}catch{t([]),r(JSON.stringify({name:"custom_agent",display_name:"Custom Agent",domain:"general",version:"0.0.1",capabilities:["analyze","suggest"],risk_class:"low",examples:["say hello","summarize the design"]},null,2))}})()},[]);const a=async()=>{try{const o=JSON.parse(s),c=await fetch("/api/v1/agents/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!c.ok)throw new Error(await c.text());i("Agent registered","success"),window.dispatchEvent(new CustomEvent("of:agents:refresh")),n()}catch(o){console.error(o),i("Failed to register agent","error"),alert(`Invalid spec or server error:
${(o==null?void 0:o.message)??o}`)}};return p.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:p.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-[800px] max-w-[95vw] p-4 flex flex-col gap-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h2",{className:"text-lg font-semibold",children:"Create New Agent"}),p.jsx("button",{onClick:n,className:"text-gray-500 hover:text-black",children:"✕"})]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsxs("select",{className:"border rounded p-2 text-sm",onChange:o=>{try{const c=e.find(u=>u.id===o.target.value);c!=null&&c.spec&&r(JSON.stringify(c.spec,null,2))}catch{}},children:[p.jsx("option",{value:"",children:"Select a template…"}),e.map(o=>p.jsx("option",{value:o.id,children:o.title},o.id))]}),p.jsx("div",{className:"text-xs text-gray-500 self-center",children:"Start from a template or paste a JSON spec below."})]}),p.jsx("textarea",{className:"font-mono text-xs border rounded p-2 h-72 w-full",value:s,onChange:o=>r(o.target.value)}),p.jsxs("div",{className:"flex justify-end gap-2",children:[p.jsx("button",{onClick:n,className:"px-3 py-1 text-sm rounded bg-gray-100 hover:bg-gray-200",children:"Cancel"}),p.jsx("button",{onClick:a,className:"px-3 py-1 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",children:"Create"})]})]})})},aD=({card:n})=>{const e=z(f=>f.analyzeAndExecute),t=z(f=>f.sessionId),s=z(f=>f.lastPrompt),[r,i]=T.useState(!1),[a,o]=T.useState(null),c=f=>{if(f===void 0)return null;const g=Math.round(f*100);let y="text-gray-500",m="bg-gray-100",b=yy;return f>=.8?(y="text-green-600",m="bg-green-100",b=Tg):f>=.6?(y="text-blue-600",m="bg-blue-100",b=yy):(y="text-yellow-600",m="bg-yellow-100",b=Cv),{percentage:g,color:y,bgColor:m,Icon:b}},u=c(n.confidence),d=async(f,g)=>{o(f);try{await fetch(`${ee}/ai/log-feedback-v2`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t,user_prompt:s||"",proposed_action:{action:"design_card_feedback",card_title:n.title,agent:n.agent},user_decision:f==="accepted"?"approved":"rejected",component_type:void 0,design_context:void 0,session_history:void 0,confidence_shown:n.confidence??null,confirmed_by:"human"})})}catch(y){console.error("Failed to send feedback:",y)}},h=(f="primary")=>{switch(f){case"primary":return"bg-blue-600 hover:bg-blue-700 text-white";case"secondary":return"bg-gray-200 hover:bg-gray-300 text-gray-800";case"danger":return"bg-red-600 hover:bg-red-700 text-white";default:return"bg-blue-600 hover:bg-blue-700 text-white"}};return p.jsxs("div",{className:"w-full bg-white border border-gray-200 rounded-lg shadow hover:shadow-md transition-shadow duration-200",children:[p.jsxs("div",{className:"p-4 border-b border-gray-100",children:[p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"text-base font-semibold text-gray-900",children:n.title}),n.agent&&p.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Suggested by ",n.agent]})]}),u&&p.jsxs("div",{className:`flex items-center space-x-2 px-2 py-1 rounded-md ${u.bgColor}`,children:[p.jsx(u.Icon,{className:`w-4 h-4 ${u.color}`}),p.jsxs("span",{className:`text-sm font-medium ${u.color}`,children:[u.percentage,"%"]})]})]}),n.description&&p.jsx("p",{className:"mt-2 text-sm text-gray-600 whitespace-pre-wrap",children:n.description})]}),n.imageUrl&&p.jsx("div",{className:"px-4 pt-4",children:p.jsx("img",{src:n.imageUrl,alt:n.title,className:"w-full h-32 object-cover rounded-md border"})}),n.specs&&n.specs.length>0&&p.jsx("div",{className:"px-4 py-3",children:p.jsx("table",{className:"w-full text-sm border-collapse",children:p.jsx("tbody",{children:n.specs.map(f=>p.jsxs("tr",{className:"border-t border-gray-200 first:border-t-0",children:[p.jsx("td",{className:"py-2 pr-4 font-medium text-gray-700 whitespace-nowrap",children:f.label}),p.jsx("td",{className:"py-2 text-gray-900",children:f.value})]},f.label))})})}),p.jsxs("div",{className:"p-4 space-y-3",children:[n.actions&&n.actions.length>0&&p.jsx("div",{className:"flex flex-wrap gap-2",children:n.actions.map(f=>p.jsx("button",{onClick:()=>{e(f.command),f.label.toLowerCase().includes("accept")&&d("accepted")},className:`text-sm font-medium px-4 py-2 rounded-md transition-colors ${h(f.variant)}`,children:f.label},f.label))}),!a&&n.cardId&&p.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[p.jsx("span",{className:"text-xs text-gray-500",children:"Is this suggestion helpful?"}),p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsxs("button",{onClick:()=>d("accepted"),className:"flex items-center space-x-1 px-2 py-1 text-sm text-green-600 hover:bg-green-50 rounded transition-colors",children:[p.jsx(iP,{className:"w-4 h-4"}),p.jsx("span",{children:"Yes"})]}),p.jsxs("button",{onClick:()=>d("rejected"),className:"flex items-center space-x-1 px-2 py-1 text-sm text-red-600 hover:bg-red-50 rounded transition-colors",children:[p.jsx(sP,{className:"w-4 h-4"}),p.jsx("span",{children:"No"})]})]})]}),a&&p.jsx("div",{className:"flex items-center space-x-2 pt-2 border-t border-gray-100",children:a==="accepted"?p.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[p.jsx(Tg,{className:"w-4 h-4"}),p.jsx("span",{className:"text-sm",children:"Thank you for the feedback!"})]}):p.jsxs("div",{className:"flex items-center space-x-2 text-orange-600",children:[p.jsx(yy,{className:"w-4 h-4"}),p.jsx("span",{className:"text-sm",children:"We'll improve our suggestions"})]})}),n.alternatives&&n.alternatives.length>0&&p.jsxs("div",{className:"pt-2 border-t border-gray-100",children:[p.jsxs("button",{onClick:()=>i(!r),className:"flex items-center space-x-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:[p.jsx(ZT,{className:"w-4 h-4"}),p.jsxs("span",{children:["See ",n.alternatives.length," alternative",n.alternatives.length!==1?"s":""]}),r?p.jsx(wT,{className:"w-4 h-4"}):p.jsx(fT,{className:"w-4 h-4"})]}),r&&p.jsx("div",{className:"mt-3 space-y-2",children:n.alternatives.map((f,g)=>{const y=c(f.confidence);return p.jsx("div",{className:"p-3 bg-gray-50 rounded-md hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>e(f.command),children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("h4",{className:"text-sm font-medium text-gray-900",children:f.title}),p.jsx("p",{className:"text-xs text-gray-600 mt-1",children:f.description})]}),y&&p.jsxs("span",{className:`text-xs px-2 py-1 rounded ${y.bgColor} ${y.color}`,children:[y.percentage,"%"]})]})},g)})})]})]})]})},oD=({message:n})=>{if(n.card)return p.jsx("div",{className:"w-full flex justify-start my-2",children:p.jsx(aD,{card:n.card})});if(n.type==="status")return p.jsx("div",{className:"w-full flex justify-center my-2",children:p.jsx("div",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded-md text-xs font-medium",children:n.text})});const e=n.author==="User";return p.jsx("div",{className:kr("w-full flex",e?"justify-end":"justify-start"),children:p.jsx("div",{className:kr("max-w-[80%] rounded-2xl px-4 py-2 text-sm whitespace-pre-wrap break-words",{"bg-blue-600 text-white":e,"bg-gray-200 text-gray-800":!e}),children:n.text})})},lD=({sessionId:n,onSubmit:e,onCancel:t,initialValues:s={},isModal:r=!1})=>{var S,E,C,N;const[i,a]=T.useState(s),[o,c]=T.useState({}),[u,d]=T.useState(!1),[h,f]=T.useState(!1),{addStatusMessage:g}=z();T.useEffect(()=>{n&&Object.keys(s).length===0&&y()},[n]);const y=async()=>{try{const k=await fetch(`${ee}/odl/sessions/${n}/analysis`);if(k.ok){const R=await k.json()}}catch(k){console.warn("Could not load existing requirements:",k)}},m=()=>{var R,P;const k={};return!i.target_power||i.target_power<=0?k.target_power="Target power must be greater than 0":i.target_power>1e6&&(k.target_power="Target power seems unreasonably high"),!i.roof_area||i.roof_area<=0?k.roof_area="Roof area must be greater than 0":i.roof_area>1e4&&(k.roof_area="Roof area seems unreasonably large"),!i.budget||i.budget<=0?k.budget="Budget must be greater than 0":i.budget<1e3&&(k.budget="Budget may be too low for a solar system"),i.backup_hours&&i.backup_hours<0&&(k.backup_hours="Backup hours cannot be negative"),(R=i.environmental_conditions)!=null&&R.wind_speed&&i.environmental_conditions.wind_speed<0&&(k.wind_speed="Wind speed cannot be negative"),(P=i.environmental_conditions)!=null&&P.snow_load&&i.environmental_conditions.snow_load<0&&(k.snow_load="Snow load cannot be negative"),c(k),Object.keys(k).length===0},b=async k=>{if(k.preventDefault(),!!m()){d(!0);try{const R=await fetch(`${ee}/odl/sessions/${n}/requirements`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({requirements:i})});if(!R.ok){const P=await R.json();throw new Error(P.detail||"Failed to save requirements")}g("Requirements saved successfully","success"),e(i)}catch(R){console.error("Error saving requirements:",R);const P=R instanceof Error?R.message:"Unknown error";g(`Failed to save requirements: ${P}`,"error")}finally{d(!1)}}},w=k=>{const R=k.split(",").map(P=>P.trim()).filter(Boolean);a({...i,preferred_brands:R})},x=r?"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg max-h-[90vh] overflow-y-auto":"max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-sm";return p.jsxs("div",{className:x,children:[p.jsxs("div",{className:"mb-6",children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Design Requirements"}),p.jsx("p",{className:"text-gray-600 mt-1",children:"Specify your solar system requirements to generate an optimized design"})]}),p.jsxs("form",{onSubmit:b,className:"space-y-6",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"target_power",className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Power (Watts) *"}),p.jsx("input",{type:"number",id:"target_power",value:i.target_power||"",onChange:k=>a({...i,target_power:parseFloat(k.target.value)||void 0}),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.target_power?"border-red-500":"border-gray-300"}`,placeholder:"5000",min:"100",max:"1000000"}),o.target_power&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.target_power}),p.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Typical residential: 3,000-10,000W"})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"roof_area",className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Roof Area (m²) *"}),p.jsx("input",{type:"number",id:"roof_area",value:i.roof_area||"",onChange:k=>a({...i,roof_area:parseFloat(k.target.value)||void 0}),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.roof_area?"border-red-500":"border-gray-300"}`,placeholder:"50",min:"1",max:"10000",step:"0.1"}),o.roof_area&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.roof_area}),p.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Usable roof space for solar panels"})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"budget",className:"block text-sm font-medium text-gray-700 mb-2",children:"Budget ($) *"}),p.jsx("input",{type:"number",id:"budget",value:i.budget||"",onChange:k=>a({...i,budget:parseFloat(k.target.value)||void 0}),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.budget?"border-red-500":"border-gray-300"}`,placeholder:"15000",min:"1000"}),o.budget&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.budget}),p.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Total budget including equipment and installation"})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"backup_hours",className:"block text-sm font-medium text-gray-700 mb-2",children:"Backup Hours (optional)"}),p.jsx("input",{type:"number",id:"backup_hours",value:i.backup_hours||"",onChange:k=>a({...i,backup_hours:parseFloat(k.target.value)||void 0}),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.backup_hours?"border-red-500":"border-gray-300"}`,placeholder:"8",min:"0",max:"72"}),o.backup_hours&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.backup_hours}),p.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Hours of backup power needed during outages"})]})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"preferred_brands",className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Brands (optional)"}),p.jsx("input",{type:"text",id:"preferred_brands",value:((S=i.preferred_brands)==null?void 0:S.join(", "))||"",onChange:k=>w(k.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"SunPower, Tesla, LG, Panasonic"}),p.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Comma-separated list of preferred component brands"})]}),p.jsx("div",{children:p.jsxs("button",{type:"button",onClick:()=>f(!h),className:"flex items-center text-sm text-blue-600 hover:text-blue-800",children:[h?"▼":"▶"," Advanced Environmental Conditions"]})}),h&&p.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[p.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Environmental Conditions"}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"climate_zone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Climate Zone"}),p.jsxs("select",{id:"climate_zone",value:((E=i.environmental_conditions)==null?void 0:E.climate_zone)||"",onChange:k=>a({...i,environmental_conditions:{...i.environmental_conditions,climate_zone:k.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[p.jsx("option",{value:"",children:"Select zone"}),p.jsx("option",{value:"tropical",children:"Tropical"}),p.jsx("option",{value:"subtropical",children:"Subtropical"}),p.jsx("option",{value:"temperate",children:"Temperate"}),p.jsx("option",{value:"continental",children:"Continental"}),p.jsx("option",{value:"polar",children:"Polar"})]})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"wind_speed",className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Wind Speed (km/h)"}),p.jsx("input",{type:"number",id:"wind_speed",value:((C=i.environmental_conditions)==null?void 0:C.wind_speed)||"",onChange:k=>a({...i,environmental_conditions:{...i.environmental_conditions,wind_speed:parseFloat(k.target.value)||void 0}}),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.wind_speed?"border-red-500":"border-gray-300"}`,placeholder:"150",min:"0",max:"300"}),o.wind_speed&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.wind_speed})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"snow_load",className:"block text-sm font-medium text-gray-700 mb-2",children:"Snow Load (Pa)"}),p.jsx("input",{type:"number",id:"snow_load",value:((N=i.environmental_conditions)==null?void 0:N.snow_load)||"",onChange:k=>a({...i,environmental_conditions:{...i.environmental_conditions,snow_load:parseFloat(k.target.value)||void 0}}),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.snow_load?"border-red-500":"border-gray-300"}`,placeholder:"2400",min:"0",max:"10000"}),o.snow_load&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.snow_load})]})]})]}),p.jsxs("div",{className:"flex space-x-4 pt-6 border-t border-gray-200",children:[p.jsx("button",{type:"submit",disabled:u,className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Saving...":"Save Requirements"}),p.jsx("button",{type:"button",onClick:t,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"})]}),Object.keys(o).length>0&&p.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:[p.jsx("p",{className:"text-sm text-red-800",children:"Please fix the following errors before submitting:"}),p.jsx("ul",{className:"mt-1 text-sm text-red-700 list-disc list-inside",children:Object.values(o).map((k,R)=>p.jsx("li",{children:k},R))})]})]})]})};function BC(n){return`${n}_${crypto.randomUUID()}`}const cD=({acceptedTypes:n=[".pdf",".png",".jpg",".jpeg",".txt",".csv"],maxFileSize:e=50,multiple:t=!1,onUploadComplete:s,className:r="",variant:i="full"})=>{const a=T.useRef(null),{addUpload:o,updateUpload:c,addMessage:u,addStatusMessage:d,uploads:h}=z(),[f,g]=T.useState(!1),[y,m]=T.useState([]),b=P=>{var I;const L=[];P.size>e*1024*1024&&L.push(`File size must be less than ${e}MB`);const M="."+((I=P.name.split(".").pop())==null?void 0:I.toLowerCase());return n.includes(M)||L.push(`File type ${M} is not supported. Accepted types: ${n.join(", ")}`),L},w=T.useCallback(async P=>{const L=Array.from(P),M=[],I=[];L.forEach(B=>{const K=b(B);K.length>0?M.push(`${B.name}: ${K.join(", ")}`):I.push(B)}),m(M);const U=[];for(const B of I){const K=BC("upload");o({id:K,name:B.name,size:B.size,mime:B.type,progress:0,assetType:"component",parsed_at:null,parsing_status:null,parsing_error:null,is_human_verified:!1}),d(`Uploading ${B.name}…`,"info");try{const j=await Uw(B,D=>c(K,{progress:D}));c(K,{...j,id:j.id,progress:100,parsing_status:"pending"}),U.push(j),u({author:"User",text:`✅ Uploaded ${B.name}`}),d(`Upload complete: ${B.name}`,"success")}catch(j){console.error("Upload failed",j),c(K,{progress:-1}),u({author:"User",text:`❌ Upload failed for ${B.name}`}),(j==null?void 0:j.status)===401?d("Unauthorized. Please log in to upload files.","error"):d(`Upload failed: ${B.name}`,"error")}}a.current&&(a.current.value=""),s&&U.length>0&&s(U)},[n,e,o,c,u,d,s]),x=P=>{const L=P.target.files;L&&w(L)},S=P=>{P.preventDefault(),g(!0)},E=P=>{P.preventDefault(),g(!1)},C=P=>{P.preventDefault(),g(!1);const L=P.dataTransfer.files;L&&w(L)},N=()=>{var P;(P=a.current)==null||P.click()},k=P=>{var M;switch((M=P.split(".").pop())==null?void 0:M.toLowerCase()){case"pdf":return p.jsx(TT,{className:"w-6 h-6 text-red-500"});case"png":case"jpg":case"jpeg":return p.jsx(DT,{className:"w-6 h-6 text-blue-500"});default:return p.jsx(RT,{className:"w-6 h-6 text-gray-500"})}},R=h.filter(P=>P.progress>=0&&P.progress<100);return i==="button"?p.jsxs("div",{className:r,children:[p.jsx("input",{ref:a,type:"file",onChange:x,accept:n.join(","),multiple:t,className:"hidden"}),p.jsxs("button",{onClick:N,className:"relative p-2 text-gray-500 hover:text-blue-600 transition-colors","aria-label":"Upload file",children:[p.jsx(qA,{size:20}),R.length>0&&p.jsxs(p.Fragment,{children:[p.jsx(ec,{size:14,className:"absolute top-0 right-0 text-blue-600 animate-spin"}),p.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white rounded-full text-xs w-4 h-4 flex items-center justify-center",children:R.length})]})]})]}):i==="compact"?p.jsxs("div",{className:`space-y-2 ${r}`,children:[p.jsx("input",{ref:a,type:"file",onChange:x,accept:n.join(","),multiple:t,className:"hidden"}),p.jsxs("button",{onClick:N,className:"flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:[p.jsx(Db,{className:"w-4 h-4"}),p.jsx("span",{className:"text-sm",children:"Upload Files"})]}),R.map(P=>p.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[p.jsx(ec,{className:"w-4 h-4 animate-spin text-blue-500"}),p.jsx("span",{className:"flex-1 truncate",children:P.name}),p.jsxs("span",{className:"text-gray-500",children:[P.progress,"%"]})]},P.id)),y.map((P,L)=>p.jsxs("div",{className:"flex items-center space-x-2 text-sm text-red-600",children:[p.jsx(Cv,{className:"w-4 h-4"}),p.jsx("span",{children:P})]},L))]}):p.jsxs("div",{className:`space-y-4 ${r}`,children:[p.jsx("input",{ref:a,type:"file",onChange:x,accept:n.join(","),multiple:t,className:"hidden"}),p.jsx("div",{onClick:N,onDragOver:S,onDragLeave:E,onDrop:C,className:`
          relative border-2 border-dashed rounded-lg p-6 cursor-pointer transition-all duration-200
          ${f?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"}
        `,children:p.jsxs("div",{className:"text-center",children:[p.jsx(Db,{className:`mx-auto h-12 w-12 ${f?"text-blue-500":"text-gray-400"}`}),p.jsxs("div",{className:"mt-4",children:[p.jsx("p",{className:"text-sm font-medium text-gray-900",children:f?"Drop files here":"Upload datasheets and documents"}),p.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Drag and drop files or click to browse"}),p.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Supported: ",n.join(", ")," • Max ",e,"MB"]})]})]})}),R.length>0&&p.jsxs("div",{className:"space-y-2",children:[p.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Uploading..."}),R.map(P=>p.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-md",children:[k(P.name),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:P.name}),p.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[p.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:p.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${P.progress}%`}})}),p.jsxs("span",{className:"text-xs text-gray-500",children:[P.progress,"%"]})]})]}),p.jsx(ec,{className:"w-4 h-4 animate-spin text-blue-500"})]},P.id))]}),y.length>0&&p.jsxs("div",{className:"space-y-2",children:[p.jsx("h4",{className:"text-sm font-medium text-red-900",children:"Upload Errors"}),y.map((P,L)=>p.jsxs("div",{className:"flex items-start space-x-2 p-3 bg-red-50 rounded-md",children:[p.jsx(Cv,{className:"w-4 h-4 text-red-500 mt-0.5"}),p.jsx("p",{className:"text-sm text-red-700",children:P}),p.jsx("button",{onClick:()=>m(M=>M.filter((I,U)=>U!==L)),className:"ml-auto p-1 text-red-500 hover:text-red-700",children:p.jsx(hP,{className:"w-3 h-3"})})]},L))]}),h.filter(P=>P.progress===100).slice(-3).length>0&&p.jsxs("div",{className:"space-y-2",children:[p.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Recently Uploaded"}),h.filter(P=>P.progress===100).slice(-3).map(P=>p.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 rounded-md",children:[k(P.name),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:P.name}),p.jsx("p",{className:"text-xs text-gray-500",children:P.parsing_status==="success"?"Parsed successfully":P.parsing_status==="failed"?"Parsing failed":P.parsing_status==="processing"?"Processing...":"Ready for parsing"})]}),p.jsx(Tg,{className:"w-4 h-4 text-green-500"})]},P.id))]})]})},uD={pending:ET,in_progress:ec,complete:Tg,blocked:cP},dD={pending:"text-gray-400",in_progress:"text-blue-500",complete:"text-green-600",blocked:"text-yellow-500"},hD=()=>{const n=z(h=>h.planTasks),e=z(h=>h.performPlanTask),t=z(h=>h.sessionId),s=z(h=>h.graphVersion),r=z(h=>h.setGraphVersion),i=z(h=>h.setPlanTasks),a=z(h=>h.addMessage);z(h=>h.updatePlanTaskStatus);const o=z(h=>h.isAiProcessing);if(!n||n.length===0)return null;const c=n.findIndex(h=>h.status==="pending"||h.status==="blocked"),u=h=>{if(o)return!1;const f=n[h];return f.status==="pending"||f.status==="blocked"||f.status==="in_progress"},d=h=>h===c;return p.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[p.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[p.jsx("div",{className:"text-xs font-semibold uppercase text-gray-600",children:"Plan"}),p.jsxs("div",{className:"text-xs text-gray-500",children:[n.filter(h=>h.status==="complete").length," of ",n.length," complete"]})]}),p.jsx("div",{className:"space-y-3",children:n.map((h,f)=>{const g=uD[h.status],y=dD[h.status],m=h.status==="in_progress",b=d(f),w=u(f),x=f<c;return p.jsxs("div",{className:"flex items-start space-x-3",children:[f<n.length-1&&p.jsx("div",{className:"absolute ml-2 mt-6 h-6 w-0.5 bg-gray-300"}),p.jsxs("button",{type:"button",onClick:()=>{w&&(h.status==="pending"||h.status==="blocked")&&(t?we.act(t,h.id,void 0,s).then(S=>{var E,C;typeof S.version=="number"&&r(S.version),S.card&&a({id:crypto.randomUUID(),author:"AI",text:S.card.title,card:{title:S.card.title,description:S.card.body,specs:(E=S.card.specs)==null?void 0:E.map(N=>({label:N.label,value:N.value})),actions:(C=S.card.actions)==null?void 0:C.map(N=>({label:N.label,command:N.command})),confidence:S.card.confidence},type:"card"}),Array.isArray(S.updated_tasks)&&i(S.updated_tasks.map(N=>({id:N.id,title:N.title,description:N.reason||N.description,status:N.status})))}).catch(()=>e(h)):e(h))},disabled:!w,className:`relative flex items-start space-x-3 w-full text-left p-3 rounded-lg border transition-all duration-200 ${b?"border-blue-200 bg-blue-50 shadow-sm":x?"border-green-200 bg-green-50":"border-gray-200 bg-white hover:bg-gray-50"} ${w?"cursor-pointer":"cursor-default"}`,"aria-label":`Execute ${h.title}`,children:[p.jsx("div",{className:"flex-shrink-0 mt-0.5",children:p.jsx(g,{className:`h-5 w-5 ${y} ${m?"animate-spin":""}`,"aria-hidden":"true"})}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h4",{className:`text-sm font-medium ${b?"text-blue-900":"text-gray-900"}`,children:h.title}),p.jsxs("div",{className:"flex items-center space-x-2",children:[b&&p.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-700 bg-blue-100 rounded",children:[p.jsx(kT,{className:"w-3 h-3 mr-1"}),"Current"]}),w&&h.status==="pending"&&p.jsx(aT,{className:"w-4 h-4 text-blue-500"})]})]}),h.description&&p.jsx("p",{className:`mt-1 text-xs leading-relaxed ${b?"text-blue-700":"text-gray-600"}`,children:h.description}),b&&h.status==="pending"&&p.jsx("div",{className:"mt-2 text-xs text-blue-600 font-medium",children:"Click to execute this task"})]})]})]},h.id)})}),n.some(h=>h.id==="gather_requirements"&&h.status==="blocked")&&p.jsxs("div",{className:"mt-4 space-y-3",children:[p.jsx("div",{className:"text-xs font-semibold uppercase text-gray-600",children:"Unblock Gather Requirements"}),p.jsx(lD,{}),p.jsxs("div",{className:"border rounded-lg bg-white p-3",children:[p.jsx("div",{className:"text-sm font-medium text-gray-900 mb-2",children:"Missing components?"}),p.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Upload panel/inverter datasheets. We will parse and ingest them automatically, then refresh the plan."}),p.jsx(cD,{variant:"compact",onUploadComplete:async h=>{try{for(const g of h);const f=z.getState().sessionId;if(f){await we.getRequirementsStatus(f);const g=await we.getPlanForSession(f,"design system");Array.isArray(g.tasks)&&z.getState().setPlanTasks(g.tasks)}}catch(f){console.error(f)}}})]})]})]})},fD=()=>{const n=z(t=>t.messages),e=z(t=>t.isAiProcessing);return p.jsxs("div",{className:"grid-in-chat-history flex flex-col h-full bg-white overflow-y-auto min-h-0",style:{borderLeft:"1px solid #e5e7eb"},children:[p.jsx(hD,{}),p.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[n.map((t,s)=>p.jsx(oD,{message:t},s)),e&&p.jsx("div",{className:"w-full flex justify-start mt-2","aria-live":"polite","aria-label":"AI processing indicator",children:p.jsxs("div",{className:"flex items-center space-x-2 bg-gray-200 text-gray-800 px-4 py-2 rounded-2xl text-sm",children:[p.jsx(ec,{className:"animate-spin h-4 w-4"}),p.jsx("span",{children:"Echo is thinking…"})]})})]})]})},pD=()=>{const n=T.useRef(null),{addUpload:e,updateUpload:t,addMessage:s,addStatusMessage:r,uploads:i}=z(),a=()=>{var c;return(c=n.current)==null?void 0:c.click()},o=async c=>{var h;const u=(h=c.target.files)==null?void 0:h[0];if(!u)return;const d=BC("upload");e({id:d,name:u.name,size:u.size,mime:u.type,progress:0,assetType:"component",parsed_at:null,parsing_status:null,parsing_error:null,is_human_verified:!1}),r(`Uploading ${u.name}…`,"info");try{const f=await Uw(u,g=>t(d,{progress:g}));t(d,{...f,id:f.id,progress:101,parsing_status:null,parsing_error:null}),s({author:"User",text:`Uploaded ${u.name}`}),r("Upload complete","success")}catch(f){console.error("Upload failed",f),t(d,{progress:-1}),s({author:"User",text:`❌ Upload failed for ${u.name}`}),(f==null?void 0:f.status)===401?r("Unauthorized. Please log in to upload files.","error"):r("Upload failed","error")}};return p.jsxs(p.Fragment,{children:[p.jsx("input",{type:"file",ref:n,onChange:o,className:"hidden"}),p.jsxs("button",{onClick:a,className:"relative p-2 text-gray-500 hover:text-blue-600 transition-colors","aria-label":"Upload file",children:[p.jsx(qA,{size:20}),i.some(c=>c.progress>=0&&c.progress<100)&&p.jsx(ec,{size:14,className:"absolute top-0 right-0 text-blue-600 animate-spin"}),(()=>{const c=i.filter(u=>u.progress>=0&&u.progress<100).length;return c>0?p.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white rounded-full text-xs w-4 h-4 flex items-center justify-center",children:c}):null})()]})]})},gD=()=>{const n=z(t=>t.quickActions),e=z(t=>t.analyzeAndExecute);return!n||n.length===0?null:p.jsx("div",{className:"grid-in-chat-actions border-t border-gray-200 bg-white px-3 py-2 flex flex-wrap gap-2",children:n.map(t=>p.jsx("button",{onClick:()=>e(t.command),className:"bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium px-3 py-1 rounded-md transition-colors",children:t.label},t.id))})},mD=()=>{const n=z(t=>t.currentMode),e=z(t=>t.setCurrentMode);return p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("label",{htmlFor:"mode-select",className:"text-sm text-gray-700 font-medium",children:"Mode:"}),p.jsxs("select",{id:"mode-select",value:n,onChange:t=>e(t.target.value),className:"border border-gray-300 text-sm rounded-md px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[p.jsx("option",{value:"design",children:"Design"}),p.jsx("option",{value:"analyze",children:"Analyze"}),p.jsx("option",{value:"manual",children:"Manual"}),p.jsx("option",{value:"business",children:"Business"})]})]})},yD=()=>{const n=z(b=>b.chatDraft),e=z(b=>b.setChatDraft),t=z(b=>b.analyzeAndExecute),s=z(b=>b.clearChatDraft),r=z(b=>b.voiceMode),i=z(b=>b.startListening),a=z(b=>b.stopListening),o=z(b=>b.voiceTranscript),c=z(b=>b.isAiProcessing),u=z(b=>b.activeDatasheet),d=z(b=>b.setActiveDatasheet),h=z(b=>b.addStatusMessage),f=z(b=>b.setDatasheetDirty),g=r==="listening",y=r==="speaking",m=async()=>{const b=n.trim();if(!b)return;const w=b.toLowerCase();if(u&&(w==="confirm and close"||w==="confirm & close")){try{await fx(u.id),d(null),f(!1),h("Datasheet confirmed","success")}catch(x){console.error("Confirm & Close failed",x),h("Failed to confirm datasheet","error")}s();return}t(b),s()};return p.jsxs("div",{className:"grid-in-chat-input p-3 bg-white border-t border-white",style:{borderLeft:"1px solid #e5e7eb"},children:[p.jsx(gD,{}),p.jsx("div",{className:"flex justify-between items-center mt-2 mb-2",children:p.jsx(mD,{})}),p.jsxs("div",{className:"relative",children:[p.jsx("textarea",{value:g?o:n,onChange:b=>e(b.target.value),onKeyDown:b=>{b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),m())},placeholder:g?"Listening...":y?"Echo is speaking...":"Ask Echo to do something...",className:"w-full h-full p-2 border border-gray-300 rounded bg-white text-black placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none pr-24",rows:2,readOnly:g||y}),p.jsxs("div",{className:"absolute right-2 bottom-2 flex gap-2",children:[p.jsx(pD,{}),p.jsx("button",{onClick:()=>{g?a():i()},className:`p-2 rounded-md ${g?"bg-red-600 text-white":"bg-gray-100"}`,"aria-label":"Record voice command",disabled:c||y,children:y?p.jsx(WA,{className:"h-5 w-5 animate-pulse"}):p.jsx(BT,{className:"h-5 w-5"})}),p.jsx("button",{onClick:()=>void m(),disabled:c||g||y,className:"p-2 bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 text-white","aria-label":"Send message",children:p.jsx(XT,{className:"h-5 w-5"})})]})]})]})},vD=()=>{const{voiceOutputEnabled:n,toggleVoiceOutput:e,isContinuousConversation:t,toggleContinuousConversation:s}=z();return p.jsxs("div",{className:"p-4 border-t border-gray-200",children:[p.jsxs("div",{className:"flex justify-between items-center gap-4",children:[p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("input",{id:"voice-output",type:"checkbox",className:"form-checkbox",checked:n,onChange:e}),p.jsx("label",{htmlFor:"voice-output",className:"text-sm font-medium",children:"Voice Output"})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("input",{id:"continuous-conversation",type:"checkbox",className:"form-checkbox",checked:t,onChange:s}),p.jsx("label",{htmlFor:"continuous-conversation",className:"text-sm font-medium",children:"Continuous Conversation"})]})]}),p.jsx("p",{className:"mt-4 text-xs text-gray-500",children:"OriginFlow is a prototype. Responses may be inaccurate."})]})},wD=()=>{const n=z(s=>s.voiceMode),e=z(s=>s.stopListening),t=z(s=>s.updateVoiceTranscript);return T.useEffect(()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s){console.warn("SpeechRecognition API not supported in this browser.");return}const r=new s;if(r.continuous=!0,r.interimResults=!0,r.lang="en-US",r.onresult=i=>{let a="",o="";for(let c=i.resultIndex;c<i.results.length;++c){const u=i.results[c][0].transcript;i.results[c].isFinal?a+=u:o+=u}if(o&&t(o),a){const c=a.trim().toLowerCase();if(c==="stop listening"||c==="stop"){e();return}e(c)}},r.onerror=()=>{n==="listening"&&e()},n==="listening")try{r.start()}catch{}else r.stop();return()=>{r.stop()}},[n,e,t]),null},xD=()=>{const n=z(o=>o.messages),e=z(o=>o.voiceOutputEnabled),t=z(o=>o.isContinuousConversation),s=z(o=>o.startListening),r=z(o=>o.stopListening),i=z(o=>o.setVoiceMode),a=T.useRef(null);return T.useEffect(()=>{if(!e||n.length===0)return;const o=n[n.length-1];if(o.author!=="AI"||a.current===o.id)return;const c=window.speechSynthesis;if(!c)return;r(),i("speaking");const u=o.summary||o.text,d=new SpeechSynthesisUtterance(u);d.onend=()=>{t?s():i("idle")},c.speak(d),a.current=o.id},[n,e,t,s,r,i]),null},bD=()=>{const[n,e]=T.useState(!1),t=z(r=>r.isSubNavVisible),s=z(r=>r.toggleSubNav);return p.jsxs(p.Fragment,{children:[p.jsx(wD,{}),p.jsx(xD,{}),p.jsxs("div",{className:"grid h-screen w-screen min-h-0 transition-all duration-300 ease-in-out",style:{gridTemplateColumns:`${n?"64px":"250px"} 1fr 350px`,gridTemplateRows:`64px ${t?"48px":"0px"} 1fr auto 48px`,gridTemplateAreas:`
          "sidebar-header header      chat-history"
          "sidebar        toolbar     chat-history"
          "sidebar        main        chat-history"
          "sidebar        main        chat-input"
          "sidebar-footer status      chat-footer"
        `},children:[p.jsx(Zj,{isCollapsed:n}),p.jsx(yP,{toggleSidebar:()=>e(!n),toggleToolbar:s}),t&&p.jsx(rD,{}),p.jsx(Jj,{isCollapsed:n}),p.jsx("div",{className:"grid-in-main relative min-h-0 overflow-auto bg-gray-50",children:p.jsx(Xj,{})}),p.jsx(fD,{}),p.jsx(yD,{}),p.jsx(vD,{}),p.jsx(eD,{isCollapsed:n}),p.jsx(nD,{})]})]})},SD=({items:n,onClose:e})=>p.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center",children:p.jsxs("div",{className:"bg-white p-4 rounded",children:[p.jsx("h2",{className:"font-bold mb-2",children:"Bill of Materials"}),p.jsx("ul",{className:"list-disc pl-6 max-h-60 overflow-auto",children:n.map(t=>p.jsx("li",{children:t},t))}),p.jsx("button",{className:"mt-4 btn",onClick:e,children:"Close"})]})}),AD=()=>{const{bomItems:n,setBom:e,loadUploads:t,addComponent:s,updateComponentPosition:r,updateUpload:i,setActiveDatasheet:a,setRoute:o,addStatusMessage:c}=z(),u=LP(RP(Kw)),d=h=>{var m,b,w;const{active:f,over:g,delta:y}=h;if(g){if(g.id==="canvas-area"&&((m=f.data.current)==null?void 0:m.type)==="file-asset"){const x=f.data.current.asset;s({name:x.name,type:x.mime,standard_code:x.id});return}if(g.id==="component-canvas-area"&&((b=f.data.current)==null?void 0:b.type)==="file-asset"){const x=f.data.current.asset;if(x.parsing_status==="success"){o("components"),(async()=>{try{const E=await Hd(x.id),C=`${ee}/files/${E.id}/file`;a({id:E.id,url:C,payload:E.parsed_payload})}catch(E){console.error("Failed to load parsed datasheet:",E),i(x.id,{parsing_status:"failed",parsing_error:E.message||"Failed to fetch status"}),c("Failed to load datasheet","error")}})();return}i(x.id,{parsing_status:"processing"}),o("components"),c("Parsing datasheet...","info"),Hw(x.id).catch(E=>{i(x.id,{parsing_status:"failed",parsing_error:E.message}),c("Datasheet parsing failed","error")});const S=setInterval(async()=>{try{const E=await Hd(x.id);if(E.parsing_status==="success"){clearInterval(S),i(x.id,{parsing_status:"success",parsing_error:null});const C=`${ee}/files/${E.id}/file`;a({id:E.id,url:C,payload:E.parsed_payload}),c("Datasheet parsed successfully","success")}else E.parsing_status==="failed"&&(clearInterval(S),i(x.id,{parsing_status:"failed",parsing_error:E.parsing_error}),c("Datasheet parsing failed","error"))}catch(E){clearInterval(S),i(x.id,{parsing_status:"failed",parsing_error:E.message||"Failed to fetch status"}),c("Datasheet parsing failed","error")}},2e3);return}((w=f.data.current)==null?void 0:w.type)==="canvas-card"&&r(f.id,{x:y.x,y:y.y})}};return T.useEffect(()=>{t()},[t]),p.jsx(jR,{sensors:u,onDragEnd:d,children:p.jsxs("div",{className:"App h-full",children:[p.jsx(bD,{}),n&&p.jsx(SD,{items:n,onClose:()=>e(null)})]})})},_D="/assets/pdf.worker.min-CsnNCGNt.mjs";ms.workerSrc=_D;const _1=document.getElementById("root"),E1=_1?My.createRoot(_1):null;E1&&E1.render(p.jsx(gt.StrictMode,{children:p.jsx(AD,{})}));export{q0 as a,CD as g};
